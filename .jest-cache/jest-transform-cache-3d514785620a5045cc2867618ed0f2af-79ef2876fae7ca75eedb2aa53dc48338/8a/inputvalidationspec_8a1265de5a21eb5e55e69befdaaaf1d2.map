{"file":"C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\dto\\__tests__\\input-validation.spec.ts","mappings":"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","names":[],"sources":["C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\dto\\__tests__\\input-validation.spec.ts"],"sourcesContent":["import { ZodError } from 'zod'\nimport { createAiSettingsSchema } from './create-ai-settings.dto.ts'\nimport { submitActionSchema } from './submit-action.dto.ts'\nimport { testAiConnectionSchema, updateAiSettingsSchema } from './update-ai-settings.dto.ts'\n\ndescribe('AI settings validation schemas', () => {\n  const basePayload = {\n    provider: 'OpenAI',\n    apiKey: 'sk-VALIDKEY_1234567890',\n    modelId: 'gpt-4o-mini',\n    baseUrl: 'https://api.openai.com/v1',\n    roles: ['narrative_synthesis', 'logic_parsing'],\n  } as const\n\n  it('accepts a valid payload and trims fields', () => {\n    const result = createAiSettingsSchema.parse({\n      ...basePayload,\n      apiKey: '  sk-VALIDKEY_1234567890  ',\n      modelId: ' gpt-4o-mini ',\n      roles: [' narrative_synthesis ', 'logic_parsing'],\n    })\n\n    expect(result.apiKey).toBe('sk-VALIDKEY_1234567890')\n    expect(result.modelId).toBe('gpt-4o-mini')\n    expect(result.roles).toEqual(['narrative_synthesis', 'logic_parsing'])\n  })\n\n  it('rejects unknown providers', () => {\n    expect(() =>\n      createAiSettingsSchema.parse({\n        ...basePayload,\n        provider: 'Unknown',\n      })\n    ).toThrow(ZodError)\n  })\n\n  it('rejects API keys with spaces or invalid characters', () => {\n    expect(() =>\n      createAiSettingsSchema.parse({\n        ...basePayload,\n        apiKey: 'sk invalid key',\n      })\n    ).toThrow('API key contains invalid characters.')\n  })\n\n  it('rejects role names with forbidden characters', () => {\n    expect(() =>\n      createAiSettingsSchema.parse({\n        ...basePayload,\n        roles: ['admin', 'bad role!'],\n      })\n    ).toThrow('Role name can only include letters, numbers, colon, underscore, or hyphen.')\n  })\n\n  it('allows partial updates with sanitized fields', () => {\n    const result = updateAiSettingsSchema.parse({\n      apiKey: 'sk-NEWKEY_123456789',\n      roles: ['critic'],\n    })\n\n    expect(result.apiKey).toBe('sk-NEWKEY_123456789')\n    expect(result.roles).toEqual(['critic'])\n  })\n\n  it('validates test connection payloads consistently', () => {\n    expect(() =>\n      testAiConnectionSchema.parse({\n        provider: 'OpenAI',\n        apiKey: 'sk-invalid key',\n      })\n    ).toThrow('API key contains invalid characters.')\n  })\n})\n\ndescribe('Submit action schema', () => {\n  it('accepts valid command payloads', () => {\n    const result = submitActionSchema.parse({\n      type: 'command',\n      payload: 'Investigate the mysterious glow.',\n    })\n\n    expect(result.payload).toBe('Investigate the mysterious glow.')\n  })\n\n  it('rejects command payloads with control characters', () => {\n    expect(() =>\n      submitActionSchema.parse({\n        type: 'command',\n        payload: 'Invalid\\u0007payload',\n      })\n    ).toThrow('Command payload contains invalid control characters.')\n  })\n\n  it('rejects option payloads exceeding length limits', () => {\n    expect(() =>\n      submitActionSchema.parse({\n        type: 'option',\n        payload: {\n          dimension: 'exploration',\n          check: 'perception',\n          success_rate: 'high',\n          text: 'x'.repeat(401),\n        },\n      })\n    ).toThrow('Option text must be 400 characters or fewer.')\n  })\n})\n"],"version":3}