{"file":"C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\vcp\\async-workflow.service.ts","mappings":"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","names":[],"sources":["C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\vcp\\async-workflow.service.ts"],"sourcesContent":["// ============================================================================\r\n// 异步工作流引擎服务集成\r\n// 集成 VCPToolBox 的非线性异步工作流，支持复杂任务编排\r\n// ============================================================================\r\n\r\nimport { Injectable, Logger, OnModuleInit } from '@nestjs/common'\r\nimport { ConfigService } from '@nestjs/config'\r\nimport {\r\n  asyncWorkflowEngine,\r\n  WorkflowTemplate,\r\n  WorkflowInstance,\r\n  WorkflowExecutionOptions,\r\n  WorkflowNode,\r\n  WorkflowConnection\r\n} from '../../../vcptoolbox/src/modules/tools/AsyncWorkflowEngine'\r\n\r\n@Injectable()\r\nexport class AsyncWorkflowService implements OnModuleInit {\r\n  private readonly logger = new Logger(AsyncWorkflowService.name)\r\n  private predefinedTemplates: Map<string, WorkflowTemplate> = new Map()\r\n\r\n  constructor(private configService: ConfigService) {}\r\n\r\n  async onModuleInit() {\r\n    await this.initializeWorkflowEngine()\r\n    await this.createPredefinedTemplates()\r\n    this.setupEventHandlers()\r\n    this.logger.log('异步工作流引擎已初始化')\r\n  }\r\n\r\n  // ==================== 引擎初始化 ====================\r\n\r\n  /**\r\n   * 初始化工作流引擎\r\n   */\r\n  private async initializeWorkflowEngine(): Promise<void> {\r\n    // 设置引擎参数\r\n    // 这里可以根据配置调整引擎参数\r\n\r\n    this.logger.log('工作流引擎参数已配置')\r\n  }\r\n\r\n  /**\r\n   * 创建预定义模板\r\n   */\r\n  private async createPredefinedTemplates(): Promise<void> {\r\n    // 故事创作工作流模板\r\n    await this.createStoryCreationTemplate()\r\n\r\n    // 角色开发工作流模板\r\n    await this.createCharacterDevelopmentTemplate()\r\n\r\n    // 世界构建工作流模板\r\n    await this.createWorldBuildingTemplate()\r\n\r\n    // 多模态叙事工作流模板\r\n    await this.createMultimodalNarrativeTemplate()\r\n\r\n    this.logger.log('预定义工作流模板已创建')\r\n  }\r\n\r\n  /**\r\n   * 创建故事创作模板\r\n   */\r\n  private async createStoryCreationTemplate(): Promise<string> {\r\n    const template: Omit<WorkflowTemplate, 'id' | 'createdAt' | 'updatedAt'> = {\r\n      name: '故事创作工作流',\r\n      description: '完整的AI辅助故事创作流程',\r\n      version: '1.0.0',\r\n      nodes: [\r\n        {\r\n          id: 'concept-generation',\r\n          type: 'task',\r\n          name: '创意概念生成',\r\n          description: '基于用户输入生成故事概念',\r\n          config: { taskType: 'ai', model: 'gpt-4', maxTokens: 500 },\r\n          inputs: [],\r\n          outputs: [{ id: 'concept-out', sourceNodeId: 'concept-generation', targetNodeId: 'logic-validation', condition: { type: 'expression', expression: 'true' } }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 3,\r\n          timeout: 60000\r\n        },\r\n        {\r\n          id: 'logic-validation',\r\n          type: 'task',\r\n          name: '逻辑验证',\r\n          description: '验证故事概念的逻辑一致性',\r\n          config: { taskType: 'ai', analysisType: 'logic' },\r\n          inputs: [{ id: 'logic-in', sourceNodeId: 'concept-generation', targetNodeId: 'logic-validation' }],\r\n          outputs: [\r\n            { id: 'logic-valid', sourceNodeId: 'logic-validation', targetNodeId: 'character-creation', condition: { type: 'expression', expression: 'result.isValid === true' } },\r\n            { id: 'logic-invalid', sourceNodeId: 'logic-validation', targetNodeId: 'concept-revision', condition: { type: 'expression', expression: 'result.isValid === false' } }\r\n          ],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 30000,\r\n          dependencies: ['concept-generation']\r\n        },\r\n        {\r\n          id: 'concept-revision',\r\n          type: 'task',\r\n          name: '概念修改',\r\n          description: '根据逻辑验证结果修改故事概念',\r\n          config: { taskType: 'ai', revisionType: 'logic-fix' },\r\n          inputs: [{ id: 'revision-in', sourceNodeId: 'logic-validation', targetNodeId: 'concept-revision' }],\r\n          outputs: [{ id: 'revision-out', sourceNodeId: 'concept-revision', targetNodeId: 'logic-validation', condition: { type: 'expression', expression: 'true' } }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 3,\r\n          timeout: 45000,\r\n          dependencies: ['logic-validation']\r\n        },\r\n        {\r\n          id: 'character-creation',\r\n          type: 'parallel',\r\n          name: '角色创建',\r\n          description: '并行创建多个主要角色',\r\n          config: { tasks: ['protagonist', 'antagonist', 'supporting'] },\r\n          inputs: [{ id: 'char-in', sourceNodeId: 'logic-validation', targetNodeId: 'character-creation' }],\r\n          outputs: [{ id: 'char-out', sourceNodeId: 'character-creation', targetNodeId: 'world-building', condition: { type: 'expression', expression: 'true' } }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 120000,\r\n          dependencies: ['logic-validation']\r\n        },\r\n        {\r\n          id: 'world-building',\r\n          type: 'task',\r\n          name: '世界构建',\r\n          description: '构建故事的世界观和设定',\r\n          config: { taskType: 'ai', worldType: 'comprehensive' },\r\n          inputs: [{ id: 'world-in', sourceNodeId: 'character-creation', targetNodeId: 'world-building' }],\r\n          outputs: [{ id: 'world-out', sourceNodeId: 'world-building', targetNodeId: 'plot-structure', condition: { type: 'expression', expression: 'true' } }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 90000,\r\n          dependencies: ['character-creation']\r\n        },\r\n        {\r\n          id: 'plot-structure',\r\n          type: 'task',\r\n          name: '情节结构设计',\r\n          description: '设计故事的情节框架和转折点',\r\n          config: { taskType: 'ai', structureType: 'three-act' },\r\n          inputs: [{ id: 'plot-in', sourceNodeId: 'world-building', targetNodeId: 'plot-structure' }],\r\n          outputs: [{ id: 'plot-out', sourceNodeId: 'plot-structure', targetNodeId: 'content-generation', condition: { type: 'expression', expression: 'true' } }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 75000,\r\n          dependencies: ['world-building']\r\n        },\r\n        {\r\n          id: 'content-generation',\r\n          type: 'task',\r\n          name: '内容生成',\r\n          description: '生成完整的故事情节内容',\r\n          config: { taskType: 'ai', contentType: 'full-narrative', maxLength: 5000 },\r\n          inputs: [{ id: 'content-in', sourceNodeId: 'plot-structure', targetNodeId: 'content-generation' }],\r\n          outputs: [{ id: 'content-out', sourceNodeId: 'content-generation', targetNodeId: 'quality-review', condition: { type: 'expression', expression: 'true' } }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 3,\r\n          timeout: 300000,\r\n          dependencies: ['plot-structure']\r\n        },\r\n        {\r\n          id: 'quality-review',\r\n          type: 'task',\r\n          name: '质量审查',\r\n          description: '对生成内容进行质量评估和修改',\r\n          config: { taskType: 'ai', reviewType: 'comprehensive' },\r\n          inputs: [{ id: 'review-in', sourceNodeId: 'content-generation', targetNodeId: 'quality-review' }],\r\n          outputs: [\r\n            { id: 'review-pass', sourceNodeId: 'quality-review', targetNodeId: 'final-output', condition: { type: 'expression', expression: 'result.quality > 0.8' } },\r\n            { id: 'review-fail', sourceNodeId: 'quality-review', targetNodeId: 'content-revision', condition: { type: 'expression', expression: 'result.quality <= 0.8' } }\r\n          ],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 60000,\r\n          dependencies: ['content-generation']\r\n        },\r\n        {\r\n          id: 'content-revision',\r\n          type: 'task',\r\n          name: '内容修改',\r\n          description: '根据质量审查结果修改内容',\r\n          config: { taskType: 'ai', revisionType: 'quality-improvement' },\r\n          inputs: [{ id: 'revision-in', sourceNodeId: 'quality-review', targetNodeId: 'content-revision' }],\r\n          outputs: [{ id: 'revision-out', sourceNodeId: 'content-revision', targetNodeId: 'quality-review', condition: { type: 'expression', expression: 'true' } }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 3,\r\n          timeout: 180000,\r\n          dependencies: ['quality-review']\r\n        },\r\n        {\r\n          id: 'final-output',\r\n          type: 'task',\r\n          name: '最终输出',\r\n          description: '格式化并输出最终的故事',\r\n          config: { taskType: 'format', outputFormat: 'markdown' },\r\n          inputs: [{ id: 'final-in', sourceNodeId: 'quality-review', targetNodeId: 'final-output' }],\r\n          outputs: [],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 1,\r\n          timeout: 30000,\r\n          dependencies: ['quality-review']\r\n        }\r\n      ],\r\n      connections: [], // 连接已在节点中定义\r\n      defaultConfig: {\r\n        maxRetries: 3,\r\n        timeout: 300000,\r\n        priority: 'high'\r\n      },\r\n      tags: ['story-creation', 'narrative', 'ai-assisted']\r\n    }\r\n\r\n    const templateId = asyncWorkflowEngine.createTemplate(template)\r\n    this.predefinedTemplates.set('story-creation', asyncWorkflowEngine.getTemplate(templateId)!)\r\n\r\n    return templateId\r\n  }\r\n\r\n  /**\r\n   * 创建角色开发模板\r\n   */\r\n  private async createCharacterDevelopmentTemplate(): Promise<string> {\r\n    // 简化的角色开发模板\r\n    const template: Omit<WorkflowTemplate, 'id' | 'createdAt' | 'updatedAt'> = {\r\n      name: '角色开发工作流',\r\n      description: '详细的角色塑造和性格发展流程',\r\n      version: '1.0.0',\r\n      nodes: [\r\n        {\r\n          id: 'character-basics',\r\n          type: 'task',\r\n          name: '角色基础设定',\r\n          description: '定义角色的基本属性和背景',\r\n          config: { taskType: 'character', step: 'basics' },\r\n          inputs: [],\r\n          outputs: [{ id: 'basics-out', sourceNodeId: 'character-basics', targetNodeId: 'personality-analysis' }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 30000\r\n        },\r\n        {\r\n          id: 'personality-analysis',\r\n          type: 'task',\r\n          name: '性格分析',\r\n          description: '深入分析角色性格特征和动机',\r\n          config: { taskType: 'character', step: 'personality' },\r\n          inputs: [{ id: 'personality-in', sourceNodeId: 'character-basics', targetNodeId: 'personality-analysis' }],\r\n          outputs: [{ id: 'personality-out', sourceNodeId: 'personality-analysis', targetNodeId: 'development-arc' }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 45000,\r\n          dependencies: ['character-basics']\r\n        },\r\n        {\r\n          id: 'development-arc',\r\n          type: 'task',\r\n          name: '发展弧线设计',\r\n          description: '设计角色的成长和变化轨迹',\r\n          config: { taskType: 'character', step: 'arc' },\r\n          inputs: [{ id: 'arc-in', sourceNodeId: 'personality-analysis', targetNodeId: 'development-arc' }],\r\n          outputs: [{ id: 'arc-out', sourceNodeId: 'development-arc', targetNodeId: 'character-output' }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 60000,\r\n          dependencies: ['personality-analysis']\r\n        },\r\n        {\r\n          id: 'character-output',\r\n          type: 'task',\r\n          name: '角色资料输出',\r\n          description: '生成完整的角色资料文档',\r\n          config: { taskType: 'format', format: 'character-sheet' },\r\n          inputs: [{ id: 'output-in', sourceNodeId: 'development-arc', targetNodeId: 'character-output' }],\r\n          outputs: [],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 1,\r\n          timeout: 20000,\r\n          dependencies: ['development-arc']\r\n        }\r\n      ],\r\n      connections: [],\r\n      defaultConfig: {\r\n        maxRetries: 2,\r\n        timeout: 120000,\r\n        priority: 'normal'\r\n      },\r\n      tags: ['character-development', 'personality', 'characterization']\r\n    }\r\n\r\n    const templateId = asyncWorkflowEngine.createTemplate(template)\r\n    this.predefinedTemplates.set('character-development', asyncWorkflowEngine.getTemplate(templateId)!)\r\n\r\n    return templateId\r\n  }\r\n\r\n  /**\r\n   * 创建世界构建模板\r\n   */\r\n  private async createWorldBuildingTemplate(): Promise<string> {\r\n    // 简化的世界构建模板\r\n    const template: Omit<WorkflowTemplate, 'id' | 'createdAt' | 'updatedAt'> = {\r\n      name: '世界构建工作流',\r\n      description: '系统性的世界观和设定构建流程',\r\n      version: '1.0.0',\r\n      nodes: [\r\n        {\r\n          id: 'world-concept',\r\n          type: 'task',\r\n          name: '世界概念设计',\r\n          description: '定义世界的基本概念和规则',\r\n          config: { taskType: 'world', step: 'concept' },\r\n          inputs: [],\r\n          outputs: [{ id: 'concept-out', sourceNodeId: 'world-concept', targetNodeId: 'setting-details' }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 45000\r\n        },\r\n        {\r\n          id: 'setting-details',\r\n          type: 'parallel',\r\n          name: '设定细节完善',\r\n          description: '并行完善世界的各个方面设定',\r\n          config: { tasks: ['geography', 'culture', 'magic-system', 'technology'] },\r\n          inputs: [{ id: 'details-in', sourceNodeId: 'world-concept', targetNodeId: 'setting-details' }],\r\n          outputs: [{ id: 'details-out', sourceNodeId: 'setting-details', targetNodeId: 'consistency-check' }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 180000,\r\n          dependencies: ['world-concept']\r\n        },\r\n        {\r\n          id: 'consistency-check',\r\n          type: 'task',\r\n          name: '一致性检查',\r\n          description: '验证世界设定的内部一致性',\r\n          config: { taskType: 'validation', checkType: 'world-consistency' },\r\n          inputs: [{ id: 'check-in', sourceNodeId: 'setting-details', targetNodeId: 'consistency-check' }],\r\n          outputs: [{ id: 'check-out', sourceNodeId: 'consistency-check', targetNodeId: 'world-output' }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 60000,\r\n          dependencies: ['setting-details']\r\n        },\r\n        {\r\n          id: 'world-output',\r\n          type: 'task',\r\n          name: '世界设定输出',\r\n          description: '生成完整的世界设定文档',\r\n          config: { taskType: 'format', format: 'world-bible' },\r\n          inputs: [{ id: 'output-in', sourceNodeId: 'consistency-check', targetNodeId: 'world-output' }],\r\n          outputs: [],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 1,\r\n          timeout: 30000,\r\n          dependencies: ['consistency-check']\r\n        }\r\n      ],\r\n      connections: [],\r\n      defaultConfig: {\r\n        maxRetries: 2,\r\n        timeout: 150000,\r\n        priority: 'normal'\r\n      },\r\n      tags: ['world-building', 'lore', 'setting', 'world-design']\r\n    }\r\n\r\n    const templateId = asyncWorkflowEngine.createTemplate(template)\r\n    this.predefinedTemplates.set('world-building', asyncWorkflowEngine.getTemplate(templateId)!)\r\n\r\n    return templateId\r\n  }\r\n\r\n  /**\r\n   * 创建多模态叙事模板\r\n   */\r\n  private async createMultimodalNarrativeTemplate(): Promise<string> {\r\n    // 多模态叙事模板\r\n    const template: Omit<WorkflowTemplate, 'id' | 'createdAt' | 'updatedAt'> = {\r\n      name: '多模态叙事工作流',\r\n      description: '结合文本、图像、音频的多模态故事创作',\r\n      version: '1.0.0',\r\n      nodes: [\r\n        {\r\n          id: 'text-script',\r\n          type: 'task',\r\n          name: '文本脚本创作',\r\n          description: '创作故事的文本脚本',\r\n          config: { taskType: 'ai', modality: 'text', maxLength: 2000 },\r\n          inputs: [],\r\n          outputs: [{ id: 'text-out', sourceNodeId: 'text-script', targetNodeId: 'parallel-modality' }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 90000\r\n        },\r\n        {\r\n          id: 'parallel-modality',\r\n          type: 'parallel',\r\n          name: '多模态内容生成',\r\n          description: '并行生成图像、音频等模态内容',\r\n          config: { tasks: ['image-generation', 'audio-narration', 'music-scoring'] },\r\n          inputs: [{ id: 'modality-in', sourceNodeId: 'text-script', targetNodeId: 'parallel-modality' }],\r\n          outputs: [{ id: 'modality-out', sourceNodeId: 'parallel-modality', targetNodeId: 'integration' }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 3,\r\n          timeout: 300000,\r\n          dependencies: ['text-script']\r\n        },\r\n        {\r\n          id: 'integration',\r\n          type: 'task',\r\n          name: '多模态集成',\r\n          description: '将各模态内容整合为连贯的叙事体验',\r\n          config: { taskType: 'integration', integrationType: 'multimodal' },\r\n          inputs: [{ id: 'integration-in', sourceNodeId: 'parallel-modality', targetNodeId: 'integration' }],\r\n          outputs: [{ id: 'integration-out', sourceNodeId: 'integration', targetNodeId: 'multimodal-output' }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 120000,\r\n          dependencies: ['parallel-modality']\r\n        },\r\n        {\r\n          id: 'multimodal-output',\r\n          type: 'task',\r\n          name: '多模态输出',\r\n          description: '生成最终的多模态叙事作品',\r\n          config: { taskType: 'format', format: 'multimodal-package' },\r\n          inputs: [{ id: 'output-in', sourceNodeId: 'integration', targetNodeId: 'multimodal-output' }],\r\n          outputs: [],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 1,\r\n          timeout: 60000,\r\n          dependencies: ['integration']\r\n        }\r\n      ],\r\n      connections: [],\r\n      defaultConfig: {\r\n        maxRetries: 3,\r\n        timeout: 480000,\r\n        priority: 'high'\r\n      },\r\n      tags: ['multimodal', 'narrative', 'media', 'integration']\r\n    }\r\n\r\n    const templateId = asyncWorkflowEngine.createTemplate(template)\r\n    this.predefinedTemplates.set('multimodal-narrative', asyncWorkflowEngine.getTemplate(templateId)!)\r\n\r\n    return templateId\r\n  }\r\n\r\n  /**\r\n   * 设置事件处理器\r\n   */\r\n  private setupEventHandlers(): void {\r\n    // 监听工作流事件\r\n    asyncWorkflowEngine.on('workflowInstantiated', (workflow) => {\r\n      this.logger.log(`工作流已实例化: ${workflow.id} - ${workflow.name}`)\r\n    })\r\n\r\n    asyncWorkflowEngine.on('workflowStarted', (workflow) => {\r\n      this.logger.log(`工作流已启动: ${workflow.id}`)\r\n    })\r\n\r\n    asyncWorkflowEngine.on('workflowCompleted', (workflow) => {\r\n      this.logger.log(`工作流已完成: ${workflow.id} (${workflow.metadata.actualDuration}ms)`)\r\n    })\r\n\r\n    asyncWorkflowEngine.on('workflowFailed', (workflow) => {\r\n      this.logger.error(`工作流执行失败: ${workflow.id}`)\r\n    })\r\n\r\n    asyncWorkflowEngine.on('nodeCompleted', (data: { instanceId: string; nodeId: string; result: any }) => {\r\n      this.logger.debug(`工作流节点完成: ${data.nodeId}`)\r\n    })\r\n\r\n    asyncWorkflowEngine.on('nodeFailed', (data: { instanceId: string; nodeId: string; error: string }) => {\r\n      this.logger.warn(`工作流节点失败: ${data.nodeId}`, data.error)\r\n    })\r\n  }\r\n\r\n  // ==================== 工作流管理 ====================\r\n\r\n  /**\r\n   * 使用预定义模板创建工作流实例\r\n   */\r\n  async createWorkflowFromTemplate(\r\n    templateName: string,\r\n    name: string,\r\n    options: WorkflowExecutionOptions = {}\r\n  ): Promise<string> {\r\n    const template = this.predefinedTemplates.get(templateName)\r\n    if (!template) {\r\n      throw new Error(`预定义模板 '${templateName}' 不存在`)\r\n    }\r\n\r\n    const instanceId = asyncWorkflowEngine.instantiateWorkflow(template.id, name, options)\r\n    this.logger.log(`基于模板 '${templateName}' 创建工作流实例: ${instanceId}`)\r\n\r\n    return instanceId\r\n  }\r\n\r\n  /**\r\n   * 创建自定义工作流\r\n   */\r\n  async createCustomWorkflow(\r\n    templateData: Omit<WorkflowTemplate, 'id' | 'createdAt' | 'updatedAt'>,\r\n    instanceName: string,\r\n    options: WorkflowExecutionOptions = {}\r\n  ): Promise<string> {\r\n    const templateId = asyncWorkflowEngine.createTemplate(templateData)\r\n    const instanceId = asyncWorkflowEngine.instantiateWorkflow(templateId, instanceName, options)\r\n\r\n    this.logger.log(`创建自定义工作流: ${instanceId}`)\r\n    return instanceId\r\n  }\r\n\r\n  /**\r\n   * 启动工作流\r\n   */\r\n  async startWorkflow(instanceId: string): Promise<void> {\r\n    await asyncWorkflowEngine.startWorkflow(instanceId)\r\n    this.logger.log(`工作流已启动: ${instanceId}`)\r\n  }\r\n\r\n  /**\r\n   * 暂停工作流\r\n   */\r\n  async pauseWorkflow(instanceId: string): Promise<void> {\r\n    await asyncWorkflowEngine.pauseWorkflow(instanceId)\r\n    this.logger.log(`工作流已暂停: ${instanceId}`)\r\n  }\r\n\r\n  /**\r\n   * 恢复工作流\r\n   */\r\n  async resumeWorkflow(instanceId: string): Promise<void> {\r\n    await asyncWorkflowEngine.resumeWorkflow(instanceId)\r\n    this.logger.log(`工作流已恢复: ${instanceId}`)\r\n  }\r\n\r\n  /**\r\n   * 取消工作流\r\n   */\r\n  async cancelWorkflow(instanceId: string, reason?: string): Promise<void> {\r\n    await asyncWorkflowEngine.cancelWorkflow(instanceId, reason)\r\n    this.logger.log(`工作流已取消: ${instanceId}${reason ? ` - ${reason}` : ''}`)\r\n  }\r\n\r\n  /**\r\n   * 获取工作流状态\r\n   */\r\n  getWorkflowStatus(instanceId: string): WorkflowInstance | null {\r\n    return asyncWorkflowEngine.getWorkflowStatus(instanceId)\r\n  }\r\n\r\n  /**\r\n   * 获取所有活跃工作流\r\n   */\r\n  getActiveWorkflows(): WorkflowInstance[] {\r\n    // 这里需要从引擎获取活跃工作流列表\r\n    // 由于引擎API限制，暂时返回空数组\r\n    return []\r\n  }\r\n\r\n  // ==================== 叙事专用工作流 ====================\r\n\r\n  /**\r\n   * 创建故事创作工作流\r\n   */\r\n  async createStoryCreationWorkflow(\r\n    storyId: string,\r\n    userPrompt: string,\r\n    options: {\r\n      genre?: string\r\n      length?: 'short' | 'medium' | 'long'\r\n      style?: string\r\n      characters?: number\r\n    } = {}\r\n  ): Promise<string> {\r\n    const workflowName = `故事创作: ${storyId}`\r\n\r\n    const workflowOptions: WorkflowExecutionOptions = {\r\n      priority: 'high',\r\n      variables: {\r\n        storyId,\r\n        userPrompt,\r\n        genre: options.genre || 'fantasy',\r\n        length: options.length || 'medium',\r\n        style: options.style || 'narrative',\r\n        characterCount: options.characters || 3\r\n      },\r\n      inputData: {\r\n        prompt: userPrompt,\r\n        requirements: options\r\n      }\r\n    }\r\n\r\n    const instanceId = await this.createWorkflowFromTemplate('story-creation', workflowName, workflowOptions)\r\n\r\n    // 自动启动工作流\r\n    await this.startWorkflow(instanceId)\r\n\r\n    return instanceId\r\n  }\r\n\r\n  /**\r\n   * 创建角色开发工作流\r\n   */\r\n  async createCharacterDevelopmentWorkflow(\r\n    characterId: string,\r\n    characterConcept: string,\r\n    options: {\r\n      archetype?: string\r\n      complexity?: 'simple' | 'detailed' | 'complex'\r\n      background?: any\r\n    } = {}\r\n  ): Promise<string> {\r\n    const workflowName = `角色开发: ${characterId}`\r\n\r\n    const workflowOptions: WorkflowExecutionOptions = {\r\n      priority: 'normal',\r\n      variables: {\r\n        characterId,\r\n        characterConcept,\r\n        archetype: options.archetype || 'hero',\r\n        complexity: options.complexity || 'detailed'\r\n      },\r\n      inputData: {\r\n        concept: characterConcept,\r\n        options: options\r\n      }\r\n    }\r\n\r\n    const instanceId = await this.createWorkflowFromTemplate('character-development', workflowName, workflowOptions)\r\n    await this.startWorkflow(instanceId)\r\n\r\n    return instanceId\r\n  }\r\n\r\n  /**\r\n   * 创建世界构建工作流\r\n   */\r\n  async createWorldBuildingWorkflow(\r\n    worldId: string,\r\n    worldConcept: string,\r\n    options: {\r\n      scope?: 'small' | 'medium' | 'large'\r\n      genre?: string\r\n      technologyLevel?: string\r\n      magicLevel?: string\r\n    } = {}\r\n  ): Promise<string> {\r\n    const workflowName = `世界构建: ${worldId}`\r\n\r\n    const workflowOptions: WorkflowExecutionOptions = {\r\n      priority: 'normal',\r\n      variables: {\r\n        worldId,\r\n        worldConcept,\r\n        scope: options.scope || 'medium',\r\n        genre: options.genre || 'fantasy',\r\n        technologyLevel: options.technologyLevel || 'medieval',\r\n        magicLevel: options.magicLevel || 'high'\r\n      },\r\n      inputData: {\r\n        concept: worldConcept,\r\n        options: options\r\n      }\r\n    }\r\n\r\n    const instanceId = await this.createWorkflowFromTemplate('world-building', workflowName, workflowOptions)\r\n    await this.startWorkflow(instanceId)\r\n\r\n    return instanceId\r\n  }\r\n\r\n  /**\r\n   * 创建多模态叙事工作流\r\n   */\r\n  async createMultimodalNarrativeWorkflow(\r\n    narrativeId: string,\r\n    script: string,\r\n    modalities: ('text' | 'image' | 'audio' | 'video')[] = ['text', 'image']\r\n  ): Promise<string> {\r\n    const workflowName = `多模态叙事: ${narrativeId}`\r\n\r\n    const workflowOptions: WorkflowExecutionOptions = {\r\n      priority: 'high',\r\n      variables: {\r\n        narrativeId,\r\n        modalities: modalities.join(',')\r\n      },\r\n      inputData: {\r\n        script,\r\n        modalities\r\n      }\r\n    }\r\n\r\n    const instanceId = await this.createWorkflowFromTemplate('multimodal-narrative', workflowName, workflowOptions)\r\n    await this.startWorkflow(instanceId)\r\n\r\n    return instanceId\r\n  }\r\n\r\n  // ==================== 工作流监控 ====================\r\n\r\n  /**\r\n   * 获取工作流统计信息\r\n   */\r\n  getWorkflowStats(): any {\r\n    return asyncWorkflowEngine.getEngineStats()\r\n  }\r\n\r\n  /**\r\n   * 获取工作流性能指标\r\n   */\r\n  getWorkflowMetrics(): any {\r\n    const stats = this.getWorkflowStats()\r\n    const activeWorkflows = this.getActiveWorkflows()\r\n\r\n    return {\r\n      ...stats,\r\n      activeWorkflows: activeWorkflows.length,\r\n      averageCompletionTime: this.calculateAverageCompletionTime(activeWorkflows),\r\n      successRate: this.calculateSuccessRate(activeWorkflows),\r\n      resourceUtilization: this.calculateResourceUtilization()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 计算平均完成时间\r\n   */\r\n  private calculateAverageCompletionTime(workflows: WorkflowInstance[]): number {\r\n    const completedWorkflows = workflows.filter(w => w.status === 'completed' && w.metadata.actualDuration)\r\n\r\n    if (completedWorkflows.length === 0) return 0\r\n\r\n    const totalTime = completedWorkflows.reduce((sum, w) => sum + (w.metadata.actualDuration || 0), 0)\r\n    return totalTime / completedWorkflows.length\r\n  }\r\n\r\n  /**\r\n   * 计算成功率\r\n   */\r\n  private calculateSuccessRate(workflows: WorkflowInstance[]): number {\r\n    if (workflows.length === 0) return 0\r\n\r\n    const successful = workflows.filter(w => w.status === 'completed').length\r\n    return successful / workflows.length\r\n  }\r\n\r\n  /**\r\n   * 计算资源利用率\r\n   */\r\n  private calculateResourceUtilization(): any {\r\n    // 简化的资源利用率计算\r\n    const stats = this.getWorkflowStats()\r\n\r\n    return {\r\n      executorUtilization: stats.runningInstances / Math.max(stats.nodeExecutors, 1),\r\n      queueUtilization: stats.queuedInstances / Math.max(stats.maxConcurrentExecutions || 10, 1),\r\n      memoryEfficiency: 0.85 // 模拟值\r\n    }\r\n  }\r\n\r\n  // ==================== 模板管理 ====================\r\n\r\n  /**\r\n   * 获取可用模板列表\r\n   */\r\n  getAvailableTemplates(): Array<{ id: string, name: string, description: string, tags: string[] }> {\r\n    return Array.from(this.predefinedTemplates.values()).map(template => ({\r\n      id: template.id,\r\n      name: template.name,\r\n      description: template.description,\r\n      tags: template.tags\r\n    }))\r\n  }\r\n\r\n  /**\r\n   * 获取模板详情\r\n   */\r\n  getTemplateDetails(templateId: string): WorkflowTemplate | null {\r\n    return asyncWorkflowEngine.getTemplate(templateId)\r\n  }\r\n\r\n  // ==================== 高级功能 ====================\r\n\r\n  /**\r\n   * 创建条件分支工作流\r\n   */\r\n  async createConditionalWorkflow(\r\n    name: string,\r\n    conditions: Array<{\r\n      condition: string\r\n      workflowTemplate: string\r\n      parameters: any\r\n    }>\r\n  ): Promise<string> {\r\n    // 创建一个决策节点，根据条件选择不同的子工作流\r\n    const template: Omit<WorkflowTemplate, 'id' | 'createdAt' | 'updatedAt'> = {\r\n      name: `条件工作流: ${name}`,\r\n      description: '基于条件动态选择执行路径的工作流',\r\n      version: '1.0.0',\r\n      nodes: [\r\n        {\r\n          id: 'decision',\r\n          type: 'decision',\r\n          name: '条件判断',\r\n          description: '评估条件并选择执行路径',\r\n          config: { conditions },\r\n          inputs: [],\r\n          outputs: conditions.map((cond, index) => ({\r\n            id: `branch-${index}`,\r\n            sourceNodeId: 'decision',\r\n            targetNodeId: `subworkflow-${index}`,\r\n            condition: { type: 'expression', expression: cond.condition }\r\n          })),\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 1,\r\n          timeout: 30000\r\n        },\r\n        ...conditions.map((cond, index) => ({\r\n          id: `subworkflow-${index}`,\r\n          type: 'subprocess',\r\n          name: `子工作流 ${index + 1}`,\r\n          description: `执行 ${cond.workflowTemplate} 模板`,\r\n          config: {\r\n            subTemplate: cond.workflowTemplate,\r\n            parameters: cond.parameters\r\n          },\r\n          inputs: [{ id: `input-${index}`, sourceNodeId: 'decision', targetNodeId: `subworkflow-${index}` }],\r\n          outputs: [{ id: `output-${index}`, sourceNodeId: `subworkflow-${index}`, targetNodeId: 'merge' }],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 2,\r\n          timeout: 300000,\r\n          dependencies: ['decision']\r\n        })),\r\n        {\r\n          id: 'merge',\r\n          type: 'gateway',\r\n          name: '结果合并',\r\n          description: '合并各分支的执行结果',\r\n          config: { gatewayType: 'exclusive' },\r\n          inputs: conditions.map((_, index) => ({\r\n            id: `merge-input-${index}`,\r\n            sourceNodeId: `subworkflow-${index}`,\r\n            targetNodeId: 'merge'\r\n          })),\r\n          outputs: [],\r\n          status: 'pending',\r\n          retryCount: 0,\r\n          maxRetries: 1,\r\n          timeout: 30000,\r\n          dependencies: conditions.map((_, index) => `subworkflow-${index}`)\r\n        }\r\n      ],\r\n      connections: [],\r\n      defaultConfig: {\r\n        maxRetries: 2,\r\n        timeout: 600000,\r\n        priority: 'normal'\r\n      },\r\n      tags: ['conditional', 'dynamic', 'branching']\r\n    }\r\n\r\n    const instanceId = await this.createCustomWorkflow(template, name)\r\n    return instanceId\r\n  }\r\n\r\n  // ==================== 健康检查和维护 ====================\r\n\r\n  /**\r\n   * 健康检查\r\n   */\r\n  async healthCheck(): Promise<{ status: string, details?: any }> {\r\n    try {\r\n      const stats = this.getWorkflowStats()\r\n      const activeWorkflows = this.getActiveWorkflows()\r\n\r\n      const issues = []\r\n\r\n      // 检查是否有长时间运行的工作流\r\n      const longRunning = activeWorkflows.filter(w => {\r\n        if (!w.startTime) return false\r\n        const runtime = Date.now() - w.startTime.getTime()\r\n        return runtime > 30 * 60 * 1000 // 30分钟\r\n      })\r\n\r\n      if (longRunning.length > 0) {\r\n        issues.push(`${longRunning.length} 个工作流运行时间过长`)\r\n      }\r\n\r\n      // 检查队列积压\r\n      if (stats.queuedInstances > 10) {\r\n        issues.push(`工作流队列积压: ${stats.queuedInstances} 个实例`)\r\n      }\r\n\r\n      return {\r\n        status: issues.length > 0 ? 'warning' : 'healthy',\r\n        details: {\r\n          stats,\r\n          activeWorkflows: activeWorkflows.length,\r\n          issues\r\n        }\r\n      }\r\n    } catch (error: any) {\r\n      return {\r\n        status: 'error',\r\n        details: error.message\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 清理已完成的工作流\r\n   */\r\n  async cleanupCompletedWorkflows(olderThanHours: number = 24): Promise<number> {\r\n    const cleaned = asyncWorkflowEngine.cleanupCompletedInstances(olderThanHours)\r\n    this.logger.log(`清理了 ${cleaned} 个过期的工作流实例`)\r\n    return cleaned\r\n  }\r\n}\r\n"],"version":3}