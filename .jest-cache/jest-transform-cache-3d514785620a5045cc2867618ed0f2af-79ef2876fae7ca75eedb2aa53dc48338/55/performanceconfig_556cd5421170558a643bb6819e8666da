15b6e74eb54cc5c316b345d4f7da7e6b
"use strict";
// 文件路径: packages/common-backend/src/config/performance-config.ts
// 职责: 性能监控基线配置和SLA指标定义
Object.defineProperty(exports, "__esModule", { value: true });
exports.PERFORMANCE_CONFIG = void 0;
exports.getSLATarget = getSLATarget;
exports.getPerformanceThreshold = getPerformanceThreshold;
exports.isPerformanceHealthy = isPerformanceHealthy;
/**
 * @constant PERFORMANCE_CONFIG
 * @description 性能监控配置
 */
exports.PERFORMANCE_CONFIG = {
    // SLA目标
    slas: {
        api: {
            responseTime: { p50: 200, p95: 500, p99: 1000 },
            availability: 99.9,
            errorRate: 0.1,
            throughput: 1000,
        },
        ai: {
            responseTime: { p50: 2000, p95: 3000, p99: 5000 },
            availability: 99.5,
            errorRate: 1.0,
            throughput: 100,
        },
        database: {
            responseTime: { p50: 50, p95: 200, p99: 500 },
            availability: 99.9,
            errorRate: 0.01,
            throughput: 5000,
        },
        cache: {
            responseTime: { p50: 5, p95: 20, p99: 50 },
            availability: 99.99,
            errorRate: 0.001,
            throughput: 10000,
        },
        queue: {
            responseTime: { p50: 100, p95: 500, p99: 2000 },
            availability: 99.9,
            errorRate: 0.1,
            throughput: 2000,
        },
        websocket: {
            responseTime: { p50: 50, p95: 100, p99: 200 },
            availability: 99.9,
            errorRate: 0.1,
            throughput: 5000,
        },
    },
    // 性能阈值
    thresholds: {
        responseTime: {
            warning: 1000, // 1秒
            critical: 3000, // 3秒
            emergency: 10000, // 10秒
        },
        errorRate: {
            warning: 1.0, // 1%
            critical: 5.0, // 5%
            emergency: 10.0, // 10%
        },
        cpuUsage: {
            warning: 70, // 70%
            critical: 85, // 85%
            emergency: 95, // 95%
        },
        memoryUsage: {
            warning: 80, // 80%
            critical: 90, // 90%
            emergency: 95, // 95%
        },
        connectionCount: {
            warning: 1000, // 1000连接
            critical: 2000, // 2000连接
            emergency: 5000, // 5000连接
        },
    },
    // 监控配置
    monitoring: {
        /** 采样率 */
        sampleRate: 0.1, // 10%采样
        /** 指标收集间隔 (毫秒) */
        collectionInterval: 60000, // 1分钟
        /** 告警检查间隔 (毫秒) */
        alertCheckInterval: 300000, // 5分钟
        /** 性能报告生成间隔 (毫秒) */
        reportInterval: 3600000, // 1小时
        /** 历史数据保留天数 */
        retentionDays: 30,
    },
    // 容量规划
    capacity: {
        /** 最大并发用户数 */
        maxConcurrentUsers: 10000,
        /** 数据库连接池大小 */
        dbConnectionPool: 50,
        /** Redis连接池大小 */
        redisConnectionPool: 100,
        /** WebSocket最大连接数 */
        maxWebSocketConnections: 50000,
        /** 队列并发处理数 */
        queueConcurrency: 20,
    },
};
/**
 * @function getSLATarget
 * @description 获取指定服务的SLA目标
 */
function getSLATarget(service) {
    return exports.PERFORMANCE_CONFIG.slas[service];
}
/**
 * @function getPerformanceThreshold
 * @description 获取指定指标的性能阈值
 */
function getPerformanceThreshold(metric, level) {
    return exports.PERFORMANCE_CONFIG.thresholds[metric]?.[level] || 0;
}
/**
 * @function isPerformanceHealthy
 * @description 检查性能指标是否健康
 */
function isPerformanceHealthy(service, metric, value) {
    const sla = getSLATarget(service);
    switch (metric) {
        case 'responseTime':
            if (value <= sla.responseTime.p95)
                return { healthy: true, level: 'healthy' };
            if (value <= getPerformanceThreshold('responseTime', 'warning'))
                return { healthy: false, level: 'warning' };
            if (value <= getPerformanceThreshold('responseTime', 'critical'))
                return { healthy: false, level: 'critical' };
            return { healthy: false, level: 'emergency' };
        case 'errorRate':
            if (value <= sla.errorRate)
                return { healthy: true, level: 'healthy' };
            if (value <= getPerformanceThreshold('errorRate', 'warning'))
                return { healthy: false, level: 'warning' };
            if (value <= getPerformanceThreshold('errorRate', 'critical'))
                return { healthy: false, level: 'critical' };
            return { healthy: false, level: 'emergency' };
        case 'availability':
            if (value >= sla.availability)
                return { healthy: true, level: 'healthy' };
            if (value >= sla.availability - 0.1)
                return { healthy: false, level: 'warning' };
            if (value >= sla.availability - 0.5)
                return { healthy: false, level: 'critical' };
            return { healthy: false, level: 'emergency' };
        default:
            return { healthy: true, level: 'healthy' };
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFxjb25maWdcXHBlcmZvcm1hbmNlLWNvbmZpZy50cyIsIm1hcHBpbmdzIjoiO0FBQUEsaUVBQWlFO0FBQ2pFLHVCQUF1Qjs7O0FBMkt2QixvQ0FFQztBQU1ELDBEQUtDO0FBTUQsb0RBaUNDO0FBdktEOzs7R0FHRztBQUNVLFFBQUEsa0JBQWtCLEdBQUc7SUFDaEMsUUFBUTtJQUNSLElBQUksRUFBRTtRQUNKLEdBQUcsRUFBRTtZQUNILFlBQVksRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFO1lBQy9DLFlBQVksRUFBRSxJQUFJO1lBQ2xCLFNBQVMsRUFBRSxHQUFHO1lBQ2QsVUFBVSxFQUFFLElBQUk7U0FDakI7UUFDRCxFQUFFLEVBQUU7WUFDRixZQUFZLEVBQUUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRTtZQUNqRCxZQUFZLEVBQUUsSUFBSTtZQUNsQixTQUFTLEVBQUUsR0FBRztZQUNkLFVBQVUsRUFBRSxHQUFHO1NBQ2hCO1FBQ0QsUUFBUSxFQUFFO1lBQ1IsWUFBWSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUU7WUFDN0MsWUFBWSxFQUFFLElBQUk7WUFDbEIsU0FBUyxFQUFFLElBQUk7WUFDZixVQUFVLEVBQUUsSUFBSTtTQUNqQjtRQUNELEtBQUssRUFBRTtZQUNMLFlBQVksRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFO1lBQzFDLFlBQVksRUFBRSxLQUFLO1lBQ25CLFNBQVMsRUFBRSxLQUFLO1lBQ2hCLFVBQVUsRUFBRSxLQUFLO1NBQ2xCO1FBQ0Qs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QUcsQ0FBQyxZQUFZLEdBQUcsR0FBRztnQkFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLENBQUE7WUFDaEYsSUFBSSxLQUFLLElBQUksR0FBRyxDQUFDLFlBQVksR0FBRyxHQUFHO2dCQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsQ0FBQTtZQUNqRixPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLENBQUE7UUFFL0M7WUFDRSxPQUFPLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLENBQUE7SUFDOUMsQ0FBQztBQUNILENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFxjb25maWdcXHBlcmZvcm1hbmNlLWNvbmZpZy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyDmlofku7bot6/lvoQ6IHBhY2thZ2VzL2NvbW1vbi1iYWNrZW5kL3NyYy9jb25maWcvcGVyZm9ybWFuY2UtY29uZmlnLnRzXG4vLyDogYzotKM6IOaAp+iDveebkeaOp+Wfuue6v+mFjee9ruWSjFNMQeaMh+agh+WumuS5iVxuXG4vKipcbiAqIEBpbnRlcmZhY2UgU0xBVGFyZ2V0c1xuICogQGRlc2NyaXB0aW9uIFNMQeebruagh+WumuS5iVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNMQVRhcmdldHMge1xuICAvKiog5ZON5bqU5pe26Ze055uu5qCHICjmr6vnp5IpICovXG4gIHJlc3BvbnNlVGltZToge1xuICAgIC8qKiBQNTDlk43lupTml7bpl7QgKi9cbiAgICBwNTA6IG51bWJlclxuICAgIC8qKiBQOTXlk43lupTml7bpl7QgKi9cbiAgICBwOTU6IG51bWJlclxuICAgIC8qKiBQOTnlk43lupTml7bpl7QgKi9cbiAgICBwOTk6IG51bWJlclxuICB9XG4gIC8qKiDlj6/nlKjmgKfnm67moIcgKOeZvuWIhuavlCkgKi9cbiAgYXZhaWxhYmlsaXR5OiBudW1iZXJcbiAgLyoqIOmUmeivr+eOh+ebruaghyAo55m+5YiG5q+UKSAqL1xuICBlcnJvclJhdGU6IG51bWJlclxuICAvKiog5ZCe5ZCQ6YeP55uu5qCHIChSUFMpICovXG4gIHRocm91Z2hwdXQ6IG51bWJlclxufVxuXG4vKipcbiAqIEBpbnRlcmZhY2UgUGVyZm9ybWFuY2VUaHJlc2hvbGRzXG4gKiBAZGVzY3JpcHRpb24g5oCn6IO96ZiI5YC86YWN572uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUGVyZm9ybWFuY2VUaHJlc2hvbGRzIHtcbiAgLyoqIOitpuWRiumYiOWAvCAqL1xuICB3YXJuaW5nOiBudW1iZXJcbiAgLyoqIOS4pemHjemYiOWAvCAqL1xuICBjcml0aWNhbDogbnVtYmVyXG4gIC8qKiDntKfmgKXpmIjlgLwgKi9cbiAgZW1lcmdlbmN5OiBudW1iZXJcbn1cblxuLyoqXG4gKiBAaW50ZXJmYWNlIFNlcnZpY2VTTEFzXG4gKiBAZGVzY3JpcHRpb24g5ZCE5pyN5Yqh55qEU0xB6YWN572uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU2VydmljZVNMQXMge1xuICAvKiogQVBJ572R5YWzICovXG4gIGFwaTogU0xBVGFyZ2V0c1xuICAvKiogQUnmjqjnkIbmnI3liqEgKi9cbiAgYWk6IFNMQVRhcmdldHNcbiAgLyoqIOaVsOaNruW6k+afpeivoiAqL1xuICBkYXRhYmFzZTogU0xBVGFyZ2V0c1xuICAvKiog57yT5a2Y5pON5L2cICovXG4gIGNhY2hlOiBTTEFUYXJnZXRzXG4gIC8qKiDmtojmga/pmJ/liJcgKi9cbiAgcXVldWU6IFNMQVRhcmdldHNcbiAgLyoqIFdlYlNvY2tldOi/nuaOpSAqL1xuICB3ZWJzb2NrZXQ6IFNMQVRhcmdldHNcbn1cblxuLyoqXG4gKiBAY29uc3RhbnQgUEVSRk9STUFOQ0VfQ09ORklHXG4gKiBAZGVzY3JpcHRpb24g5oCn6IO955uR5o6n6YWN572uXG4gKi9cbmV4cG9ydCBjb25zdCBQRVJGT1JNQU5DRV9DT05GSUcgPSB7XG4gIC8vIFNMQeebruagh1xuICBzbGFzOiB7XG4gICAgYXBpOiB7XG4gICAgICByZXNwb25zZVRpbWU6IHsgcDUwOiAyMDAsIHA5NTogNTAwLCBwOTk6IDEwMDAgfSxcbiAgICAgIGF2YWlsYWJpbGl0eTogOTkuOSxcbiAgICAgIGVycm9yUmF0ZTogMC4xLFxuICAgICAgdGhyb3VnaHB1dDogMTAwMCxcbiAgICB9LFxuICAgIGFpOiB7XG4gICAgICByZXNwb25zZVRpbWU6IHsgcDUwOiAyMDAwLCBwOTU6IDMwMDAsIHA5OTogNTAwMCB9LFxuICAgICAgYXZhaWxhYmlsaXR5OiA5OS41LFxuICAgICAgZXJyb3JSYXRlOiAxLjAsXG4gICAgICB0aHJvdWdocHV0OiAxMDAsXG4gICAgfSxcbiAgICBkYXRhYmFzZToge1xuICAgICAgcmVzcG9uc2VUaW1lOiB7IHA1MDogNTAsIHA5NTogMjAwLCBwOTk6IDUwMCB9LFxuICAgICAgYXZhaWxhYmlsaXR5OiA5OS45LFxuICAgICAgZXJyb3JSYXRlOiAwLjAxLFxuICAgICAgdGhyb3VnaHB1dDogNTAwMCxcbiAgICB9LFxuICAgIGNhY2hlOiB7XG4gICAgICByZXNwb25zZVRpbWU6IHsgcDUwOiA1LCBwOTU6IDIwLCBwOTk6IDUwIH0sXG4gICAgICBhdmFpbGFiaWxpdHk6IDk5Ljk5LFxuICAgICAgZXJyb3JSYXRlOiAwLjAwMSxcbiAgICAgIHRocm91Z2hwdXQ6IDEwMDAwLFxuICAgIH0sXG4gICAgcXVldWU6IHtcbiAgICAgIHJlc3BvbnNlVGltZTogeyBwNTA6IDEwMCwgcDk1OiA1MDAsIHA5OTogMjAwMCB9LFxuICAgICAgYXZhaWxhYmlsaXR5OiA5OS45LFxuICAgICAgZXJyb3JSYXRlOiAwLjEsXG4gICAgICB0aHJvdWdocHV0OiAyMDAwLFxuICAgIH0sXG4gICAgd2Vic29ja2V0OiB7XG4gICAgICByZXNwb25zZVRpbWU6IHsgcDUwOiA1MCwgcDk1OiAxMDAsIHA5OTogMjAwIH0sXG4gICAgICBhdmFpbGFiaWxpdHk6IDk5LjksXG4gICAgICBlcnJvclJhdGU6IDAuMSxcbiAgICAgIHRocm91Z2hwdXQ6IDUwMDAsXG4gICAgfSxcbiAgfSBhcyBTZXJ2aWNlU0xBcyxcblxuICAvLyDmgKfog73pmIjlgLxcbiAgdGhyZXNob2xkczoge1xuICAgIHJlc3BvbnNlVGltZToge1xuICAgICAgd2FybmluZzogMTAwMCwgLy8gMeenklxuICAgICAgY3JpdGljYWw6IDMwMDAsIC8vIDPnp5JcbiAgICAgIGVtZXJnZW5jeTogMTAwMDAsIC8vIDEw56eSXG4gICAgfSxcbiAgICBlcnJvclJhdGU6IHtcbiAgICAgIHdhcm5pbmc6IDEuMCwgLy8gMSVcbiAgICAgIGNyaXRpY2FsOiA1LjAsIC8vIDUlXG4gICAgICBlbWVyZ2VuY3k6IDEwLjAsIC8vIDEwJVxuICAgIH0sXG4gICAgY3B1VXNhZ2U6IHtcbiAgICAgIHdhcm5pbmc6IDcwLCAvLyA3MCVcbiAgICAgIGNyaXRpY2FsOiA4NSwgLy8gODUlXG4gICAgICBlbWVyZ2VuY3k6IDk1LCAvLyA5NSVcbiAgICB9LFxuICAgIG1lbW9yeVVzYWdlOiB7XG4gICAgICB3YXJuaW5nOiA4MCwgLy8gODAlXG4gICAgICBjcml0aWNhbDogOTAsIC8vIDkwJVxuICAgICAgZW1lcmdlbmN5OiA5NSwgLy8gOTUlXG4gICAgfSxcbiAgICBjb25uZWN0aW9uQ291bnQ6IHtcbiAgICAgIHdhcm5pbmc6IDEwMDAsIC8vIDEwMDDov57mjqVcbiAgICAgIGNyaXRpY2FsOiAyMDAwLCAvLyAyMDAw6L+e5o6lXG4gICAgICBlbWVyZ2VuY3k6IDUwMDAsIC8vIDUwMDDov57mjqVcbiAgICB9LFxuICB9IGFzIFJlY29yZDxzdHJpbmcsIFBlcmZvcm1hbmNlVGhyZXNob2xkcz4sXG5cbiAgLy8g55uR5o6n6YWN572uXG4gIG1vbml0b3Jpbmc6IHtcbiAgICAvKiog6YeH5qC3546HICovXG4gICAgc2FtcGxlUmF0ZTogMC4xLCAvLyAxMCXph4fmoLdcblxuICAgIC8qKiDmjIfmoIfmlLbpm4bpl7TpmpQgKOavq+enkikgKi9cbiAgICBjb2xsZWN0aW9uSW50ZXJ2YWw6IDYwMDAwLCAvLyAx5YiG6ZKfXG5cbiAgICAvKiog5ZGK6K2m5qOA5p+l6Ze06ZqUICjmr6vnp5IpICovXG4gICAgYWxlcnRDaGVja0ludGVydmFsOiAzMDAwMDAsIC8vIDXliIbpkp9cblxuICAgIC8qKiDmgKfog73miqXlkYrnlJ/miJDpl7TpmpQgKOavq+enkikgKi9cbiAgICByZXBvcnRJbnRlcnZhbDogMzYwMDAwMCwgLy8gMeWwj+aXtlxuXG4gICAgLyoqIOWOhuWPsuaVsOaNruS/neeVmeWkqeaVsCAqL1xuICAgIHJldGVudGlvbkRheXM6IDMwLFxuICB9LFxuXG4gIC8vIOWuuemHj+inhOWIklxuICBjYXBhY2l0eToge1xuICAgIC8qKiDmnIDlpKflubblj5HnlKjmiLfmlbAgKi9cbiAgICBtYXhDb25jdXJyZW50VXNlcnM6IDEwMDAwLFxuXG4gICAgLyoqIOaVsOaNruW6k+i/nuaOpeaxoOWkp+WwjyAqL1xuICAgIGRiQ29ubmVjdGlvblBvb2w6IDUwLFxuXG4gICAgLyoqIFJlZGlz6L+e5o6l5rGg5aSn5bCPICovXG4gICAgcmVkaXNDb25uZWN0aW9uUG9vbDogMTAwLFxuXG4gICAgLyoqIFdlYlNvY2tldOacgOWkp+i/nuaOpeaVsCAqL1xuICAgIG1heFdlYlNvY2tldENvbm5lY3Rpb25zOiA1MDAwMCxcblxuICAgIC8qKiDpmJ/liJflubblj5HlpITnkIbmlbAgKi9cbiAgICBxdWV1ZUNvbmN1cnJlbmN5OiAyMCxcbiAgfSxcbn1cblxuLyoqXG4gKiBAZnVuY3Rpb24gZ2V0U0xBVGFyZ2V0XG4gKiBAZGVzY3JpcHRpb24g6I635Y+W5oyH5a6a5pyN5Yqh55qEU0xB55uu5qCHXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRTTEFUYXJnZXQoc2VydmljZToga2V5b2YgU2VydmljZVNMQXMpOiBTTEFUYXJnZXRzIHtcbiAgcmV0dXJuIFBFUkZPUk1BTkNFX0NPTkZJRy5zbGFzW3NlcnZpY2VdXG59XG5cbi8qKlxuICogQGZ1bmN0aW9uIGdldFBlcmZvcm1hbmNlVGhyZXNob2xkXG4gKiBAZGVzY3JpcHRpb24g6I635Y+W5oyH5a6a5oyH5qCH55qE5oCn6IO96ZiI5YC8XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRQZXJmb3JtYW5jZVRocmVzaG9sZChcbiAgbWV0cmljOiBzdHJpbmcsXG4gIGxldmVsOiBrZXlvZiBQZXJmb3JtYW5jZVRocmVzaG9sZHNcbik6IG51bWJlciB7XG4gIHJldHVybiBQRVJGT1JNQU5DRV9DT05GSUcudGhyZXNob2xkc1ttZXRyaWNdPy5bbGV2ZWxdIHx8IDBcbn1cblxuLyoqXG4gKiBAZnVuY3Rpb24gaXNQZXJmb3JtYW5jZUhlYWx0aHlcbiAqIEBkZXNjcmlwdGlvbiDmo4Dmn6XmgKfog73mjIfmoIfmmK/lkKblgaXlurdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzUGVyZm9ybWFuY2VIZWFsdGh5KFxuICBzZXJ2aWNlOiBrZXlvZiBTZXJ2aWNlU0xBcyxcbiAgbWV0cmljOiAncmVzcG9uc2VUaW1lJyB8ICdlcnJvclJhdGUnIHwgJ2F2YWlsYWJpbGl0eScsXG4gIHZhbHVlOiBudW1iZXJcbik6IHsgaGVhbHRoeTogYm9vbGVhbjsgbGV2ZWw6ICdoZWFsdGh5JyB8ICd3YXJuaW5nJyB8ICdjcml0aWNhbCcgfCAnZW1lcmdlbmN5JyB9IHtcbiAgY29uc3Qgc2xhID0gZ2V0U0xBVGFyZ2V0KHNlcnZpY2UpXG5cbiAgc3dpdGNoIChtZXRyaWMpIHtcbiAgICBjYXNlICdyZXNwb25zZVRpbWUnOlxuICAgICAgaWYgKHZhbHVlIDw9IHNsYS5yZXNwb25zZVRpbWUucDk1KSByZXR1cm4geyBoZWFsdGh5OiB0cnVlLCBsZXZlbDogJ2hlYWx0aHknIH1cbiAgICAgIGlmICh2YWx1ZSA8PSBnZXRQZXJmb3JtYW5jZVRocmVzaG9sZCgncmVzcG9uc2VUaW1lJywgJ3dhcm5pbmcnKSlcbiAgICAgICAgcmV0dXJuIHsgaGVhbHRoeTogZmFsc2UsIGxldmVsOiAnd2FybmluZycgfVxuICAgICAgaWYgKHZhbHVlIDw9IGdldFBlcmZvcm1hbmNlVGhyZXNob2xkKCdyZXNwb25zZVRpbWUnLCAnY3JpdGljYWwnKSlcbiAgICAgICAgcmV0dXJuIHsgaGVhbHRoeTogZmFsc2UsIGxldmVsOiAnY3JpdGljYWwnIH1cbiAgICAgIHJldHVybiB7IGhlYWx0aHk6IGZhbHNlLCBsZXZlbDogJ2VtZXJnZW5jeScgfVxuXG4gICAgY2FzZSAnZXJyb3JSYXRlJzpcbiAgICAgIGlmICh2YWx1ZSA8PSBzbGEuZXJyb3JSYXRlKSByZXR1cm4geyBoZWFsdGh5OiB0cnVlLCBsZXZlbDogJ2hlYWx0aHknIH1cbiAgICAgIGlmICh2YWx1ZSA8PSBnZXRQZXJmb3JtYW5jZVRocmVzaG9sZCgnZXJyb3JSYXRlJywgJ3dhcm5pbmcnKSlcbiAgICAgICAgcmV0dXJuIHsgaGVhbHRoeTogZmFsc2UsIGxldmVsOiAnd2FybmluZycgfVxuICAgICAgaWYgKHZhbHVlIDw9IGdldFBlcmZvcm1hbmNlVGhyZXNob2xkKCdlcnJvclJhdGUnLCAnY3JpdGljYWwnKSlcbiAgICAgICAgcmV0dXJuIHsgaGVhbHRoeTogZmFsc2UsIGxldmVsOiAnY3JpdGljYWwnIH1cbiAgICAgIHJldHVybiB7IGhlYWx0aHk6IGZhbHNlLCBsZXZlbDogJ2VtZXJnZW5jeScgfVxuXG4gICAgY2FzZSAnYXZhaWxhYmlsaXR5JzpcbiAgICAgIGlmICh2YWx1ZSA+PSBzbGEuYXZhaWxhYmlsaXR5KSByZXR1cm4geyBoZWFsdGh5OiB0cnVlLCBsZXZlbDogJ2hlYWx0aHknIH1cbiAgICAgIGlmICh2YWx1ZSA+PSBzbGEuYXZhaWxhYmlsaXR5IC0gMC4xKSByZXR1cm4geyBoZWFsdGh5OiBmYWxzZSwgbGV2ZWw6ICd3YXJuaW5nJyB9XG4gICAgICBpZiAodmFsdWUgPj0gc2xhLmF2YWlsYWJpbGl0eSAtIDAuNSkgcmV0dXJuIHsgaGVhbHRoeTogZmFsc2UsIGxldmVsOiAnY3JpdGljYWwnIH1cbiAgICAgIHJldHVybiB7IGhlYWx0aHk6IGZhbHNlLCBsZXZlbDogJ2VtZXJnZW5jeScgfVxuXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiB7IGhlYWx0aHk6IHRydWUsIGxldmVsOiAnaGVhbHRoeScgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=