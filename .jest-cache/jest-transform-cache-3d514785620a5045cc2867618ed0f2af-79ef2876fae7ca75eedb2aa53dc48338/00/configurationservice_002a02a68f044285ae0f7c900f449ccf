41db793cb427f9c3864d8a27254f7162
"use strict";
// 文件路径: packages/common-backend/src/config/configuration.service.ts
// 核心理念: 类型安全的配置服务，提供便捷的配置访问接口
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfigurationService = void 0;
const common_1 = require("@nestjs/common");
/**
 * @class ConfigurationService
 * @description 类型安全的配置服务
 * 提供对所有环境变量的类型安全访问
 */
let ConfigurationService = class ConfigurationService {
    constructor(configService) {
        this.configService = configService;
    }
    // --- 数据库配置 ---
    get databaseUrl() {
        return this.configService.get('DATABASE_URL', { infer: true });
    }
    get dbConnectionLimit() {
        return this.configService.get('DB_CONNECTION_LIMIT', { infer: true });
    }
    get dbPoolTimeout() {
        return this.configService.get('DB_POOL_TIMEOUT', { infer: true });
    }
    get dbIdleTimeout() {
        return this.configService.get('DB_IDLE_TIMEOUT', { infer: true });
    }
    // --- Redis 配置 ---
    get redisUrl() {
        return this.configService.get('REDIS_URL', { infer: true });
    }
    get redisHost() {
        return this.configService.get('REDIS_HOST', { infer: true });
    }
    get redisPort() {
        return this.configService.get('REDIS_PORT', { infer: true });
    }
    // --- 加密配置 ---
    get encryptionKey() {
        return this.configService.get('ENCRYPTION_KEY', { infer: true });
    }
    get encryptionSalt() {
        return this.configService.get('ENCRYPTION_SALT', { infer: true });
    }
    get encryptionUseSalt() {
        return this.configService.get('ENCRYPTION_USE_SALT', { infer: true });
    }
    get encryptionAlgorithm() {
        return this.configService.get('ENCRYPTION_ALGORITHM', { infer: true });
    }
    // --- Sentry 配置 ---
    get sentryDsn() {
        return this.configService.get('SENTRY_DSN', { infer: true });
    }
    get sentryEnvironment() {
        return this.configService.get('SENTRY_ENVIRONMENT', { infer: true });
    }
    get sentryTracesSampleRate() {
        return this.configService.get('SENTRY_TRACES_SAMPLE_RATE', { infer: true });
    }
    // --- AI Provider 配置 ---
    get fallbackApiKey() {
        return this.configService.get('FALLBACK_API_KEY', { infer: true });
    }
    get fallbackModelId() {
        return this.configService.get('FALLBACK_MODEL_ID', { infer: true });
    }
    get fallbackBaseUrl() {
        return this.configService.get('FALLBACK_BASE_URL', { infer: true });
    }
    // --- 应用配置 ---
    get nodeEnv() {
        return this.configService.get('NODE_ENV', { infer: true });
    }
    get port() {
        return this.configService.get('PORT', { infer: true });
    }
    get corsOrigin() {
        return this.configService.get('CORS_ORIGIN', { infer: true });
    }
    // --- Qdrant 配置 ---
    get qdrantUrl() {
        return this.configService.get('QDRANT_URL', { infer: true });
    }
    get qdrantApiKey() {
        return this.configService.get('QDRANT_API_KEY', { infer: true });
    }
    // --- Clerk 配置 ---
    get clerkSecretKey() {
        return this.configService.get('CLERK_SECRET_KEY', { infer: true });
    }
    get clerkPublishableKey() {
        return this.configService.get('CLERK_PUBLISHABLE_KEY', { infer: true });
    }
    get clerkWebhookSecretKey() {
        return this.configService.get('CLERK_WEBHOOK_SECRET_KEY', { infer: true });
    }
    // --- RabbitMQ 配置 ---
    get rabbitmqUrl() {
        return this.configService.get('RABBITMQ_URL', { infer: true });
    }
    // --- JWT 配置 ---
    get jwtSecret() {
        return this.configService.get('JWT_SECRET', { infer: true });
    }
    get jwtExpirationSeconds() {
        return this.configService.get('JWT_EXPIRATION_SECONDS', { infer: true });
    }
    // --- 服务端口配置 ---
    get backendGatewayPort() {
        return this.configService.get('BACKEND_GATEWAY_PORT', { infer: true });
    }
    get creationAgentHttpPort() {
        return this.configService.get('CREATION_AGENT_HTTP_PORT', { infer: true });
    }
    get logicAgentHttpPort() {
        return this.configService.get('LOGIC_AGENT_HTTP_PORT', { infer: true });
    }
    get narrativeAgentHttpPort() {
        return this.configService.get('NARRATIVE_AGENT_HTTP_PORT', { infer: true });
    }
    // --- 便捷方法 ---
    get isDevelopment() {
        return this.nodeEnv === 'development';
    }
    get isProduction() {
        return this.nodeEnv === 'production';
    }
    get isTest() {
        return this.nodeEnv === 'test';
    }
    /**
     * 获取配置值，如果未设置则抛出错误
     */
    getOrThrow(key) {
        return this.configService.getOrThrow(key, { infer: true });
    }
    /**
     * 获取配置值，支持默认值
     */
    get(key, defaultValue) {
        return this.configService.get(key, defaultValue, { infer: true });
    }
};
exports.ConfigurationService = ConfigurationService;
exports.ConfigurationService = ConfigurationService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [Function])
], ConfigurationService);
//# sourceMappingURL=configuration.service.js.map