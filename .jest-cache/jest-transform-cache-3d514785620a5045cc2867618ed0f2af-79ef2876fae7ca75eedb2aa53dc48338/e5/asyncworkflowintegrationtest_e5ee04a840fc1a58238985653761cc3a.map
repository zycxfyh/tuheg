{"file":"C:\\Users\\16663\\Desktop\\tuheg\\apps\\vcptoolbox\\src\\integration-tests\\async-workflow-integration.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\16663\\Desktop\\tuheg\\apps\\vcptoolbox\\src\\integration-tests\\async-workflow-integration.test.ts"],"sourcesContent":["// ============================================================================\n// 异步工作流引擎集成测试\n// 验证 VCPToolBox 工作流编排能力的正确集成\n// ============================================================================\n\nimport { ConfigService } from '@nestjs/config'\nimport { Test, type TestingModule } from '@nestjs/testing'\nimport { AsyncWorkflowService } from '../../../../packages/common-backend/src/vcp/async-workflow.service'\n\ndescribe('AsyncWorkflowService Integration', () => {\n  let service: AsyncWorkflowService\n  let configService: ConfigService\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        AsyncWorkflowService,\n        {\n          provide: ConfigService,\n          useValue: {\n            get: jest.fn((key: string, defaultValue?: any) => {\n              const config = {\n                WORKFLOW_MAX_CONCURRENT: 10,\n                WORKFLOW_DEFAULT_TIMEOUT: 300000,\n                WORKFLOW_CLEANUP_INTERVAL: 24,\n                WORKFLOW_STATS_INTERVAL: 5,\n              }\n              return config[key] || defaultValue\n            }),\n          },\n        },\n      ],\n    }).compile()\n\n    service = module.get<AsyncWorkflowService>(AsyncWorkflowService)\n    configService = module.get<ConfigService>(ConfigService)\n  })\n\n  it('应该能获取工作流统计信息', () => {\n    const stats = service.getWorkflowStats()\n\n    expect(stats).toHaveProperty('templates')\n    expect(stats).toHaveProperty('instances')\n    expect(stats).toHaveProperty('runningInstances')\n    expect(stats).toHaveProperty('queuedInstances')\n    expect(stats).toHaveProperty('nodeExecutors')\n    expect(typeof stats.templates).toBe('number')\n  })\n\n  it('应该能执行健康检查', async () => {\n    const health = await service.healthCheck()\n\n    expect(health).toHaveProperty('status')\n    expect(['healthy', 'warning', 'error']).toContain(health.status)\n\n    if (health.status !== 'error') {\n      expect(health).toHaveProperty('details')\n      expect(health.details).toHaveProperty('stats')\n      expect(health.details).toHaveProperty('activeWorkflows')\n    }\n  })\n\n  it('应该能获取工作流性能指标', () => {\n    const metrics = service.getWorkflowMetrics()\n\n    expect(metrics).toHaveProperty('templates')\n    expect(metrics).toHaveProperty('activeWorkflows')\n    expect(metrics).toHaveProperty('averageCompletionTime')\n    expect(metrics).toHaveProperty('successRate')\n    expect(metrics).toHaveProperty('resourceUtilization')\n  })\n\n  it('应该能获取可用模板列表', () => {\n    const templates = service.getAvailableTemplates()\n\n    expect(Array.isArray(templates)).toBe(true)\n    expect(templates.length).toBeGreaterThan(0)\n\n    // 检查是否包含预期的模板\n    const templateNames = templates.map((t) => t.name)\n    expect(templateNames).toContain('故事创作工作流')\n    expect(templateNames).toContain('角色开发工作流')\n    expect(templateNames).toContain('世界构建工作流')\n    expect(templateNames).toContain('多模态叙事工作流')\n\n    templates.forEach((template) => {\n      expect(template).toHaveProperty('id')\n      expect(template).toHaveProperty('name')\n      expect(template).toHaveProperty('description')\n      expect(template).toHaveProperty('tags')\n      expect(Array.isArray(template.tags)).toBe(true)\n    })\n  })\n\n  it('应该能获取模板详情', () => {\n    const templates = service.getAvailableTemplates()\n    const firstTemplate = templates[0]\n\n    const details = service.getTemplateDetails(firstTemplate.id)\n    expect(details).not.toBeNull()\n    expect(details?.id).toBe(firstTemplate.id)\n    expect(details?.name).toBe(firstTemplate.name)\n    expect(details).toHaveProperty('nodes')\n    expect(details).toHaveProperty('connections')\n    expect(details).toHaveProperty('defaultConfig')\n    expect(Array.isArray(details?.nodes)).toBe(true)\n  })\n\n  it('应该能创建故事创作工作流', async () => {\n    const storyId = 'test-story-workflow'\n    const userPrompt = '写一个关于太空探索的故事'\n\n    const workflowId = await service.createStoryCreationWorkflow(storyId, userPrompt, {\n      genre: 'sci-fi',\n      length: 'medium',\n      characters: 3,\n    })\n\n    expect(typeof workflowId).toBe('string')\n    expect(workflowId.length).toBeGreaterThan(0)\n\n    // 验证工作流状态\n    const status = service.getWorkflowStatus(workflowId)\n    expect(status).not.toBeNull()\n    expect(status?.name).toContain('故事创作')\n    expect(status?.status).toBe('running') // 应该自动启动\n  })\n\n  it('应该能创建角色开发工作流', async () => {\n    const characterId = 'test-character-workflow'\n    const characterConcept = '一个勇敢的年轻探险家'\n\n    const workflowId = await service.createCharacterDevelopmentWorkflow(\n      characterId,\n      characterConcept,\n      {\n        archetype: 'hero',\n        complexity: 'detailed',\n      }\n    )\n\n    expect(typeof workflowId).toBe('string')\n\n    const status = service.getWorkflowStatus(workflowId)\n    expect(status).not.toBeNull()\n    expect(status?.name).toContain('角色开发')\n    expect(status?.status).toBe('running')\n  })\n\n  it('应该能创建世界构建工作流', async () => {\n    const worldId = 'test-world-workflow'\n    const worldConcept = '一个魔法与科技并存的奇幻世界'\n\n    const workflowId = await service.createWorldBuildingWorkflow(worldId, worldConcept, {\n      scope: 'large',\n      genre: 'fantasy',\n      technologyLevel: 'magitech',\n      magicLevel: 'high',\n    })\n\n    expect(typeof workflowId).toBe('string')\n\n    const status = service.getWorkflowStatus(workflowId)\n    expect(status).not.toBeNull()\n    expect(status?.name).toContain('世界构建')\n    expect(status?.status).toBe('running')\n  })\n\n  it('应该能创建多模态叙事工作流', async () => {\n    const narrativeId = 'test-multimodal-workflow'\n    const script = '从前有一个勇敢的小孩，他决定探索未知的世界...'\n\n    const workflowId = await service.createMultimodalNarrativeWorkflow(narrativeId, script, [\n      'text',\n      'image',\n      'audio',\n    ])\n\n    expect(typeof workflowId).toBe('string')\n\n    const status = service.getWorkflowStatus(workflowId)\n    expect(status).not.toBeNull()\n    expect(status?.name).toContain('多模态叙事')\n    expect(status?.status).toBe('running')\n  })\n\n  it('应该能管理工作流生命周期', async () => {\n    // 创建一个简单的工作流用于测试\n    const storyId = 'lifecycle-test'\n    const workflowId = await service.createStoryCreationWorkflow(storyId, '测试生命周期')\n\n    // 验证初始状态\n    let status = service.getWorkflowStatus(workflowId)\n    expect(status?.status).toBe('running')\n\n    // 暂停工作流\n    await service.pauseWorkflow(workflowId)\n    status = service.getWorkflowStatus(workflowId)\n    expect(status?.status).toBe('paused')\n\n    // 恢复工作流\n    await service.resumeWorkflow(workflowId)\n    status = service.getWorkflowStatus(workflowId)\n    expect(status?.status).toBe('running')\n\n    // 取消工作流\n    await service.cancelWorkflow(workflowId, '测试取消')\n    status = service.getWorkflowStatus(workflowId)\n    expect(status?.status).toBe('cancelled')\n  })\n\n  it('应该能创建条件分支工作流', async () => {\n    const conditions = [\n      {\n        condition: 'inputData.genre === \"fantasy\"',\n        workflowTemplate: 'story-creation',\n        parameters: { genre: 'fantasy' },\n      },\n      {\n        condition: 'inputData.genre === \"sci-fi\"',\n        workflowTemplate: 'story-creation',\n        parameters: { genre: 'sci-fi' },\n      },\n    ]\n\n    const workflowId = await service.createConditionalWorkflow('条件故事创作', conditions)\n\n    expect(typeof workflowId).toBe('string')\n\n    const status = service.getWorkflowStatus(workflowId)\n    expect(status).not.toBeNull()\n    expect(status?.name).toContain('条件工作流')\n  })\n\n  it('应该能获取活跃工作流列表', () => {\n    const activeWorkflows = service.getActiveWorkflows()\n    expect(Array.isArray(activeWorkflows)).toBe(true)\n    // 当前实现可能返回空数组，取决于实际运行的工作流\n  })\n\n  it('应该能清理已完成的工作流', async () => {\n    const cleaned = await service.cleanupCompletedWorkflows(0) // 清理所有已完成的\n    expect(typeof cleaned).toBe('number')\n    expect(cleaned).toBeGreaterThanOrEqual(0)\n  })\n\n  it('应该能创建基于模板的工作流实例', async () => {\n    const templates = service.getAvailableTemplates()\n    const storyTemplate = templates.find((t) => t.name === '故事创作工作流')\n\n    expect(storyTemplate).toBeDefined()\n\n    const workflowId = await service.createWorkflowFromTemplate(\n      'story-creation',\n      '基于模板的故事',\n      {\n        priority: 'high',\n        inputData: { customPrompt: '测试模板实例化' },\n      }\n    )\n\n    expect(typeof workflowId).toBe('string')\n\n    const status = service.getWorkflowStatus(workflowId)\n    expect(status).not.toBeNull()\n    expect(status?.name).toBe('基于模板的故事')\n  })\n\n  it('应该能创建自定义工作流', async () => {\n    const customTemplate = {\n      name: '自定义测试工作流',\n      description: '用于测试的简单工作流',\n      version: '1.0.0',\n      nodes: [\n        {\n          id: 'start-node',\n          type: 'task' as const,\n          name: '开始任务',\n          description: '工作流的起始任务',\n          config: { taskType: 'test' },\n          inputs: [],\n          outputs: [{ id: 'start-out', sourceNodeId: 'start-node', targetNodeId: 'end-node' }],\n          status: 'pending' as const,\n          retryCount: 0,\n          maxRetries: 1,\n          timeout: 30000,\n        },\n        {\n          id: 'end-node',\n          type: 'task' as const,\n          name: '结束任务',\n          description: '工作流的结束任务',\n          config: { taskType: 'test' },\n          inputs: [{ id: 'end-in', sourceNodeId: 'start-node', targetNodeId: 'end-node' }],\n          outputs: [],\n          status: 'pending' as const,\n          retryCount: 0,\n          maxRetries: 1,\n          timeout: 30000,\n          dependencies: ['start-node'],\n        },\n      ],\n      connections: [],\n      defaultConfig: {\n        maxRetries: 1,\n        timeout: 60000,\n        priority: 'normal' as const,\n      },\n      tags: ['test', 'custom'],\n    }\n\n    const workflowId = await service.createCustomWorkflow(customTemplate, '自定义工作流测试')\n\n    expect(typeof workflowId).toBe('string')\n\n    const status = service.getWorkflowStatus(workflowId)\n    expect(status).not.toBeNull()\n    expect(status?.name).toBe('自定义工作流测试')\n  })\n\n  it('应该正确配置工作流参数', () => {\n    expect(configService.get).toHaveBeenCalledWith('WORKFLOW_MAX_CONCURRENT', 10)\n    expect(configService.get).toHaveBeenCalledWith('WORKFLOW_DEFAULT_TIMEOUT', 300000)\n  })\n})\n"],"version":3}