{"file":"C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\validation\\__tests__\\enhanced-validator.spec.ts","mappings":"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","names":[],"sources":["C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\validation\\__tests__\\enhanced-validator.spec.ts"],"sourcesContent":["// 文件路径: packages/common-backend/src/validation/enhanced-validator.spec.ts\n// 测试增强验证器的功能\n\nimport { z } from 'zod'\nimport { EnhancedValidator } from './enhanced-validator.ts'\n\ndescribe('EnhancedValidator', () => {\n  describe('validate', () => {\n    it('应该成功验证有效数据', () => {\n      const schema = z.object({\n        name: z.string().min(3),\n        age: z.number().min(0),\n      })\n\n      const result = EnhancedValidator.validate(schema, {\n        name: 'John Doe',\n        age: 25,\n      })\n\n      expect(result.success).toBe(true)\n      expect(result.data).toEqual({ name: 'John Doe', age: 25 })\n      expect(result.errors).toBeUndefined()\n    })\n\n    it('应该返回友好的错误消息', () => {\n      const schema = z.object({\n        name: z.string().min(3),\n        age: z.number().min(0),\n      })\n\n      const result = EnhancedValidator.validate(schema, {\n        name: 'Jo',\n        age: -1,\n      })\n\n      expect(result.success).toBe(false)\n      expect(result.errors).toBeDefined()\n      expect(result.errors?.length).toBeGreaterThan(0)\n\n      // 检查错误消息是否友好\n      const nameError = result.errors?.find((e) => e.path.includes('name'))\n      expect(nameError?.message).toContain('字符串长度至少为')\n    })\n\n    it('应该处理类型错误', () => {\n      const schema = z.object({\n        email: z.string().email(),\n      })\n\n      const result = EnhancedValidator.validate(schema, {\n        email: 123,\n      })\n\n      expect(result.success).toBe(false)\n      expect(result.errors).toBeDefined()\n\n      const emailError = result.errors?.find((e) => e.path.includes('email'))\n      expect(emailError?.code).toBe('invalid_type')\n      expect(emailError?.expected).toBe('string')\n    })\n  })\n\n  describe('safeParse', () => {\n    it('应该安全解析数据', () => {\n      const schema = z.object({\n        value: z.string(),\n      })\n\n      const result = EnhancedValidator.safeParse(schema, { value: 'test' })\n\n      expect(result.success).toBe(true)\n      expect(result.data).toEqual({ value: 'test' })\n    })\n\n    it('应该在不抛出异常的情况下处理错误', () => {\n      const schema = z.object({\n        value: z.string(),\n      })\n\n      const result = EnhancedValidator.safeParse(schema, { value: 123 })\n\n      expect(result.success).toBe(false)\n      expect(result.errors).toBeDefined()\n    })\n  })\n\n  describe('formatErrorsAsString', () => {\n    it('应该格式化错误为字符串', () => {\n      const schema = z.object({\n        name: z.string().min(3),\n        age: z.number().min(0),\n      })\n\n      const result = EnhancedValidator.validate(schema, {\n        name: 'Jo',\n        age: -1,\n      })\n\n      if (!result.success && result.errors) {\n        const formatted = EnhancedValidator.formatErrorsAsString(result.errors)\n        expect(formatted).toContain('name')\n        expect(formatted).toContain('age')\n      }\n    })\n  })\n})\n"],"version":3}