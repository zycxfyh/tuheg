f39c22ddc4685ad908ec3872b47dd8d0
"use strict";
// 文件路径: packages/common-backend/src/observability/sentry.config.ts
// 核心理念: 增强的错误追踪和性能监控配置
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.configureSentry = configureSentry;
exports.setSentryUser = setSentryUser;
exports.setSentryContext = setSentryContext;
exports.setSentryTag = setSentryTag;
exports.captureException = captureException;
exports.captureMessage = captureMessage;
const Sentry = __importStar(require("@sentry/node"));
/**
 * @function configureSentry
 * @description 配置 Sentry，增强错误追踪和性能监控
 *
 * @example
 * ```typescript
 * configureSentry({
 *   environment: 'production',
 *   release: '1.0.0',
 *   enablePerformanceMonitoring: true,
 *   tags: {
 *     service: 'backend-gateway',
 *   },
 * });
 * ```
 */
function configureSentry(options = {}) {
    const { environment = process.env.NODE_ENV || 'development', release = process.env.APP_VERSION || '1.0.0', dsn = process.env.SENTRY_DSN, tracesSampleRate = environment === 'production' ? 0.1 : 1.0, profilesSampleRate = environment === 'production' ? 0.1 : 1.0, enablePerformanceMonitoring = true, tags = {}, ignoreErrors = [
        // 忽略常见的网络错误
        'NetworkError',
        'Network request failed',
        // 忽略已知的第三方库错误
        'ResizeObserver loop limit exceeded',
    ], } = options;
    if (!dsn) {
        console.warn('Sentry DSN not configured, skipping Sentry initialization');
        return;
    }
    const sentryOptions = {
        dsn,
        environment,
        release,
        tracesSampleRate,
        profilesSampleRate: enablePerformanceMonitoring ? profilesSampleRate : 0,
        // 忽略的错误
        ignoreErrors,
        // 自定义标签
        initialScope: {
            tags: {
                ...tags,
                environment,
                release,
            },
        },
        // 性能监控配置
        integrations: [
            // HTTP 请求追踪
            Sentry.httpIntegration(),
            // Express 追踪
            Sentry.expressIntegration(),
        ],
        // 在开发环境中启用调试
        debug: environment === 'development',
        // 自动会话追踪
        autoSessionTracking: true,
        // 发送默认 PII（个人可识别信息）
        sendDefaultPii: false,
    };
    Sentry.init(sentryOptions);
    console.log(`Sentry initialized for environment: ${environment}, release: ${release}`);
}
/**
 * @function setSentryUser
 * @description 设置 Sentry 用户上下文
 */
function setSentryUser(user) {
    Sentry.setUser({
        id: user.id,
        email: user.email,
        username: user.username,
    });
}
/**
 * @function setSentryContext
 * @description 设置 Sentry 上下文
 */
function setSentryContext(key, context) {
    Sentry.setContext(key, context);
}
/**
 * @function setSentryTag
 * @description 设置 Sentry 标签
 */
function setSentryTag(key, value) {
    Sentry.setTag(key, value);
}
/**
 * @function captureException
 * @description 捕获异常（增强版）
 */
function captureException(error, context) {
    if (context?.tags) {
        for (const [key, value] of Object.entries(context.tags)) {
            Sentry.setTag(key, value);
        }
    }
    if (context?.extra) {
        Sentry.setExtra('context', context.extra);
    }
    if (context?.user) {
        setSentryUser(context.user);
    }
    Sentry.captureException(error);
}
/**
 * @function captureMessage
 * @description 捕获消息（增强版）
 */
function captureMessage(message, level = 'info', context) {
    if (context?.tags) {
        for (const [key, value] of Object.entries(context.tags)) {
            Sentry.setTag(key, value);
        }
    }
    if (context?.extra) {
        Sentry.setExtra('context', context.extra);
    }
    Sentry.captureMessage(message, level);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFxvYnNlcnZhYmlsaXR5XFxzZW50cnkuY29uZmlnLnRzIiwibWFwcGluZ3MiOiI7QUFBQSxtRUFBbUU7QUFDbkUsdUJBQXVCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTRDdkIsMENBeURDO0FBTUQsc0NBTUM7QUFNRCw0Q0FFQztBQU1ELG9DQUVDO0FBTUQsNENBdUJDO0FBTUQsd0NBbUJDO0FBckxELHFEQUFzQztBQTBCdEM7Ozs7Ozs7Ozs7Ozs7OztHQWVHO0FBQ0gsU0FBZ0IsZUFBZSxDQUFDLFVBQStCLEVBQUU7SUFDL0QsTUFBTSxFQUNKLFdBQVcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsSUFBSSxhQUFhLEVBQ25ELE9BQU8sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsSUFBSSxPQUFPLEVBQzVDLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFDNUIsZ0JBQWdCLEdBQUcsV0FBVyxLQUFLLFlBQVksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQzNELGtCQUFrQixHQUFHLFdBQVcsS0FBSyxZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUM3RCwyQkFBMkIsR0FBRyxJQUFJLEVBQ2xDLElBQUksR0FBRyxFQUFFLEVBQ1QsWUFBWSxHQUFHO1FBQ2IsWUFBWTtRQUNaLGNBQWM7UUFDZCx3QkFBd0I7UUFDeEIsY0FBYztRQUNkLG9DQUFvQztLQUNyQyxHQUNGLEdBQUcsT0FBTyxDQUFBO0lBRVgsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ1QsT0FBTyxDQUFDLElBQUksQ0FBQywyREFBMkQsQ0FBQyxDQUFBO1FBQ3pFLE9BQU07SUFDUixDQUFDO0lBRUQsTUFBTSxhQUFhLEdBQWdCO1FBQ2pDLEdBQUc7UUFDSCxXQUFXO1FBQ1gs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SUFDM0MsQ0FBQztJQUVELE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFBO0FBQ3ZDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFxvYnNlcnZhYmlsaXR5XFxzZW50cnkuY29uZmlnLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIOaWh+S7tui3r+W+hDogcGFja2FnZXMvY29tbW9uLWJhY2tlbmQvc3JjL29ic2VydmFiaWxpdHkvc2VudHJ5LmNvbmZpZy50c1xuLy8g5qC45b+D55CG5b+1OiDlop7lvLrnmoTplJnor6/ov73ouKrlkozmgKfog73nm5HmjqfphY3nva5cblxuaW1wb3J0ICogYXMgU2VudHJ5IGZyb20gJ0BzZW50cnkvbm9kZSdcbmltcG9ydCB0eXBlIHsgTm9kZU9wdGlvbnMgfSBmcm9tICdAc2VudHJ5L25vZGUnXG5cbi8qKlxuICogQGludGVyZmFjZSBTZW50cnlDb25maWdPcHRpb25zXG4gKiBAZGVzY3JpcHRpb24gU2VudHJ5IOmFjee9rumAiemhuVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNlbnRyeUNvbmZpZ09wdGlvbnMge1xuICAvKiog546v5aKD5ZCN56ewICovXG4gIGVudmlyb25tZW50Pzogc3RyaW5nXG4gIC8qKiDlj5HluIPniYjmnKwgKi9cbiAgcmVsZWFzZT86IHN0cmluZ1xuICAvKiogRFNOICovXG4gIGRzbj86IHN0cmluZ1xuICAvKiog6YeH5qC3546HICovXG4gIHRyYWNlc1NhbXBsZVJhdGU/OiBudW1iZXJcbiAgLyoqIOaAp+iDveebkeaOp+mHh+agt+eOhyAqL1xuICBwcm9maWxlc1NhbXBsZVJhdGU/OiBudW1iZXJcbiAgLyoqIOaYr+WQpuWQr+eUqOaAp+iDveebkeaOpyAqL1xuICBlbmFibGVQZXJmb3JtYW5jZU1vbml0b3Jpbmc/OiBib29sZWFuXG4gIC8qKiDoh6rlrprkuYnmoIfnrb4gKi9cbiAgdGFncz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz5cbiAgLyoqIOW/veeVpeeahOmUmeivryAqL1xuICBpZ25vcmVFcnJvcnM/OiBzdHJpbmdbXVxufVxuXG4vKipcbiAqIEBmdW5jdGlvbiBjb25maWd1cmVTZW50cnlcbiAqIEBkZXNjcmlwdGlvbiDphY3nva4gU2VudHJ577yM5aKe5by66ZSZ6K+v6L+96Liq5ZKM5oCn6IO955uR5o6nXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGNvbmZpZ3VyZVNlbnRyeSh7XG4gKiAgIGVudmlyb25tZW50OiAncHJvZHVjdGlvbicsXG4gKiAgIHJlbGVhc2U6ICcxLjAuMCcsXG4gKiAgIGVuYWJsZVBlcmZvcm1hbmNlTW9uaXRvcmluZzogdHJ1ZSxcbiAqICAgdGFnczoge1xuICogICAgIHNlcnZpY2U6ICdiYWNrZW5kLWdhdGV3YXknLFxuICogICB9LFxuICogfSk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbmZpZ3VyZVNlbnRyeShvcHRpb25zOiBTZW50cnlDb25maWdPcHRpb25zID0ge30pOiB2b2lkIHtcbiAgY29uc3Qge1xuICAgIGVudmlyb25tZW50ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgfHwgJ2RldmVsb3BtZW50JyxcbiAgICByZWxlYXNlID0gcHJvY2Vzcy5lbnYuQVBQX1ZFUlNJT04gfHwgJzEuMC4wJyxcbiAgICBkc24gPSBwcm9jZXNzLmVudi5TRU5UUllfRFNOLFxuICAgIHRyYWNlc1NhbXBsZVJhdGUgPSBlbnZpcm9ubWVudCA9PT0gJ3Byb2R1Y3Rpb24nID8gMC4xIDogMS4wLFxuICAgIHByb2ZpbGVzU2FtcGxlUmF0ZSA9IGVudmlyb25tZW50ID09PSAncHJvZHVjdGlvbicgPyAwLjEgOiAxLjAsXG4gICAgZW5hYmxlUGVyZm9ybWFuY2VNb25pdG9yaW5nID0gdHJ1ZSxcbiAgICB0YWdzID0ge30sXG4gICAgaWdub3JlRXJyb3JzID0gW1xuICAgICAgLy8g5b+955Wl5bi46KeB55qE572R57uc6ZSZ6K+vXG4gICAgICAnTmV0d29ya0Vycm9yJyxcbiAgICAgICdOZXR3b3JrIHJlcXVlc3QgZmFpbGVkJyxcbiAgICAgIC8vIOW/veeVpeW3suefpeeahOesrOS4ieaWueW6k+mUmeivr1xuICAgICAgJ1Jlc2l6ZU9ic2VydmVyIGxvb3AgbGltaXQgZXhjZWVkZWQnLFxuICAgIF0sXG4gIH0gPSBvcHRpb25zXG5cbiAgaWYgKCFkc24pIHtcbiAgICBjb25zb2xlLndhcm4oJ1NlbnRyeSBEU04gbm90IGNvbmZpZ3VyZWQsIHNraXBwaW5nIFNlbnRyeSBpbml0aWFsaXphdGlvbicpXG4gICAgcmV0dXJuXG4gIH1cblxuICBjb25zdCBzZW50cnlPcHRpb25zOiBOb2RlT3B0aW9ucyA9IHtcbiAgICBkc24sXG4gICAgZW52aXJvbm1lbnQsXG4gICAgcmVsZWFzZSxcbiAgICB0cmFjZXNTYW1wbGVSYXRlLFxuICAgIHByb2ZpbGVzU2FtcGxlUmF0ZTogZW5hYmxlUGVyZm9ybWFuY2VNb25pdG9yaW5nID8gcHJvZmlsZXNTYW1wbGVSYXRlIDogMCxcbiAgICAvLyDlv73nlaXnmoTplJnor69cbiAgICBpZ25vcmVFcnJvcnMsXG4gICAgLy8g6Ieq5a6a5LmJ5qCH562+XG4gICAgaW5pdGlhbFNjb3BlOiB7XG4gICAgICB0YWdzOiB7XG4gICAgICAgIC4uLnRhZ3MsXG4gICAgICAgIGVudmlyb25tZW50LFxuICAgICAgICByZWxlYXNlLFxuICAgICAgfSxcbiAgICB9LFxuICAgIC8vIOaAp+iDveebkeaOp+mFjee9rlxuICAgIGludGVncmF0aW9uczogW1xuICAgICAgLy8gSFRUUCDor7fmsYLov73ouKpcbiAgICAgIFNlbnRyeS5odHRwSW50ZWdyYXRpb24oKSxcbiAgICAgIC8vIEV4cHJlc3Mg6L+96LiqXG4gICAgICBTZW50cnkuZXhwcmVzc0ludGVncmF0aW9uKCksXG4gICAgXSxcbiAgICAvLyDlnKjlvIDlj5Hnjq/looPkuK3lkK/nlKjosIPor5VcbiAgICBkZWJ1ZzogZW52aXJvbm1lbnQgPT09ICdkZXZlbG9wbWVudCcsXG4gICAgLy8g6Ieq5Yqo5Lya6K+d6L+96LiqXG4gICAgYXV0b1Nlc3Npb25UcmFja2luZzogdHJ1ZSxcbiAgICAvLyDlj5HpgIHpu5jorqQgUElJ77yI5Liq5Lq65Y+v6K+G5Yir5L+h5oGv77yJXG4gICAgc2VuZERlZmF1bHRQaWk6IGZhbHNlLFxuICB9XG5cbiAgU2VudHJ5LmluaXQoc2VudHJ5T3B0aW9ucylcblxuICBjb25zb2xlLmxvZyhgU2VudHJ5IGluaXRpYWxpemVkIGZvciBlbnZpcm9ubWVudDogJHtlbnZpcm9ubWVudH0sIHJlbGVhc2U6ICR7cmVsZWFzZX1gKVxufVxuXG4vKipcbiAqIEBmdW5jdGlvbiBzZXRTZW50cnlVc2VyXG4gKiBAZGVzY3JpcHRpb24g6K6+572uIFNlbnRyeSDnlKjmiLfkuIrkuIvmlodcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldFNlbnRyeVVzZXIodXNlcjogeyBpZDogc3RyaW5nOyBlbWFpbD86IHN0cmluZzsgdXNlcm5hbWU/OiBzdHJpbmcgfSk6IHZvaWQge1xuICBTZW50cnkuc2V0VXNlcih7XG4gICAgaWQ6IHVzZXIuaWQsXG4gICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgdXNlcm5hbWU6IHVzZXIudXNlcm5hbWUsXG4gIH0pXG59XG5cbi8qKlxuICogQGZ1bmN0aW9uIHNldFNlbnRyeUNvbnRleHRcbiAqIEBkZXNjcmlwdGlvbiDorr7nva4gU2VudHJ5IOS4iuS4i+aWh1xuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0U2VudHJ5Q29udGV4dChrZXk6IHN0cmluZywgY29udGV4dDogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiB2b2lkIHtcbiAgU2VudHJ5LnNldENvbnRleHQoa2V5LCBjb250ZXh0KVxufVxuXG4vKipcbiAqIEBmdW5jdGlvbiBzZXRTZW50cnlUYWdcbiAqIEBkZXNjcmlwdGlvbiDorr7nva4gU2VudHJ5IOagh+etvlxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0U2VudHJ5VGFnKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKTogdm9pZCB7XG4gIFNlbnRyeS5zZXRUYWcoa2V5LCB2YWx1ZSlcbn1cblxuLyoqXG4gKiBAZnVuY3Rpb24gY2FwdHVyZUV4Y2VwdGlvblxuICogQGRlc2NyaXB0aW9uIOaNleiOt+W8guW4uO+8iOWinuW8uueJiO+8iVxuICovXG5leHBvcnQgZnVuY3Rpb24gY2FwdHVyZUV4Y2VwdGlvbihcbiAgZXJyb3I6IEVycm9yLFxuICBjb250ZXh0Pzoge1xuICAgIHRhZ3M/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+XG4gICAgZXh0cmE/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuICAgIHVzZXI/OiB7IGlkOiBzdHJpbmc7IGVtYWlsPzogc3RyaW5nIH1cbiAgfVxuKTogdm9pZCB7XG4gIGlmIChjb250ZXh0Py50YWdzKSB7XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoY29udGV4dC50YWdzKSkge1xuICAgICAgU2VudHJ5LnNldFRhZyhrZXksIHZhbHVlKVxuICAgIH1cbiAgfVxuXG4gIGlmIChjb250ZXh0Py5leHRyYSkge1xuICAgIFNlbnRyeS5zZXRFeHRyYSgnY29udGV4dCcsIGNvbnRleHQuZXh0cmEpXG4gIH1cblxuICBpZiAoY29udGV4dD8udXNlcikge1xuICAgIHNldFNlbnRyeVVzZXIoY29udGV4dC51c2VyKVxuICB9XG5cbiAgU2VudHJ5LmNhcHR1cmVFeGNlcHRpb24oZXJyb3IpXG59XG5cbi8qKlxuICogQGZ1bmN0aW9uIGNhcHR1cmVNZXNzYWdlXG4gKiBAZGVzY3JpcHRpb24g5o2V6I635raI5oGv77yI5aKe5by654mI77yJXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYXB0dXJlTWVzc2FnZShcbiAgbWVzc2FnZTogc3RyaW5nLFxuICBsZXZlbDogU2VudHJ5LlNldmVyaXR5TGV2ZWwgPSAnaW5mbycsXG4gIGNvbnRleHQ/OiB7XG4gICAgdGFncz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz5cbiAgICBleHRyYT86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4gIH1cbik6IHZvaWQge1xuICBpZiAoY29udGV4dD8udGFncykge1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGNvbnRleHQudGFncykpIHtcbiAgICAgIFNlbnRyeS5zZXRUYWcoa2V5LCB2YWx1ZSlcbiAgICB9XG4gIH1cblxuICBpZiAoY29udGV4dD8uZXh0cmEpIHtcbiAgICBTZW50cnkuc2V0RXh0cmEoJ2NvbnRleHQnLCBjb250ZXh0LmV4dHJhKVxuICB9XG5cbiAgU2VudHJ5LmNhcHR1cmVNZXNzYWdlKG1lc3NhZ2UsIGxldmVsKVxufVxuIl0sInZlcnNpb24iOjN9