bb6f1b6aa2b67f0dd7fdf86fc95ac8a0
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const common_1 = require("@nestjs/common");
const testing_1 = require("@nestjs/testing");
const jest_mock_extended_1 = require("jest-mock-extended");
const auth_controller_1 = require("./auth.controller");
const auth_service_1 = require("./auth.service");
describe('AuthController', () => {
    let controller;
    let authServiceMock;
    const mockUser = {
        id: 'user-123',
        email: 'test@example.com',
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    const mockLoginResponse = {
        access_token: 'jwt-token-here',
    };
    beforeEach(async () => {
        authServiceMock = (0, jest_mock_extended_1.mockDeep)();
        const module = await testing_1.Test.createTestingModule({
            controllers: [auth_controller_1.AuthController],
            providers: [
                {
                    provide: auth_service_1.AuthService,
                    useValue: authServiceMock,
                },
            ],
        }).compile();
        controller = module.get(auth_controller_1.AuthController);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('register', () => {
        const registerDto = {
            email: 'test@example.com',
            password: 'password123',
        };
        it('should register a new user successfully', async () => {
            authServiceMock.register.mockResolvedValue(mockUser);
            const result = await controller.register(registerDto);
            expect(authServiceMock.register).toHaveBeenCalledWith(registerDto);
            expect(result).toEqual(mockUser);
        });
        it('should throw ConflictException when email already exists', async () => {
            const conflictError = new common_1.ConflictException('Email already registered.');
            authServiceMock.register.mockRejectedValue(conflictError);
            await expect(controller.register(registerDto)).rejects.toThrow(common_1.ConflictException);
            expect(authServiceMock.register).toHaveBeenCalledWith(registerDto);
        });
    });
    describe('login', () => {
        const loginDto = {
            email: 'test@example.com',
            password: 'password123',
        };
        it('should login user successfully', async () => {
            authServiceMock.login.mockResolvedValue(mockLoginResponse);
            const result = await controller.login(loginDto);
            expect(authServiceMock.login).toHaveBeenCalledWith(loginDto);
            expect(result).toEqual(mockLoginResponse);
        });
        it('should throw UnauthorizedException for invalid credentials', async () => {
            const unauthorizedError = new common_1.UnauthorizedException('Invalid credentials.');
            authServiceMock.login.mockRejectedValue(unauthorizedError);
            await expect(controller.login(loginDto)).rejects.toThrow(common_1.UnauthorizedException);
            expect(authServiceMock.login).toHaveBeenCalledWith(loginDto);
        });
    });
    describe('getProfile', () => {
        it('should return user profile from request', () => {
            const mockRequest = {
                user: mockUser,
            };
            const result = controller.getProfile(mockRequest);
            expect(result).toEqual(mockUser);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXGFwcHNcXGJhY2tlbmQtZ2F0ZXdheVxcc3JjXFxhdXRoXFxfX3Rlc3RzX19cXGF1dGguY29udHJvbGxlci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsMkNBQXlFO0FBQ3pFLDZDQUEwRDtBQUMxRCwyREFBaUU7QUFDakUsdURBQWtEO0FBQ2xELGlEQUE0QztBQUU1QyxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO0lBQzlCLElBQUksVUFBMEIsQ0FBQTtJQUM5QixJQUFJLGVBQTJDLENBQUE7SUFFL0MsTUFBTSxRQUFRLEdBQUc7UUFDZixFQUFFLEVBQUUsVUFBVTtRQUNkLEtBQUssRUFBRSxrQkFBa0I7UUFDekIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO1FBQ3JCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRTtLQUN0QixDQUFBO0lBRUQsTUFBTSxpQkFBaUIsR0FBRztRQUN4QixZQUFZLEVBQUUsZ0JBQWdCO0tBQy9CLENBQUE7SUFFRCxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsZUFBZSxHQUFHLElBQUEsNkJBQVEsR0FBZSxDQUFBO1FBRXpDLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxXQUFXLEVBQUUsQ0FBQyxnQ0FBYyxDQUFDO1lBQzdCLFNBQVMsRUFBRTtnQkFDVDtvQkFDRSxPQUFPLEVBQUUsMEJBQVc7b0JBQ3BCLFFBQVEsRUFBRSxlQUFlO2lCQUMxQjthQUNGO1NBQ0YsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFBO1FBRVosVUFBVSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQWlCLGdDQUFjLENBQUMsQ0FBQTtJQUN6RCxDQUFDLENBQUMsQ0FBQTtJQUVGLFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUE7SUFDdEIsQ0FBQyxDQUFDLENBQUE7SUFFRixRQUFRLENBQUMsVUFBVSxFQUFFLEdBQUcs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QUMsQ0FBQyxDQUFBIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcMTY2NjNcXERlc2t0b3BcXHR1aGVnXFxhcHBzXFxiYWNrZW5kLWdhdGV3YXlcXHNyY1xcYXV0aFxcX190ZXN0c19fXFxhdXRoLmNvbnRyb2xsZXIuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb25mbGljdEV4Y2VwdGlvbiwgVW5hdXRob3JpemVkRXhjZXB0aW9uIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nXG5pbXBvcnQgeyBUZXN0LCB0eXBlIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnXG5pbXBvcnQgeyB0eXBlIERlZXBNb2NrUHJveHksIG1vY2tEZWVwIH0gZnJvbSAnamVzdC1tb2NrLWV4dGVuZGVkJ1xuaW1wb3J0IHsgQXV0aENvbnRyb2xsZXIgfSBmcm9tICcuL2F1dGguY29udHJvbGxlcidcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnLi9hdXRoLnNlcnZpY2UnXG5cbmRlc2NyaWJlKCdBdXRoQ29udHJvbGxlcicsICgpID0+IHtcbiAgbGV0IGNvbnRyb2xsZXI6IEF1dGhDb250cm9sbGVyXG4gIGxldCBhdXRoU2VydmljZU1vY2s6IERlZXBNb2NrUHJveHk8QXV0aFNlcnZpY2U+XG5cbiAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgaWQ6ICd1c2VyLTEyMycsXG4gICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICB9XG5cbiAgY29uc3QgbW9ja0xvZ2luUmVzcG9uc2UgPSB7XG4gICAgYWNjZXNzX3Rva2VuOiAnand0LXRva2VuLWhlcmUnLFxuICB9XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgYXV0aFNlcnZpY2VNb2NrID0gbW9ja0RlZXA8QXV0aFNlcnZpY2U+KClcblxuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBjb250cm9sbGVyczogW0F1dGhDb250cm9sbGVyXSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQXV0aFNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IGF1dGhTZXJ2aWNlTW9jayxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpXG5cbiAgICBjb250cm9sbGVyID0gbW9kdWxlLmdldDxBdXRoQ29udHJvbGxlcj4oQXV0aENvbnRyb2xsZXIpXG4gIH0pXG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKVxuICB9KVxuXG4gIGRlc2NyaWJlKCdyZWdpc3RlcicsICgpID0+IHtcbiAgICBjb25zdCByZWdpc3RlckR0byA9IHtcbiAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICBwYXNzd29yZDogJ3Bhc3N3b3JkMTIzJyxcbiAgICB9XG5cbiAgICBpdCgnc2hvdWxkIHJlZ2lzdGVyIGEgbmV3IHVzZXIgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXV0aFNlcnZpY2VNb2NrLnJlZ2lzdGVyLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnJlZ2lzdGVyKHJlZ2lzdGVyRHRvKVxuXG4gICAgICBleHBlY3QoYXV0aFNlcnZpY2VNb2NrLnJlZ2lzdGVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChyZWdpc3RlckR0bylcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1VzZXIpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgQ29uZmxpY3RFeGNlcHRpb24gd2hlbiBlbWFpbCBhbHJlYWR5IGV4aXN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZsaWN0RXJyb3IgPSBuZXcgQ29uZmxpY3RFeGNlcHRpb24oJ0VtYWlsIGFscmVhZHkgcmVnaXN0ZXJlZC4nKVxuICAgICAgYXV0aFNlcnZpY2VNb2NrLnJlZ2lzdGVyLm1vY2tSZWplY3RlZFZhbHVlKGNvbmZsaWN0RXJyb3IpXG5cbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLnJlZ2lzdGVyKHJlZ2lzdGVyRHRvKSkucmVqZWN0cy50b1Rocm93KENvbmZsaWN0RXhjZXB0aW9uKVxuICAgICAgZXhwZWN0KGF1dGhTZXJ2aWNlTW9jay5yZWdpc3RlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgocmVnaXN0ZXJEdG8pXG4gICAgfSlcbiAgfSlcblxuICBkZXNjcmliZSgnbG9naW4nLCAoKSA9PiB7XG4gICAgY29uc3QgbG9naW5EdG8gPSB7XG4gICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZDEyMycsXG4gICAgfVxuXG4gICAgaXQoJ3Nob3VsZCBsb2dpbiB1c2VyIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF1dGhTZXJ2aWNlTW9jay5sb2dpbi5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTG9naW5SZXNwb25zZSlcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5sb2dpbihsb2dpbkR0bylcblxuICAgICAgZXhwZWN0KGF1dGhTZXJ2aWNlTW9jay5sb2dpbikudG9IYXZlQmVlbkNhbGxlZFdpdGgobG9naW5EdG8pXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tMb2dpblJlc3BvbnNlKVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIHRocm93IFVuYXV0aG9yaXplZEV4Y2VwdGlvbiBmb3IgaW52YWxpZCBjcmVkZW50aWFscycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVuYXV0aG9yaXplZEVycm9yID0gbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbignSW52YWxpZCBjcmVkZW50aWFscy4nKVxuICAgICAgYXV0aFNlcnZpY2VNb2NrLmxvZ2luLm1vY2tSZWplY3RlZFZhbHVlKHVuYXV0aG9yaXplZEVycm9yKVxuXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5sb2dpbihsb2dpbkR0bykpLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFeGNlcHRpb24pXG4gICAgICBleHBlY3QoYXV0aFNlcnZpY2VNb2NrLmxvZ2luKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChsb2dpbkR0bylcbiAgICB9KVxuICB9KVxuXG4gIGRlc2NyaWJlKCdnZXRQcm9maWxlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHVzZXIgcHJvZmlsZSBmcm9tIHJlcXVlc3QnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgdXNlcjogbW9ja1VzZXIsXG4gICAgICB9IGFzIGFueVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBjb250cm9sbGVyLmdldFByb2ZpbGUobW9ja1JlcXVlc3QpXG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1VzZXIpXG4gICAgfSlcbiAgfSlcbn0pXG4iXSwidmVyc2lvbiI6M30=