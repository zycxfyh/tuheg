{"file":"C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\config\\env.schema.ts","mappings":"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","names":[],"sources":["C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\config\\env.schema.ts"],"sourcesContent":["// 文件路径: packages/common-backend/src/config/env.schema.ts\n// 核心理念: 类型安全的环境变量验证，启动时验证所有配置\n\nimport { z } from 'zod'\n\n/**\n * @description 环境变量 Schema\n * 使用 Zod 验证所有环境变量，确保类型安全和配置完整\n */\nexport const envSchema = z.object({\n  // 数据库配置\n  DATABASE_URL: z.string().url('DATABASE_URL 必须是有效的 URL'),\n  // 数据库连接池配置\n  DB_CONNECTION_LIMIT: z.coerce.number().int().min(1).max(100).default(20),\n  DB_POOL_TIMEOUT: z.coerce.number().int().min(1).max(300).default(20), // 秒\n  DB_IDLE_TIMEOUT: z.coerce.number().int().min(1).max(3600).default(300), // 秒\n\n  // Redis 配置\n  REDIS_URL: z.string().url('REDIS_URL 必须是有效的 URL').optional(),\n  REDIS_HOST: z.string().default('localhost'),\n  REDIS_PORT: z.coerce.number().int().positive().default(6379),\n\n  // 加密配置\n  ENCRYPTION_KEY: z.string().min(32, 'ENCRYPTION_KEY 至少需要 32 个字符'),\n  ENCRYPTION_SALT: z.string().min(16, 'ENCRYPTION_SALT 至少需要 16 个字符'),\n  ENCRYPTION_USE_SALT: z\n    .string()\n    .transform((val) => ['true', '1', 'yes'].includes(val.toLowerCase()))\n    .pipe(z.boolean())\n    .default('false'),\n  ENCRYPTION_ALGORITHM: z.string().default('aes-256-gcm'),\n\n  // Sentry 配置\n  SENTRY_DSN: z.string().url('SENTRY_DSN 必须是有效的 URL').optional(),\n  SENTRY_ENVIRONMENT: z.string().default('development'),\n  SENTRY_TRACES_SAMPLE_RATE: z\n    .string()\n    .transform((val) => Number.parseFloat(val))\n    .pipe(z.number().min(0).max(1))\n    .default('1.0'),\n\n  // AI Provider 配置\n  DEEPSEEK_API_KEY: z.string().optional(),\n  DEEPSEEK_BASE_URL: z.string().url().default('https://api.deepseek.com/v1'),\n\n  // AI Provider 后备配置\n  FALLBACK_API_KEY: z.string().optional(),\n  FALLBACK_MODEL_ID: z.string().default('deepseek-chat'),\n  FALLBACK_BASE_URL: z.string().url().optional(),\n\n  // 应用配置\n  NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),\n  PORT: z.coerce.number().int().positive().default(3000),\n  CORS_ORIGIN: z.string().url().default('http://localhost:5173'),\n\n  // Qdrant 配置（向量数据库）\n  QDRANT_URL: z.string().url().default('http://localhost:6333'),\n  QDRANT_API_KEY: z.string().optional(),\n\n  // Clerk 配置\n  CLERK_SECRET_KEY: z.string().optional(),\n  CLERK_PUBLISHABLE_KEY: z.string().optional(),\n  CLERK_WEBHOOK_SECRET_KEY: z.string().optional(),\n\n  // RabbitMQ 配置\n  RABBITMQ_URL: z.string().url().default('amqp://localhost:5672'),\n\n  // JWT 配置 (用于传统认证)\n  JWT_SECRET: z.string().min(32, 'JWT_SECRET 至少需要 32 个字符'),\n  JWT_EXPIRATION_SECONDS: z.coerce.number().int().positive().default(3600),\n\n  // 服务端口配置\n  BACKEND_GATEWAY_PORT: z.coerce.number().int().positive().default(3000),\n  CREATION_AGENT_HTTP_PORT: z.coerce.number().int().positive().default(8080),\n  LOGIC_AGENT_HTTP_PORT: z.coerce.number().int().positive().default(8081),\n  NARRATIVE_AGENT_HTTP_PORT: z.coerce.number().int().positive().default(8082),\n})\n\n/**\n * @type Env\n * @description 验证后的环境变量类型\n */\nexport type Env = z.infer<typeof envSchema>\n\n/**\n * @function validateEnv\n * @description 验证环境变量\n * @returns 验证后的环境变量\n * @throws {Error} 如果验证失败\n */\nexport function validateEnv(): Env {\n  try {\n    return envSchema.parse(process.env)\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      const errorMessages = error.errors.map((err) => {\n        const path = err.path.join('.')\n        return `${path}: ${err.message}`\n      })\n\n      throw new Error(\n        `环境变量验证失败:\\n${errorMessages.join('\\n')}\\n\\n请检查 .env 文件或环境变量配置。`\n      )\n    }\n    throw error\n  }\n}\n"],"version":3}