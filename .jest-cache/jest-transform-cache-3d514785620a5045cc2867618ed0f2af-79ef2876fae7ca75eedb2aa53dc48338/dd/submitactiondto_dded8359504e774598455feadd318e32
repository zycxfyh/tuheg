4b282b534f3c67aaf2dea4dbdbebe1a8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.submitActionSchema = void 0;
const zod_1 = require("zod");
const noControlCharacters = (value) => {
    for (let i = 0; i < value.length; i++) {
        const charCode = value.charCodeAt(i);
        if ((charCode >= 0 && charCode <= 8) ||
            (charCode >= 11 && charCode <= 12) ||
            (charCode >= 14 && charCode <= 31) ||
            charCode === 127) {
            return false;
        }
    }
    return true;
};
const maxLength400 = (value) => value.length <= 400;
exports.submitActionSchema = zod_1.z
    .object({
    type: zod_1.z.enum(['option', 'command', 'meta']),
    payload: zod_1.z.any(),
})
    .superRefine((data, ctx) => {
    if (data.type === 'command') {
        if (typeof data.payload !== 'string') {
            ctx.addIssue({
                code: zod_1.z.ZodIssueCode.custom,
                message: 'Command payload must be a string.',
                path: ['payload'],
            });
            return;
        }
        if (!noControlCharacters(data.payload)) {
            ctx.addIssue({
                code: zod_1.z.ZodIssueCode.custom,
                message: 'Command payload contains invalid control characters.',
                path: ['payload'],
            });
        }
    }
    else if (data.type === 'option') {
        if (typeof data.payload !== 'object' || data.payload === null) {
            ctx.addIssue({
                code: zod_1.z.ZodIssueCode.custom,
                message: 'Option payload must be an object.',
                path: ['payload'],
            });
            return;
        }
        const payload = data.payload;
        if (typeof payload.text !== 'string') {
            ctx.addIssue({
                code: zod_1.z.ZodIssueCode.custom,
                message: 'Option payload text must be a string.',
                path: ['payload', 'text'],
            });
            return;
        }
        if (!maxLength400(payload.text)) {
            ctx.addIssue({
                code: zod_1.z.ZodIssueCode.custom,
                message: 'Option text must be 400 characters or fewer.',
                path: ['payload', 'text'],
            });
        }
    }
});
//# sourceMappingURL=submit-action.dto.js.map