{"file":"C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\vcp\\async-workflow.service.ts","mappings":"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","names":[],"sources":["C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\vcp\\async-workflow.service.ts"],"sourcesContent":["// ============================================================================\n// 异步工作流引擎服务集成\n// 集成 VCPToolBox 的非线性异步工作流，支持复杂任务编排\n// ============================================================================\n\nimport { Injectable, Logger, type OnModuleInit } from '@nestjs/common'\nimport { ConfigService } from '@nestjs/config'\nimport {\n  asyncWorkflowEngine,\n  WorkflowConnection,\n  type WorkflowExecutionOptions,\n  type WorkflowInstance,\n  WorkflowNode,\n  type WorkflowTemplate,\n} from '../../../vcptoolbox/src/modules/tools/AsyncWorkflowEngine'\n\n@Injectable()\nexport class AsyncWorkflowService implements OnModuleInit {\n  private readonly logger = new Logger(AsyncWorkflowService.name)\n  private predefinedTemplates: Map<string, WorkflowTemplate> = new Map()\n\n  constructor(private configService: ConfigService) {}\n\n  async onModuleInit() {\n    await this.initializeWorkflowEngine()\n    await this.createPredefinedTemplates()\n    this.setupEventHandlers()\n    this.logger.log('异步工作流引擎已初始化')\n  }\n\n  // ==================== 引擎初始化 ====================\n\n  /**\n   * 初始化工作流引擎\n   */\n  private async initializeWorkflowEngine(): Promise<void> {\n    // 设置引擎参数\n    // 这里可以根据配置调整引擎参数\n\n    this.logger.log('工作流引擎参数已配置')\n  }\n\n  /**\n   * 创建预定义模板\n   */\n  private async createPredefinedTemplates(): Promise<void> {\n    // 故事创作工作流模板\n    await this.createStoryCreationTemplate()\n\n    // 角色开发工作流模板\n    await this.createCharacterDevelopmentTemplate()\n\n    // 世界构建工作流模板\n    await this.createWorldBuildingTemplate()\n\n    // 多模态叙事工作流模板\n    await this.createMultimodalNarrativeTemplate()\n\n    this.logger.log('预定义工作流模板已创建')\n  }\n\n  /**\n   * 创建故事创作模板\n   */\n  private async createStoryCreationTemplate(): Promise<string> {\n    const template: Omit<WorkflowTemplate, 'id' | 'createdAt' | 'updatedAt'> = {\n      name: '故事创作工作流',\n      description: '完整的AI辅助故事创作流程',\n      version: '1.0.0',\n      nodes: [\n        {\n          id: 'concept-generation',\n          type: 'task',\n          name: '创意概念生成',\n          description: '基于用户输入生成故事概念',\n          config: { taskType: 'ai', model: 'gpt-4', maxTokens: 500 },\n          inputs: [],\n          outputs: [\n            {\n              id: 'concept-out',\n              sourceNodeId: 'concept-generation',\n              targetNodeId: 'logic-validation',\n              condition: { type: 'expression', expression: 'true' },\n            },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 3,\n          timeout: 60000,\n        },\n        {\n          id: 'logic-validation',\n          type: 'task',\n          name: '逻辑验证',\n          description: '验证故事概念的逻辑一致性',\n          config: { taskType: 'ai', analysisType: 'logic' },\n          inputs: [\n            {\n              id: 'logic-in',\n              sourceNodeId: 'concept-generation',\n              targetNodeId: 'logic-validation',\n            },\n          ],\n          outputs: [\n            {\n              id: 'logic-valid',\n              sourceNodeId: 'logic-validation',\n              targetNodeId: 'character-creation',\n              condition: { type: 'expression', expression: 'result.isValid === true' },\n            },\n            {\n              id: 'logic-invalid',\n              sourceNodeId: 'logic-validation',\n              targetNodeId: 'concept-revision',\n              condition: { type: 'expression', expression: 'result.isValid === false' },\n            },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 30000,\n          dependencies: ['concept-generation'],\n        },\n        {\n          id: 'concept-revision',\n          type: 'task',\n          name: '概念修改',\n          description: '根据逻辑验证结果修改故事概念',\n          config: { taskType: 'ai', revisionType: 'logic-fix' },\n          inputs: [\n            {\n              id: 'revision-in',\n              sourceNodeId: 'logic-validation',\n              targetNodeId: 'concept-revision',\n            },\n          ],\n          outputs: [\n            {\n              id: 'revision-out',\n              sourceNodeId: 'concept-revision',\n              targetNodeId: 'logic-validation',\n              condition: { type: 'expression', expression: 'true' },\n            },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 3,\n          timeout: 45000,\n          dependencies: ['logic-validation'],\n        },\n        {\n          id: 'character-creation',\n          type: 'parallel',\n          name: '角色创建',\n          description: '并行创建多个主要角色',\n          config: { tasks: ['protagonist', 'antagonist', 'supporting'] },\n          inputs: [\n            { id: 'char-in', sourceNodeId: 'logic-validation', targetNodeId: 'character-creation' },\n          ],\n          outputs: [\n            {\n              id: 'char-out',\n              sourceNodeId: 'character-creation',\n              targetNodeId: 'world-building',\n              condition: { type: 'expression', expression: 'true' },\n            },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 120000,\n          dependencies: ['logic-validation'],\n        },\n        {\n          id: 'world-building',\n          type: 'task',\n          name: '世界构建',\n          description: '构建故事的世界观和设定',\n          config: { taskType: 'ai', worldType: 'comprehensive' },\n          inputs: [\n            { id: 'world-in', sourceNodeId: 'character-creation', targetNodeId: 'world-building' },\n          ],\n          outputs: [\n            {\n              id: 'world-out',\n              sourceNodeId: 'world-building',\n              targetNodeId: 'plot-structure',\n              condition: { type: 'expression', expression: 'true' },\n            },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 90000,\n          dependencies: ['character-creation'],\n        },\n        {\n          id: 'plot-structure',\n          type: 'task',\n          name: '情节结构设计',\n          description: '设计故事的情节框架和转折点',\n          config: { taskType: 'ai', structureType: 'three-act' },\n          inputs: [\n            { id: 'plot-in', sourceNodeId: 'world-building', targetNodeId: 'plot-structure' },\n          ],\n          outputs: [\n            {\n              id: 'plot-out',\n              sourceNodeId: 'plot-structure',\n              targetNodeId: 'content-generation',\n              condition: { type: 'expression', expression: 'true' },\n            },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 75000,\n          dependencies: ['world-building'],\n        },\n        {\n          id: 'content-generation',\n          type: 'task',\n          name: '内容生成',\n          description: '生成完整的故事情节内容',\n          config: { taskType: 'ai', contentType: 'full-narrative', maxLength: 5000 },\n          inputs: [\n            {\n              id: 'content-in',\n              sourceNodeId: 'plot-structure',\n              targetNodeId: 'content-generation',\n            },\n          ],\n          outputs: [\n            {\n              id: 'content-out',\n              sourceNodeId: 'content-generation',\n              targetNodeId: 'quality-review',\n              condition: { type: 'expression', expression: 'true' },\n            },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 3,\n          timeout: 300000,\n          dependencies: ['plot-structure'],\n        },\n        {\n          id: 'quality-review',\n          type: 'task',\n          name: '质量审查',\n          description: '对生成内容进行质量评估和修改',\n          config: { taskType: 'ai', reviewType: 'comprehensive' },\n          inputs: [\n            { id: 'review-in', sourceNodeId: 'content-generation', targetNodeId: 'quality-review' },\n          ],\n          outputs: [\n            {\n              id: 'review-pass',\n              sourceNodeId: 'quality-review',\n              targetNodeId: 'final-output',\n              condition: { type: 'expression', expression: 'result.quality > 0.8' },\n            },\n            {\n              id: 'review-fail',\n              sourceNodeId: 'quality-review',\n              targetNodeId: 'content-revision',\n              condition: { type: 'expression', expression: 'result.quality <= 0.8' },\n            },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 60000,\n          dependencies: ['content-generation'],\n        },\n        {\n          id: 'content-revision',\n          type: 'task',\n          name: '内容修改',\n          description: '根据质量审查结果修改内容',\n          config: { taskType: 'ai', revisionType: 'quality-improvement' },\n          inputs: [\n            { id: 'revision-in', sourceNodeId: 'quality-review', targetNodeId: 'content-revision' },\n          ],\n          outputs: [\n            {\n              id: 'revision-out',\n              sourceNodeId: 'content-revision',\n              targetNodeId: 'quality-review',\n              condition: { type: 'expression', expression: 'true' },\n            },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 3,\n          timeout: 180000,\n          dependencies: ['quality-review'],\n        },\n        {\n          id: 'final-output',\n          type: 'task',\n          name: '最终输出',\n          description: '格式化并输出最终的故事',\n          config: { taskType: 'format', outputFormat: 'markdown' },\n          inputs: [\n            { id: 'final-in', sourceNodeId: 'quality-review', targetNodeId: 'final-output' },\n          ],\n          outputs: [],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 1,\n          timeout: 30000,\n          dependencies: ['quality-review'],\n        },\n      ],\n      connections: [], // 连接已在节点中定义\n      defaultConfig: {\n        maxRetries: 3,\n        timeout: 300000,\n        priority: 'high',\n      },\n      tags: ['story-creation', 'narrative', 'ai-assisted'],\n    }\n\n    const templateId = asyncWorkflowEngine.createTemplate(template)\n    this.predefinedTemplates.set('story-creation', asyncWorkflowEngine.getTemplate(templateId)!)\n\n    return templateId\n  }\n\n  /**\n   * 创建角色开发模板\n   */\n  private async createCharacterDevelopmentTemplate(): Promise<string> {\n    // 简化的角色开发模板\n    const template: Omit<WorkflowTemplate, 'id' | 'createdAt' | 'updatedAt'> = {\n      name: '角色开发工作流',\n      description: '详细的角色塑造和性格发展流程',\n      version: '1.0.0',\n      nodes: [\n        {\n          id: 'character-basics',\n          type: 'task',\n          name: '角色基础设定',\n          description: '定义角色的基本属性和背景',\n          config: { taskType: 'character', step: 'basics' },\n          inputs: [],\n          outputs: [\n            {\n              id: 'basics-out',\n              sourceNodeId: 'character-basics',\n              targetNodeId: 'personality-analysis',\n            },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 30000,\n        },\n        {\n          id: 'personality-analysis',\n          type: 'task',\n          name: '性格分析',\n          description: '深入分析角色性格特征和动机',\n          config: { taskType: 'character', step: 'personality' },\n          inputs: [\n            {\n              id: 'personality-in',\n              sourceNodeId: 'character-basics',\n              targetNodeId: 'personality-analysis',\n            },\n          ],\n          outputs: [\n            {\n              id: 'personality-out',\n              sourceNodeId: 'personality-analysis',\n              targetNodeId: 'development-arc',\n            },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 45000,\n          dependencies: ['character-basics'],\n        },\n        {\n          id: 'development-arc',\n          type: 'task',\n          name: '发展弧线设计',\n          description: '设计角色的成长和变化轨迹',\n          config: { taskType: 'character', step: 'arc' },\n          inputs: [\n            { id: 'arc-in', sourceNodeId: 'personality-analysis', targetNodeId: 'development-arc' },\n          ],\n          outputs: [\n            { id: 'arc-out', sourceNodeId: 'development-arc', targetNodeId: 'character-output' },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 60000,\n          dependencies: ['personality-analysis'],\n        },\n        {\n          id: 'character-output',\n          type: 'task',\n          name: '角色资料输出',\n          description: '生成完整的角色资料文档',\n          config: { taskType: 'format', format: 'character-sheet' },\n          inputs: [\n            { id: 'output-in', sourceNodeId: 'development-arc', targetNodeId: 'character-output' },\n          ],\n          outputs: [],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 1,\n          timeout: 20000,\n          dependencies: ['development-arc'],\n        },\n      ],\n      connections: [],\n      defaultConfig: {\n        maxRetries: 2,\n        timeout: 120000,\n        priority: 'normal',\n      },\n      tags: ['character-development', 'personality', 'characterization'],\n    }\n\n    const templateId = asyncWorkflowEngine.createTemplate(template)\n    this.predefinedTemplates.set(\n      'character-development',\n      asyncWorkflowEngine.getTemplate(templateId)!\n    )\n\n    return templateId\n  }\n\n  /**\n   * 创建世界构建模板\n   */\n  private async createWorldBuildingTemplate(): Promise<string> {\n    // 简化的世界构建模板\n    const template: Omit<WorkflowTemplate, 'id' | 'createdAt' | 'updatedAt'> = {\n      name: '世界构建工作流',\n      description: '系统性的世界观和设定构建流程',\n      version: '1.0.0',\n      nodes: [\n        {\n          id: 'world-concept',\n          type: 'task',\n          name: '世界概念设计',\n          description: '定义世界的基本概念和规则',\n          config: { taskType: 'world', step: 'concept' },\n          inputs: [],\n          outputs: [\n            { id: 'concept-out', sourceNodeId: 'world-concept', targetNodeId: 'setting-details' },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 45000,\n        },\n        {\n          id: 'setting-details',\n          type: 'parallel',\n          name: '设定细节完善',\n          description: '并行完善世界的各个方面设定',\n          config: { tasks: ['geography', 'culture', 'magic-system', 'technology'] },\n          inputs: [\n            { id: 'details-in', sourceNodeId: 'world-concept', targetNodeId: 'setting-details' },\n          ],\n          outputs: [\n            {\n              id: 'details-out',\n              sourceNodeId: 'setting-details',\n              targetNodeId: 'consistency-check',\n            },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 180000,\n          dependencies: ['world-concept'],\n        },\n        {\n          id: 'consistency-check',\n          type: 'task',\n          name: '一致性检查',\n          description: '验证世界设定的内部一致性',\n          config: { taskType: 'validation', checkType: 'world-consistency' },\n          inputs: [\n            { id: 'check-in', sourceNodeId: 'setting-details', targetNodeId: 'consistency-check' },\n          ],\n          outputs: [\n            { id: 'check-out', sourceNodeId: 'consistency-check', targetNodeId: 'world-output' },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 60000,\n          dependencies: ['setting-details'],\n        },\n        {\n          id: 'world-output',\n          type: 'task',\n          name: '世界设定输出',\n          description: '生成完整的世界设定文档',\n          config: { taskType: 'format', format: 'world-bible' },\n          inputs: [\n            { id: 'output-in', sourceNodeId: 'consistency-check', targetNodeId: 'world-output' },\n          ],\n          outputs: [],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 1,\n          timeout: 30000,\n          dependencies: ['consistency-check'],\n        },\n      ],\n      connections: [],\n      defaultConfig: {\n        maxRetries: 2,\n        timeout: 150000,\n        priority: 'normal',\n      },\n      tags: ['world-building', 'lore', 'setting', 'world-design'],\n    }\n\n    const templateId = asyncWorkflowEngine.createTemplate(template)\n    this.predefinedTemplates.set('world-building', asyncWorkflowEngine.getTemplate(templateId)!)\n\n    return templateId\n  }\n\n  /**\n   * 创建多模态叙事模板\n   */\n  private async createMultimodalNarrativeTemplate(): Promise<string> {\n    // 多模态叙事模板\n    const template: Omit<WorkflowTemplate, 'id' | 'createdAt' | 'updatedAt'> = {\n      name: '多模态叙事工作流',\n      description: '结合文本、图像、音频的多模态故事创作',\n      version: '1.0.0',\n      nodes: [\n        {\n          id: 'text-script',\n          type: 'task',\n          name: '文本脚本创作',\n          description: '创作故事的文本脚本',\n          config: { taskType: 'ai', modality: 'text', maxLength: 2000 },\n          inputs: [],\n          outputs: [\n            { id: 'text-out', sourceNodeId: 'text-script', targetNodeId: 'parallel-modality' },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 90000,\n        },\n        {\n          id: 'parallel-modality',\n          type: 'parallel',\n          name: '多模态内容生成',\n          description: '并行生成图像、音频等模态内容',\n          config: { tasks: ['image-generation', 'audio-narration', 'music-scoring'] },\n          inputs: [\n            { id: 'modality-in', sourceNodeId: 'text-script', targetNodeId: 'parallel-modality' },\n          ],\n          outputs: [\n            { id: 'modality-out', sourceNodeId: 'parallel-modality', targetNodeId: 'integration' },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 3,\n          timeout: 300000,\n          dependencies: ['text-script'],\n        },\n        {\n          id: 'integration',\n          type: 'task',\n          name: '多模态集成',\n          description: '将各模态内容整合为连贯的叙事体验',\n          config: { taskType: 'integration', integrationType: 'multimodal' },\n          inputs: [\n            {\n              id: 'integration-in',\n              sourceNodeId: 'parallel-modality',\n              targetNodeId: 'integration',\n            },\n          ],\n          outputs: [\n            {\n              id: 'integration-out',\n              sourceNodeId: 'integration',\n              targetNodeId: 'multimodal-output',\n            },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 120000,\n          dependencies: ['parallel-modality'],\n        },\n        {\n          id: 'multimodal-output',\n          type: 'task',\n          name: '多模态输出',\n          description: '生成最终的多模态叙事作品',\n          config: { taskType: 'format', format: 'multimodal-package' },\n          inputs: [\n            { id: 'output-in', sourceNodeId: 'integration', targetNodeId: 'multimodal-output' },\n          ],\n          outputs: [],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 1,\n          timeout: 60000,\n          dependencies: ['integration'],\n        },\n      ],\n      connections: [],\n      defaultConfig: {\n        maxRetries: 3,\n        timeout: 480000,\n        priority: 'high',\n      },\n      tags: ['multimodal', 'narrative', 'media', 'integration'],\n    }\n\n    const templateId = asyncWorkflowEngine.createTemplate(template)\n    this.predefinedTemplates.set(\n      'multimodal-narrative',\n      asyncWorkflowEngine.getTemplate(templateId)!\n    )\n\n    return templateId\n  }\n\n  /**\n   * 设置事件处理器\n   */\n  private setupEventHandlers(): void {\n    // 监听工作流事件\n    asyncWorkflowEngine.on('workflowInstantiated', (workflow) => {\n      this.logger.log(`工作流已实例化: ${workflow.id} - ${workflow.name}`)\n    })\n\n    asyncWorkflowEngine.on('workflowStarted', (workflow) => {\n      this.logger.log(`工作流已启动: ${workflow.id}`)\n    })\n\n    asyncWorkflowEngine.on('workflowCompleted', (workflow) => {\n      this.logger.log(`工作流已完成: ${workflow.id} (${workflow.metadata.actualDuration}ms)`)\n    })\n\n    asyncWorkflowEngine.on('workflowFailed', (workflow) => {\n      this.logger.error(`工作流执行失败: ${workflow.id}`)\n    })\n\n    asyncWorkflowEngine.on(\n      'nodeCompleted',\n      (data: { instanceId: string; nodeId: string; result: any }) => {\n        this.logger.debug(`工作流节点完成: ${data.nodeId}`)\n      }\n    )\n\n    asyncWorkflowEngine.on(\n      'nodeFailed',\n      (data: { instanceId: string; nodeId: string; error: string }) => {\n        this.logger.warn(`工作流节点失败: ${data.nodeId}`, data.error)\n      }\n    )\n  }\n\n  // ==================== 工作流管理 ====================\n\n  /**\n   * 使用预定义模板创建工作流实例\n   */\n  async createWorkflowFromTemplate(\n    templateName: string,\n    name: string,\n    options: WorkflowExecutionOptions = {}\n  ): Promise<string> {\n    const template = this.predefinedTemplates.get(templateName)\n    if (!template) {\n      throw new Error(`预定义模板 '${templateName}' 不存在`)\n    }\n\n    const instanceId = asyncWorkflowEngine.instantiateWorkflow(template.id, name, options)\n    this.logger.log(`基于模板 '${templateName}' 创建工作流实例: ${instanceId}`)\n\n    return instanceId\n  }\n\n  /**\n   * 创建自定义工作流\n   */\n  async createCustomWorkflow(\n    templateData: Omit<WorkflowTemplate, 'id' | 'createdAt' | 'updatedAt'>,\n    instanceName: string,\n    options: WorkflowExecutionOptions = {}\n  ): Promise<string> {\n    const templateId = asyncWorkflowEngine.createTemplate(templateData)\n    const instanceId = asyncWorkflowEngine.instantiateWorkflow(templateId, instanceName, options)\n\n    this.logger.log(`创建自定义工作流: ${instanceId}`)\n    return instanceId\n  }\n\n  /**\n   * 启动工作流\n   */\n  async startWorkflow(instanceId: string): Promise<void> {\n    await asyncWorkflowEngine.startWorkflow(instanceId)\n    this.logger.log(`工作流已启动: ${instanceId}`)\n  }\n\n  /**\n   * 暂停工作流\n   */\n  async pauseWorkflow(instanceId: string): Promise<void> {\n    await asyncWorkflowEngine.pauseWorkflow(instanceId)\n    this.logger.log(`工作流已暂停: ${instanceId}`)\n  }\n\n  /**\n   * 恢复工作流\n   */\n  async resumeWorkflow(instanceId: string): Promise<void> {\n    await asyncWorkflowEngine.resumeWorkflow(instanceId)\n    this.logger.log(`工作流已恢复: ${instanceId}`)\n  }\n\n  /**\n   * 取消工作流\n   */\n  async cancelWorkflow(instanceId: string, reason?: string): Promise<void> {\n    await asyncWorkflowEngine.cancelWorkflow(instanceId, reason)\n    this.logger.log(`工作流已取消: ${instanceId}${reason ? ` - ${reason}` : ''}`)\n  }\n\n  /**\n   * 获取工作流状态\n   */\n  getWorkflowStatus(instanceId: string): WorkflowInstance | null {\n    return asyncWorkflowEngine.getWorkflowStatus(instanceId)\n  }\n\n  /**\n   * 获取所有活跃工作流\n   */\n  getActiveWorkflows(): WorkflowInstance[] {\n    // 这里需要从引擎获取活跃工作流列表\n    // 由于引擎API限制，暂时返回空数组\n    return []\n  }\n\n  // ==================== 叙事专用工作流 ====================\n\n  /**\n   * 创建故事创作工作流\n   */\n  async createStoryCreationWorkflow(\n    storyId: string,\n    userPrompt: string,\n    options: {\n      genre?: string\n      length?: 'short' | 'medium' | 'long'\n      style?: string\n      characters?: number\n    } = {}\n  ): Promise<string> {\n    const workflowName = `故事创作: ${storyId}`\n\n    const workflowOptions: WorkflowExecutionOptions = {\n      priority: 'high',\n      variables: {\n        storyId,\n        userPrompt,\n        genre: options.genre || 'fantasy',\n        length: options.length || 'medium',\n        style: options.style || 'narrative',\n        characterCount: options.characters || 3,\n      },\n      inputData: {\n        prompt: userPrompt,\n        requirements: options,\n      },\n    }\n\n    const instanceId = await this.createWorkflowFromTemplate(\n      'story-creation',\n      workflowName,\n      workflowOptions\n    )\n\n    // 自动启动工作流\n    await this.startWorkflow(instanceId)\n\n    return instanceId\n  }\n\n  /**\n   * 创建角色开发工作流\n   */\n  async createCharacterDevelopmentWorkflow(\n    characterId: string,\n    characterConcept: string,\n    options: {\n      archetype?: string\n      complexity?: 'simple' | 'detailed' | 'complex'\n      background?: any\n    } = {}\n  ): Promise<string> {\n    const workflowName = `角色开发: ${characterId}`\n\n    const workflowOptions: WorkflowExecutionOptions = {\n      priority: 'normal',\n      variables: {\n        characterId,\n        characterConcept,\n        archetype: options.archetype || 'hero',\n        complexity: options.complexity || 'detailed',\n      },\n      inputData: {\n        concept: characterConcept,\n        options: options,\n      },\n    }\n\n    const instanceId = await this.createWorkflowFromTemplate(\n      'character-development',\n      workflowName,\n      workflowOptions\n    )\n    await this.startWorkflow(instanceId)\n\n    return instanceId\n  }\n\n  /**\n   * 创建世界构建工作流\n   */\n  async createWorldBuildingWorkflow(\n    worldId: string,\n    worldConcept: string,\n    options: {\n      scope?: 'small' | 'medium' | 'large'\n      genre?: string\n      technologyLevel?: string\n      magicLevel?: string\n    } = {}\n  ): Promise<string> {\n    const workflowName = `世界构建: ${worldId}`\n\n    const workflowOptions: WorkflowExecutionOptions = {\n      priority: 'normal',\n      variables: {\n        worldId,\n        worldConcept,\n        scope: options.scope || 'medium',\n        genre: options.genre || 'fantasy',\n        technologyLevel: options.technologyLevel || 'medieval',\n        magicLevel: options.magicLevel || 'high',\n      },\n      inputData: {\n        concept: worldConcept,\n        options: options,\n      },\n    }\n\n    const instanceId = await this.createWorkflowFromTemplate(\n      'world-building',\n      workflowName,\n      workflowOptions\n    )\n    await this.startWorkflow(instanceId)\n\n    return instanceId\n  }\n\n  /**\n   * 创建多模态叙事工作流\n   */\n  async createMultimodalNarrativeWorkflow(\n    narrativeId: string,\n    script: string,\n    modalities: ('text' | 'image' | 'audio' | 'video')[] = ['text', 'image']\n  ): Promise<string> {\n    const workflowName = `多模态叙事: ${narrativeId}`\n\n    const workflowOptions: WorkflowExecutionOptions = {\n      priority: 'high',\n      variables: {\n        narrativeId,\n        modalities: modalities.join(','),\n      },\n      inputData: {\n        script,\n        modalities,\n      },\n    }\n\n    const instanceId = await this.createWorkflowFromTemplate(\n      'multimodal-narrative',\n      workflowName,\n      workflowOptions\n    )\n    await this.startWorkflow(instanceId)\n\n    return instanceId\n  }\n\n  // ==================== 工作流监控 ====================\n\n  /**\n   * 获取工作流统计信息\n   */\n  getWorkflowStats(): any {\n    return asyncWorkflowEngine.getEngineStats()\n  }\n\n  /**\n   * 获取工作流性能指标\n   */\n  getWorkflowMetrics(): any {\n    const stats = this.getWorkflowStats()\n    const activeWorkflows = this.getActiveWorkflows()\n\n    return {\n      ...stats,\n      activeWorkflows: activeWorkflows.length,\n      averageCompletionTime: this.calculateAverageCompletionTime(activeWorkflows),\n      successRate: this.calculateSuccessRate(activeWorkflows),\n      resourceUtilization: this.calculateResourceUtilization(),\n    }\n  }\n\n  /**\n   * 计算平均完成时间\n   */\n  private calculateAverageCompletionTime(workflows: WorkflowInstance[]): number {\n    const completedWorkflows = workflows.filter(\n      (w) => w.status === 'completed' && w.metadata.actualDuration\n    )\n\n    if (completedWorkflows.length === 0) return 0\n\n    const totalTime = completedWorkflows.reduce(\n      (sum, w) => sum + (w.metadata.actualDuration || 0),\n      0\n    )\n    return totalTime / completedWorkflows.length\n  }\n\n  /**\n   * 计算成功率\n   */\n  private calculateSuccessRate(workflows: WorkflowInstance[]): number {\n    if (workflows.length === 0) return 0\n\n    const successful = workflows.filter((w) => w.status === 'completed').length\n    return successful / workflows.length\n  }\n\n  /**\n   * 计算资源利用率\n   */\n  private calculateResourceUtilization(): any {\n    // 简化的资源利用率计算\n    const stats = this.getWorkflowStats()\n\n    return {\n      executorUtilization: stats.runningInstances / Math.max(stats.nodeExecutors, 1),\n      queueUtilization: stats.queuedInstances / Math.max(stats.maxConcurrentExecutions || 10, 1),\n      memoryEfficiency: 0.85, // 模拟值\n    }\n  }\n\n  // ==================== 模板管理 ====================\n\n  /**\n   * 获取可用模板列表\n   */\n  getAvailableTemplates(): Array<{\n    id: string\n    name: string\n    description: string\n    tags: string[]\n  }> {\n    return Array.from(this.predefinedTemplates.values()).map((template) => ({\n      id: template.id,\n      name: template.name,\n      description: template.description,\n      tags: template.tags,\n    }))\n  }\n\n  /**\n   * 获取模板详情\n   */\n  getTemplateDetails(templateId: string): WorkflowTemplate | null {\n    return asyncWorkflowEngine.getTemplate(templateId)\n  }\n\n  // ==================== 高级功能 ====================\n\n  /**\n   * 创建条件分支工作流\n   */\n  async createConditionalWorkflow(\n    name: string,\n    conditions: Array<{\n      condition: string\n      workflowTemplate: string\n      parameters: any\n    }>\n  ): Promise<string> {\n    // 创建一个决策节点，根据条件选择不同的子工作流\n    const template: Omit<WorkflowTemplate, 'id' | 'createdAt' | 'updatedAt'> = {\n      name: `条件工作流: ${name}`,\n      description: '基于条件动态选择执行路径的工作流',\n      version: '1.0.0',\n      nodes: [\n        {\n          id: 'decision',\n          type: 'decision',\n          name: '条件判断',\n          description: '评估条件并选择执行路径',\n          config: { conditions },\n          inputs: [],\n          outputs: conditions.map((cond, index) => ({\n            id: `branch-${index}`,\n            sourceNodeId: 'decision',\n            targetNodeId: `subworkflow-${index}`,\n            condition: { type: 'expression', expression: cond.condition },\n          })),\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 1,\n          timeout: 30000,\n        },\n        ...conditions.map((cond, index) => ({\n          id: `subworkflow-${index}`,\n          type: 'subprocess',\n          name: `子工作流 ${index + 1}`,\n          description: `执行 ${cond.workflowTemplate} 模板`,\n          config: {\n            subTemplate: cond.workflowTemplate,\n            parameters: cond.parameters,\n          },\n          inputs: [\n            {\n              id: `input-${index}`,\n              sourceNodeId: 'decision',\n              targetNodeId: `subworkflow-${index}`,\n            },\n          ],\n          outputs: [\n            { id: `output-${index}`, sourceNodeId: `subworkflow-${index}`, targetNodeId: 'merge' },\n          ],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 2,\n          timeout: 300000,\n          dependencies: ['decision'],\n        })),\n        {\n          id: 'merge',\n          type: 'gateway',\n          name: '结果合并',\n          description: '合并各分支的执行结果',\n          config: { gatewayType: 'exclusive' },\n          inputs: conditions.map((_, index) => ({\n            id: `merge-input-${index}`,\n            sourceNodeId: `subworkflow-${index}`,\n            targetNodeId: 'merge',\n          })),\n          outputs: [],\n          status: 'pending',\n          retryCount: 0,\n          maxRetries: 1,\n          timeout: 30000,\n          dependencies: conditions.map((_, index) => `subworkflow-${index}`),\n        },\n      ],\n      connections: [],\n      defaultConfig: {\n        maxRetries: 2,\n        timeout: 600000,\n        priority: 'normal',\n      },\n      tags: ['conditional', 'dynamic', 'branching'],\n    }\n\n    const instanceId = await this.createCustomWorkflow(template, name)\n    return instanceId\n  }\n\n  // ==================== 健康检查和维护 ====================\n\n  /**\n   * 健康检查\n   */\n  async healthCheck(): Promise<{ status: string; details?: any }> {\n    try {\n      const stats = this.getWorkflowStats()\n      const activeWorkflows = this.getActiveWorkflows()\n\n      const issues = []\n\n      // 检查是否有长时间运行的工作流\n      const longRunning = activeWorkflows.filter((w) => {\n        if (!w.startTime) return false\n        const runtime = Date.now() - w.startTime.getTime()\n        return runtime > 30 * 60 * 1000 // 30分钟\n      })\n\n      if (longRunning.length > 0) {\n        issues.push(`${longRunning.length} 个工作流运行时间过长`)\n      }\n\n      // 检查队列积压\n      if (stats.queuedInstances > 10) {\n        issues.push(`工作流队列积压: ${stats.queuedInstances} 个实例`)\n      }\n\n      return {\n        status: issues.length > 0 ? 'warning' : 'healthy',\n        details: {\n          stats,\n          activeWorkflows: activeWorkflows.length,\n          issues,\n        },\n      }\n    } catch (error: any) {\n      return {\n        status: 'error',\n        details: error.message,\n      }\n    }\n  }\n\n  /**\n   * 清理已完成的工作流\n   */\n  async cleanupCompletedWorkflows(olderThanHours: number = 24): Promise<number> {\n    const cleaned = asyncWorkflowEngine.cleanupCompletedInstances(olderThanHours)\n    this.logger.log(`清理了 ${cleaned} 个过期的工作流实例`)\n    return cleaned\n  }\n}\n"],"version":3}