52a3b4e1e39995bd2eeedcee069e299d
"use strict";
// ============================================================================
// Tar* 变量系统集成服务
// 集成 VCPToolBox 的动态配置和环境感知能力
// ============================================================================
var __esDecorate = (this && this.__esDecorate) || function (ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {
    function accept(f) { if (f !== void 0 && typeof f !== "function") throw new TypeError("Function expected"); return f; }
    var kind = contextIn.kind, key = kind === "getter" ? "get" : kind === "setter" ? "set" : "value";
    var target = !descriptorIn && ctor ? contextIn["static"] ? ctor : ctor.prototype : null;
    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});
    var _, done = false;
    for (var i = decorators.length - 1; i >= 0; i--) {
        var context = {};
        for (var p in contextIn) context[p] = p === "access" ? {} : contextIn[p];
        for (var p in contextIn.access) context.access[p] = contextIn.access[p];
        context.addInitializer = function (f) { if (done) throw new TypeError("Cannot add initializers after decoration has completed"); extraInitializers.push(accept(f || null)); };
        var result = (0, decorators[i])(kind === "accessor" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);
        if (kind === "accessor") {
            if (result === void 0) continue;
            if (result === null || typeof result !== "object") throw new TypeError("Object expected");
            if (_ = accept(result.get)) descriptor.get = _;
            if (_ = accept(result.set)) descriptor.set = _;
            if (_ = accept(result.init)) initializers.unshift(_);
        }
        else if (_ = accept(result)) {
            if (kind === "field") initializers.unshift(_);
            else descriptor[key] = _;
        }
    }
    if (target) Object.defineProperty(target, contextIn.name, descriptor);
    done = true;
};
var __runInitializers = (this && this.__runInitializers) || function (thisArg, initializers, value) {
    var useValue = arguments.length > 2;
    for (var i = 0; i < initializers.length; i++) {
        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);
    }
    return useValue ? value : void 0;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.TarVariableService = void 0;
const common_1 = require("@nestjs/common");
const TarVariableSystem_1 = require("../../../apps/vcptoolbox/src/modules/core/TarVariableSystem");
let TarVariableService = (() => {
    let _classDecorators = [(0, common_1.Injectable)()];
    let _classDescriptor;
    let _classExtraInitializers = [];
    let _classThis;
    var TarVariableService = class {
        static { _classThis = this; }
        static {
            const _metadata = typeof Symbol === "function" && Symbol.metadata ? Object.create(null) : void 0;
            __esDecorate(null, _classDescriptor = { value: _classThis }, _classDecorators, { kind: "class", name: _classThis.name, metadata: _metadata }, null, _classExtraInitializers);
            TarVariableService = _classThis = _classDescriptor.value;
            if (_metadata) Object.defineProperty(_classThis, Symbol.metadata, { enumerable: true, configurable: true, writable: true, value: _metadata });
            __runInitializers(_classThis, _classExtraInitializers);
        }
        configService;
        logger = new common_1.Logger(TarVariableService.name);
        constructor(configService) {
            this.configService = configService;
        }
        async onModuleInit() {
            await this.initializeSystemVariables();
            this.setupDynamicUpdates();
            this.logger.log('Tar* 变量系统已初始化');
        }
        // ==================== 系统变量初始化 ====================
        /**
         * 初始化系统变量
         */
        async initializeSystemVariables() {
            // 时间相关变量
            await this.registerSystemVariable({
                name: 'VarTimeNow',
                value: () => new Date().toLocaleString('zh-CN'),
                type: 'dynamic',
                scope: 'global',
                dependencies: [],
                metadata: {
                    description: '当前时间（中文格式）',
                    author: 'system',
                    tags: ['time', 'system', 'narrative']
                }
            });
            // 位置相关变量（简化实现，实际应该调用地理位置API）
            await this.registerSystemVariable({
                name: 'VarCity',
                value: this.configService.get('DEFAULT_CITY', '北京市'),
                type: 'dynamic',
                scope: 'global',
                dependencies: [],
                updater: async () => {
                    // 实际实现中应该调用地理位置服务
                    return this.configService.get('DEFAULT_CITY', '北京市');
                },
                metadata: {
                    description: '当前位置城市',
                    author: 'system',
                    tags: ['location', 'system', 'narrative']
                }
            });
            // 天气信息变量
            await this.registerSystemVariable({
                name: 'VCPWeatherInfo',
                value: '晴天，温度适中',
                type: 'dynamic',
                scope: 'global',
                dependencies: ['VarCity'],
                updater: async (context) => {
                    const city = await this.getVariableValue('VarCity', context);
                    // 实际实现中应该调用天气API
                    return `${city} - 晴天，温度20-25°C，适合创作`;
                },
                metadata: {
                    description: '天气信息，用于叙事环境设定',
                    author: 'system',
                    tags: ['weather', 'system', 'narrative']
                }
            });
            // 用户相关变量
            await this.registerSystemVariable({
                name: 'UserName',
                value: '创作者',
                type: 'dynamic',
                scope: 'session',
                dependencies: [],
                metadata: {
                    description: '当前用户名称',
                    author: 'system',
                    tags: ['user', 'session', 'narrative']
                }
            });
            // 创作风格变量
            await this.registerSystemVariable({
                name: 'NarrativeStyle',
                value: this.configService.get('DEFAULT_NARRATIVE_STYLE', '现代现实主义'),
                type: 'dynamic',
                scope: 'session',
                dependencies: [],
                metadata: {
                    description: '当前叙事风格',
                    author: 'system',
                    tags: ['narrative', 'style', 'session']
                }
            });
            // AI模型配置变量
            await this.registerSystemVariable({
                name: 'AIModelConfig',
                value: {
                    provider: this.configService.get('AI_PROVIDER', 'openai'),
                    model: this.configService.get('AI_MODEL', 'gpt-4'),
                    temperature: 0.7,
                    maxTokens: 2000
                },
                type: 'static',
                scope: 'global',
                dependencies: [],
                metadata: {
                    description: 'AI模型配置参数',
                    author: 'system',
                    tags: ['ai', 'config', 'model']
                }
            });
            // 故事世界设定变量
            await this.registerSystemVariable({
                name: 'WorldSetting',
                value: '现代都市',
                type: 'dynamic',
                scope: 'session',
                dependencies: [],
                metadata: {
                    description: '当前故事世界设定',
                    author: 'system',
                    tags: ['world', 'setting', 'narrative']
                }
            });
            // 角色性格模板变量
            await this.registerSystemVariable({
                name: 'CharacterTemplate',
                value: 'balanced',
                type: 'dynamic',
                scope: 'task',
                dependencies: [],
                metadata: {
                    description: '角色性格模板',
                    author: 'system',
                    tags: ['character', 'template', 'narrative']
                }
            });
            // 工具列表变量（VCP兼容）
            await this.registerSystemVariable({
                name: 'VarToolList',
                value: '文生图工具{{VCPFluxGen}},对话生成工具{{VCPDialogueGen}},情感分析工具{{VCPEmotionAnalyzer}}',
                type: 'computed',
                scope: 'agent',
                dependencies: ['VCPFluxGen', 'VCPDialogueGen', 'VCPEmotionAnalyzer'],
                metadata: {
                    description: '可用工具列表（VCP格式）',
                    author: 'system',
                    tags: ['tools', 'vcp', 'agent']
                }
            });
        }
        // ==================== 变量管理接口 ====================
        /**
         * 注册系统变量
         */
        async registerSystemVariable(variable) {
            try {
                TarVariableSystem_1.tarVariableManager.registerVariable(variable);
                this.logger.debug(`系统变量已注册: ${variable.name}`);
            }
            catch (error) {
                this.logger.error(`注册系统变量失败 ${variable.name}:`, error);
            }
        }
        /**
         * 获取变量值
         */
        async getVariableValue(name, context) {
            try {
                return await TarVariableSystem_1.tarVariableManager.getVariableValue(name, context);
            }
            catch (error) {
                this.logger.warn(`获取变量值失败 ${name}:`, error);
                return null;
            }
        }
        /**
         * 设置变量值
         */
        async setVariableValue(name, value, context) {
            try {
                TarVariableSystem_1.tarVariableManager.setVariableValue(name, value, context);
                this.logger.debug(`变量值已设置: ${name} = ${value}`);
            }
            catch (error) {
                this.logger.error(`设置变量值失败 ${name}:`, error);
                throw error;
            }
        }
        /**
         * 批量获取变量值
         */
        async getMultipleValues(names, context) {
            return await TarVariableSystem_1.tarVariableManager.getMultipleValues(names, context);
        }
        /**
         * 处理嵌套变量替换
         */
        async processNestedVariables(template, context) {
            try {
                return await TarVariableSystem_1.tarVariableManager.processNestedVariables(template, context);
            }
            catch (error) {
                this.logger.warn(`变量替换失败:`, error);
                return template; // 返回原模板
            }
        }
        /**
         * 监听变量变化
         */
        watchVariable(name, callback) {
            return TarVariableSystem_1.tarVariableManager.watchVariable(name, callback);
        }
        // ==================== 动态更新设置 ====================
        /**
         * 设置动态更新
         */
        setupDynamicUpdates() {
            // 设置时间变量的定期更新
            setInterval(async () => {
                try {
                    await this.updateTimeVariables();
                }
                catch (error) {
                    this.logger.error('更新时间变量失败:', error);
                }
            }, 60000); // 每分钟更新
            // 设置用户状态变量的监听
            this.watchVariable('UserName', (variable) => {
                this.logger.debug(`用户名已更新: ${variable.value}`);
                // 触发相关变量的重新计算
                TarVariableSystem_1.tarVariableManager.triggerVariableUpdate('NarrativeStyle');
            });
            // 设置世界设定变化的监听
            this.watchVariable('WorldSetting', async (variable) => {
                this.logger.debug(`世界设定已更新: ${variable.value}`);
                // 根据世界设定调整相关变量
                await this.adjustVariablesForWorldSetting(variable.value);
            });
        }
        /**
         * 更新时间相关变量
         */
        async updateTimeVariables() {
            const now = new Date();
            const context = {
                environment: { timestamp: now.getTime() },
                timestamp: now
            };
            // 触发时间变量更新
            TarVariableSystem_1.tarVariableManager.triggerVariableUpdate('VarTimeNow', context);
            TarVariableSystem_1.tarVariableManager.triggerVariableUpdate('VCPWeatherInfo', context);
        }
        /**
         * 根据世界设定调整变量
         */
        async adjustVariablesForWorldSetting(worldSetting) {
            const settingAdjustments = {
                '现代都市': {
                    narrativeStyle: '现实主义',
                    characterTemplate: 'urban-professional'
                },
                '奇幻世界': {
                    narrativeStyle: '奇幻史诗',
                    characterTemplate: 'heroic-fantasy'
                },
                '科幻未来': {
                    narrativeStyle: '赛博朋克',
                    characterTemplate: 'cybernetic-enhanced'
                },
                '历史古代': {
                    narrativeStyle: '古典文学',
                    characterTemplate: 'historical-figure'
                }
            };
            const adjustments = settingAdjustments[worldSetting];
            if (adjustments) {
                await this.setVariableValue('NarrativeStyle', adjustments.narrativeStyle);
                await this.setVariableValue('CharacterTemplate', adjustments.characterTemplate);
            }
        }
        // ==================== 叙事专用接口 ====================
        /**
         * 为故事生成准备变量上下文
         */
        async prepareNarrativeContext(storyId, userId) {
            const context = {
                agentId: `narrative-agent-${storyId}`,
                sessionId: storyId,
                userId,
                environment: {},
                timestamp: new Date()
            };
            // 获取相关变量值
            const [timeNow, city, weather, userName, narrativeStyle, worldSetting, characterTemplate] = await Promise.all([
                this.getVariableValue('VarTimeNow', context),
                this.getVariableValue('VarCity', context),
                this.getVariableValue('VCPWeatherInfo', context),
                this.getVariableValue('UserName', context),
                this.getVariableValue('NarrativeStyle', context),
                this.getVariableValue('WorldSetting', context),
                this.getVariableValue('CharacterTemplate', context)
            ]);
            context.environment = {
                timeNow,
                city,
                weather,
                userName,
                narrativeStyle,
                worldSetting,
                characterTemplate
            };
            return context;
        }
        /**
         * 生成叙事提示词
         */
        async generateNarrativePrompt(basePrompt, context) {
            const fullContext = context || await this.prepareNarrativeContext('default');
            // 构建增强的提示词
            const enhancedPrompt = `
当前环境信息：
- 时间：{{VarTimeNow}}
- 地点：{{VarCity}}
- 天气：{{VCPWeatherInfo}}
- 用户：{{UserName}}
- 叙事风格：{{NarrativeStyle}}
- 世界设定：{{WorldSetting}}
- 角色模板：{{CharacterTemplate}}

原始创作需求：${basePrompt}

请基于以上环境信息，创作符合当前设定和风格的故事内容。
`;
            return await this.processNestedVariables(enhancedPrompt, fullContext);
        }
        /**
         * 更新用户创作偏好
         */
        async updateUserPreferences(userId, preferences) {
            const context = {
                userId,
                environment: {},
                timestamp: new Date()
            };
            if (preferences.narrativeStyle) {
                await this.setVariableValue('NarrativeStyle', preferences.narrativeStyle, context);
            }
            if (preferences.worldSetting) {
                await this.setVariableValue('WorldSetting', preferences.worldSetting, context);
            }
            if (preferences.characterTemplate) {
                await this.setVariableValue('CharacterTemplate', preferences.characterTemplate, context);
            }
            this.logger.log(`用户偏好已更新: ${userId}`);
        }
        // ==================== 工具集成接口 ====================
        /**
         * 获取工具配置
         */
        async getToolConfig(toolName) {
            const toolConfig = await this.getVariableValue(`VCP${toolName}`);
            return toolConfig || null;
        }
        /**
         * 注册工具变量
         */
        async registerToolVariable(toolName, config) {
            await this.registerSystemVariable({
                name: `VCP${toolName}`,
                value: config,
                type: 'static',
                scope: 'global',
                dependencies: [],
                metadata: {
                    description: `${toolName} 工具配置`,
                    author: 'system',
                    tags: ['tool', 'vcp', 'config']
                }
            });
        }
        // ==================== 监控和统计 ====================
        /**
         * 获取变量系统统计
         */
        getVariableStats() {
            // 这里可以返回变量系统的统计信息
            return {
                totalVariables: 0, // 实际实现中应该从tarVariableManager获取
                activeWatchers: 0,
                recentUpdates: []
            };
        }
        /**
         * 清理过期变量
         */
        async cleanupExpiredVariables() {
            // 清理逻辑
            this.logger.log('变量清理完成');
        }
    };
    return TarVariableService = _classThis;
})();
exports.TarVariableService = TarVariableService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFx2Y3BcXHRhci12YXJpYWJsZS5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7QUFBQSwrRUFBK0U7QUFDL0UsZ0JBQWdCO0FBQ2hCLDZCQUE2QjtBQUM3QiwrRUFBK0U7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFL0UsMkNBQWlFO0FBRWpFLG1HQUE4SDtJQUdqSCxrQkFBa0I7NEJBRDlCLElBQUEsbUJBQVUsR0FBRTs7Ozs7Ozs7WUFDYiw2S0ErYkM7OztZQS9iWSx1REFBa0I7O1FBR1QsYUFBYTtRQUZoQixNQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFN0QsWUFBb0IsYUFBNEI7WUFBNUIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFBRyxDQUFDO1FBRXBELEtBQUssQ0FBQyxZQUFZO1lBQ2hCLE1BQU0sSUFBSSxDQUFDLHlCQUF5QixFQUFFLENBQUE7WUFDdEMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUE7WUFDMUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLENBQUE7UUFDbEMsQ0FBQztRQUVELG9EQUFvRDtRQUVwRDs7V0FFRztRQUNLLEtBQUssQ0FBQyx5QkFBeUI7WUFDckMsU0FBUztZQUNULE1BQU0sSUFBSSxDQUFDLHNCQUFzQixDQUFDO2dCQUNoQyxJQUFJLEVBQUUsWUFBWTtnQkFDbEIsS0FBSyxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQztnQkFDL0MsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsS0FBSyxFQUFFLFFBQVE7Z0JBQ2YsWUFBWSxFQUFFLEVBQUU7Z0JBQ2hCLFFBQVEsRUFBRTtvQkFDUixXQUFXLEVBQUUsWUFBWTtvQkFDekIsTUFBTSxFQUFFLFFBQVE7b0JBQ2hCLElBQUksRUFB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LENBQUMsc0JBQXNCLENBQUM7Z0JBQ2hDLElBQUksRUFBRSxNQUFNLFFBQVEsRUFBRTtnQkFDdEIsS0FBSyxFQUFFLE1BQU07Z0JBQ2IsSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsS0FBSyxFQUFFLFFBQVE7Z0JBQ2YsWUFBWSxFQUFFLEVBQUU7Z0JBQ2hCLFFBQVEsRUFBRTtvQkFDUixXQUFXLEVBQUUsR0FBRyxRQUFRLE9BQU87b0JBQy9CLE1BQU0sRUFBRSxRQUFRO29CQUNoQixJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQztpQkFDaEM7YUFDRixDQUFDLENBQUE7UUFDSixDQUFDO1FBRUQsa0RBQWtEO1FBRWxEOztXQUVHO1FBQ0gsZ0JBQWdCO1lBQ2Qsa0JBQWtCO1lBQ2xCLE9BQU87Z0JBQ0wsY0FBYyxFQUFFLENBQUMsRUFBRSwrQkFBK0I7Z0JBQ2xELGNBQWMsRUFBRSxDQUFDO2dCQUNqQixhQUFhLEVBQUUsRUFBRTthQUNsQixDQUFBO1FBQ0gsQ0FBQztRQUVEOztXQUVHO1FBQ0gsS0FBSyxDQUFDLHVCQUF1QjtZQUMzQixPQUFPO1lBQ1AsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDM0IsQ0FBQzs7OztBQTliVSxnREFBa0IiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFx2Y3BcXHRhci12YXJpYWJsZS5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gVGFyKiDlj5jph4/ns7vnu5/pm4bmiJDmnI3liqFcclxuLy8g6ZuG5oiQIFZDUFRvb2xCb3gg55qE5Yqo5oCB6YWN572u5ZKM546v5aKD5oSf55+l6IO95YqbXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmltcG9ydCB7IEluamVjdGFibGUsIExvZ2dlciwgT25Nb2R1bGVJbml0IH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nXHJcbmltcG9ydCB7IENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZydcclxuaW1wb3J0IHsgdGFyVmFyaWFibGVNYW5hZ2VyLCBUYXJWYXJpYWJsZSwgVmFyaWFibGVDb250ZXh0IH0gZnJvbSAnLi4vLi4vLi4vYXBwcy92Y3B0b29sYm94L3NyYy9tb2R1bGVzL2NvcmUvVGFyVmFyaWFibGVTeXN0ZW0nXHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBUYXJWYXJpYWJsZVNlcnZpY2UgaW1wbGVtZW50cyBPbk1vZHVsZUluaXQge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihUYXJWYXJpYWJsZVNlcnZpY2UubmFtZSlcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjb25maWdTZXJ2aWNlOiBDb25maWdTZXJ2aWNlKSB7fVxyXG5cclxuICBhc3luYyBvbk1vZHVsZUluaXQoKSB7XHJcbiAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVTeXN0ZW1WYXJpYWJsZXMoKVxyXG4gICAgdGhpcy5zZXR1cER5bmFtaWNVcGRhdGVzKClcclxuICAgIHRoaXMubG9nZ2VyLmxvZygnVGFyKiDlj5jph4/ns7vnu5/lt7LliJ3lp4vljJYnKVxyXG4gIH1cclxuXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT0g57O757uf5Y+Y6YeP5Yid5aeL5YyWID09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIneWni+WMluezu+e7n+WPmOmHj1xyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgaW5pdGlhbGl6ZVN5c3RlbVZhcmlhYmxlcygpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIC8vIOaXtumXtOebuOWFs+WPmOmHj1xyXG4gICAgYXdhaXQgdGhpcy5yZWdpc3RlclN5c3RlbVZhcmlhYmxlKHtcclxuICAgICAgbmFtZTogJ1ZhclRpbWVOb3cnLFxyXG4gICAgICB2YWx1ZTogKCkgPT4gbmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygnemgtQ04nKSxcclxuICAgICAgdHlwZTogJ2R5bmFtaWMnLFxyXG4gICAgICBzY29wZTogJ2dsb2JhbCcsXHJcbiAgICAgIGRlcGVuZGVuY2llczogW10sXHJcbiAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgZGVzY3JpcHRpb246ICflvZPliY3ml7bpl7TvvIjkuK3mlofmoLzlvI/vvIknLFxyXG4gICAgICAgIGF1dGhvcjogJ3N5c3RlbScsXHJcbiAgICAgICAgdGFnczogWyd0aW1lJywgJ3N5c3RlbScsICduYXJyYXRpdmUnXVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIC8vIOS9jee9ruebuOWFs+WPmOmHj++8iOeugOWMluWunueOsO+8jOWunumZheW6lOivpeiwg+eUqOWcsOeQhuS9jee9rkFQSe+8iVxyXG4gICAgYXdhaXQgdGhpcy5yZWdpc3RlclN5c3RlbVZhcmlhYmxlKHtcclxuICAgICAgbmFtZTogJ1ZhckNpdHknLFxyXG4gICAgICB2YWx1ZTogdGhpcy5jb25maWdTZXJ2aWNlLmdldCgnREVGQVVMVF9DSVRZJywgJ+WMl+S6rOW4gicpLFxyXG4gICAgICB0eXBlOiAnZHluYW1pYycsXHJcbiAgICAgIHNjb3BlOiAnZ2xvYmFsJyxcclxuICAgICAgZGVwZW5kZW5jaWVzOiBbXSxcclxuICAgICAgdXBkYXRlcjogYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIC8vIOWunumZheWunueOsOS4reW6lOivpeiwg+eUqOWcsOeQhuS9jee9ruacjeWKoVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0KCdERUZBVUxUX0NJVFknLCAn5YyX5Lqs5biCJylcclxuICAgICAgfSxcclxuICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICBkZXNjcmlwdGlvbjogJ+W9k+WJjeS9jee9ruWfjuW4gicsXHJcbiAgICAgICAgYXV0aG9yOiAnc3lzdGVtJyxcclxuICAgICAgICB0YWdzOiBbJ2xvY2F0aW9uJywgJ3N5c3RlbScsICduYXJyYXRpdmUnXVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIC8vIOWkqeawlOS/oeaBr+WPmOmHj1xyXG4gICAgYXdhaXQgdGhpcy5yZWdpc3RlclN5c3RlbVZhcmlhYmxlKHtcclxuICAgICAgbmFtZTogJ1ZDUFdlYXRoZXJJbmZvJyxcclxuICAgICAgdmFsdWU6ICfmmbTlpKnvvIzmuKnluqbpgILkuK0nLFxyXG4gICAgICB0eXBlOiAnZHluYW1pYycsXHJcbiAgICAgIHNjb3BlOiAnZ2xvYmFsJyxcclxuICAgICAgZGVwZW5kZW5jaWVzOiBbJ1ZhckNpdHknXSxcclxuICAgICAgdXBkYXRlcjogYXN5bmMgKGNvbnRleHQ6IFZhcmlhYmxlQ29udGV4dCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNpdHkgPSBhd2FpdCB0aGlzLmdldFZhcmlhYmxlVmFsdWUoJ1ZhckNpdHknLCBjb250ZXh0KVxyXG4gICAgICAgIC8vIOWunumZheWunueOsOS4reW6lOivpeiwg+eUqOWkqeawlEFQSVxyXG4gICAgICAgIHJldHVybiBgJHtjaXR5fSAtIOaZtOWkqe+8jOa4qeW6pjIwLTI1wrBD77yM6YCC5ZCI5Yib5L2cYFxyXG4gICAgICB9LFxyXG4gICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAn5aSp5rCU5L+h5oGv77yM55So5LqO5Y+Z5LqL546v5aKD6K6+5a6aJyxcclxuICAgICAgICBhdXRob3I6ICdzeXN0ZW0nLFxyXG4gICAgICAgIHRhZ3M6IFsnd2VhdGhlcicsICdzeXN0ZW0nLCAnbmFycmF0aXZlJ11cclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICAvLyDnlKjmiLfnm7jlhbPlj5jph49cclxuICAgIGF3YWl0IHRoaXMucmVnaXN0ZXJTeXN0ZW1WYXJpYWJsZSh7XHJcbiAgICAgIG5hbWU6ICdVc2VyTmFtZScsXHJcbiAgICAgIHZhbHVlOiAn5Yib5L2c6ICFJyxcclxuICAgICAgdHlwZTogJ2R5bmFtaWMnLFxyXG4gICAgICBzY29wZTogJ3Nlc3Npb24nLFxyXG4gICAgICBkZXBlbmRlbmNpZXM6IFtdLFxyXG4gICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAn5b2T5YmN55So5oi35ZCN56ewJyxcclxuICAgICAgICBhdXRob3I6ICdzeXN0ZW0nLFxyXG4gICAgICAgIHRhZ3M6IFsndXNlcicsICdzZXNzaW9uJywgJ25hcnJhdGl2ZSddXHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgLy8g5Yib5L2c6aOO5qC85Y+Y6YePXHJcbiAgICBhd2FpdCB0aGlzLnJlZ2lzdGVyU3lzdGVtVmFyaWFibGUoe1xyXG4gICAgICBuYW1lOiAnTmFycmF0aXZlU3R5bGUnLFxyXG4gICAgICB2YWx1ZTogdGhpcy5jb25maWdTZXJ2aWNlLmdldCgnREVGQVVMVF9OQVJSQVRJVkVfU1RZTEUnLCAn546w5Luj546w5a6e5Li75LmJJyksXHJcbiAgICAgIHR5cGU6ICdkeW5hbWljJyxcclxuICAgICAgc2NvcGU6ICdzZXNzaW9uJyxcclxuICAgICAgZGVwZW5kZW5jaWVzOiBbXSxcclxuICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICBkZXNjcmlwdGlvbjogJ+W9k+WJjeWPmeS6i+mjjuagvCcsXHJcbiAgICAgICAgYXV0aG9yOiAnc3lzdGVtJyxcclxuICAgICAgICB0YWdzOiBbJ25hcnJhdGl2ZScsICdzdHlsZScsICdzZXNzaW9uJ11cclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICAvLyBBSeaooeWei+mFjee9ruWPmOmHj1xyXG4gICAgYXdhaXQgdGhpcy5yZWdpc3RlclN5c3RlbVZhcmlhYmxlKHtcclxuICAgICAgbmFtZTogJ0FJTW9kZWxDb25maWcnLFxyXG4gICAgICB2YWx1ZToge1xyXG4gICAgICAgIHByb3ZpZGVyOiB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0KCdBSV9QUk9WSURFUicsICdvcGVuYWknKSxcclxuICAgICAgICBtb2RlbDogdGhpcy5jb25maWdTZXJ2aWNlLmdldCgnQUlfTU9ERUwnLCAnZ3B0LTQnKSxcclxuICAgICAgICB0ZW1wZXJhdHVyZTogMC43LFxyXG4gICAgICAgIG1heFRva2VuczogMjAwMFxyXG4gICAgICB9LFxyXG4gICAgICB0eXBlOiAnc3RhdGljJyxcclxuICAgICAgc2NvcGU6ICdnbG9iYWwnLFxyXG4gICAgICBkZXBlbmRlbmNpZXM6IFtdLFxyXG4gICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQUnmqKHlnovphY3nva7lj4LmlbAnLFxyXG4gICAgICAgIGF1dGhvcjogJ3N5c3RlbScsXHJcbiAgICAgICAgdGFnczogWydhaScsICdjb25maWcnLCAnbW9kZWwnXVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIC8vIOaVheS6i+S4lueVjOiuvuWumuWPmOmHj1xyXG4gICAgYXdhaXQgdGhpcy5yZWdpc3RlclN5c3RlbVZhcmlhYmxlKHtcclxuICAgICAgbmFtZTogJ1dvcmxkU2V0dGluZycsXHJcbiAgICAgIHZhbHVlOiAn546w5Luj6YO95biCJyxcclxuICAgICAgdHlwZTogJ2R5bmFtaWMnLFxyXG4gICAgICBzY29wZTogJ3Nlc3Npb24nLFxyXG4gICAgICBkZXBlbmRlbmNpZXM6IFtdLFxyXG4gICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAn5b2T5YmN5pWF5LqL5LiW55WM6K6+5a6aJyxcclxuICAgICAgICBhdXRob3I6ICdzeXN0ZW0nLFxyXG4gICAgICAgIHRhZ3M6IFsnd29ybGQnLCAnc2V0dGluZycsICduYXJyYXRpdmUnXVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIC8vIOinkuiJsuaAp+agvOaooeadv+WPmOmHj1xyXG4gICAgYXdhaXQgdGhpcy5yZWdpc3RlclN5c3RlbVZhcmlhYmxlKHtcclxuICAgICAgbmFtZTogJ0NoYXJhY3RlclRlbXBsYXRlJyxcclxuICAgICAgdmFsdWU6ICdiYWxhbmNlZCcsXHJcbiAgICAgIHR5cGU6ICdkeW5hbWljJyxcclxuICAgICAgc2NvcGU6ICd0YXNrJyxcclxuICAgICAgZGVwZW5kZW5jaWVzOiBbXSxcclxuICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICBkZXNjcmlwdGlvbjogJ+inkuiJsuaAp+agvOaooeadvycsXHJcbiAgICAgICAgYXV0aG9yOiAnc3lzdGVtJyxcclxuICAgICAgICB0YWdzOiBbJ2NoYXJhY3RlcicsICd0ZW1wbGF0ZScsICduYXJyYXRpdmUnXVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIC8vIOW3peWFt+WIl+ihqOWPmOmHj++8iFZDUOWFvOWuue+8iVxyXG4gICAgYXdhaXQgdGhpcy5yZWdpc3RlclN5c3RlbVZhcmlhYmxlKHtcclxuICAgICAgbmFtZTogJ1ZhclRvb2xMaXN0JyxcclxuICAgICAgdmFsdWU6ICfmlofnlJ/lm77lt6Xlhbd7e1ZDUEZsdXhHZW59fSzlr7nor53nlJ/miJDlt6Xlhbd7e1ZDUERpYWxvZ3VlR2VufX0s5oOF5oSf5YiG5p6Q5bel5YW3e3tWQ1BFbW90aW9uQW5hbHl6ZXJ9fScsXHJcbiAgICAgIHR5cGU6ICdjb21wdXRlZCcsXHJcbiAgICAgIHNjb3BlOiAnYWdlbnQnLFxyXG4gICAgICBkZXBlbmRlbmNpZXM6IFsnVkNQRmx1eEdlbicsICdWQ1BEaWFsb2d1ZUdlbicsICdWQ1BFbW90aW9uQW5hbHl6ZXInXSxcclxuICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICBkZXNjcmlwdGlvbjogJ+WPr+eUqOW3peWFt+WIl+ihqO+8iFZDUOagvOW8j++8iScsXHJcbiAgICAgICAgYXV0aG9yOiAnc3lzdGVtJyxcclxuICAgICAgICB0YWdzOiBbJ3Rvb2xzJywgJ3ZjcCcsICdhZ2VudCddXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PSDlj5jph4/nrqHnkIbmjqXlj6MgPT09PT09PT09PT09PT09PT09PT1cclxuXHJcbiAgLyoqXHJcbiAgICog5rOo5YaM57O757uf5Y+Y6YePXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyByZWdpc3RlclN5c3RlbVZhcmlhYmxlKHZhcmlhYmxlOiBPbWl0PFRhclZhcmlhYmxlLCAnbWV0YWRhdGEnPik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgdGFyVmFyaWFibGVNYW5hZ2VyLnJlZ2lzdGVyVmFyaWFibGUodmFyaWFibGUpXHJcbiAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKGDns7vnu5/lj5jph4/lt7Lms6jlhow6ICR7dmFyaWFibGUubmFtZX1gKVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYOazqOWGjOezu+e7n+WPmOmHj+Wksei0pSAke3ZhcmlhYmxlLm5hbWV9OmAsIGVycm9yKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5Y+Y6YeP5YC8XHJcbiAgICovXHJcbiAgYXN5bmMgZ2V0VmFyaWFibGVWYWx1ZShuYW1lOiBzdHJpbmcsIGNvbnRleHQ/OiBWYXJpYWJsZUNvbnRleHQpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIGF3YWl0IHRhclZhcmlhYmxlTWFuYWdlci5nZXRWYXJpYWJsZVZhbHVlKG5hbWUsIGNvbnRleHQpXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci53YXJuKGDojrflj5blj5jph4/lgLzlpLHotKUgJHtuYW1lfTpgLCBlcnJvcilcclxuICAgICAgcmV0dXJuIG51bGxcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruWPmOmHj+WAvFxyXG4gICAqL1xyXG4gIGFzeW5jIHNldFZhcmlhYmxlVmFsdWUobmFtZTogc3RyaW5nLCB2YWx1ZTogYW55LCBjb250ZXh0PzogVmFyaWFibGVDb250ZXh0KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICB0YXJWYXJpYWJsZU1hbmFnZXIuc2V0VmFyaWFibGVWYWx1ZShuYW1lLCB2YWx1ZSwgY29udGV4dClcclxuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoYOWPmOmHj+WAvOW3suiuvue9rjogJHtuYW1lfSA9ICR7dmFsdWV9YClcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGDorr7nva7lj5jph4/lgLzlpLHotKUgJHtuYW1lfTpgLCBlcnJvcilcclxuICAgICAgdGhyb3cgZXJyb3JcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+iOt+WPluWPmOmHj+WAvFxyXG4gICAqL1xyXG4gIGFzeW5jIGdldE11bHRpcGxlVmFsdWVzKG5hbWVzOiBzdHJpbmdbXSwgY29udGV4dD86IFZhcmlhYmxlQ29udGV4dCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgYW55Pj4ge1xyXG4gICAgcmV0dXJuIGF3YWl0IHRhclZhcmlhYmxlTWFuYWdlci5nZXRNdWx0aXBsZVZhbHVlcyhuYW1lcywgY29udGV4dClcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWkhOeQhuW1jOWll+WPmOmHj+abv+aNolxyXG4gICAqL1xyXG4gIGFzeW5jIHByb2Nlc3NOZXN0ZWRWYXJpYWJsZXModGVtcGxhdGU6IHN0cmluZywgY29udGV4dD86IFZhcmlhYmxlQ29udGV4dCk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICByZXR1cm4gYXdhaXQgdGFyVmFyaWFibGVNYW5hZ2VyLnByb2Nlc3NOZXN0ZWRWYXJpYWJsZXModGVtcGxhdGUsIGNvbnRleHQpXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci53YXJuKGDlj5jph4/mm7/mjaLlpLHotKU6YCwgZXJyb3IpXHJcbiAgICAgIHJldHVybiB0ZW1wbGF0ZSAvLyDov5Tlm57ljp/mqKHmnb9cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOebkeWQrOWPmOmHj+WPmOWMllxyXG4gICAqL1xyXG4gIHdhdGNoVmFyaWFibGUobmFtZTogc3RyaW5nLCBjYWxsYmFjazogKHZhcmlhYmxlOiBUYXJWYXJpYWJsZSkgPT4gdm9pZCk6ICgpID0+IHZvaWQge1xyXG4gICAgcmV0dXJuIHRhclZhcmlhYmxlTWFuYWdlci53YXRjaFZhcmlhYmxlKG5hbWUsIGNhbGxiYWNrKVxyXG4gIH1cclxuXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT0g5Yqo5oCB5pu05paw6K6+572uID09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruWKqOaAgeabtOaWsFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0dXBEeW5hbWljVXBkYXRlcygpOiB2b2lkIHtcclxuICAgIC8vIOiuvue9ruaXtumXtOWPmOmHj+eahOWumuacn+abtOaWsFxyXG4gICAgc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMudXBkYXRlVGltZVZhcmlhYmxlcygpXHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ+abtOaWsOaXtumXtOWPmOmHj+Wksei0pTonLCBlcnJvcilcclxuICAgICAgfVxyXG4gICAgfSwgNjAwMDApIC8vIOavj+WIhumSn+abtOaWsFxyXG5cclxuICAgIC8vIOiuvue9rueUqOaIt+eKtuaAgeWPmOmHj+eahOebkeWQrFxyXG4gICAgdGhpcy53YXRjaFZhcmlhYmxlKCdVc2VyTmFtZScsICh2YXJpYWJsZSkgPT4ge1xyXG4gICAgICB0aGlzLmxvZ2dlci5kZWJ1Zyhg55So5oi35ZCN5bey5pu05pawOiAke3ZhcmlhYmxlLnZhbHVlfWApXHJcbiAgICAgIC8vIOinpuWPkeebuOWFs+WPmOmHj+eahOmHjeaWsOiuoeeul1xyXG4gICAgICB0YXJWYXJpYWJsZU1hbmFnZXIudHJpZ2dlclZhcmlhYmxlVXBkYXRlKCdOYXJyYXRpdmVTdHlsZScpXHJcbiAgICB9KVxyXG5cclxuICAgIC8vIOiuvue9ruS4lueVjOiuvuWumuWPmOWMlueahOebkeWQrFxyXG4gICAgdGhpcy53YXRjaFZhcmlhYmxlKCdXb3JsZFNldHRpbmcnLCBhc3luYyAodmFyaWFibGUpID0+IHtcclxuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoYOS4lueVjOiuvuWumuW3suabtOaWsDogJHt2YXJpYWJsZS52YWx1ZX1gKVxyXG4gICAgICAvLyDmoLnmja7kuJbnlYzorr7lrprosIPmlbTnm7jlhbPlj5jph49cclxuICAgICAgYXdhaXQgdGhpcy5hZGp1c3RWYXJpYWJsZXNGb3JXb3JsZFNldHRpbmcodmFyaWFibGUudmFsdWUpXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5pu05paw5pe26Ze055u45YWz5Y+Y6YePXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyB1cGRhdGVUaW1lVmFyaWFibGVzKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKVxyXG4gICAgY29uc3QgY29udGV4dDogVmFyaWFibGVDb250ZXh0ID0ge1xyXG4gICAgICBlbnZpcm9ubWVudDogeyB0aW1lc3RhbXA6IG5vdy5nZXRUaW1lKCkgfSxcclxuICAgICAgdGltZXN0YW1wOiBub3dcclxuICAgIH1cclxuXHJcbiAgICAvLyDop6blj5Hml7bpl7Tlj5jph4/mm7TmlrBcclxuICAgIHRhclZhcmlhYmxlTWFuYWdlci50cmlnZ2VyVmFyaWFibGVVcGRhdGUoJ1ZhclRpbWVOb3cnLCBjb250ZXh0KVxyXG4gICAgdGFyVmFyaWFibGVNYW5hZ2VyLnRyaWdnZXJWYXJpYWJsZVVwZGF0ZSgnVkNQV2VhdGhlckluZm8nLCBjb250ZXh0KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2u5LiW55WM6K6+5a6a6LCD5pW05Y+Y6YePXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBhZGp1c3RWYXJpYWJsZXNGb3JXb3JsZFNldHRpbmcod29ybGRTZXR0aW5nOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IHNldHRpbmdBZGp1c3RtZW50czogUmVjb3JkPHN0cmluZywgYW55PiA9IHtcclxuICAgICAgJ+eOsOS7o+mDveW4gic6IHtcclxuICAgICAgICBuYXJyYXRpdmVTdHlsZTogJ+eOsOWunuS4u+S5iScsXHJcbiAgICAgICAgY2hhcmFjdGVyVGVtcGxhdGU6ICd1cmJhbi1wcm9mZXNzaW9uYWwnXHJcbiAgICAgIH0sXHJcbiAgICAgICflpYflubvkuJbnlYwnOiB7XHJcbiAgICAgICAgbmFycmF0aXZlU3R5bGU6ICflpYflubvlj7Lor5cnLFxyXG4gICAgICAgIGNoYXJhY3RlclRlbXBsYXRlOiAnaGVyb2ljLWZhbnRhc3knXHJcbiAgICAgIH0sXHJcbiAgICAgICfnp5HlubvmnKrmnaUnOiB7XHJcbiAgICAgICAgbmFycmF0aXZlU3R5bGU6ICfotZvljZrmnIvlhYsnLFxyXG4gICAgICAgIGNoYXJhY3RlclRlbXBsYXRlOiAnY3liZXJuZXRpYy1lbmhhbmNlZCdcclxuICAgICAgfSxcclxuICAgICAgJ+WOhuWPsuWPpOS7oyc6IHtcclxuICAgICAgICBuYXJyYXRpdmVTdHlsZTogJ+WPpOWFuOaWh+WtpicsXHJcbiAgICAgICAgY2hhcmFjdGVyVGVtcGxhdGU6ICdoaXN0b3JpY2FsLWZpZ3VyZSdcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGFkanVzdG1lbnRzID0gc2V0dGluZ0FkanVzdG1lbnRzW3dvcmxkU2V0dGluZ11cclxuICAgIGlmIChhZGp1c3RtZW50cykge1xyXG4gICAgICBhd2FpdCB0aGlzLnNldFZhcmlhYmxlVmFsdWUoJ05hcnJhdGl2ZVN0eWxlJywgYWRqdXN0bWVudHMubmFycmF0aXZlU3R5bGUpXHJcbiAgICAgIGF3YWl0IHRoaXMuc2V0VmFyaWFibGVWYWx1ZSgnQ2hhcmFjdGVyVGVtcGxhdGUnLCBhZGp1c3RtZW50cy5jaGFyYWN0ZXJUZW1wbGF0ZSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09IOWPmeS6i+S4k+eUqOaOpeWPoyA9PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICAvKipcclxuICAgKiDkuLrmlYXkuovnlJ/miJDlh4blpIflj5jph4/kuIrkuIvmlodcclxuICAgKi9cclxuICBhc3luYyBwcmVwYXJlTmFycmF0aXZlQ29udGV4dChzdG9yeUlkOiBzdHJpbmcsIHVzZXJJZD86IHN0cmluZyk6IFByb21pc2U8VmFyaWFibGVDb250ZXh0PiB7XHJcbiAgICBjb25zdCBjb250ZXh0OiBWYXJpYWJsZUNvbnRleHQgPSB7XHJcbiAgICAgIGFnZW50SWQ6IGBuYXJyYXRpdmUtYWdlbnQtJHtzdG9yeUlkfWAsXHJcbiAgICAgIHNlc3Npb25JZDogc3RvcnlJZCxcclxuICAgICAgdXNlcklkLFxyXG4gICAgICBlbnZpcm9ubWVudDoge30sXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOiOt+WPluebuOWFs+WPmOmHj+WAvFxyXG4gICAgY29uc3QgW1xyXG4gICAgICB0aW1lTm93LFxyXG4gICAgICBjaXR5LFxyXG4gICAgICB3ZWF0aGVyLFxyXG4gICAgICB1c2VyTmFtZSxcclxuICAgICAgbmFycmF0aXZlU3R5bGUsXHJcbiAgICAgIHdvcmxkU2V0dGluZyxcclxuICAgICAgY2hhcmFjdGVyVGVtcGxhdGVcclxuICAgIF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICAgIHRoaXMuZ2V0VmFyaWFibGVWYWx1ZSgnVmFyVGltZU5vdycsIGNvbnRleHQpLFxyXG4gICAgICB0aGlzLmdldFZhcmlhYmxlVmFsdWUoJ1ZhckNpdHknLCBjb250ZXh0KSxcclxuICAgICAgdGhpcy5nZXRWYXJpYWJsZVZhbHVlKCdWQ1BXZWF0aGVySW5mbycsIGNvbnRleHQpLFxyXG4gICAgICB0aGlzLmdldFZhcmlhYmxlVmFsdWUoJ1VzZXJOYW1lJywgY29udGV4dCksXHJcbiAgICAgIHRoaXMuZ2V0VmFyaWFibGVWYWx1ZSgnTmFycmF0aXZlU3R5bGUnLCBjb250ZXh0KSxcclxuICAgICAgdGhpcy5nZXRWYXJpYWJsZVZhbHVlKCdXb3JsZFNldHRpbmcnLCBjb250ZXh0KSxcclxuICAgICAgdGhpcy5nZXRWYXJpYWJsZVZhbHVlKCdDaGFyYWN0ZXJUZW1wbGF0ZScsIGNvbnRleHQpXHJcbiAgICBdKVxyXG5cclxuICAgIGNvbnRleHQuZW52aXJvbm1lbnQgPSB7XHJcbiAgICAgIHRpbWVOb3csXHJcbiAgICAgIGNpdHksXHJcbiAgICAgIHdlYXRoZXIsXHJcbiAgICAgIHVzZXJOYW1lLFxyXG4gICAgICBuYXJyYXRpdmVTdHlsZSxcclxuICAgICAgd29ybGRTZXR0aW5nLFxyXG4gICAgICBjaGFyYWN0ZXJUZW1wbGF0ZVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBjb250ZXh0XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnlJ/miJDlj5nkuovmj5DnpLror41cclxuICAgKi9cclxuICBhc3luYyBnZW5lcmF0ZU5hcnJhdGl2ZVByb21wdChiYXNlUHJvbXB0OiBzdHJpbmcsIGNvbnRleHQ/OiBWYXJpYWJsZUNvbnRleHQpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgY29uc3QgZnVsbENvbnRleHQgPSBjb250ZXh0IHx8IGF3YWl0IHRoaXMucHJlcGFyZU5hcnJhdGl2ZUNvbnRleHQoJ2RlZmF1bHQnKVxyXG5cclxuICAgIC8vIOaehOW7uuWinuW8uueahOaPkOekuuivjVxyXG4gICAgY29uc3QgZW5oYW5jZWRQcm9tcHQgPSBgXHJcbuW9k+WJjeeOr+Wig+S/oeaBr++8mlxyXG4tIOaXtumXtO+8mnt7VmFyVGltZU5vd319XHJcbi0g5Zyw54K577yae3tWYXJDaXR5fX1cclxuLSDlpKnmsJTvvJp7e1ZDUFdlYXRoZXJJbmZvfX1cclxuLSDnlKjmiLfvvJp7e1VzZXJOYW1lfX1cclxuLSDlj5nkuovpo47moLzvvJp7e05hcnJhdGl2ZVN0eWxlfX1cclxuLSDkuJbnlYzorr7lrprvvJp7e1dvcmxkU2V0dGluZ319XHJcbi0g6KeS6Imy5qih5p2/77yae3tDaGFyYWN0ZXJUZW1wbGF0ZX19XHJcblxyXG7ljp/lp4vliJvkvZzpnIDmsYLvvJoke2Jhc2VQcm9tcHR9XHJcblxyXG7or7fln7rkuo7ku6XkuIrnjq/looPkv6Hmga/vvIzliJvkvZznrKblkIjlvZPliY3orr7lrprlkozpo47moLznmoTmlYXkuovlhoXlrrnjgIJcclxuYFxyXG5cclxuICAgIHJldHVybiBhd2FpdCB0aGlzLnByb2Nlc3NOZXN0ZWRWYXJpYWJsZXMoZW5oYW5jZWRQcm9tcHQsIGZ1bGxDb250ZXh0KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5pu05paw55So5oi35Yib5L2c5YGP5aW9XHJcbiAgICovXHJcbiAgYXN5bmMgdXBkYXRlVXNlclByZWZlcmVuY2VzKHVzZXJJZDogc3RyaW5nLCBwcmVmZXJlbmNlczoge1xyXG4gICAgbmFycmF0aXZlU3R5bGU/OiBzdHJpbmdcclxuICAgIHdvcmxkU2V0dGluZz86IHN0cmluZ1xyXG4gICAgY2hhcmFjdGVyVGVtcGxhdGU/OiBzdHJpbmdcclxuICB9KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBjb250ZXh0OiBWYXJpYWJsZUNvbnRleHQgPSB7XHJcbiAgICAgIHVzZXJJZCxcclxuICAgICAgZW52aXJvbm1lbnQ6IHt9LFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcclxuICAgIH1cclxuXHJcbiAgICBpZiAocHJlZmVyZW5jZXMubmFycmF0aXZlU3R5bGUpIHtcclxuICAgICAgYXdhaXQgdGhpcy5zZXRWYXJpYWJsZVZhbHVlKCdOYXJyYXRpdmVTdHlsZScsIHByZWZlcmVuY2VzLm5hcnJhdGl2ZVN0eWxlLCBjb250ZXh0KVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChwcmVmZXJlbmNlcy53b3JsZFNldHRpbmcpIHtcclxuICAgICAgYXdhaXQgdGhpcy5zZXRWYXJpYWJsZVZhbHVlKCdXb3JsZFNldHRpbmcnLCBwcmVmZXJlbmNlcy53b3JsZFNldHRpbmcsIGNvbnRleHQpXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHByZWZlcmVuY2VzLmNoYXJhY3RlclRlbXBsYXRlKSB7XHJcbiAgICAgIGF3YWl0IHRoaXMuc2V0VmFyaWFibGVWYWx1ZSgnQ2hhcmFjdGVyVGVtcGxhdGUnLCBwcmVmZXJlbmNlcy5jaGFyYWN0ZXJUZW1wbGF0ZSwgY29udGV4dClcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmxvZ2dlci5sb2coYOeUqOaIt+WBj+WlveW3suabtOaWsDogJHt1c2VySWR9YClcclxuICB9XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09IOW3peWFt+mbhuaIkOaOpeWPoyA9PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5blt6XlhbfphY3nva5cclxuICAgKi9cclxuICBhc3luYyBnZXRUb29sQ29uZmlnKHRvb2xOYW1lOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgY29uc3QgdG9vbENvbmZpZyA9IGF3YWl0IHRoaXMuZ2V0VmFyaWFibGVWYWx1ZShgVkNQJHt0b29sTmFtZX1gKVxyXG4gICAgcmV0dXJuIHRvb2xDb25maWcgfHwgbnVsbFxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5rOo5YaM5bel5YW35Y+Y6YePXHJcbiAgICovXHJcbiAgYXN5bmMgcmVnaXN0ZXJUb29sVmFyaWFibGUodG9vbE5hbWU6IHN0cmluZywgY29uZmlnOiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGF3YWl0IHRoaXMucmVnaXN0ZXJTeXN0ZW1WYXJpYWJsZSh7XHJcbiAgICAgIG5hbWU6IGBWQ1Ake3Rvb2xOYW1lfWAsXHJcbiAgICAgIHZhbHVlOiBjb25maWcsXHJcbiAgICAgIHR5cGU6ICdzdGF0aWMnLFxyXG4gICAgICBzY29wZTogJ2dsb2JhbCcsXHJcbiAgICAgIGRlcGVuZGVuY2llczogW10sXHJcbiAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgZGVzY3JpcHRpb246IGAke3Rvb2xOYW1lfSDlt6XlhbfphY3nva5gLFxyXG4gICAgICAgIGF1dGhvcjogJ3N5c3RlbScsXHJcbiAgICAgICAgdGFnczogWyd0b29sJywgJ3ZjcCcsICdjb25maWcnXVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT0g55uR5o6n5ZKM57uf6K6hID09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWPmOmHj+ezu+e7n+e7n+iuoVxyXG4gICAqL1xyXG4gIGdldFZhcmlhYmxlU3RhdHMoKTogYW55IHtcclxuICAgIC8vIOi/memHjOWPr+S7pei/lOWbnuWPmOmHj+ezu+e7n+eahOe7n+iuoeS/oeaBr1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdG90YWxWYXJpYWJsZXM6IDAsIC8vIOWunumZheWunueOsOS4reW6lOivpeS7jnRhclZhcmlhYmxlTWFuYWdlcuiOt+WPllxyXG4gICAgICBhY3RpdmVXYXRjaGVyczogMCxcclxuICAgICAgcmVjZW50VXBkYXRlczogW11cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOa4heeQhui/h+acn+WPmOmHj1xyXG4gICAqL1xyXG4gIGFzeW5jIGNsZWFudXBFeHBpcmVkVmFyaWFibGVzKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgLy8g5riF55CG6YC76L6RXHJcbiAgICB0aGlzLmxvZ2dlci5sb2coJ+WPmOmHj+a4heeQhuWujOaIkCcpXHJcbiAgfVxyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==