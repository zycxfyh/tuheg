{"file":"C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\types\\queue-message-schemas.ts","mappings":"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","names":[],"sources":["C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\types\\queue-message-schemas.ts"],"sourcesContent":["// 文件路径: packages/common-backend/src/types/queue-message-schemas.ts\n// 职责: 定义所有队列消息的 Zod Schema，用于运行时验证\n//\n// 核心功能:\n// 1. 为所有跨服务消息定义严格的 Schema\n// 2. 确保消息格式在运行时被验证\n// 3. 无效消息被立即丢弃，避免下游错误\n\nimport { z } from 'zod'\nimport { submitActionSchema } from '../dto/submit-action.dto'\nimport { directiveSetSchema } from './state-change-directive.dto'\n\n/**\n * GameCreationPayload Schema\n * 用于验证从 backend-gateway 发往 creation-agent 的创世消息\n */\nexport const gameCreationPayloadSchema = z.object({\n  userId: z.string().min(1, 'UserId must not be empty'),\n  concept: z\n    .string()\n    .min(10, 'Concept must be at least 10 characters long')\n    .max(500, 'Concept must be 500 characters or less'),\n})\n\nexport type GameCreationPayload = z.infer<typeof gameCreationPayloadSchema>\n\n/**\n * GameActionJobData Schema\n * 用于验证从 backend-gateway 发往 logic-agent 的玩家行动消息\n *\n * 注意：gameStateSnapshot 是一个复杂的 Prisma 类型，这里只验证基本结构\n * 详细的结构验证在业务逻辑层进行\n */\nexport const gameActionJobDataSchema = z.object({\n  gameId: z.string().uuid('GameId must be a valid UUID'),\n  userId: z.string().min(1, 'UserId must not be empty'),\n  playerAction: submitActionSchema,\n  gameStateSnapshot: z.object({\n    id: z.string(),\n    name: z.string(),\n    ownerId: z.string(),\n    createdAt: z.union([z.date(), z.string()]), // 支持 Date 对象和 ISO 字符串\n    updatedAt: z.union([z.date(), z.string()]),\n    character: z\n      .object({\n        id: z.string(),\n        gameId: z.string(),\n        name: z.string(),\n        card: z.unknown(), // Prisma Json 类型\n        createdAt: z.union([z.date(), z.string()]),\n        updatedAt: z.union([z.date(), z.string()]),\n      })\n      .nullable()\n      .optional(),\n    worldBook: z\n      .array(\n        z.object({\n          id: z.string(),\n          gameId: z.string(),\n          key: z.string(),\n          content: z.unknown(), // Prisma Json 类型\n          createdAt: z.union([z.date(), z.string()]),\n          updatedAt: z.union([z.date(), z.string()]),\n        })\n      )\n      .optional(),\n  }),\n  correlationId: z.string().optional(),\n})\n\n/**\n * NarrativeRenderingPayload Schema\n * 用于验证从 logic-agent 发往 narrative-agent 的叙事渲染消息\n */\nexport const narrativeRenderingPayloadSchema = z.object({\n  gameId: z.string().uuid('GameId must be a valid UUID'),\n  userId: z.string().min(1, 'UserId must not be empty'),\n  playerAction: submitActionSchema,\n  executedDirectives: directiveSetSchema,\n  correlationId: z.string().min(1, 'CorrelationId must not be empty'),\n})\n\nexport type NarrativeRenderingPayload = z.infer<typeof narrativeRenderingPayloadSchema>\n"],"version":3}