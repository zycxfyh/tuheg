4647cd5a1040182e929d56b1fbc9d9ae
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const zod_1 = require("zod");
const retry_strategy_1 = require("../retry-strategy");
describe('retry-strategy', () => {
    describe('classifyError', () => {
        it('should classify network errors as retryable', () => {
            const error = new Error('ECONNREFUSED');
            const classification = (0, retry_strategy_1.classifyError)(error);
            expect(classification.category).toBe(retry_strategy_1.ErrorCategory.NETWORK);
            expect(classification.shouldRetry).toBe(true);
        });
        it('should classify timeout errors as retryable', () => {
            const error = new Error('ETIMEDOUT');
            const classification = (0, retry_strategy_1.classifyError)(error);
            expect(classification.category).toBe(retry_strategy_1.ErrorCategory.NETWORK);
            expect(classification.shouldRetry).toBe(true);
        });
        it('should classify 429 rate limit errors as retryable', () => {
            const error = Object.assign(new Error('Rate limit exceeded'), {
                status: 429,
            });
            const classification = (0, retry_strategy_1.classifyError)(error);
            expect(classification.category).toBe(retry_strategy_1.ErrorCategory.TEMPORARY_API_ERROR);
            expect(classification.shouldRetry).toBe(true);
        });
        it('should classify 503 errors as retryable', () => {
            const error = Object.assign(new Error('Service unavailable'), {
                statusCode: 503,
            });
            const classification = (0, retry_strategy_1.classifyError)(error);
            expect(classification.category).toBe(retry_strategy_1.ErrorCategory.TEMPORARY_API_ERROR);
            expect(classification.shouldRetry).toBe(true);
        });
        it('should classify 401/403 errors as non-retryable', () => {
            const error401 = Object.assign(new Error('Unauthorized'), {
                status: 401,
            });
            const classification401 = (0, retry_strategy_1.classifyError)(error401);
            expect(classification401.category).toBe(retry_strategy_1.ErrorCategory.AUTHENTICATION_ERROR);
            expect(classification401.shouldRetry).toBe(false);
            const error403 = Object.assign(new Error('Forbidden'), { status: 403 });
            const classification403 = (0, retry_strategy_1.classifyError)(error403);
            expect(classification403.category).toBe(retry_strategy_1.ErrorCategory.AUTHENTICATION_ERROR);
            expect(classification403.shouldRetry).toBe(false);
        });
        it('should classify 400 errors as non-retryable', () => {
            const error = Object.assign(new Error('Bad request'), { status: 400 });
            const classification = (0, retry_strategy_1.classifyError)(error);
            expect(classification.category).toBe(retry_strategy_1.ErrorCategory.INVALID_REQUEST);
            expect(classification.shouldRetry).toBe(false);
        });
        it('should classify Zod validation errors as retryable with feedback', () => {
            const schema = zod_1.z.object({ name: zod_1.z.string() });
            const result = schema.safeParse({});
            expect(result.success).toBe(false);
            if (!result.success) {
                const classification = (0, retry_strategy_1.classifyError)(result.error, 'Field name is required');
                expect(classification.category).toBe(retry_strategy_1.ErrorCategory.VALIDATION_ERROR);
                expect(classification.shouldRetry).toBe(true);
                expect(classification.hasFeedback).toBe(true);
                expect(classification.feedback).toBeDefined();
            }
        });
        it('should classify JSON parse errors as retryable', () => {
            const error = new SyntaxError('Unexpected token in JSON');
            const classification = (0, retry_strategy_1.classifyError)(error);
            expect(classification.category).toBe(retry_strategy_1.ErrorCategory.JSON_PARSE_ERROR);
            expect(classification.shouldRetry).toBe(true);
        });
        it('should classify unknown errors as retryable (conservative)', () => {
            const error = new Error('Some unknown error');
            const classification = (0, retry_strategy_1.classifyError)(error);
            expect(classification.category).toBe(retry_strategy_1.ErrorCategory.UNKNOWN);
            expect(classification.shouldRetry).toBe(true);
        });
    });
    describe('calculateRetryDelay', () => {
        it('should calculate exponential backoff', () => {
            const config = { ...retry_strategy_1.DEFAULT_RETRY_CONFIG, enableJitter: false };
            expect((0, retry_strategy_1.calculateRetryDelay)(0, config)).toBe(500); // 500 * 2^0
            expect((0, retry_strategy_1.calculateRetryDelay)(1, config)).toBe(1000); // 500 * 2^1
            expect((0, retry_strategy_1.calculateRetryDelay)(2, config)).toBe(2000); // 500 * 2^2
            expect((0, retry_strategy_1.calculateRetryDelay)(3, config)).toBe(4000); // 500 * 2^3
        });
        it('should cap delay at maxDelayMs', () => {
            const config = {
                ...retry_strategy_1.DEFAULT_RETRY_CONFIG,
                maxDelayMs: 1000,
                enableJitter: false,
            };
            expect((0, retry_strategy_1.calculateRetryDelay)(0, config)).toBe(500);
            expect((0, retry_strategy_1.calculateRetryDelay)(1, config)).toBe(1000);
            expect((0, retry_strategy_1.calculateRetryDelay)(10, config)).toBe(1000); // Capped
        });
        it('should apply jitter when enabled', () => {
            const config = { ...retry_strategy_1.DEFAULT_RETRY_CONFIG, enableJitter: true };
            const delayMs = (0, retry_strategy_1.calculateRetryDelay)(1, config);
            // Jitter should add randomness (though exact values are random)
            expect(delayMs).toBeGreaterThan(0);
            expect(delayMs).toBeLessThanOrEqual(1200); // 1000 * 1.2 (max with 20% jitter)
            // Verify multiple calls produce different values (due to jitter)
            const delays = Array.from({ length: 5 }, () => (0, retry_strategy_1.calculateRetryDelay)(1, config));
            const uniqueDelays = new Set(delays);
            // At least some values should be different (jitter adds randomness)
            expect(uniqueDelays.size).toBeGreaterThan(1);
        });
        it('should never return negative delay', () => {
            const config = { ...retry_strategy_1.DEFAULT_RETRY_CONFIG, enableJitter: true };
            for (let i = 0; i < 10; i++) {
                const delayMs = (0, retry_strategy_1.calculateRetryDelay)(i, config);
                expect(delayMs).toBeGreaterThanOrEqual(0);
            }
        });
    });
    describe('getRecommendedDelay', () => {
        it('should use longer delay for rate limit errors', () => {
            const rateLimitDelay = (0, retry_strategy_1.getRecommendedDelay)(retry_strategy_1.ErrorCategory.TEMPORARY_API_ERROR, 0, retry_strategy_1.DEFAULT_RETRY_CONFIG);
            const networkDelay = (0, retry_strategy_1.getRecommendedDelay)(retry_strategy_1.ErrorCategory.NETWORK, 0, retry_strategy_1.DEFAULT_RETRY_CONFIG);
            // Rate limit should have longer initial delay (2000 vs 500)
            expect(rateLimitDelay).toBeGreaterThan(networkDelay);
        });
        it('should use shorter delay for validation errors', () => {
            const validationDelay = (0, retry_strategy_1.getRecommendedDelay)(retry_strategy_1.ErrorCategory.VALIDATION_ERROR, 0, retry_strategy_1.DEFAULT_RETRY_CONFIG);
            const networkDelay = (0, retry_strategy_1.getRecommendedDelay)(retry_strategy_1.ErrorCategory.NETWORK, 0, retry_strategy_1.DEFAULT_RETRY_CONFIG);
            // Validation errors should have shorter delay (200 vs 500)
            expect(validationDelay).toBeLessThan(networkDelay);
        });
        it('should use standard delay for network errors', () => {
            const delayMs = (0, retry_strategy_1.getRecommendedDelay)(retry_strategy_1.ErrorCategory.NETWORK, 0, retry_strategy_1.DEFAULT_RETRY_CONFIG);
            // With jitter enabled, delay can range from 400ms to 600ms (Â±20% of 500ms)
            expect(delayMs).toBeGreaterThanOrEqual(400);
            expect(delayMs).toBeLessThanOrEqual(600);
        });
    });
    describe('delay', () => {
        it('should delay for specified milliseconds', async () => {
            const start = Date.now();
            await (0, retry_strategy_1.delay)(100);
            const elapsed = Date.now() - start;
            // Should be at least 100ms (may be slightly more due to scheduling)
            expect(elapsed).toBeGreaterThanOrEqual(90);
            expect(elapsed).toBeLessThan(150); // Allow some overhead
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxhaS1kb21haW5cXHNyY1xcYWlcXF9fdGVzdHNfX1xccmV0cnktc3RyYXRlZ3kuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZCQUF1QjtBQUN2QixzREFPMEI7QUFFMUIsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtJQUM5QixRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtRQUM3QixFQUFFLENBQUMsNkNBQTZDLEVBQUUsR0FBRyxFQUFFO1lBQ3JELE1BQU0sS0FBSyxHQUFHLElBQUksS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFBO1lBQ3ZDLE1BQU0sY0FBYyxHQUFHLElBQUEsOEJBQWEsRUFBQyxLQUFLLENBQUMsQ0FBQTtZQUMzQyxNQUFNLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyw4QkFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1lBQzNELE1BQU0sQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQy9DLENBQUMsQ0FBQyxDQUFBO1FBRUYsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEdBQUcsRUFBRTtZQUNyRCxNQUFNLEtBQUssR0FBRyxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQTtZQUNwQyxNQUFNLGNBQWMsR0FBRyxJQUFBLDhCQUFhLEVBQUMsS0FBSyxDQUFDLENBQUE7WUFDM0MsTUFBTSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsOEJBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQTtZQUMzRCxNQUFNLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUMvQyxDQUFDLENBQUMsQ0FBQTtRQUVGLEVBQUUsQ0FBQyxvREFBb0QsRUFBRSxHQUFHLEVBQUU7WUFDNUQsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLE1B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bWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXDE2NjYzXFxEZXNrdG9wXFx0dWhlZ1xccGFja2FnZXNcXGFpLWRvbWFpblxcc3JjXFxhaVxcX190ZXN0c19fXFxyZXRyeS1zdHJhdGVneS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHogfSBmcm9tICd6b2QnXG5pbXBvcnQge1xuICBjYWxjdWxhdGVSZXRyeURlbGF5LFxuICBjbGFzc2lmeUVycm9yLFxuICBERUZBVUxUX1JFVFJZX0NPTkZJRyxcbiAgZGVsYXksXG4gIEVycm9yQ2F0ZWdvcnksXG4gIGdldFJlY29tbWVuZGVkRGVsYXksXG59IGZyb20gJy4uL3JldHJ5LXN0cmF0ZWd5J1xuXG5kZXNjcmliZSgncmV0cnktc3RyYXRlZ3knLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdjbGFzc2lmeUVycm9yJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2xhc3NpZnkgbmV0d29yayBlcnJvcnMgYXMgcmV0cnlhYmxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0VDT05OUkVGVVNFRCcpXG4gICAgICBjb25zdCBjbGFzc2lmaWNhdGlvbiA9IGNsYXNzaWZ5RXJyb3IoZXJyb3IpXG4gICAgICBleHBlY3QoY2xhc3NpZmljYXRpb24uY2F0ZWdvcnkpLnRvQmUoRXJyb3JDYXRlZ29yeS5ORVRXT1JLKVxuICAgICAgZXhwZWN0KGNsYXNzaWZpY2F0aW9uLnNob3VsZFJldHJ5KS50b0JlKHRydWUpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgY2xhc3NpZnkgdGltZW91dCBlcnJvcnMgYXMgcmV0cnlhYmxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0VUSU1FRE9VVCcpXG4gICAgICBjb25zdCBjbGFzc2lmaWNhdGlvbiA9IGNsYXNzaWZ5RXJyb3IoZXJyb3IpXG4gICAgICBleHBlY3QoY2xhc3NpZmljYXRpb24uY2F0ZWdvcnkpLnRvQmUoRXJyb3JDYXRlZ29yeS5ORVRXT1JLKVxuICAgICAgZXhwZWN0KGNsYXNzaWZpY2F0aW9uLnNob3VsZFJldHJ5KS50b0JlKHRydWUpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgY2xhc3NpZnkgNDI5IHJhdGUgbGltaXQgZXJyb3JzIGFzIHJldHJ5YWJsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yID0gT2JqZWN0LmFzc2lnbihuZXcgRXJyb3IoJ1JhdGUgbGltaXQgZXhjZWVkZWQnKSwge1xuICAgICAgICBzdGF0dXM6IDQyOSxcbiAgICAgIH0pXG4gICAgICBjb25zdCBjbGFzc2lmaWNhdGlvbiA9IGNsYXNzaWZ5RXJyb3IoZXJyb3IpXG4gICAgICBleHBlY3QoY2xhc3NpZmljYXRpb24uY2F0ZWdvcnkpLnRvQmUoRXJyb3JDYXRlZ29yeS5URU1QT1JBUllfQVBJX0VSUk9SKVxuICAgICAgZXhwZWN0KGNsYXNzaWZpY2F0aW9uLnNob3VsZFJldHJ5KS50b0JlKHRydWUpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgY2xhc3NpZnkgNTAzIGVycm9ycyBhcyByZXRyeWFibGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IE9iamVjdC5hc3NpZ24obmV3IEVycm9yKCdTZXJ2aWNlIHVuYXZhaWxhYmxlJyksIHtcbiAgICAgICAgc3RhdHVzQ29kZTogNTAzLFxuICAgICAgfSlcbiAgICAgIGNvbnN0IGNsYXNzaWZpY2F0aW9uID0gY2xhc3NpZnlFcnJvcihlcnJvcilcbiAgICAgIGV4cGVjdChjbGFzc2lmaWNhdGlvbi5jYXRlZ29yeSkudG9CZShFcnJvckNhdGVnb3J5LlRFTVBPUkFSWV9BUElfRVJST1IpXG4gICAgICBleHBlY3QoY2xhc3NpZmljYXRpb24uc2hvdWxkUmV0cnkpLnRvQmUodHJ1ZSlcbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBjbGFzc2lmeSA0MDEvNDAzIGVycm9ycyBhcyBub24tcmV0cnlhYmxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3I0MDEgPSBPYmplY3QuYXNzaWduKG5ldyBFcnJvcignVW5hdXRob3JpemVkJyksIHtcbiAgICAgICAgc3RhdHVzOiA0MDEsXG4gICAgICB9KVxuICAgICAgY29uc3QgY2xhc3NpZmljYXRpb240MDEgPSBjbGFzc2lmeUVycm9yKGVycm9yNDAxKVxuICAgICAgZXhwZWN0KGNsYXNzaWZpY2F0aW9uNDAxLmNhdGVnb3J5KS50b0JlKEVycm9yQ2F0ZWdvcnkuQVVUSEVOVElDQVRJT05fRVJST1IpXG4gICAgICBleHBlY3QoY2xhc3NpZmljYXRpb240MDEuc2hvdWxkUmV0cnkpLnRvQmUoZmFsc2UpXG5cbiAgICAgIGNvbnN0IGVycm9yNDAzID0gT2JqZWN0LmFzc2lnbihuZXcgRXJyb3IoJ0ZvcmJpZGRlbicpLCB7IHN0YXR1czogNDAzIH0pXG4gICAgICBjb25zdCBjbGFzc2lmaWNhdGlvbjQwMyA9IGNsYXNzaWZ5RXJyb3IoZXJyb3I0MDMpXG4gICAgICBleHBlY3QoY2xhc3NpZmljYXRpb240MDMuY2F0ZWdvcnkpLnRvQmUoRXJyb3JDYXRlZ29yeS5BVVRIRU5USUNBVElPTl9FUlJPUilcbiAgICAgIGV4cGVjdChjbGFzc2lmaWNhdGlvbjQwMy5zaG91bGRSZXRyeSkudG9CZShmYWxzZSlcbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBjbGFzc2lmeSA0MDAgZXJyb3JzIGFzIG5vbi1yZXRyeWFibGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IE9iamVjdC5hc3NpZ24obmV3IEVycm9yKCdCYWQgcmVxdWVzdCcpLCB7IHN0YXR1czogNDAwIH0pXG4gICAgICBjb25zdCBjbGFzc2lmaWNhdGlvbiA9IGNsYXNzaWZ5RXJyb3IoZXJyb3IpXG4gICAgICBleHBlY3QoY2xhc3NpZmljYXRpb24uY2F0ZWdvcnkpLnRvQmUoRXJyb3JDYXRlZ29yeS5JTlZBTElEX1JFUVVFU1QpXG4gICAgICBleHBlY3QoY2xhc3NpZmljYXRpb24uc2hvdWxkUmV0cnkpLnRvQmUoZmFsc2UpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgY2xhc3NpZnkgWm9kIHZhbGlkYXRpb24gZXJyb3JzIGFzIHJldHJ5YWJsZSB3aXRoIGZlZWRiYWNrJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2NoZW1hID0gei5vYmplY3QoeyBuYW1lOiB6LnN0cmluZygpIH0pXG4gICAgICBjb25zdCByZXN1bHQgPSBzY2hlbWEuc2FmZVBhcnNlKHt9KVxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKVxuXG4gICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGNvbnN0IGNsYXNzaWZpY2F0aW9uID0gY2xhc3NpZnlFcnJvcihyZXN1bHQuZXJyb3IsICdGaWVsZCBuYW1lIGlzIHJlcXVpcmVkJylcbiAgICAgICAgZXhwZWN0KGNsYXNzaWZpY2F0aW9uLmNhdGVnb3J5KS50b0JlKEVycm9yQ2F0ZWdvcnkuVkFMSURBVElPTl9FUlJPUilcbiAgICAgICAgZXhwZWN0KGNsYXNzaWZpY2F0aW9uLnNob3VsZFJldHJ5KS50b0JlKHRydWUpXG4gICAgICAgIGV4cGVjdChjbGFzc2lmaWNhdGlvbi5oYXNGZWVkYmFjaykudG9CZSh0cnVlKVxuICAgICAgICBleHBlY3QoY2xhc3NpZmljYXRpb24uZmVlZGJhY2spLnRvQmVEZWZpbmVkKClcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBjbGFzc2lmeSBKU09OIHBhcnNlIGVycm9ycyBhcyByZXRyeWFibGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBTeW50YXhFcnJvcignVW5leHBlY3RlZCB0b2tlbiBpbiBKU09OJylcbiAgICAgIGNvbnN0IGNsYXNzaWZpY2F0aW9uID0gY2xhc3NpZnlFcnJvcihlcnJvcilcbiAgICAgIGV4cGVjdChjbGFzc2lmaWNhdGlvbi5jYXRlZ29yeSkudG9CZShFcnJvckNhdGVnb3J5LkpTT05fUEFSU0VfRVJST1IpXG4gICAgICBleHBlY3QoY2xhc3NpZmljYXRpb24uc2hvdWxkUmV0cnkpLnRvQmUodHJ1ZSlcbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBjbGFzc2lmeSB1bmtub3duIGVycm9ycyBhcyByZXRyeWFibGUgKGNvbnNlcnZhdGl2ZSknLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignU29tZSB1bmtub3duIGVycm9yJylcbiAgICAgIGNvbnN0IGNsYXNzaWZpY2F0aW9uID0gY2xhc3NpZnlFcnJvcihlcnJvcilcbiAgICAgIGV4cGVjdChjbGFzc2lmaWNhdGlvbi5jYXRlZ29yeSkudG9CZShFcnJvckNhdGVnb3J5LlVOS05PV04pXG4gICAgICBleHBlY3QoY2xhc3NpZmljYXRpb24uc2hvdWxkUmV0cnkpLnRvQmUodHJ1ZSlcbiAgICB9KVxuICB9KVxuXG4gIGRlc2NyaWJlKCdjYWxjdWxhdGVSZXRyeURlbGF5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGV4cG9uZW50aWFsIGJhY2tvZmYnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7IC4uLkRFRkFVTFRfUkVUUllfQ09ORklHLCBlbmFibGVKaXR0ZXI6IGZhbHNlIH1cblxuICAgICAgZXhwZWN0KGNhbGN1bGF0ZVJldHJ5RGVsYXkoMCwgY29uZmlnKSkudG9CZSg1MDApIC8vIDUwMCAqIDJeMFxuICAgICAgZXhwZWN0KGNhbGN1bGF0ZVJldHJ5RGVsYXkoMSwgY29uZmlnKSkudG9CZSgxMDAwKSAvLyA1MDAgKiAyXjFcbiAgICAgIGV4cGVjdChjYWxjdWxhdGVSZXRyeURlbGF5KDIsIGNvbmZpZykpLnRvQmUoMjAwMCkgLy8gNTAwICogMl4yXG4gICAgICBleHBlY3QoY2FsY3VsYXRlUmV0cnlEZWxheSgzLCBjb25maWcpKS50b0JlKDQwMDApIC8vIDUwMCAqIDJeM1xuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIGNhcCBkZWxheSBhdCBtYXhEZWxheU1zJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICAuLi5ERUZBVUxUX1JFVFJZX0NPTkZJRyxcbiAgICAgICAgbWF4RGVsYXlNczogMTAwMCxcbiAgICAgICAgZW5hYmxlSml0dGVyOiBmYWxzZSxcbiAgICAgIH1cblxuICAgICAgZXhwZWN0KGNhbGN1bGF0ZVJldHJ5RGVsYXkoMCwgY29uZmlnKSkudG9CZSg1MDApXG4gICAgICBleHBlY3QoY2FsY3VsYXRlUmV0cnlEZWxheSgxLCBjb25maWcpKS50b0JlKDEwMDApXG4gICAgICBleHBlY3QoY2FsY3VsYXRlUmV0cnlEZWxheSgxMCwgY29uZmlnKSkudG9CZSgxMDAwKSAvLyBDYXBwZWRcbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBhcHBseSBqaXR0ZXIgd2hlbiBlbmFibGVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0geyAuLi5ERUZBVUxUX1JFVFJZX0NPTkZJRywgZW5hYmxlSml0dGVyOiB0cnVlIH1cbiAgICAgIGNvbnN0IGRlbGF5TXMgPSBjYWxjdWxhdGVSZXRyeURlbGF5KDEsIGNvbmZpZylcblxuICAgICAgLy8gSml0dGVyIHNob3VsZCBhZGQgcmFuZG9tbmVzcyAodGhvdWdoIGV4YWN0IHZhbHVlcyBhcmUgcmFuZG9tKVxuICAgICAgZXhwZWN0KGRlbGF5TXMpLnRvQmVHcmVhdGVyVGhhbigwKVxuICAgICAgZXhwZWN0KGRlbGF5TXMpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMTIwMCkgLy8gMTAwMCAqIDEuMiAobWF4IHdpdGggMjAlIGppdHRlcilcblxuICAgICAgLy8gVmVyaWZ5IG11bHRpcGxlIGNhbGxzIHByb2R1Y2UgZGlmZmVyZW50IHZhbHVlcyAoZHVlIHRvIGppdHRlcilcbiAgICAgIGNvbnN0IGRlbGF5cyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDUgfSwgKCkgPT4gY2FsY3VsYXRlUmV0cnlEZWxheSgxLCBjb25maWcpKVxuICAgICAgY29uc3QgdW5pcXVlRGVsYXlzID0gbmV3IFNldChkZWxheXMpXG4gICAgICAvLyBBdCBsZWFzdCBzb21lIHZhbHVlcyBzaG91bGQgYmUgZGlmZmVyZW50IChqaXR0ZXIgYWRkcyByYW5kb21uZXNzKVxuICAgICAgZXhwZWN0KHVuaXF1ZURlbGF5cy5zaXplKS50b0JlR3JlYXRlclRoYW4oMSlcbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBuZXZlciByZXR1cm4gbmVnYXRpdmUgZGVsYXknLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7IC4uLkRFRkFVTFRfUkVUUllfQ09ORklHLCBlbmFibGVKaXR0ZXI6IHRydWUgfVxuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgICAgY29uc3QgZGVsYXlNcyA9IGNhbGN1bGF0ZVJldHJ5RGVsYXkoaSwgY29uZmlnKVxuICAgICAgICBleHBlY3QoZGVsYXlNcykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKVxuICAgICAgfVxuICAgIH0pXG4gIH0pXG5cbiAgZGVzY3JpYmUoJ2dldFJlY29tbWVuZGVkRGVsYXknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB1c2UgbG9uZ2VyIGRlbGF5IGZvciByYXRlIGxpbWl0IGVycm9ycycsICgpID0+IHtcbiAgICAgIGNvbnN0IHJhdGVMaW1pdERlbGF5ID0gZ2V0UmVjb21tZW5kZWREZWxheShcbiAgICAgICAgRXJyb3JDYXRlZ29yeS5URU1QT1JBUllfQVBJX0VSUk9SLFxuICAgICAgICAwLFxuICAgICAgICBERUZBVUxUX1JFVFJZX0NPTkZJR1xuICAgICAgKVxuICAgICAgY29uc3QgbmV0d29ya0RlbGF5ID0gZ2V0UmVjb21tZW5kZWREZWxheShFcnJvckNhdGVnb3J5Lk5FVFdPUkssIDAsIERFRkFVTFRfUkVUUllfQ09ORklHKVxuXG4gICAgICAvLyBSYXRlIGxpbWl0IHNob3VsZCBoYXZlIGxvbmdlciBpbml0aWFsIGRlbGF5ICgyMDAwIHZzIDUwMClcbiAgICAgIGV4cGVjdChyYXRlTGltaXREZWxheSkudG9CZUdyZWF0ZXJUaGFuKG5ldHdvcmtEZWxheSlcbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCB1c2Ugc2hvcnRlciBkZWxheSBmb3IgdmFsaWRhdGlvbiBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZGF0aW9uRGVsYXkgPSBnZXRSZWNvbW1lbmRlZERlbGF5KFxuICAgICAgICBFcnJvckNhdGVnb3J5LlZBTElEQVRJT05fRVJST1IsXG4gICAgICAgIDAsXG4gICAgICAgIERFRkFVTFRfUkVUUllfQ09ORklHXG4gICAgICApXG4gICAgICBjb25zdCBuZXR3b3JrRGVsYXkgPSBnZXRSZWNvbW1lbmRlZERlbGF5KEVycm9yQ2F0ZWdvcnkuTkVUV09SSywgMCwgREVGQVVMVF9SRVRSWV9DT05GSUcpXG5cbiAgICAgIC8vIFZhbGlkYXRpb24gZXJyb3JzIHNob3VsZCBoYXZlIHNob3J0ZXIgZGVsYXkgKDIwMCB2cyA1MDApXG4gICAgICBleHBlY3QodmFsaWRhdGlvbkRlbGF5KS50b0JlTGVzc1RoYW4obmV0d29ya0RlbGF5KVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIHVzZSBzdGFuZGFyZCBkZWxheSBmb3IgbmV0d29yayBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBkZWxheU1zID0gZ2V0UmVjb21tZW5kZWREZWxheShFcnJvckNhdGVnb3J5Lk5FVFdPUkssIDAsIERFRkFVTFRfUkVUUllfQ09ORklHKVxuXG4gICAgICAvLyBXaXRoIGppdHRlciBlbmFibGVkLCBkZWxheSBjYW4gcmFuZ2UgZnJvbSA0MDBtcyB0byA2MDBtcyAowrEyMCUgb2YgNTAwbXMpXG4gICAgICBleHBlY3QoZGVsYXlNcykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCg0MDApXG4gICAgICBleHBlY3QoZGVsYXlNcykudG9CZUxlc3NUaGFuT3JFcXVhbCg2MDApXG4gICAgfSlcbiAgfSlcblxuICBkZXNjcmliZSgnZGVsYXknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBkZWxheSBmb3Igc3BlY2lmaWVkIG1pbGxpc2Vjb25kcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKVxuICAgICAgYXdhaXQgZGVsYXkoMTAwKVxuICAgICAgY29uc3QgZWxhcHNlZCA9IERhdGUubm93KCkgLSBzdGFydFxuXG4gICAgICAvLyBTaG91bGQgYmUgYXQgbGVhc3QgMTAwbXMgKG1heSBiZSBzbGlnaHRseSBtb3JlIGR1ZSB0byBzY2hlZHVsaW5nKVxuICAgICAgZXhwZWN0KGVsYXBzZWQpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoOTApXG4gICAgICBleHBlY3QoZWxhcHNlZCkudG9CZUxlc3NUaGFuKDE1MCkgLy8gQWxsb3cgc29tZSBvdmVyaGVhZFxuICAgIH0pXG4gIH0pXG59KVxuIl0sInZlcnNpb24iOjN9