{"file":"C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\ai\\__tests__\\schema-error-formatter.spec.ts","mappings":"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","names":[],"sources":["C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\ai\\__tests__\\schema-error-formatter.spec.ts"],"sourcesContent":["import { z } from 'zod'\nimport { formatZodError, formatZodErrorAsJson } from './schema-error-formatter'\n\ndescribe('formatZodError', () => {\n  it('should format missing field error', () => {\n    const schema = z.object({\n      name: z.string(),\n      age: z.number(),\n    })\n\n    const result = schema.safeParse({ name: 'John' })\n    expect(result.success).toBe(false)\n\n    if (!result.success) {\n      const formatted = formatZodError(result.error as any)\n      expect(formatted.summary).toContain('Validation failed')\n      expect(formatted.fieldErrors.length).toBeGreaterThan(0)\n      expect(formatted.fieldErrors.some((e) => e.path.includes('age'))).toBe(true)\n      expect(formatted.aiFeedback).toContain('age')\n    }\n  })\n\n  it('should format type mismatch error', () => {\n    const schema = z.object({\n      count: z.number(),\n    })\n\n    const result = schema.safeParse({ count: 'not-a-number' })\n    expect(result.success).toBe(false)\n\n    if (!result.success) {\n      const formatted = formatZodError(result.error as any)\n      expect(formatted.fieldErrors.length).toBeGreaterThan(0)\n      const countError = formatted.fieldErrors.find((e) => e.path === 'count')\n      expect(countError).toBeDefined()\n      expect(countError?.expected).toBe('number')\n      // received 可能为 undefined（如果无法从错误中提取）\n      // 只要错误消息正确就足够了\n    }\n  })\n\n  it('should format enum error', () => {\n    const schema = z.object({\n      status: z.enum(['active', 'inactive', 'pending']),\n    })\n\n    const result = schema.safeParse({ status: 'invalid' })\n    expect(result.success).toBe(false)\n\n    if (!result.success) {\n      const formatted = formatZodError(result.error as any)\n      const statusError = formatted.fieldErrors.find((e) => e.path === 'status')\n      expect(statusError).toBeDefined()\n      expect(statusError?.expected).toContain('active')\n      expect(statusError?.expected).toContain('inactive')\n    }\n  })\n\n  it('should format array length error', () => {\n    const schema = z.object({\n      items: z.array(z.string()).min(2),\n    })\n\n    const result = schema.safeParse({ items: ['one'] })\n    expect(result.success).toBe(false)\n\n    if (!result.success) {\n      const formatted = formatZodError(result.error as any)\n      const itemsError = formatted.fieldErrors.find((e) => e.path === 'items')\n      expect(itemsError).toBeDefined()\n      expect(itemsError?.expected).toContain('at least')\n    }\n  })\n\n  it('should generate AI-friendly feedback', () => {\n    const schema = z.object({\n      name: z.string().min(1),\n      email: z.string().email(),\n    })\n\n    const result = schema.safeParse({\n      name: '',\n      email: 'invalid-email',\n    })\n    expect(result.success).toBe(false)\n\n    if (!result.success) {\n      const formatted = formatZodError(result.error as any)\n      expect(formatted.aiFeedback).toContain('Validation Errors Detected')\n      expect(formatted.aiFeedback).toContain('Action Required')\n      expect(formatted.aiFeedback).toContain('name')\n      expect(formatted.aiFeedback).toContain('email')\n    }\n  })\n\n  it('should handle nested object errors', () => {\n    const schema = z.object({\n      user: z.object({\n        name: z.string(),\n        age: z.number(),\n      }),\n    })\n\n    const result = schema.safeParse({\n      user: { name: 'John' },\n    })\n    expect(result.success).toBe(false)\n\n    if (!result.success) {\n      const formatted = formatZodError(result.error as any)\n      const userAgeError = formatted.fieldErrors.find((e) => e.path.includes('age'))\n      expect(userAgeError).toBeDefined()\n      expect(formatted.aiFeedback).toContain('user')\n    }\n  })\n\n  it('should format as JSON correctly', () => {\n    const schema = z.object({\n      name: z.string(),\n    })\n\n    const result = schema.safeParse({})\n    expect(result.success).toBe(false)\n\n    if (!result.success) {\n      const formatted = formatZodError(result.error)\n      const json = formatZodErrorAsJson(formatted)\n      expect(() => JSON.parse(json)).not.toThrow()\n      const parsed = JSON.parse(json)\n      expect(parsed).toHaveProperty('summary')\n      expect(parsed).toHaveProperty('fieldErrors')\n      expect(parsed).toHaveProperty('errorCount')\n    }\n  })\n})\n"],"version":3}