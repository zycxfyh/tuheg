{"file":"C:\\Users\\16663\\Desktop\\tuheg\\packages\\narrative-domain\\src\\dto\\submit-action.dto.ts","mappings":"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","names":[],"sources":["C:\\Users\\16663\\Desktop\\tuheg\\packages\\narrative-domain\\src\\dto\\submit-action.dto.ts"],"sourcesContent":["// 文件路径: packages/narrative-domain/src/dto/submit-action.dto.ts\n\nimport { z } from 'zod'\n\n// 自定义验证函数：检查控制字符\nconst noControlCharacters = (value: string) => {\n  // 检查是否包含控制字符（除了制表符、换行符、回车符）\n  // 使用字符码检查来避免ESLint的正则表达式控制字符规则\n  for (let i = 0; i < value.length; i++) {\n    const charCode = value.charCodeAt(i)\n    // 排除制表符(\\t=9)、换行符(\\n=10)、回车符(\\r=13)\n    if (\n      (charCode >= 0 && charCode <= 8) ||\n      (charCode >= 11 && charCode <= 12) ||\n      (charCode >= 14 && charCode <= 31) ||\n      charCode === 127\n    ) {\n      return false\n    }\n  }\n  return true\n}\n\n// 自定义验证函数：检查字符串长度\nconst maxLength400 = (value: string) => value.length <= 400\n\n/**\n * @name submitActionSchema\n * @description [联邦法律] 定义了玩家提交一个\"行动\"时，其数据包的标准格式。\n */\nexport const submitActionSchema = z\n  .object({\n    // 'type' 字段区分了不同的行动种类\n    type: z.enum(['option', 'command', 'meta']),\n    // 'payload' 载荷可以是任何东西，具体结构由type决定\n    payload: z.any(),\n  })\n  .superRefine((data, ctx) => {\n    // 根据type进行不同的验证\n    if (data.type === 'command') {\n      // command类型的payload应该是字符串，且不能包含控制字符\n      if (typeof data.payload !== 'string') {\n        ctx.addIssue({\n          code: z.ZodIssueCode.custom,\n          message: 'Command payload must be a string.',\n          path: ['payload'],\n        })\n        return\n      }\n\n      if (!noControlCharacters(data.payload)) {\n        ctx.addIssue({\n          code: z.ZodIssueCode.custom,\n          message: 'Command payload contains invalid control characters.',\n          path: ['payload'],\n        })\n      }\n    } else if (data.type === 'option') {\n      // option类型的payload应该是一个对象，包含text字段\n      if (typeof data.payload !== 'object' || data.payload === null) {\n        ctx.addIssue({\n          code: z.ZodIssueCode.custom,\n          message: 'Option payload must be an object.',\n          path: ['payload'],\n        })\n        return\n      }\n\n      const payload = data.payload as any\n      if (typeof payload.text !== 'string') {\n        ctx.addIssue({\n          code: z.ZodIssueCode.custom,\n          message: 'Option payload text must be a string.',\n          path: ['payload', 'text'],\n        })\n        return\n      }\n\n      if (!maxLength400(payload.text)) {\n        ctx.addIssue({\n          code: z.ZodIssueCode.custom,\n          message: 'Option text must be 400 characters or fewer.',\n          path: ['payload', 'text'],\n        })\n      }\n    }\n    // meta类型暂不进行额外验证\n  })\n\nexport type SubmitActionDto = z.infer<typeof submitActionSchema>"],"version":3}