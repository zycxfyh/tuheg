574797569fee2f8fdf898a8b6486ba4e
"use strict";
// ============================================================================
// Tar* 变量系统集成服务
// 集成 VCPToolBox 的动态配置和环境感知能力
// ============================================================================
var __esDecorate = (this && this.__esDecorate) || function (ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {
    function accept(f) { if (f !== void 0 && typeof f !== "function") throw new TypeError("Function expected"); return f; }
    var kind = contextIn.kind, key = kind === "getter" ? "get" : kind === "setter" ? "set" : "value";
    var target = !descriptorIn && ctor ? contextIn["static"] ? ctor : ctor.prototype : null;
    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});
    var _, done = false;
    for (var i = decorators.length - 1; i >= 0; i--) {
        var context = {};
        for (var p in contextIn) context[p] = p === "access" ? {} : contextIn[p];
        for (var p in contextIn.access) context.access[p] = contextIn.access[p];
        context.addInitializer = function (f) { if (done) throw new TypeError("Cannot add initializers after decoration has completed"); extraInitializers.push(accept(f || null)); };
        var result = (0, decorators[i])(kind === "accessor" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);
        if (kind === "accessor") {
            if (result === void 0) continue;
            if (result === null || typeof result !== "object") throw new TypeError("Object expected");
            if (_ = accept(result.get)) descriptor.get = _;
            if (_ = accept(result.set)) descriptor.set = _;
            if (_ = accept(result.init)) initializers.unshift(_);
        }
        else if (_ = accept(result)) {
            if (kind === "field") initializers.unshift(_);
            else descriptor[key] = _;
        }
    }
    if (target) Object.defineProperty(target, contextIn.name, descriptor);
    done = true;
};
var __runInitializers = (this && this.__runInitializers) || function (thisArg, initializers, value) {
    var useValue = arguments.length > 2;
    for (var i = 0; i < initializers.length; i++) {
        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);
    }
    return useValue ? value : void 0;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.TarVariableService = void 0;
const common_1 = require("@nestjs/common");
const TarVariableSystem_1 = require("../../../apps/vcptoolbox/src/modules/core/TarVariableSystem");
let TarVariableService = (() => {
    let _classDecorators = [(0, common_1.Injectable)()];
    let _classDescriptor;
    let _classExtraInitializers = [];
    let _classThis;
    var TarVariableService = class {
        static { _classThis = this; }
        static {
            const _metadata = typeof Symbol === "function" && Symbol.metadata ? Object.create(null) : void 0;
            __esDecorate(null, _classDescriptor = { value: _classThis }, _classDecorators, { kind: "class", name: _classThis.name, metadata: _metadata }, null, _classExtraInitializers);
            TarVariableService = _classThis = _classDescriptor.value;
            if (_metadata) Object.defineProperty(_classThis, Symbol.metadata, { enumerable: true, configurable: true, writable: true, value: _metadata });
            __runInitializers(_classThis, _classExtraInitializers);
        }
        configService;
        logger = new common_1.Logger(TarVariableService.name);
        constructor(configService) {
            this.configService = configService;
        }
        async onModuleInit() {
            await this.initializeSystemVariables();
            this.setupDynamicUpdates();
            this.logger.log('Tar* 变量系统已初始化');
        }
        // ==================== 系统变量初始化 ====================
        /**
         * 初始化系统变量
         */
        async initializeSystemVariables() {
            // 时间相关变量
            await this.registerSystemVariable({
                name: 'VarTimeNow',
                value: () => new Date().toLocaleString('zh-CN'),
                type: 'dynamic',
                scope: 'global',
                dependencies: [],
                metadata: {
                    description: '当前时间（中文格式）',
                    author: 'system',
                    tags: ['time', 'system', 'narrative'],
                },
            });
            // 位置相关变量（简化实现，实际应该调用地理位置API）
            await this.registerSystemVariable({
                name: 'VarCity',
                value: this.configService.get('DEFAULT_CITY', '北京市'),
                type: 'dynamic',
                scope: 'global',
                dependencies: [],
                updater: async () => {
                    // 实际实现中应该调用地理位置服务
                    return this.configService.get('DEFAULT_CITY', '北京市');
                },
                metadata: {
                    description: '当前位置城市',
                    author: 'system',
                    tags: ['location', 'system', 'narrative'],
                },
            });
            // 天气信息变量
            await this.registerSystemVariable({
                name: 'VCPWeatherInfo',
                value: '晴天，温度适中',
                type: 'dynamic',
                scope: 'global',
                dependencies: ['VarCity'],
                updater: async (context) => {
                    const city = await this.getVariableValue('VarCity', context);
                    // 实际实现中应该调用天气API
                    return `${city} - 晴天，温度20-25°C，适合创作`;
                },
                metadata: {
                    description: '天气信息，用于叙事环境设定',
                    author: 'system',
                    tags: ['weather', 'system', 'narrative'],
                },
            });
            // 用户相关变量
            await this.registerSystemVariable({
                name: 'UserName',
                value: '创作者',
                type: 'dynamic',
                scope: 'session',
                dependencies: [],
                metadata: {
                    description: '当前用户名称',
                    author: 'system',
                    tags: ['user', 'session', 'narrative'],
                },
            });
            // 创作风格变量
            await this.registerSystemVariable({
                name: 'NarrativeStyle',
                value: this.configService.get('DEFAULT_NARRATIVE_STYLE', '现代现实主义'),
                type: 'dynamic',
                scope: 'session',
                dependencies: [],
                metadata: {
                    description: '当前叙事风格',
                    author: 'system',
                    tags: ['narrative', 'style', 'session'],
                },
            });
            // AI模型配置变量
            await this.registerSystemVariable({
                name: 'AIModelConfig',
                value: {
                    provider: this.configService.get('AI_PROVIDER', 'openai'),
                    model: this.configService.get('AI_MODEL', 'gpt-4'),
                    temperature: 0.7,
                    maxTokens: 2000,
                },
                type: 'static',
                scope: 'global',
                dependencies: [],
                metadata: {
                    description: 'AI模型配置参数',
                    author: 'system',
                    tags: ['ai', 'config', 'model'],
                },
            });
            // 故事世界设定变量
            await this.registerSystemVariable({
                name: 'WorldSetting',
                value: '现代都市',
                type: 'dynamic',
                scope: 'session',
                dependencies: [],
                metadata: {
                    description: '当前故事世界设定',
                    author: 'system',
                    tags: ['world', 'setting', 'narrative'],
                },
            });
            // 角色性格模板变量
            await this.registerSystemVariable({
                name: 'CharacterTemplate',
                value: 'balanced',
                type: 'dynamic',
                scope: 'task',
                dependencies: [],
                metadata: {
                    description: '角色性格模板',
                    author: 'system',
                    tags: ['character', 'template', 'narrative'],
                },
            });
            // 工具列表变量（VCP兼容）
            await this.registerSystemVariable({
                name: 'VarToolList',
                value: '文生图工具{{VCPFluxGen}},对话生成工具{{VCPDialogueGen}},情感分析工具{{VCPEmotionAnalyzer}}',
                type: 'computed',
                scope: 'agent',
                dependencies: ['VCPFluxGen', 'VCPDialogueGen', 'VCPEmotionAnalyzer'],
                metadata: {
                    description: '可用工具列表（VCP格式）',
                    author: 'system',
                    tags: ['tools', 'vcp', 'agent'],
                },
            });
        }
        // ==================== 变量管理接口 ====================
        /**
         * 注册系统变量
         */
        async registerSystemVariable(variable) {
            try {
                TarVariableSystem_1.tarVariableManager.registerVariable(variable);
                this.logger.debug(`系统变量已注册: ${variable.name}`);
            }
            catch (error) {
                this.logger.error(`注册系统变量失败 ${variable.name}:`, error);
            }
        }
        /**
         * 获取变量值
         */
        async getVariableValue(name, context) {
            try {
                return await TarVariableSystem_1.tarVariableManager.getVariableValue(name, context);
            }
            catch (error) {
                this.logger.warn(`获取变量值失败 ${name}:`, error);
                return null;
            }
        }
        /**
         * 设置变量值
         */
        async setVariableValue(name, value, context) {
            try {
                TarVariableSystem_1.tarVariableManager.setVariableValue(name, value, context);
                this.logger.debug(`变量值已设置: ${name} = ${value}`);
            }
            catch (error) {
                this.logger.error(`设置变量值失败 ${name}:`, error);
                throw error;
            }
        }
        /**
         * 批量获取变量值
         */
        async getMultipleValues(names, context) {
            return await TarVariableSystem_1.tarVariableManager.getMultipleValues(names, context);
        }
        /**
         * 处理嵌套变量替换
         */
        async processNestedVariables(template, context) {
            try {
                return await TarVariableSystem_1.tarVariableManager.processNestedVariables(template, context);
            }
            catch (error) {
                this.logger.warn(`变量替换失败:`, error);
                return template; // 返回原模板
            }
        }
        /**
         * 监听变量变化
         */
        watchVariable(name, callback) {
            return TarVariableSystem_1.tarVariableManager.watchVariable(name, callback);
        }
        // ==================== 动态更新设置 ====================
        /**
         * 设置动态更新
         */
        setupDynamicUpdates() {
            // 设置时间变量的定期更新
            setInterval(async () => {
                try {
                    await this.updateTimeVariables();
                }
                catch (error) {
                    this.logger.error('更新时间变量失败:', error);
                }
            }, 60000); // 每分钟更新
            // 设置用户状态变量的监听
            this.watchVariable('UserName', (variable) => {
                this.logger.debug(`用户名已更新: ${variable.value}`);
                // 触发相关变量的重新计算
                TarVariableSystem_1.tarVariableManager.triggerVariableUpdate('NarrativeStyle');
            });
            // 设置世界设定变化的监听
            this.watchVariable('WorldSetting', async (variable) => {
                this.logger.debug(`世界设定已更新: ${variable.value}`);
                // 根据世界设定调整相关变量
                await this.adjustVariablesForWorldSetting(variable.value);
            });
        }
        /**
         * 更新时间相关变量
         */
        async updateTimeVariables() {
            const now = new Date();
            const context = {
                environment: { timestamp: now.getTime() },
                timestamp: now,
            };
            // 触发时间变量更新
            TarVariableSystem_1.tarVariableManager.triggerVariableUpdate('VarTimeNow', context);
            TarVariableSystem_1.tarVariableManager.triggerVariableUpdate('VCPWeatherInfo', context);
        }
        /**
         * 根据世界设定调整变量
         */
        async adjustVariablesForWorldSetting(worldSetting) {
            const settingAdjustments = {
                现代都市: {
                    narrativeStyle: '现实主义',
                    characterTemplate: 'urban-professional',
                },
                奇幻世界: {
                    narrativeStyle: '奇幻史诗',
                    characterTemplate: 'heroic-fantasy',
                },
                科幻未来: {
                    narrativeStyle: '赛博朋克',
                    characterTemplate: 'cybernetic-enhanced',
                },
                历史古代: {
                    narrativeStyle: '古典文学',
                    characterTemplate: 'historical-figure',
                },
            };
            const adjustments = settingAdjustments[worldSetting];
            if (adjustments) {
                await this.setVariableValue('NarrativeStyle', adjustments.narrativeStyle);
                await this.setVariableValue('CharacterTemplate', adjustments.characterTemplate);
            }
        }
        // ==================== 叙事专用接口 ====================
        /**
         * 为故事生成准备变量上下文
         */
        async prepareNarrativeContext(storyId, userId) {
            const context = {
                agentId: `narrative-agent-${storyId}`,
                sessionId: storyId,
                userId,
                environment: {},
                timestamp: new Date(),
            };
            // 获取相关变量值
            const [timeNow, city, weather, userName, narrativeStyle, worldSetting, characterTemplate] = await Promise.all([
                this.getVariableValue('VarTimeNow', context),
                this.getVariableValue('VarCity', context),
                this.getVariableValue('VCPWeatherInfo', context),
                this.getVariableValue('UserName', context),
                this.getVariableValue('NarrativeStyle', context),
                this.getVariableValue('WorldSetting', context),
                this.getVariableValue('CharacterTemplate', context),
            ]);
            context.environment = {
                timeNow,
                city,
                weather,
                userName,
                narrativeStyle,
                worldSetting,
                characterTemplate,
            };
            return context;
        }
        /**
         * 生成叙事提示词
         */
        async generateNarrativePrompt(basePrompt, context) {
            const fullContext = context || (await this.prepareNarrativeContext('default'));
            // 构建增强的提示词
            const enhancedPrompt = `
当前环境信息：
- 时间：{{VarTimeNow}}
- 地点：{{VarCity}}
- 天气：{{VCPWeatherInfo}}
- 用户：{{UserName}}
- 叙事风格：{{NarrativeStyle}}
- 世界设定：{{WorldSetting}}
- 角色模板：{{CharacterTemplate}}

原始创作需求：${basePrompt}

请基于以上环境信息，创作符合当前设定和风格的故事内容。
`;
            return await this.processNestedVariables(enhancedPrompt, fullContext);
        }
        /**
         * 更新用户创作偏好
         */
        async updateUserPreferences(userId, preferences) {
            const context = {
                userId,
                environment: {},
                timestamp: new Date(),
            };
            if (preferences.narrativeStyle) {
                await this.setVariableValue('NarrativeStyle', preferences.narrativeStyle, context);
            }
            if (preferences.worldSetting) {
                await this.setVariableValue('WorldSetting', preferences.worldSetting, context);
            }
            if (preferences.characterTemplate) {
                await this.setVariableValue('CharacterTemplate', preferences.characterTemplate, context);
            }
            this.logger.log(`用户偏好已更新: ${userId}`);
        }
        // ==================== 工具集成接口 ====================
        /**
         * 获取工具配置
         */
        async getToolConfig(toolName) {
            const toolConfig = await this.getVariableValue(`VCP${toolName}`);
            return toolConfig || null;
        }
        /**
         * 注册工具变量
         */
        async registerToolVariable(toolName, config) {
            await this.registerSystemVariable({
                name: `VCP${toolName}`,
                value: config,
                type: 'static',
                scope: 'global',
                dependencies: [],
                metadata: {
                    description: `${toolName} 工具配置`,
                    author: 'system',
                    tags: ['tool', 'vcp', 'config'],
                },
            });
        }
        // ==================== 监控和统计 ====================
        /**
         * 获取变量系统统计
         */
        getVariableStats() {
            // 这里可以返回变量系统的统计信息
            return {
                totalVariables: 0, // 实际实现中应该从tarVariableManager获取
                activeWatchers: 0,
                recentUpdates: [],
            };
        }
        /**
         * 清理过期变量
         */
        async cleanupExpiredVariables() {
            // 清理逻辑
            this.logger.log('变量清理完成');
        }
    };
    return TarVariableService = _classThis;
})();
exports.TarVariableService = TarVariableService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFx2Y3BcXHRhci12YXJpYWJsZS5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7QUFBQSwrRUFBK0U7QUFDL0UsZ0JBQWdCO0FBQ2hCLDZCQUE2QjtBQUM3QiwrRUFBK0U7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFL0UsMkNBQXNFO0FBRXRFLG1HQUlvRTtJQUd2RCxrQkFBa0I7NEJBRDlCLElBQUEsbUJBQVUsR0FBRTs7Ozs7Ozs7WUFDYiw2S0ErYkM7OztZQS9iWSx1REFBa0I7O1FBR1QsYUFBYTtRQUZoQixNQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFN0QsWUFBb0IsYUFBNEI7WUFBNUIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFBRyxDQUFDO1FBRXBELEtBQUssQ0FBQyxZQUFZO1lBQ2hCLE1BQU0sSUFBSSxDQUFDLHlCQUF5QixFQUFFLENBQUE7WUFDdEMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUE7WUFDMUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLENBQUE7UUFDbEMsQ0FBQztRQUVELG9EQUFvRDtRQUVwRDs7V0FFRztRQUNLLEtBQUssQ0FBQyx5QkFBeUI7WUFDckMsU0FBUztZQUNULE1BQU0sSUFBSSxDQUFDLHNCQUFzQixDQUFDO2dCQUNoQyxJQUFJLEVBQUUsWUFBWTtnQkFDbEIsS0FBSyxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQztnQkFDL0MsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsS0FBSyxFQUFFLFFBQVE7Z0JBQ2YsWUFBWSxFQUFFLEVBQUU7Z0JBQ2hCLFFBQVEsRUFBRTtvQkFDUixXQUFXLEVBQUUsWUFBWTtvQkFDekIsTUFBTSxFQUFFLFFBQVE7b0JBQ2hCLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsV0FBVyxDQUFDO2lCQUN0QzthQUNGLENBQUMsQ0FBQTtZQUVGLDZCQUE2QjtZQUM3QixNQUFNLElBQUksQ0FBQyxzQkFBc0IsQ0FBQztnQkFDaEMsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsS0FBSyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxLQUFLLENBQUM7Z0JBQ3BELElBQUksRUFBRSxTQUFTO2dCQUNmLEtBQUssRUFBRSxRQUFRO2dCQUNmLFlBQVksRUFBRSxFQUFFO2dCQUNoQixPQUFPLEVBQUUsS0FBSyxJQUFJLEVBQUU7b0JBQ2xCLGtCQUFrQjtvQkFDbEIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsS0FBSyxDQUFDLENBQUE7Z0JBQ3RELENBQUM7Z0JBQ0QsUUFBUSxFQUFFO29CQUNSLFdBQVcsRUFBRSxRQUFRO29CQUNyQixNQUFNLEVBQUUsUUFBUTtvQkFDaEIsSUFBSSxFQUFFLENBQUMsVUFBVSxFQUFFLFFBQVEsRUFBRSxXQUFXLENBQUM7aUJBQzFDO2FBQ0YsQ0FBQyxDQUFBO1lBRUYsU0FBUztZQUNULE1BQU0sSUFBSSxDQUFDLHNCQUFzQixDQUFDO2dCQUNoQyxJQUFJLEVBQUUsZ0JBQWdCO2dCQUN0QixLQUFLLEVBQUUsU0FBUztnQkFDaEIsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsS0FBSyxFQUFFLFFBQVE7Z0JBQ2YsWUFBWSxFQUFFLENBQUMsU0FBUyxDQUFDO2dCQUN6QixPQUFPLEVBQUUsS0FBSyxFQUFFLE9BQXdCLEVBQUUsRUFBRTtvQkFDMUMsTUFBTSxJQUFJLEdBQUcsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFBO29CQUM1RCxpQkFBaUI7b0JBQ2pCLE9BQU8sR0FBRyxJQUFJLHNCQUFzQixDQUFBO2dCQUN0QyxDQUFDO2dCQUNELFFBQVEsRUFBRTtvQkFDUixXQUFXLEVBQUUsZUFBZTtvQkFDNUIsTUFBTSxFQUFFLFFBQVE7b0JBQ2hCLElBQUksRUFBRSxDQUFDLFNBQVMsRUFBRSxRQUFRLEVBQUUsV0FBVyxDQUFDO2lCQUN6QzthQUNGLENBQUMsQ0FBQTtZQUVGLFNBQVM7WUFDVCxNQUFNLElBQUksQ0FBQyxzQkFBc0IsQ0FBQztnQkFDaEMsSUFBSSxFQUFFLFVBQVU7Z0JBQ2hCLEtBQUssRUFBRSxLQUFLO2dCQUNaLElBQUksRUFBRSxTQUFTO2dCQUNmLEtBQUssRUFBRSxTQUFTO2dCQUNoQixZQUFZLEVBQUUsRUFBRTtnQkFDaEIsUUFBUSxFQUFFO29CQUNSLFdBQVcsRUFBRSxRQUFRO29CQUNyQixNQUFNLEVBQUUsUUFBUTtvQkFDaEIsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxXQUFXLENBQUM7aUJBQ3ZDO2FBQ0YsQ0FBQyxDQUFBO1lBRUYsU0FBUztZQUNULE1BQU0sSUFBSSxDQUFDLHNCQUFzQixDQUFDO2dCQUNoQyxJQUFJLEVBQUUsZ0JBQWdCO2dCQUN0QixLQUFLLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMseUJBQXlCLEVBQUUsUUFBUSxDQUFDO2dCQUNsRSxJQUFJLEVBQUUsU0FBUztnQkFDZixLQUFLLEVBQUUsU0FBUztnQkFDaEIsWUFBWSxFQUFFLEVBQUU7Z0JBQ2hCLFFBQVEsRUFBRTtvQkFDUixXQUFXLEVBQUUsUUFBUTtvQkFDckIsTUFBTSxFQUFFLFFBQVE7b0JBQ2hCLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxPQUFPLEVBQUUsU0FBUyxDQUFDO2lCQUN4QzthQUNGLENBQUMsQ0FBQTtZQUVGLFdBQVc7WUFDWCxNQUFNLElBQUksQ0FBQyxzQkFBc0IsQ0FBQztnQkFDaEMsSUFBSSxFQUFFLGVBQWU7Z0JBQ3JCLEtBQUssRUFBRTtvQkFDTCxRQUFRLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLFFBQVEsQ0FBQztvQkFDekQsS0FBSyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUM7b0JBQ2xELFdBQVcsRUFBRSxHQUFHO29CQUNoQixTQUFTLEVBQUUsSUFBSTtpQkFDaEI7Z0JBQ0QsSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsS0FBSyxFQUFFLFFBQVE7Z0JBQ2YsWUFBWSxFQUFFLEVBQUU7Z0JBQ2hCLFFBQVEsRUFBRTtvQkFDUixXQUFXLEVBQUUsVUFBVTtvQkFDdkIsTUFBTSxFQUFFLFFBQVE7b0JBQ2hCLElBQUksRUFBRSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsT0FBTyxDQUFDO2lCQUNoQzthQUNGLENBQUMsQ0FBQTtZQUVGLFdBQVc7WUFDWCxNQUFNLElBQUksQ0FBQyxzQkFBc0IsQ0FBQztnQkFDaEMsSUFBSSxFQUFFLGNBQWM7Z0JBQ3BCLEtBQUssRUFBRSxNQUFNO2dCQUNiLElBQUksRUFBRSxTQUFTO2dCQUNmLEtBQUssRUFBRSxTQUFTO2dCQUNoQixZQUFZLEVBQUUsRUFBRTtnQkFDaEIsUUFBUSxFQUFFO29CQUNSLFdBQVcsRUFBRSxVQUFVO29CQUN2QixNQUFNLEVBQUUsUUFBUTtvQkFDaEIsSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLENBQUM7aUJBQ3hDO2FBQ0YsQ0FBQyxDQUFBO1lBRUYsV0FBVztZQUNYLE1BQU0sSUFBSSxDQUFDLHNCQUFzQixDQUFDO2dCQUNoQyxJQUFJLEVBQUUsbUJBQW1CO2dCQUN6QixLQUFLLEVBQUUsVUFBVTtnQkFDakIsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsS0FBSyxFQUFFLE1BQU07Z0JBQ2IsWUFBWSxFQUFFLEVBQUU7Z0JBQ2hCLFFBQVEsRUFBRTtvQkFDUixXQUFXLEVBQUUsUUFBUTtvQkFDckIsTUFBTSxFQUFFLFFBQVE7b0JBQ2hCLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxVQUFVLEVBQUUsV0FBVyxDQUFDO2lCQUM3QzthQUNGLENBQUMsQ0FBQTtZQUVGLGdCQUFnQjtZQUNoQixNQUFNLElBQUksQ0FBQyxzQkFBc0IsQ0FBQztnQkFDaEMsSUFBSSxFQUFFLGFBQWE7Z0JBQ25CLEtBQUssRUFDSCwyRUFBMkU7Z0JBQzdFLElBQUksRUFBRSxVQUFVO2dCQUNoQixLQUFLLEVBQUUsT0FBTztnQkFDZCxZQUFZLEVBQUUsQ0FBQyxZQUFZLEVBQUUsZ0JBQWdCLEVBQUUsb0JBQW9CLENBQUM7Z0JBQ3BFLFFBQVEsRUFBRTtvQkFDUixXQUFXLEVBQUUsZUFBZTtvQkFDNUIsTUFBTSxFQUFFLFFBQVE7b0JBQ2hCLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDO2lCQUNoQzthQUNGLENBQUMsQ0FBQTtRQUNKLENBQUM7UUFFRCxtREFBbUQ7UUFFbkQ7O1dBRUc7UUFDSyxLQUFLLENBQUMsc0JBQXNCLENBQUMsUUFBdUM7WUFDMUUsSUFBSSxDQUFDO2dCQUNILHNDQUFrQixDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFBO2dCQUM3QyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFBO1lBQ2hELENBQUM7WUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO2dCQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFlBQVksUUFBUSxDQUFDLElBQUksR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFBO1lBQ3hELENBQUM7UUFDSCxDQUFDO1FBRUQ7O1dBRUc7UUFDSCxLQUFLLENBQUMsZ0JBQWdCLENBQUMsSUFBWSxFQUFFLE9BQXlCO1lBQzVELElBQUksQ0FBQztnQkFDSCxPQUFPLE1BQU0sc0NBQWtCLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFBO1lBQ2pFLENBQUM7WUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO2dCQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUE7Z0JBQzNDLE9BQU8sSUFBSSxDQUFBO1lBQ2IsQ0FBQztRQUNILENBQUM7UUFFRDs7V0FFRztRQUNILEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFZLEVBQUUsS0FBVSxFQUFFLE9BQXlCO1lBQ3hFLElBQUksQ0FBQztnQkFDSCxzQ0FBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFBO2dCQUN6RCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxXQUFXLElBQUksTUFBTSxLQUFLLEVBQUUsQ0FBQyxDQUFBO1lBQ2pELENBQUM7WUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO2dCQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFdBQVcsSUFBSSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUE7Z0JBQzVDLE1BQU0sS0FBSyxDQUFBO1lBQ2IsQ0FBQztRQUNILENBQUM7UUFFRDs7V0FFRztRQUNILEtBQUssQ0FBQyxpQkFBaUIsQ0FDckIsS0FBZSxFQUNmLE9BQXlCO1lBRXpCLE9BQU8sTUFBTSxzQ0FBa0IsQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUE7UUFDbkUsQ0FBQztRQUVEOztXQUVHO1FBQ0gsS0FBSyxDQUFDLHNCQUFzQixDQUFDLFFBQWdCLEVBQUUsT0FBeUI7WUFDdEUsSUFBSSxDQUFDO2dCQUNILE9BQU8sTUFBTSxzQ0FBa0IsQ0FBQyxzQkFBc0IsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUE7WUFDM0UsQ0FBQztZQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7Z0JBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxDQUFBO2dCQUNsQyxPQUFPLFFBQVEsQ0FBQSxDQUFDLFFBQVE7WUFDMUIsQ0FBQztRQUNILENBQUM7UUFFRDs7V0FFRztRQUNILGFBQWEsQ0FBQyxJQUFZLEVBQUUsUUFBeUM7WUFDbkUsT0FBTyxzQ0FBa0IsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFBO1FBQ3pELENBQUM7UUFFRCxtREFBbUQ7UUFFbkQ7O1dBRUc7UUFDSyxtQkFBbUI7WUFDekIsY0FBYztZQUNkLFdBQVcsQ0FBQyxLQUFLLElBQUksRUFBRTtnQkFDckIsSUFBSSxDQUFDO29CQUNILE1BQU0sSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUE7Z0JBQ2xDLENBQUM7Z0JBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztvQkFDZixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUE7Z0JBQ3ZDLENBQUM7WUFDSCxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUEsQ0FBQyxRQUFRO1lBRWxCLGNBQWM7WUFDZCxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsRUFBRSxDQUFDLFFBQVEsRUFBRSxFQUFFO2dCQUMxQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxXQUFXLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFBO2dCQUM5QyxjQUFjO2dCQUNkLHNDQUFrQixDQUFDLHFCQUFxQixDQUFDLGdCQUFnQixDQUFDLENBQUE7WUFDNUQsQ0FBQyxDQUFDLENBQUE7WUFFRixjQUFjO1lBQ2QsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFO2dCQUNwRCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFBO2dCQUMvQyxlQUFlO2dCQUNmLE1BQU0sSUFBSSxDQUFDLDhCQUE4QixDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUMzRCxDQUFDLENBQUMsQ0FBQTtRQUNKLENBQUM7UUFFRDs7V0FFRztRQUNLLEtBQUssQ0FBQyxtQkFBbUI7WUFDL0IsTUFBTSxHQUFHLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQTtZQUN0QixNQUFNLE9BQU8sR0FBb0I7Z0JBQy9CLFdBQVcsRUFBRSxFQUFFLFNBQVMsRUFBRSxHQUFHLENBQUMsT0FBTyxFQUFFLEVBQUU7Z0JBQ3pDLFNBQVMsRUFBRSxHQUFHO2FBQ2YsQ0FBQTtZQUVELFdBQVc7WUFDWCxzQ0FBa0IsQ0FBQyxxQkFBcUIsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUE7WUFDL0Qsc0NBQWtCLENBQUMscUJBQXFCLENBQUMsZ0JBQWdCLEVBQUUsT0FBTyxDQUFDLENBQUE7UUFDckUsQ0FBQztRQUVEOztXQUVHO1FBQ0ssS0FBSyxDQUFDLDhCQUE4QixDQUFDLFlBQW9CO1lBQy9ELE1BQU0sa0JBQWtCLEdBQXdCO2dCQUM5QyxJQUFJLEVBQUU7b0JBQ0osY0FBYyxFQUFFLE1BQU07b0JBQ3RCLGlCQUFpQixFQUFFLG9CQUFvQjtpQkFDeEM7Z0JBQ0QsSUFBSSxFQUFFO29CQUNKLGNBQWMsRUFBRSxNQUFNO29CQUN0QixpQkFBaUIsRUFBRSxnQkFBZ0I7aUJBQ3BDO2dCQUNELElBQUksRUFBRTtvQkFDSixjQUFjLEVBQUUsTUFBTTtvQkFDdEIsaUJBQWlCLEVBQUUscUJBQXFCO2lCQUN6QztnQkFDRCxJQUFJLEVBQUU7b0JBQ0osY0FBYyxFQUFFLE1BQU07b0JBQ3RCLGlCQUFpQixFQUFFLG1CQUFtQjtpQkFDdkM7YUFDRixDQUFBO1lBRUQsTUFBTSxXQUFXLEdBQUcsa0JBQWtCLENBQUMsWUFBWSxDQUFDLENBQUE7WUFDcEQsSUFBSSxXQUFXLEVBQUUsQ0FBQztnQkFDaEIsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsZ0JBQWdCLEVBQUUsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFBO2dCQUN6RSxNQUFNLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxtQkFBbUIsRUFBRSxXQUFXLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtZQUNqRixDQUFDO1FBQ0gsQ0FBQztRQUVELG1EQUFtRDtRQUVuRDs7V0FFRztRQUNILEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxPQUFlLEVBQUUsTUFBZTtZQUM1RCxNQUFNLE9BQU8sR0FBb0I7Z0JBQy9CLE9BQU8sRUFBRSxtQkFBbUIsT0FBTyxFQUFFO2dCQUNyQyxTQUFTLEVBQUUsT0FBTztnQkFDbEIsTUFBTTtnQkFDTixXQUFXLEVBQUUsRUFBRTtnQkFDZixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7YUFDdEIsQ0FBQTtZQUVELFVBQVU7WUFDVixNQUFNLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLGNBQWMsRUFBRSxZQUFZLEVBQUUsaUJBQWlCLENBQUMsR0FDdkYsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDO2dCQUNoQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLE9BQU8sQ0FBQztnQkFDNUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUM7Z0JBQ3pDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsRUFBRSxPQUFPLENBQUM7Z0JBQ2hELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDO2dCQUMxQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsZ0JBQWdCLEVBQUUsT0FBTyxDQUFDO2dCQUNoRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxFQUFFLE9BQU8sQ0FBQztnQkFDOUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLG1CQUFtQixFQUFFLE9BQU8sQ0FBQzthQUNwRCxDQUFDLENBQUE7WUFFSixPQUFPLENBQUMsV0FBVyxHQUFHO2dCQUNwQixPQUFPO2dCQUNQLElBQUk7Z0JBQ0osT0FBTztnQkFDUCxRQUFRO2dCQUNSLGNBQWM7Z0JBQ2QsWUFBWTtnQkFDWixpQkFBaUI7YUFDbEIsQ0FBQTtZQUVELE9BQU8sT0FBTyxDQUFBO1FBQ2hCLENBQUM7UUFFRDs7V0FFRztRQUNILEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxVQUFrQixFQUFFLE9BQXlCO1lBQ3pFLE1BQU0sV0FBVyxHQUFHLE9BQU8sSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLHVCQUF1QixDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUE7WUFFOUUsV0FBVztZQUNYLE1BQU0sY0FBYyxHQUFHOzs7Ozs7Ozs7O1NBVWxCLFVBQVU7OztDQUdsQixDQUFBO1lBRUcsT0FBTyxNQUFNLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxjQUFjLEVBQUUsV0FBVyxDQUFDLENBQUE7UUFDdkUsQ0FBQztRQUVEOztXQUVHO1FBQ0gsS0FBSyxDQUFDLHFCQUFxQixDQUN6QixNQUFjLEVBQ2QsV0FJQztZQUVELE1BQU0sT0FBTyxHQUFvQjtnQkFDL0IsTUFBTTtnQkFDTixXQUFXLEVBQUUsRUFBRTtnQkFDZixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7YUFDdEIsQ0FBQTtZQUVELElBQUksV0FBVyxDQUFDLGNBQWMsRUFBRSxDQUFDO2dCQUMvQixNQUFNLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsRUFBRSxXQUFXLENBQUMsY0FBYyxFQUFFLE9BQU8sQ0FBQyxDQUFBO1lBQ3BGLENBQUM7WUFFRCxJQUFJLFdBQVcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztnQkFDN0IsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxFQUFFLFdBQVcsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUE7WUFDaEYsQ0FBQztZQUVELElBQUksV0FBVyxDQUFDLGlCQUFpQixFQUFFLENBQUM7Z0JBQ2xDLE1BQU0sSUFBSSxDQUFDLGdCQUFnQixDQUFDLG1CQUFtQixFQUFFLFdBQVcsQ0FBQyxpQkFBaUIsRUFBRSxPQUFPLENBQUMsQ0FBQTtZQUMxRixDQUFDO1lBRUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsWUFBWSxNQUFNLEVBQUUsQ0FBQyxDQUFBO1FBQ3ZDLENBQUM7UUFFRCxtREFBbUQ7UUFFbkQ7O1dBRUc7UUFDSCxLQUFLLENBQUMsYUFBYSxDQUFDLFFBQWdCO1lBQ2xDLE1BQU0sVUFBVSxHQUFHLE1BQU0sSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sUUFBUSxFQUFFLENBQUMsQ0FBQTtZQUNoRSxPQUFPLFVBQVUsSUFBSSxJQUFJLENBQUE7UUFDM0IsQ0FBQztRQUVEOztXQUVHO1FBQ0gsS0FBSyxDQUFDLG9CQUFvQixDQUFDLFFBQWdCLEVBQUUsTUFBVztZQUN0RCxNQUFNLElBQUksQ0FBQyxzQkFBc0IsQ0FBQztnQkFDaEMsSUFBSSxFQUFFLE1BQU0sUUFBUSxFQUFFO2dCQUN0QixLQUFLLEVBQUUsTUFBTTtnQkFDYixJQUFJLEVBQUUsUUFBUTtnQkFDZCxLQUFLLEVBQUUsUUFBUTtnQkFDZixZQUFZLEVBQUUsRUFBRTtnQkFDaEIsUUFBUSxFQUFFO29CQUNSLFdBQVcsRUFBRSxHQUFHLFFBQVEsT0FBTztvQkFDL0IsTUFBTSxFQUFFLFFBQVE7b0JBQ2hCLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDO2lCQUNoQzthQUNGLENBQUMsQ0FBQTtRQUNKLENBQUM7UUFFRCxrREFBa0Q7UUFFbEQ7O1dBRUc7UUFDSCxnQkFBZ0I7WUFDZCxrQkFBa0I7WUFDbEIsT0FBTztnQkFDTCxjQUFjLEVBQUUsQ0FBQyxFQUFFLCtCQUErQjtnQkFDbEQsY0FBYyxFQUFFLENBQUM7Z0JBQ2pCLGFBQWEsRUFBRSxFQUFFO2FBQ2xCLENBQUE7UUFDSCxDQUFDO1FBRUQ7O1dBRUc7UUFDSCxLQUFLLENBQUMsdUJBQXVCO1lBQzNCLE9BQU87WUFDUCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUMzQixDQUFDOzs7O0FBOWJVLGdEQUFrQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXDE2NjYzXFxEZXNrdG9wXFx0dWhlZ1xccGFja2FnZXNcXGNvbW1vbi1iYWNrZW5kXFxzcmNcXHZjcFxcdGFyLXZhcmlhYmxlLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVGFyKiDlj5jph4/ns7vnu5/pm4bmiJDmnI3liqFcbi8vIOmbhuaIkCBWQ1BUb29sQm94IOeahOWKqOaAgemFjee9ruWSjOeOr+Wig+aEn+efpeiDveWKm1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBMb2dnZXIsIHR5cGUgT25Nb2R1bGVJbml0IH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nXG5pbXBvcnQgeyBDb25maWdTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9jb25maWcnXG5pbXBvcnQge1xuICB0eXBlIFRhclZhcmlhYmxlLFxuICB0YXJWYXJpYWJsZU1hbmFnZXIsXG4gIHR5cGUgVmFyaWFibGVDb250ZXh0LFxufSBmcm9tICcuLi8uLi8uLi9hcHBzL3ZjcHRvb2xib3gvc3JjL21vZHVsZXMvY29yZS9UYXJWYXJpYWJsZVN5c3RlbSdcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFRhclZhcmlhYmxlU2VydmljZSBpbXBsZW1lbnRzIE9uTW9kdWxlSW5pdCB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihUYXJWYXJpYWJsZVNlcnZpY2UubmFtZSlcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvbmZpZ1NlcnZpY2U6IENvbmZpZ1NlcnZpY2UpIHt9XG5cbiAgYXN5bmMgb25Nb2R1bGVJbml0KCkge1xuICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZVN5c3RlbVZhcmlhYmxlcygpXG4gICAgdGhpcy5zZXR1cER5bmFtaWNVcGRhdGVzKClcbiAgICB0aGlzLmxvZ2dlci5sb2coJ1Rhciog5Y+Y6YeP57O757uf5bey5Yid5aeL5YyWJylcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09IOezu+e7n+WPmOmHj+WIneWni+WMliA9PT09PT09PT09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiDliJ3lp4vljJbns7vnu5/lj5jph49cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgaW5pdGlhbGl6ZVN5c3RlbVZhcmlhYmxlcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyDml7bpl7Tnm7jlhbPlj5jph49cbiAgICBhd2FpdCB0aGlzLnJlZ2lzdGVyU3lzdGVtVmFyaWFibGUoe1xuICAgICAgbmFtZTogJ1ZhclRpbWVOb3cnLFxuICAgICAgdmFsdWU6ICgpID0+IG5ldyBEYXRlKCkudG9Mb2NhbGVTdHJpbmcoJ3poLUNOJyksXG4gICAgICB0eXBlOiAnZHluYW1pYycsXG4gICAgICBzY29wZTogJ2dsb2JhbCcsXG4gICAgICBkZXBlbmRlbmNpZXM6IFtdLFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgZGVzY3JpcHRpb246ICflvZPliY3ml7bpl7TvvIjkuK3mlofmoLzlvI/vvIknLFxuICAgICAgICBhdXRob3I6ICdzeXN0ZW0nLFxuICAgICAgICB0YWdzOiBbJ3RpbWUnLCAnc3lzdGVtJywgJ25hcnJhdGl2ZSddLFxuICAgICAgfSxcbiAgICB9KVxuXG4gICAgLy8g5L2N572u55u45YWz5Y+Y6YeP77yI566A5YyW5a6e546w77yM5a6e6ZmF5bqU6K+l6LCD55So5Zyw55CG5L2N572uQVBJ77yJXG4gICAgYXdhaXQgdGhpcy5yZWdpc3RlclN5c3RlbVZhcmlhYmxlKHtcbiAgICAgIG5hbWU6ICdWYXJDaXR5JyxcbiAgICAgIHZhbHVlOiB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0KCdERUZBVUxUX0NJVFknLCAn5YyX5Lqs5biCJyksXG4gICAgICB0eXBlOiAnZHluYW1pYycsXG4gICAgICBzY29wZTogJ2dsb2JhbCcsXG4gICAgICBkZXBlbmRlbmNpZXM6IFtdLFxuICAgICAgdXBkYXRlcjogYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyDlrp7pmYXlrp7njrDkuK3lupTor6XosIPnlKjlnLDnkIbkvY3nva7mnI3liqFcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnU2VydmljZS5nZXQoJ0RFRkFVTFRfQ0lUWScsICfljJfkuqzluIInKVxuICAgICAgfSxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiAn5b2T5YmN5L2N572u5Z+O5biCJyxcbiAgICAgICAgYXV0aG9yOiAnc3lzdGVtJyxcbiAgICAgICAgdGFnczogWydsb2NhdGlvbicsICdzeXN0ZW0nLCAnbmFycmF0aXZlJ10sXG4gICAgICB9LFxuICAgIH0pXG5cbiAgICAvLyDlpKnmsJTkv6Hmga/lj5jph49cbiAgICBhd2FpdCB0aGlzLnJlZ2lzdGVyU3lzdGVtVmFyaWFibGUoe1xuICAgICAgbmFtZTogJ1ZDUFdlYXRoZXJJbmZvJyxcbiAgICAgIHZhbHVlOiAn5pm05aSp77yM5rip5bqm6YCC5LitJyxcbiAgICAgIHR5cGU6ICdkeW5hbWljJyxcbiAgICAgIHNjb3BlOiAnZ2xvYmFsJyxcbiAgICAgIGRlcGVuZGVuY2llczogWydWYXJDaXR5J10sXG4gICAgICB1cGRhdGVyOiBhc3luYyAoY29udGV4dDogVmFyaWFibGVDb250ZXh0KSA9PiB7XG4gICAgICAgIGNvbnN0IGNpdHkgPSBhd2FpdCB0aGlzLmdldFZhcmlhYmxlVmFsdWUoJ1ZhckNpdHknLCBjb250ZXh0KVxuICAgICAgICAvLyDlrp7pmYXlrp7njrDkuK3lupTor6XosIPnlKjlpKnmsJRBUElcbiAgICAgICAgcmV0dXJuIGAke2NpdHl9IC0g5pm05aSp77yM5rip5bqmMjAtMjXCsEPvvIzpgILlkIjliJvkvZxgXG4gICAgICB9LFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgZGVzY3JpcHRpb246ICflpKnmsJTkv6Hmga/vvIznlKjkuo7lj5nkuovnjq/looPorr7lrponLFxuICAgICAgICBhdXRob3I6ICdzeXN0ZW0nLFxuICAgICAgICB0YWdzOiBbJ3dlYXRoZXInLCAnc3lzdGVtJywgJ25hcnJhdGl2ZSddLFxuICAgICAgfSxcbiAgICB9KVxuXG4gICAgLy8g55So5oi355u45YWz5Y+Y6YePXG4gICAgYXdhaXQgdGhpcy5yZWdpc3RlclN5c3RlbVZhcmlhYmxlKHtcbiAgICAgIG5hbWU6ICdVc2VyTmFtZScsXG4gICAgICB2YWx1ZTogJ+WIm+S9nOiAhScsXG4gICAgICB0eXBlOiAnZHluYW1pYycsXG4gICAgICBzY29wZTogJ3Nlc3Npb24nLFxuICAgICAgZGVwZW5kZW5jaWVzOiBbXSxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiAn5b2T5YmN55So5oi35ZCN56ewJyxcbiAgICAgICAgYXV0aG9yOiAnc3lzdGVtJyxcbiAgICAgICAgdGFnczogWyd1c2VyJywgJ3Nlc3Npb24nLCAnbmFycmF0aXZlJ10sXG4gICAgICB9LFxuICAgIH0pXG5cbiAgICAvLyDliJvkvZzpo47moLzlj5jph49cbiAgICBhd2FpdCB0aGlzLnJlZ2lzdGVyU3lzdGVtVmFyaWFibGUoe1xuICAgICAgbmFtZTogJ05hcnJhdGl2ZVN0eWxlJyxcbiAgICAgIHZhbHVlOiB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0KCdERUZBVUxUX05BUlJBVElWRV9TVFlMRScsICfnjrDku6PnjrDlrp7kuLvkuYknKSxcbiAgICAgIHR5cGU6ICdkeW5hbWljJyxcbiAgICAgIHNjb3BlOiAnc2Vzc2lvbicsXG4gICAgICBkZXBlbmRlbmNpZXM6IFtdLFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgZGVzY3JpcHRpb246ICflvZPliY3lj5nkuovpo47moLwnLFxuICAgICAgICBhdXRob3I6ICdzeXN0ZW0nLFxuICAgICAgICB0YWdzOiBbJ25hcnJhdGl2ZScsICdzdHlsZScsICdzZXNzaW9uJ10sXG4gICAgICB9LFxuICAgIH0pXG5cbiAgICAvLyBBSeaooeWei+mFjee9ruWPmOmHj1xuICAgIGF3YWl0IHRoaXMucmVnaXN0ZXJTeXN0ZW1WYXJpYWJsZSh7XG4gICAgICBuYW1lOiAnQUlNb2RlbENvbmZpZycsXG4gICAgICB2YWx1ZToge1xuICAgICAgICBwcm92aWRlcjogdGhpcy5jb25maWdTZXJ2aWNlLmdldCgnQUlfUFJPVklERVInLCAnb3BlbmFpJyksXG4gICAgICAgIG1vZGVsOiB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0KCdBSV9NT0RFTCcsICdncHQtNCcpLFxuICAgICAgICB0ZW1wZXJhdHVyZTogMC43LFxuICAgICAgICBtYXhUb2tlbnM6IDIwMDAsXG4gICAgICB9LFxuICAgICAgdHlwZTogJ3N0YXRpYycsXG4gICAgICBzY29wZTogJ2dsb2JhbCcsXG4gICAgICBkZXBlbmRlbmNpZXM6IFtdLFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgZGVzY3JpcHRpb246ICdBSeaooeWei+mFjee9ruWPguaVsCcsXG4gICAgICAgIGF1dGhvcjogJ3N5c3RlbScsXG4gICAgICAgIHRhZ3M6IFsnYWknLCAnY29uZmlnJywgJ21vZGVsJ10sXG4gICAgICB9LFxuICAgIH0pXG5cbiAgICAvLyDmlYXkuovkuJbnlYzorr7lrprlj5jph49cbiAgICBhd2FpdCB0aGlzLnJlZ2lzdGVyU3lzdGVtVmFyaWFibGUoe1xuICAgICAgbmFtZTogJ1dvcmxkU2V0dGluZycsXG4gICAgICB2YWx1ZTogJ+eOsOS7o+mDveW4gicsXG4gICAgICB0eXBlOiAnZHluYW1pYycsXG4gICAgICBzY29wZTogJ3Nlc3Npb24nLFxuICAgICAgZGVwZW5kZW5jaWVzOiBbXSxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiAn5b2T5YmN5pWF5LqL5LiW55WM6K6+5a6aJyxcbiAgICAgICAgYXV0aG9yOiAnc3lzdGVtJyxcbiAgICAgICAgdGFnczogWyd3b3JsZCcsICdzZXR0aW5nJywgJ25hcnJhdGl2ZSddLFxuICAgICAgfSxcbiAgICB9KVxuXG4gICAgLy8g6KeS6Imy5oCn5qC85qih5p2/5Y+Y6YePXG4gICAgYXdhaXQgdGhpcy5yZWdpc3RlclN5c3RlbVZhcmlhYmxlKHtcbiAgICAgIG5hbWU6ICdDaGFyYWN0ZXJUZW1wbGF0ZScsXG4gICAgICB2YWx1ZTogJ2JhbGFuY2VkJyxcbiAgICAgIHR5cGU6ICdkeW5hbWljJyxcbiAgICAgIHNjb3BlOiAndGFzaycsXG4gICAgICBkZXBlbmRlbmNpZXM6IFtdLFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgZGVzY3JpcHRpb246ICfop5LoibLmgKfmoLzmqKHmnb8nLFxuICAgICAgICBhdXRob3I6ICdzeXN0ZW0nLFxuICAgICAgICB0YWdzOiBbJ2NoYXJhY3RlcicsICd0ZW1wbGF0ZScsICduYXJyYXRpdmUnXSxcbiAgICAgIH0sXG4gICAgfSlcblxuICAgIC8vIOW3peWFt+WIl+ihqOWPmOmHj++8iFZDUOWFvOWuue+8iVxuICAgIGF3YWl0IHRoaXMucmVnaXN0ZXJTeXN0ZW1WYXJpYWJsZSh7XG4gICAgICBuYW1lOiAnVmFyVG9vbExpc3QnLFxuICAgICAgdmFsdWU6XG4gICAgICAgICfmlofnlJ/lm77lt6Xlhbd7e1ZDUEZsdXhHZW59fSzlr7nor53nlJ/miJDlt6Xlhbd7e1ZDUERpYWxvZ3VlR2VufX0s5oOF5oSf5YiG5p6Q5bel5YW3e3tWQ1BFbW90aW9uQW5hbHl6ZXJ9fScsXG4gICAgICB0eXBlOiAnY29tcHV0ZWQnLFxuICAgICAgc2NvcGU6ICdhZ2VudCcsXG4gICAgICBkZXBlbmRlbmNpZXM6IFsnVkNQRmx1eEdlbicsICdWQ1BEaWFsb2d1ZUdlbicsICdWQ1BFbW90aW9uQW5hbHl6ZXInXSxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiAn5Y+v55So5bel5YW35YiX6KGo77yIVkNQ5qC85byP77yJJyxcbiAgICAgICAgYXV0aG9yOiAnc3lzdGVtJyxcbiAgICAgICAgdGFnczogWyd0b29scycsICd2Y3AnLCAnYWdlbnQnXSxcbiAgICAgIH0sXG4gICAgfSlcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09IOWPmOmHj+euoeeQhuaOpeWPoyA9PT09PT09PT09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiDms6jlhozns7vnu5/lj5jph49cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcmVnaXN0ZXJTeXN0ZW1WYXJpYWJsZSh2YXJpYWJsZTogT21pdDxUYXJWYXJpYWJsZSwgJ21ldGFkYXRhJz4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgdGFyVmFyaWFibGVNYW5hZ2VyLnJlZ2lzdGVyVmFyaWFibGUodmFyaWFibGUpXG4gICAgICB0aGlzLmxvZ2dlci5kZWJ1Zyhg57O757uf5Y+Y6YeP5bey5rOo5YaMOiAke3ZhcmlhYmxlLm5hbWV9YClcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYOazqOWGjOezu+e7n+WPmOmHj+Wksei0pSAke3ZhcmlhYmxlLm5hbWV9OmAsIGVycm9yKVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blj5jph4/lgLxcbiAgICovXG4gIGFzeW5jIGdldFZhcmlhYmxlVmFsdWUobmFtZTogc3RyaW5nLCBjb250ZXh0PzogVmFyaWFibGVDb250ZXh0KTogUHJvbWlzZTxhbnk+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRhclZhcmlhYmxlTWFuYWdlci5nZXRWYXJpYWJsZVZhbHVlKG5hbWUsIGNvbnRleHQpXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oYOiOt+WPluWPmOmHj+WAvOWksei0pSAke25hbWV9OmAsIGVycm9yKVxuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6K6+572u5Y+Y6YeP5YC8XG4gICAqL1xuICBhc3luYyBzZXRWYXJpYWJsZVZhbHVlKG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSwgY29udGV4dD86IFZhcmlhYmxlQ29udGV4dCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICB0YXJWYXJpYWJsZU1hbmFnZXIuc2V0VmFyaWFibGVWYWx1ZShuYW1lLCB2YWx1ZSwgY29udGV4dClcbiAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKGDlj5jph4/lgLzlt7Lorr7nva46ICR7bmFtZX0gPSAke3ZhbHVlfWApXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGDorr7nva7lj5jph4/lgLzlpLHotKUgJHtuYW1lfTpgLCBlcnJvcilcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOaJuemHj+iOt+WPluWPmOmHj+WAvFxuICAgKi9cbiAgYXN5bmMgZ2V0TXVsdGlwbGVWYWx1ZXMoXG4gICAgbmFtZXM6IHN0cmluZ1tdLFxuICAgIGNvbnRleHQ/OiBWYXJpYWJsZUNvbnRleHRcbiAgKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBhbnk+PiB7XG4gICAgcmV0dXJuIGF3YWl0IHRhclZhcmlhYmxlTWFuYWdlci5nZXRNdWx0aXBsZVZhbHVlcyhuYW1lcywgY29udGV4dClcbiAgfVxuXG4gIC8qKlxuICAgKiDlpITnkIbltYzlpZflj5jph4/mm7/mjaJcbiAgICovXG4gIGFzeW5jIHByb2Nlc3NOZXN0ZWRWYXJpYWJsZXModGVtcGxhdGU6IHN0cmluZywgY29udGV4dD86IFZhcmlhYmxlQ29udGV4dCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0YXJWYXJpYWJsZU1hbmFnZXIucHJvY2Vzc05lc3RlZFZhcmlhYmxlcyh0ZW1wbGF0ZSwgY29udGV4dClcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIud2Fybihg5Y+Y6YeP5pu/5o2i5aSx6LSlOmAsIGVycm9yKVxuICAgICAgcmV0dXJuIHRlbXBsYXRlIC8vIOi/lOWbnuWOn+aooeadv1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDnm5HlkKzlj5jph4/lj5jljJZcbiAgICovXG4gIHdhdGNoVmFyaWFibGUobmFtZTogc3RyaW5nLCBjYWxsYmFjazogKHZhcmlhYmxlOiBUYXJWYXJpYWJsZSkgPT4gdm9pZCk6ICgpID0+IHZvaWQge1xuICAgIHJldHVybiB0YXJWYXJpYWJsZU1hbmFnZXIud2F0Y2hWYXJpYWJsZShuYW1lLCBjYWxsYmFjaylcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09IOWKqOaAgeabtOaWsOiuvue9riA9PT09PT09PT09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiDorr7nva7liqjmgIHmm7TmlrBcbiAgICovXG4gIHByaXZhdGUgc2V0dXBEeW5hbWljVXBkYXRlcygpOiB2b2lkIHtcbiAgICAvLyDorr7nva7ml7bpl7Tlj5jph4/nmoTlrprmnJ/mm7TmlrBcbiAgICBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZVRpbWVWYXJpYWJsZXMoKVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ+abtOaWsOaXtumXtOWPmOmHj+Wksei0pTonLCBlcnJvcilcbiAgICAgIH1cbiAgICB9LCA2MDAwMCkgLy8g5q+P5YiG6ZKf5pu05pawXG5cbiAgICAvLyDorr7nva7nlKjmiLfnirbmgIHlj5jph4/nmoTnm5HlkKxcbiAgICB0aGlzLndhdGNoVmFyaWFibGUoJ1VzZXJOYW1lJywgKHZhcmlhYmxlKSA9PiB7XG4gICAgICB0aGlzLmxvZ2dlci5kZWJ1Zyhg55So5oi35ZCN5bey5pu05pawOiAke3ZhcmlhYmxlLnZhbHVlfWApXG4gICAgICAvLyDop6blj5Hnm7jlhbPlj5jph4/nmoTph43mlrDorqHnrpdcbiAgICAgIHRhclZhcmlhYmxlTWFuYWdlci50cmlnZ2VyVmFyaWFibGVVcGRhdGUoJ05hcnJhdGl2ZVN0eWxlJylcbiAgICB9KVxuXG4gICAgLy8g6K6+572u5LiW55WM6K6+5a6a5Y+Y5YyW55qE55uR5ZCsXG4gICAgdGhpcy53YXRjaFZhcmlhYmxlKCdXb3JsZFNldHRpbmcnLCBhc3luYyAodmFyaWFibGUpID0+IHtcbiAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKGDkuJbnlYzorr7lrprlt7Lmm7TmlrA6ICR7dmFyaWFibGUudmFsdWV9YClcbiAgICAgIC8vIOagueaNruS4lueVjOiuvuWumuiwg+aVtOebuOWFs+WPmOmHj1xuICAgICAgYXdhaXQgdGhpcy5hZGp1c3RWYXJpYWJsZXNGb3JXb3JsZFNldHRpbmcodmFyaWFibGUudmFsdWUpXG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDmm7TmlrDml7bpl7Tnm7jlhbPlj5jph49cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgdXBkYXRlVGltZVZhcmlhYmxlcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gICAgY29uc3QgY29udGV4dDogVmFyaWFibGVDb250ZXh0ID0ge1xuICAgICAgZW52aXJvbm1lbnQ6IHsgdGltZXN0YW1wOiBub3cuZ2V0VGltZSgpIH0sXG4gICAgICB0aW1lc3RhbXA6IG5vdyxcbiAgICB9XG5cbiAgICAvLyDop6blj5Hml7bpl7Tlj5jph4/mm7TmlrBcbiAgICB0YXJWYXJpYWJsZU1hbmFnZXIudHJpZ2dlclZhcmlhYmxlVXBkYXRlKCdWYXJUaW1lTm93JywgY29udGV4dClcbiAgICB0YXJWYXJpYWJsZU1hbmFnZXIudHJpZ2dlclZhcmlhYmxlVXBkYXRlKCdWQ1BXZWF0aGVySW5mbycsIGNvbnRleHQpXG4gIH1cblxuICAvKipcbiAgICog5qC55o2u5LiW55WM6K6+5a6a6LCD5pW05Y+Y6YePXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGFkanVzdFZhcmlhYmxlc0ZvcldvcmxkU2V0dGluZyh3b3JsZFNldHRpbmc6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHNldHRpbmdBZGp1c3RtZW50czogUmVjb3JkPHN0cmluZywgYW55PiA9IHtcbiAgICAgIOeOsOS7o+mDveW4gjoge1xuICAgICAgICBuYXJyYXRpdmVTdHlsZTogJ+eOsOWunuS4u+S5iScsXG4gICAgICAgIGNoYXJhY3RlclRlbXBsYXRlOiAndXJiYW4tcHJvZmVzc2lvbmFsJyxcbiAgICAgIH0sXG4gICAgICDlpYflubvkuJbnlYw6IHtcbiAgICAgICAgbmFycmF0aXZlU3R5bGU6ICflpYflubvlj7Lor5cnLFxuICAgICAgICBjaGFyYWN0ZXJUZW1wbGF0ZTogJ2hlcm9pYy1mYW50YXN5JyxcbiAgICAgIH0sXG4gICAgICDnp5HlubvmnKrmnaU6IHtcbiAgICAgICAgbmFycmF0aXZlU3R5bGU6ICfotZvljZrmnIvlhYsnLFxuICAgICAgICBjaGFyYWN0ZXJUZW1wbGF0ZTogJ2N5YmVybmV0aWMtZW5oYW5jZWQnLFxuICAgICAgfSxcbiAgICAgIOWOhuWPsuWPpOS7ozoge1xuICAgICAgICBuYXJyYXRpdmVTdHlsZTogJ+WPpOWFuOaWh+WtpicsXG4gICAgICAgIGNoYXJhY3RlclRlbXBsYXRlOiAnaGlzdG9yaWNhbC1maWd1cmUnLFxuICAgICAgfSxcbiAgICB9XG5cbiAgICBjb25zdCBhZGp1c3RtZW50cyA9IHNldHRpbmdBZGp1c3RtZW50c1t3b3JsZFNldHRpbmddXG4gICAgaWYgKGFkanVzdG1lbnRzKSB7XG4gICAgICBhd2FpdCB0aGlzLnNldFZhcmlhYmxlVmFsdWUoJ05hcnJhdGl2ZVN0eWxlJywgYWRqdXN0bWVudHMubmFycmF0aXZlU3R5bGUpXG4gICAgICBhd2FpdCB0aGlzLnNldFZhcmlhYmxlVmFsdWUoJ0NoYXJhY3RlclRlbXBsYXRlJywgYWRqdXN0bWVudHMuY2hhcmFjdGVyVGVtcGxhdGUpXG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT0g5Y+Z5LqL5LiT55So5o6l5Y+jID09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIOS4uuaVheS6i+eUn+aIkOWHhuWkh+WPmOmHj+S4iuS4i+aWh1xuICAgKi9cbiAgYXN5bmMgcHJlcGFyZU5hcnJhdGl2ZUNvbnRleHQoc3RvcnlJZDogc3RyaW5nLCB1c2VySWQ/OiBzdHJpbmcpOiBQcm9taXNlPFZhcmlhYmxlQ29udGV4dD4ge1xuICAgIGNvbnN0IGNvbnRleHQ6IFZhcmlhYmxlQ29udGV4dCA9IHtcbiAgICAgIGFnZW50SWQ6IGBuYXJyYXRpdmUtYWdlbnQtJHtzdG9yeUlkfWAsXG4gICAgICBzZXNzaW9uSWQ6IHN0b3J5SWQsXG4gICAgICB1c2VySWQsXG4gICAgICBlbnZpcm9ubWVudDoge30sXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgfVxuXG4gICAgLy8g6I635Y+W55u45YWz5Y+Y6YeP5YC8XG4gICAgY29uc3QgW3RpbWVOb3csIGNpdHksIHdlYXRoZXIsIHVzZXJOYW1lLCBuYXJyYXRpdmVTdHlsZSwgd29ybGRTZXR0aW5nLCBjaGFyYWN0ZXJUZW1wbGF0ZV0gPVxuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICB0aGlzLmdldFZhcmlhYmxlVmFsdWUoJ1ZhclRpbWVOb3cnLCBjb250ZXh0KSxcbiAgICAgICAgdGhpcy5nZXRWYXJpYWJsZVZhbHVlKCdWYXJDaXR5JywgY29udGV4dCksXG4gICAgICAgIHRoaXMuZ2V0VmFyaWFibGVWYWx1ZSgnVkNQV2VhdGhlckluZm8nLCBjb250ZXh0KSxcbiAgICAgICAgdGhpcy5nZXRWYXJpYWJsZVZhbHVlKCdVc2VyTmFtZScsIGNvbnRleHQpLFxuICAgICAgICB0aGlzLmdldFZhcmlhYmxlVmFsdWUoJ05hcnJhdGl2ZVN0eWxlJywgY29udGV4dCksXG4gICAgICAgIHRoaXMuZ2V0VmFyaWFibGVWYWx1ZSgnV29ybGRTZXR0aW5nJywgY29udGV4dCksXG4gICAgICAgIHRoaXMuZ2V0VmFyaWFibGVWYWx1ZSgnQ2hhcmFjdGVyVGVtcGxhdGUnLCBjb250ZXh0KSxcbiAgICAgIF0pXG5cbiAgICBjb250ZXh0LmVudmlyb25tZW50ID0ge1xuICAgICAgdGltZU5vdyxcbiAgICAgIGNpdHksXG4gICAgICB3ZWF0aGVyLFxuICAgICAgdXNlck5hbWUsXG4gICAgICBuYXJyYXRpdmVTdHlsZSxcbiAgICAgIHdvcmxkU2V0dGluZyxcbiAgICAgIGNoYXJhY3RlclRlbXBsYXRlLFxuICAgIH1cblxuICAgIHJldHVybiBjb250ZXh0XG4gIH1cblxuICAvKipcbiAgICog55Sf5oiQ5Y+Z5LqL5o+Q56S66K+NXG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZU5hcnJhdGl2ZVByb21wdChiYXNlUHJvbXB0OiBzdHJpbmcsIGNvbnRleHQ/OiBWYXJpYWJsZUNvbnRleHQpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IGZ1bGxDb250ZXh0ID0gY29udGV4dCB8fCAoYXdhaXQgdGhpcy5wcmVwYXJlTmFycmF0aXZlQ29udGV4dCgnZGVmYXVsdCcpKVxuXG4gICAgLy8g5p6E5bu65aKe5by655qE5o+Q56S66K+NXG4gICAgY29uc3QgZW5oYW5jZWRQcm9tcHQgPSBgXG7lvZPliY3njq/looPkv6Hmga/vvJpcbi0g5pe26Ze077yae3tWYXJUaW1lTm93fX1cbi0g5Zyw54K577yae3tWYXJDaXR5fX1cbi0g5aSp5rCU77yae3tWQ1BXZWF0aGVySW5mb319XG4tIOeUqOaIt++8mnt7VXNlck5hbWV9fVxuLSDlj5nkuovpo47moLzvvJp7e05hcnJhdGl2ZVN0eWxlfX1cbi0g5LiW55WM6K6+5a6a77yae3tXb3JsZFNldHRpbmd9fVxuLSDop5LoibLmqKHmnb/vvJp7e0NoYXJhY3RlclRlbXBsYXRlfX1cblxu5Y6f5aeL5Yib5L2c6ZyA5rGC77yaJHtiYXNlUHJvbXB0fVxuXG7or7fln7rkuo7ku6XkuIrnjq/looPkv6Hmga/vvIzliJvkvZznrKblkIjlvZPliY3orr7lrprlkozpo47moLznmoTmlYXkuovlhoXlrrnjgIJcbmBcblxuICAgIHJldHVybiBhd2FpdCB0aGlzLnByb2Nlc3NOZXN0ZWRWYXJpYWJsZXMoZW5oYW5jZWRQcm9tcHQsIGZ1bGxDb250ZXh0KVxuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOeUqOaIt+WIm+S9nOWBj+WlvVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlVXNlclByZWZlcmVuY2VzKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHByZWZlcmVuY2VzOiB7XG4gICAgICBuYXJyYXRpdmVTdHlsZT86IHN0cmluZ1xuICAgICAgd29ybGRTZXR0aW5nPzogc3RyaW5nXG4gICAgICBjaGFyYWN0ZXJUZW1wbGF0ZT86IHN0cmluZ1xuICAgIH1cbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgY29udGV4dDogVmFyaWFibGVDb250ZXh0ID0ge1xuICAgICAgdXNlcklkLFxuICAgICAgZW52aXJvbm1lbnQ6IHt9LFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgIH1cblxuICAgIGlmIChwcmVmZXJlbmNlcy5uYXJyYXRpdmVTdHlsZSkge1xuICAgICAgYXdhaXQgdGhpcy5zZXRWYXJpYWJsZVZhbHVlKCdOYXJyYXRpdmVTdHlsZScsIHByZWZlcmVuY2VzLm5hcnJhdGl2ZVN0eWxlLCBjb250ZXh0KVxuICAgIH1cblxuICAgIGlmIChwcmVmZXJlbmNlcy53b3JsZFNldHRpbmcpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2V0VmFyaWFibGVWYWx1ZSgnV29ybGRTZXR0aW5nJywgcHJlZmVyZW5jZXMud29ybGRTZXR0aW5nLCBjb250ZXh0KVxuICAgIH1cblxuICAgIGlmIChwcmVmZXJlbmNlcy5jaGFyYWN0ZXJUZW1wbGF0ZSkge1xuICAgICAgYXdhaXQgdGhpcy5zZXRWYXJpYWJsZVZhbHVlKCdDaGFyYWN0ZXJUZW1wbGF0ZScsIHByZWZlcmVuY2VzLmNoYXJhY3RlclRlbXBsYXRlLCBjb250ZXh0KVxuICAgIH1cblxuICAgIHRoaXMubG9nZ2VyLmxvZyhg55So5oi35YGP5aW95bey5pu05pawOiAke3VzZXJJZH1gKVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT0g5bel5YW36ZuG5oiQ5o6l5Y+jID09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIOiOt+WPluW3peWFt+mFjee9rlxuICAgKi9cbiAgYXN5bmMgZ2V0VG9vbENvbmZpZyh0b29sTmFtZTogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICBjb25zdCB0b29sQ29uZmlnID0gYXdhaXQgdGhpcy5nZXRWYXJpYWJsZVZhbHVlKGBWQ1Ake3Rvb2xOYW1lfWApXG4gICAgcmV0dXJuIHRvb2xDb25maWcgfHwgbnVsbFxuICB9XG5cbiAgLyoqXG4gICAqIOazqOWGjOW3peWFt+WPmOmHj1xuICAgKi9cbiAgYXN5bmMgcmVnaXN0ZXJUb29sVmFyaWFibGUodG9vbE5hbWU6IHN0cmluZywgY29uZmlnOiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnJlZ2lzdGVyU3lzdGVtVmFyaWFibGUoe1xuICAgICAgbmFtZTogYFZDUCR7dG9vbE5hbWV9YCxcbiAgICAgIHZhbHVlOiBjb25maWcsXG4gICAgICB0eXBlOiAnc3RhdGljJyxcbiAgICAgIHNjb3BlOiAnZ2xvYmFsJyxcbiAgICAgIGRlcGVuZGVuY2llczogW10sXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBkZXNjcmlwdGlvbjogYCR7dG9vbE5hbWV9IOW3peWFt+mFjee9rmAsXG4gICAgICAgIGF1dGhvcjogJ3N5c3RlbScsXG4gICAgICAgIHRhZ3M6IFsndG9vbCcsICd2Y3AnLCAnY29uZmlnJ10sXG4gICAgICB9LFxuICAgIH0pXG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PSDnm5Hmjqflkoznu5/orqEgPT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICog6I635Y+W5Y+Y6YeP57O757uf57uf6K6hXG4gICAqL1xuICBnZXRWYXJpYWJsZVN0YXRzKCk6IGFueSB7XG4gICAgLy8g6L+Z6YeM5Y+v5Lul6L+U5Zue5Y+Y6YeP57O757uf55qE57uf6K6h5L+h5oGvXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsVmFyaWFibGVzOiAwLCAvLyDlrp7pmYXlrp7njrDkuK3lupTor6Xku450YXJWYXJpYWJsZU1hbmFnZXLojrflj5ZcbiAgICAgIGFjdGl2ZVdhdGNoZXJzOiAwLFxuICAgICAgcmVjZW50VXBkYXRlczogW10sXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOa4heeQhui/h+acn+WPmOmHj1xuICAgKi9cbiAgYXN5bmMgY2xlYW51cEV4cGlyZWRWYXJpYWJsZXMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8g5riF55CG6YC76L6RXG4gICAgdGhpcy5sb2dnZXIubG9nKCflj5jph4/muIXnkIblrozmiJAnKVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=