f3b6e98a2dffea17c22ec6ab9fa5f07c
"use strict";
// ============================================================================
// WebSocket通信集成测试
// 验证 VCPToolBox WebSocket通信的正确集成
// ============================================================================
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const config_1 = require("@nestjs/config");
const websocket_service_1 = require("../../../../packages/common-backend/src/vcp/websocket.service");
describe('WebSocketService Integration', () => {
    let service;
    let configService;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                websocket_service_1.WebSocketService,
                {
                    provide: config_1.ConfigService,
                    useValue: {
                        get: jest.fn((key, defaultValue) => {
                            const config = {
                                WEBSOCKET_PORT: 8081, // 使用不同端口避免冲突
                                WEBSOCKET_HOST: 'localhost',
                                WEBSOCKET_HEARTBEAT_INTERVAL: 30000,
                                WEBSOCKET_CONNECTION_TIMEOUT: 300000
                            };
                            return config[key] || defaultValue;
                        })
                    }
                }
            ]
        }).compile();
        service = module.get(websocket_service_1.WebSocketService);
        configService = module.get(config_1.ConfigService);
    });
    afterEach(async () => {
        // 清理资源
        try {
            await service.onModuleDestroy();
        }
        catch (error) {
            // 忽略清理错误
        }
    });
    it('应该能获取WebSocket统计信息', () => {
        const stats = service.getWebSocketStats();
        expect(stats).toHaveProperty('status');
        // 在测试环境中服务器可能没有启动，所以状态可能是'stopped'
        expect(['running', 'stopped']).toContain(stats.status);
    });
    it('应该能执行健康检查', async () => {
        const health = await service.healthCheck();
        expect(health).toHaveProperty('status');
        expect(['healthy', 'error']).toContain(health.status);
        if (health.status === 'error') {
            expect(health).toHaveProperty('details');
        }
    });
    it('应该能处理Agent消息发送（模拟）', async () => {
        // 测试发送到不存在的Agent，应该返回false
        const result = await service.sendToAgent('non-existent-agent', {
            action: 'test',
            payload: { message: 'test' }
        });
        // 在没有实际WebSocket连接的情况下，应该返回false
        expect(result).toBe(false);
    });
    it('应该能处理广播消息（模拟）', async () => {
        const result = await service.broadcastToAgents({
            action: 'test-broadcast',
            payload: { message: 'broadcast test' }
        });
        // 在没有连接的情况下，广播应该影响0个客户端
        expect(result).toBe(0);
    });
    it('应该能处理协作房间操作（模拟）', async () => {
        const roomId = await service.createCollaborationRoom('test-story-123', ['agent1', 'agent2']);
        // 当前实现返回null
        expect(roomId).toBeNull();
        const joinResult = await service.joinCollaborationRoom('test-room', 'test-agent');
        expect(joinResult).toBe(true);
    });
    it('应该能处理实时编辑更新（模拟）', async () => {
        // 这应该不会抛出错误，即使没有实际的WebSocket连接
        await expect(service.sendRealtimeEdit('story-123', 'agent-456', {
            type: 'text',
            content: '新的内容',
            position: { line: 1, column: 10 }
        })).resolves.not.toThrow();
    });
    it('应该能处理AI生成进度（模拟）', async () => {
        await expect(service.sendGenerationProgress('story-123', 'agent-456', 75, 'generating')).resolves.not.toThrow();
    });
    it('应该能处理Agent协作状态（模拟）', async () => {
        await expect(service.sendAgentCollaborationStatus('story-123', {
            agents: ['agent1', 'agent2'],
            status: 'active',
            progress: 60
        })).resolves.not.toThrow();
    });
    it('应该能获取活跃协作会话（模拟）', () => {
        const sessions = service.getActiveCollaborationSessions();
        expect(Array.isArray(sessions)).toBe(true);
        // 当前实现返回空数组
        expect(sessions).toHaveLength(0);
    });
    it('应该正确配置WebSocket参数', () => {
        expect(configService.get).toHaveBeenCalledWith('WEBSOCKET_PORT', 8080);
        expect(configService.get).toHaveBeenCalledWith('WEBSOCKET_HOST', 'localhost');
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXGFwcHNcXHZjcHRvb2xib3hcXHNyY1xcaW50ZWdyYXRpb24tdGVzdHNcXHdlYnNvY2tldC1pbnRlZ3JhdGlvbi50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQSwrRUFBK0U7QUFDL0Usa0JBQWtCO0FBQ2xCLGlDQUFpQztBQUNqQywrRUFBK0U7O0FBRS9FLDZDQUFxRDtBQUNyRCwyQ0FBOEM7QUFDOUMscUdBQWdHO0FBRWhHLFFBQVEsQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7SUFDNUMsSUFBSSxPQUF5QixDQUFBO0lBQzdCLElBQUksYUFBNEIsQ0FBQTtJQUVoQyxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFNBQVMsRUFBRTtnQkFDVCxvQ0FBZ0I7Z0JBQ2hCO29CQUNFLE9BQU8sRUFBRSxzQkFBYTtvQkFDdEIsUUFBUSxFQUFFO3dCQUNSLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBVyxFQUFFLFlBQWtCLEVBQUUsRUFBRTs0QkFDL0MsTUFBTSxNQUFNLEdBQUc7Z0NBQ2IsY0FBYyxFQUFFLElBQUksRUFBRSxhQUFhO2dDQUNuQyxjQUFjLEVBQUUsV0FBVztnQ0FDM0IsNEJBQTRCLEVBQUUsS0FBSztnQ0FDbkMsNEJBQTRCLEVBQUUsTUFBTTs2QkFDckMsQ0FBQTs0QkFDRCxPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxZQUFZLENBQUE7d0JBQ3BDLENBQUMsQ0FBQztxQkFDSDtpQkFDRjthQUNGO1NBQ0YsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFBO1FBRVosT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQW1CLG9DQUFnQixDQUFDLENBQUE7UUFDeEQsYUFBYSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQWdCLHNCQUFhLENBQUMsQ0FBQTtJQUMxRCxDQUFDLENBQUMsQ0FBQTtJQUVG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RTtRQUMzQixNQUFNLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxDQUFBO1FBQ3RFLE1BQU0sQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUMsb0JBQW9CLENBQUMsZ0JBQWdCLEVBQUUsV0FBVyxDQUFDLENBQUE7SUFDL0UsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUMsQ0FBQSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXDE2NjYzXFxEZXNrdG9wXFx0dWhlZ1xcYXBwc1xcdmNwdG9vbGJveFxcc3JjXFxpbnRlZ3JhdGlvbi10ZXN0c1xcd2Vic29ja2V0LWludGVncmF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBXZWJTb2NrZXTpgJrkv6Hpm4bmiJDmtYvor5VcclxuLy8g6aqM6K+BIFZDUFRvb2xCb3ggV2ViU29ja2V06YCa5L+h55qE5q2j56Gu6ZuG5oiQXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnXHJcbmltcG9ydCB7IENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZydcclxuaW1wb3J0IHsgV2ViU29ja2V0U2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uL3BhY2thZ2VzL2NvbW1vbi1iYWNrZW5kL3NyYy92Y3Avd2Vic29ja2V0LnNlcnZpY2UnXHJcblxyXG5kZXNjcmliZSgnV2ViU29ja2V0U2VydmljZSBJbnRlZ3JhdGlvbicsICgpID0+IHtcclxuICBsZXQgc2VydmljZTogV2ViU29ja2V0U2VydmljZVxyXG4gIGxldCBjb25maWdTZXJ2aWNlOiBDb25maWdTZXJ2aWNlXHJcblxyXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcclxuICAgICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAgV2ViU29ja2V0U2VydmljZSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBwcm92aWRlOiBDb25maWdTZXJ2aWNlLFxyXG4gICAgICAgICAgdXNlVmFsdWU6IHtcclxuICAgICAgICAgICAgZ2V0OiBqZXN0LmZuKChrZXk6IHN0cmluZywgZGVmYXVsdFZhbHVlPzogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgY29uZmlnID0ge1xyXG4gICAgICAgICAgICAgICAgV0VCU09DS0VUX1BPUlQ6IDgwODEsIC8vIOS9v+eUqOS4jeWQjOerr+WPo+mBv+WFjeWGsueqgVxyXG4gICAgICAgICAgICAgICAgV0VCU09DS0VUX0hPU1Q6ICdsb2NhbGhvc3QnLFxyXG4gICAgICAgICAgICAgICAgV0VCU09DS0VUX0hFQVJUQkVBVF9JTlRFUlZBTDogMzAwMDAsXHJcbiAgICAgICAgICAgICAgICBXRUJTT0NLRVRfQ09OTkVDVElPTl9USU1FT1VUOiAzMDAwMDBcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ1trZXldIHx8IGRlZmF1bHRWYWx1ZVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gICAgfSkuY29tcGlsZSgpXHJcblxyXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8V2ViU29ja2V0U2VydmljZT4oV2ViU29ja2V0U2VydmljZSlcclxuICAgIGNvbmZpZ1NlcnZpY2UgPSBtb2R1bGUuZ2V0PENvbmZpZ1NlcnZpY2U+KENvbmZpZ1NlcnZpY2UpXHJcbiAgfSlcclxuXHJcbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcclxuICAgIC8vIOa4heeQhui1hOa6kFxyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgKHNlcnZpY2UgYXMgYW55KS5vbk1vZHVsZURlc3Ryb3koKVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgLy8g5b+955Wl5riF55CG6ZSZ6K+vXHJcbiAgICB9XHJcbiAgfSlcclxuXHJcbiAgaXQoJ+W6lOivpeiDveiOt+WPlldlYlNvY2tldOe7n+iuoeS/oeaBrycsICgpID0+IHtcclxuICAgIGNvbnN0IHN0YXRzID0gc2VydmljZS5nZXRXZWJTb2NrZXRTdGF0cygpXHJcblxyXG4gICAgZXhwZWN0KHN0YXRzKS50b0hhdmVQcm9wZXJ0eSgnc3RhdHVzJylcclxuICAgIC8vIOWcqOa1i+ivleeOr+Wig+S4reacjeWKoeWZqOWPr+iDveayoeacieWQr+WKqO+8jOaJgOS7peeKtuaAgeWPr+iDveaYrydzdG9wcGVkJ1xyXG4gICAgZXhwZWN0KFsncnVubmluZycsICdzdG9wcGVkJ10pLnRvQ29udGFpbihzdGF0cy5zdGF0dXMpXHJcbiAgfSlcclxuXHJcbiAgaXQoJ+W6lOivpeiDveaJp+ihjOWBpeW6t+ajgOafpScsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IGhlYWx0aCA9IGF3YWl0IHNlcnZpY2UuaGVhbHRoQ2hlY2soKVxyXG5cclxuICAgIGV4cGVjdChoZWFsdGgpLnRvSGF2ZVByb3BlcnR5KCdzdGF0dXMnKVxyXG4gICAgZXhwZWN0KFsnaGVhbHRoeScsICdlcnJvciddKS50b0NvbnRhaW4oaGVhbHRoLnN0YXR1cylcclxuXHJcbiAgICBpZiAoaGVhbHRoLnN0YXR1cyA9PT0gJ2Vycm9yJykge1xyXG4gICAgICBleHBlY3QoaGVhbHRoKS50b0hhdmVQcm9wZXJ0eSgnZGV0YWlscycpXHJcbiAgICB9XHJcbiAgfSlcclxuXHJcbiAgaXQoJ+W6lOivpeiDveWkhOeQhkFnZW505raI5oGv5Y+R6YCB77yI5qih5ouf77yJJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgLy8g5rWL6K+V5Y+R6YCB5Yiw5LiN5a2Y5Zyo55qEQWdlbnTvvIzlupTor6Xov5Tlm55mYWxzZVxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5zZW5kVG9BZ2VudCgnbm9uLWV4aXN0ZW50LWFnZW50Jywge1xyXG4gICAgICBhY3Rpb246ICd0ZXN0JyxcclxuICAgICAgcGF5bG9hZDogeyBtZXNzYWdlOiAndGVzdCcgfVxyXG4gICAgfSlcclxuXHJcbiAgICAvLyDlnKjmsqHmnInlrp7pmYVXZWJTb2NrZXTov57mjqXnmoTmg4XlhrXkuIvvvIzlupTor6Xov5Tlm55mYWxzZVxyXG4gICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSlcclxuICB9KVxyXG5cclxuICBpdCgn5bqU6K+l6IO95aSE55CG5bm/5pKt5raI5oGv77yI5qih5ouf77yJJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5icm9hZGNhc3RUb0FnZW50cyh7XHJcbiAgICAgIGFjdGlvbjogJ3Rlc3QtYnJvYWRjYXN0JyxcclxuICAgICAgcGF5bG9hZDogeyBtZXNzYWdlOiAnYnJvYWRjYXN0IHRlc3QnIH1cclxuICAgIH0pXHJcblxyXG4gICAgLy8g5Zyo5rKh5pyJ6L+e5o6l55qE5oOF5Ya15LiL77yM5bm/5pKt5bqU6K+l5b2x5ZONMOS4quWuouaIt+err1xyXG4gICAgZXhwZWN0KHJlc3VsdCkudG9CZSgwKVxyXG4gIH0pXHJcblxyXG4gIGl0KCflupTor6Xog73lpITnkIbljY/kvZzmiL/pl7Tmk43kvZzvvIjmqKHmi5/vvIknLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCByb29tSWQgPSBhd2FpdCBzZXJ2aWNlLmNyZWF0ZUNvbGxhYm9yYXRpb25Sb29tKCd0ZXN0LXN0b3J5LTEyMycsIFsnYWdlbnQxJywgJ2FnZW50MiddKVxyXG4gICAgLy8g5b2T5YmN5a6e546w6L+U5ZuebnVsbFxyXG4gICAgZXhwZWN0KHJvb21JZCkudG9CZU51bGwoKVxyXG5cclxuICAgIGNvbnN0IGpvaW5SZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmpvaW5Db2xsYWJvcmF0aW9uUm9vbSgndGVzdC1yb29tJywgJ3Rlc3QtYWdlbnQnKVxyXG4gICAgZXhwZWN0KGpvaW5SZXN1bHQpLnRvQmUodHJ1ZSlcclxuICB9KVxyXG5cclxuICBpdCgn5bqU6K+l6IO95aSE55CG5a6e5pe257yW6L6R5pu05paw77yI5qih5ouf77yJJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgLy8g6L+Z5bqU6K+l5LiN5Lya5oqb5Ye66ZSZ6K+v77yM5Y2z5L2/5rKh5pyJ5a6e6ZmF55qEV2ViU29ja2V06L+e5o6lXHJcbiAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5zZW5kUmVhbHRpbWVFZGl0KCdzdG9yeS0xMjMnLCAnYWdlbnQtNDU2Jywge1xyXG4gICAgICB0eXBlOiAndGV4dCcsXHJcbiAgICAgIGNvbnRlbnQ6ICfmlrDnmoTlhoXlrrknLFxyXG4gICAgICBwb3NpdGlvbjogeyBsaW5lOiAxLCBjb2x1bW46IDEwIH1cclxuICAgIH0pKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpXHJcbiAgfSlcclxuXHJcbiAgaXQoJ+W6lOivpeiDveWkhOeQhkFJ55Sf5oiQ6L+b5bqm77yI5qih5ouf77yJJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgYXdhaXQgZXhwZWN0KHNlcnZpY2Uuc2VuZEdlbmVyYXRpb25Qcm9ncmVzcygnc3RvcnktMTIzJywgJ2FnZW50LTQ1NicsIDc1LCAnZ2VuZXJhdGluZycpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpXHJcbiAgfSlcclxuXHJcbiAgaXQoJ+W6lOivpeiDveWkhOeQhkFnZW505Y2P5L2c54q25oCB77yI5qih5ouf77yJJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgYXdhaXQgZXhwZWN0KHNlcnZpY2Uuc2VuZEFnZW50Q29sbGFib3JhdGlvblN0YXR1cygnc3RvcnktMTIzJywge1xyXG4gICAgICBhZ2VudHM6IFsnYWdlbnQxJywgJ2FnZW50MiddLFxyXG4gICAgICBzdGF0dXM6ICdhY3RpdmUnLFxyXG4gICAgICBwcm9ncmVzczogNjBcclxuICAgIH0pKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpXHJcbiAgfSlcclxuXHJcbiAgaXQoJ+W6lOivpeiDveiOt+WPlua0u+i3g+WNj+S9nOS8muivne+8iOaooeaLn++8iScsICgpID0+IHtcclxuICAgIGNvbnN0IHNlc3Npb25zID0gc2VydmljZS5nZXRBY3RpdmVDb2xsYWJvcmF0aW9uU2Vzc2lvbnMoKVxyXG4gICAgZXhwZWN0KEFycmF5LmlzQXJyYXkoc2Vzc2lvbnMpKS50b0JlKHRydWUpXHJcbiAgICAvLyDlvZPliY3lrp7njrDov5Tlm57nqbrmlbDnu4RcclxuICAgIGV4cGVjdChzZXNzaW9ucykudG9IYXZlTGVuZ3RoKDApXHJcbiAgfSlcclxuXHJcbiAgaXQoJ+W6lOivpeato+ehrumFjee9rldlYlNvY2tldOWPguaVsCcsICgpID0+IHtcclxuICAgIGV4cGVjdChjb25maWdTZXJ2aWNlLmdldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1dFQlNPQ0tFVF9QT1JUJywgODA4MClcclxuICAgIGV4cGVjdChjb25maWdTZXJ2aWNlLmdldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1dFQlNPQ0tFVF9IT1NUJywgJ2xvY2FsaG9zdCcpXHJcbiAgfSlcclxufSlcclxuIl0sInZlcnNpb24iOjN9