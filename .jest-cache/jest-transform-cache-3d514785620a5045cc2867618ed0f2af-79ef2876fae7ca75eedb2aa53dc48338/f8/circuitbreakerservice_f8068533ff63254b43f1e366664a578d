ecf01f84680e4b661f29201b6b28271f
"use strict";
// 文件路径: packages/common-backend/src/resilience/circuit-breaker.service.ts
// 核心理念: 熔断器模式，防止级联故障
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var CircuitBreakerService_1;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CircuitBreakerService = exports.CircuitState = void 0;
const common_1 = require("@nestjs/common");
const ioredis_1 = require("ioredis");
/**
 * @enum CircuitState
 * @description 熔断器状态
 */
var CircuitState;
(function (CircuitState) {
    /** 关闭状态：正常处理请求 */
    CircuitState["CLOSED"] = "closed";
    /** 开启状态：拒绝所有请求，直接失败 */
    CircuitState["OPEN"] = "open";
    /** 半开状态：允许部分请求通过，测试服务是否恢复 */
    CircuitState["HALF_OPEN"] = "half_open";
})(CircuitState || (exports.CircuitState = CircuitState = {}));
/**
 * @class CircuitBreakerService
 * @description 熔断器服务
 * 实现熔断器模式，防止级联故障
 * 支持 Redis 存储以实现集群一致性
 */
let CircuitBreakerService = CircuitBreakerService_1 = class CircuitBreakerService {
    logger = new common_1.Logger(CircuitBreakerService_1.name);
    // Redis 客户端（用于分布式存储）
    redisClient;
    // 内存存储（fallback when Redis is unavailable）
    circuits = new Map();
    constructor() {
        this.initRedis();
    }
    /**
     * 初始化 Redis 客户端
     */
    initRedis() {
        const redisUrl = process.env.REDIS_URL;
        if (redisUrl) {
            try {
                this.redisClient = new ioredis_1.Redis(redisUrl, {
                    maxRetriesPerRequest: 3,
                    retryStrategy: (times) => {
                        const delay = Math.min(times * 50, 2000);
                        return delay;
                    },
                });
                this.redisClient.on('error', (error) => {
                    this.logger.warn('Redis connection error, falling back to memory store:', error);
                    this.redisClient = undefined;
                });
                this.logger.log('Circuit breaker using Redis storage');
            }
            catch (error) {
                this.logger.warn('Failed to initialize Redis, using memory store:', error);
            }
        }
        else {
            this.logger.log('Circuit breaker using memory store (REDIS_URL not configured)');
        }
    }
    /**
     * @method execute
     * @description 执行受保护的操作
     *
     * @example
     * ```typescript
     * const result = await circuitBreakerService.execute(
     *   'ai-api',
     *   async () => await aiService.call(),
     *   { failureThreshold: 5, timeout: 5000 },
     * );
     * ```
     */
    async execute(name, operation, options = {}) {
        const { failureThreshold = 5, failureRateThreshold = 0.5, timeout = 5000, halfOpenRequests = 3, successThreshold = 2, } = options;
        const circuit = await this.getOrCreateCircuit(name);
        // 检查熔断器状态
        if (circuit.state === CircuitState.OPEN) {
            // 检查是否可以进入半开状态
            const timeSinceLastFailure = Date.now() - circuit.lastFailureTime;
            if (timeSinceLastFailure >= timeout) {
                circuit.state = CircuitState.HALF_OPEN;
                circuit.halfOpenRequests = 0;
                this.logger.log(`Circuit breaker "${name}" transitioned to HALF_OPEN`);
            }
            else {
                throw new Error(`Circuit breaker "${name}" is OPEN. Request rejected.`);
            }
        }
        // 半开状态：限制请求数
        if (circuit.state === CircuitState.HALF_OPEN) {
            if (circuit.halfOpenRequests >= halfOpenRequests) {
                throw new Error(`Circuit breaker "${name}" is HALF_OPEN. Request limit reached.`);
            }
            circuit.halfOpenRequests++;
        }
        // 执行操作
        try {
            const result = await operation();
            // 成功
            await this.recordSuccess(name, circuit, successThreshold);
            return result;
        }
        catch (error) {
            // 失败
            await this.recordFailure(name, circuit, failureThreshold, failureRateThreshold);
            throw error;
        }
    }
    /**
     * @method getOrCreateCircuit
     * @description 获取或创建熔断器
     */
    async getOrCreateCircuit(name) {
        // Primeiro tenta carregar do Redis
        if (this.redisClient) {
            try {
                const redisKey = `circuit_breaker:${name}`;
                const data = await this.redisClient.hgetall(redisKey);
                if (Object.keys(data).length > 0) {
                    const circuit = {
                        state: data.state || CircuitState.CLOSED,
                        failures: parseInt(data.failures) || 0,
                        successes: parseInt(data.successes) || 0,
                        lastFailureTime: parseInt(data.lastFailureTime) || 0,
                        halfOpenRequests: parseInt(data.halfOpenRequests) || 0,
                        metrics: {
                            totalRequests: parseInt(data.totalRequests) || 0,
                            successfulRequests: parseInt(data.successfulRequests) || 0,
                            failedRequests: parseInt(data.failedRequests) || 0,
                            failureRate: parseFloat(data.failureRate) || 0,
                            state: data.state || CircuitState.CLOSED,
                            lastStateChange: parseInt(data.lastStateChange) || Date.now(),
                        },
                    };
                    this.circuits.set(name, circuit);
                    return circuit;
                }
            }
            catch (error) {
                this.logger.warn(`Failed to load circuit breaker ${name} from Redis, using memory:`, error);
            }
        }
        // Fallback para memória
        if (!this.circuits.has(name)) {
            this.circuits.set(name, {
                state: CircuitState.CLOSED,
                failures: 0,
                successes: 0,
                lastFailureTime: 0,
                halfOpenRequests: 0,
                metrics: {
                    totalRequests: 0,
                    successfulRequests: 0,
                    failedRequests: 0,
                    failureRate: 0,
                    state: CircuitState.CLOSED,
                    lastStateChange: Date.now(),
                },
            });
        }
        return this.circuits.get(name);
    }
    /**
     * @method saveCircuitToRedis
     * @description 保存熔断器状态到 Redis
     */
    async saveCircuitToRedis(name, circuit) {
        if (!this.redisClient)
            return;
        try {
            const redisKey = `circuit_breaker:${name}`;
            const data = {
                state: circuit.state,
                failures: circuit.failures.toString(),
                successes: circuit.successes.toString(),
                lastFailureTime: circuit.lastFailureTime.toString(),
                halfOpenRequests: circuit.halfOpenRequests.toString(),
                totalRequests: circuit.metrics.totalRequests.toString(),
                successfulRequests: circuit.metrics.successfulRequests.toString(),
                failedRequests: circuit.metrics.failedRequests.toString(),
                failureRate: circuit.metrics.failureRate.toString(),
                lastStateChange: circuit.metrics.lastStateChange.toString(),
            };
            await this.redisClient.hmset(redisKey, data);
            // Definir TTL de 24 horas para evitar acúmulo de dados antigos
            await this.redisClient.expire(redisKey, 86400);
        }
        catch (error) {
            this.logger.warn(`Failed to save circuit breaker ${name} to Redis:`, error);
        }
    }
    /**
     * @method recordSuccess
     * @description 记录成功
     */
    async recordSuccess(name, circuit, successThreshold) {
        circuit.metrics.totalRequests++;
        circuit.metrics.successfulRequests++;
        circuit.successes++;
        // 半开状态：如果成功次数达到阈值，切换到关闭状态
        if (circuit.state === CircuitState.HALF_OPEN) {
            if (circuit.successes >= successThreshold) {
                circuit.state = CircuitState.CLOSED;
                circuit.failures = 0;
                circuit.successes = 0;
                circuit.metrics.state = CircuitState.CLOSED;
                circuit.metrics.lastStateChange = Date.now();
                this.logger.log(`Circuit breaker "${name}" transitioned to CLOSED`);
            }
        }
        // 更新失败率
        circuit.metrics.failureRate =
            circuit.metrics.totalRequests > 0
                ? circuit.metrics.failedRequests / circuit.metrics.totalRequests
                : 0;
        // 保存到 Redis
        await this.saveCircuitToRedis(name, circuit);
    }
    /**
     * @method recordFailure
     * @description 记录失败
     */
    async recordFailure(name, circuit, failureThreshold, failureRateThreshold) {
        circuit.metrics.totalRequests++;
        circuit.metrics.failedRequests++;
        circuit.failures++;
        circuit.lastFailureTime = Date.now();
        // 更新失败率
        circuit.metrics.failureRate =
            circuit.metrics.totalRequests > 0
                ? circuit.metrics.failedRequests / circuit.metrics.totalRequests
                : 0;
        // 检查是否需要开启熔断器
        if (circuit.state === CircuitState.CLOSED) {
            const shouldOpen = circuit.failures >= failureThreshold || circuit.metrics.failureRate >= failureRateThreshold;
            if (shouldOpen) {
                circuit.state = CircuitState.OPEN;
                circuit.metrics.state = CircuitState.OPEN;
                circuit.metrics.lastStateChange = Date.now();
                this.logger.warn(`Circuit breaker "${name}" opened due to failures: ${circuit.failures}, failure rate: ${circuit.metrics.failureRate.toFixed(2)}`);
            }
        }
        else if (circuit.state === CircuitState.HALF_OPEN) {
            // 半开状态：如果失败，立即切换到开启状态
            circuit.state = CircuitState.OPEN;
            circuit.metrics.state = CircuitState.OPEN;
            circuit.metrics.lastStateChange = Date.now();
            this.logger.warn(`Circuit breaker "${name}" opened after failure in HALF_OPEN state`);
        }
        // 保存到 Redis
        await this.saveCircuitToRedis(name, circuit);
    }
    /**
     * @method getMetrics
     * @description 获取熔断器指标
     */
    getMetrics(name) {
        const circuit = this.circuits.get(name);
        return circuit ? circuit.metrics : null;
    }
    /**
     * @method reset
     * @description 重置熔断器
     */
    reset(name) {
        const circuit = this.circuits.get(name);
        if (circuit) {
            circuit.state = CircuitState.CLOSED;
            circuit.failures = 0;
            circuit.successes = 0;
            circuit.halfOpenRequests = 0;
            circuit.metrics = {
                totalRequests: 0,
                successfulRequests: 0,
                failedRequests: 0,
                failureRate: 0,
                state: CircuitState.CLOSED,
                lastStateChange: Date.now(),
            };
            this.logger.log(`Circuit breaker "${name}" reset`);
        }
    }
};
exports.CircuitBreakerService = CircuitBreakerService;
exports.CircuitBreakerService = CircuitBreakerService = CircuitBreakerService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], CircuitBreakerService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFxyZXNpbGllbmNlXFxjaXJjdWl0LWJyZWFrZXIuc2VydmljZS50cyIsIm1hcHBpbmdzIjoiO0FBQUEsMEVBQTBFO0FBQzFFLHFCQUFxQjs7Ozs7Ozs7Ozs7OztBQUVyQiwyQ0FBbUQ7QUFDbkQscUNBQStCO0FBRS9COzs7R0FHRztBQUNILElBQVksWUFPWDtBQVBELFdBQVksWUFBWTtJQUN0QixrQkFBa0I7SUFDbEIsaUNBQWlCLENBQUE7SUFDakIsdUJBQXVCO0lBQ3ZCLDZCQUFhLENBQUE7SUFDYiw2QkFBNkI7SUFDN0IsdUNBQXVCLENBQUE7QUFDekIsQ0FBQyxFQVBXLFlBQVksNEJBQVosWUFBWSxRQU92QjtBQXNDRDs7Ozs7R0FLRztBQUVJLElBQU0scUJBQXFCLDZCQUEzQixNQUFNLHFCQUFxQjtJQUNmLE1BQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQyx1QkFBcUIsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUVoRSxxQkFBcUI7SUFDYixXQUFXLENBQVE7SUFFM0IsMkNBQTJDO0lBQzFCLFFBQVEsR0FBRyxJQUFJLEdBQUcsRUFVaEMsQ0FBQTtJQUVIO1FBQ0UsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFBO0lBQ2xCLENBQUM7SUFFRDs7T0FFRztJQUNLLFNBQVM7UUFDZixNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQTtRQUN0QyxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQ2IsSUFBSSxDQUFDO2dCQUNILElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxlQUFLLENBQUMsUUFBUSxFQUFFO29CQUNyQyxvQkFBb0IsRUFBRSxDQUFDO29CQUN2QixhQUFhLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRTt3QkFDdkIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFBO3dCQUN4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LENBQUM7Z0JBQ3JCLGNBQWMsRUFBRSxDQUFDO2dCQUNqQixXQUFXLEVBQUUsQ0FBQztnQkFDZCxLQUFLLEVBQUUsWUFBWSxDQUFDLE1BQU07Z0JBQzFCLGVBQWUsRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFO2FBQzVCLENBQUE7WUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsSUFBSSxTQUFTLENBQUMsQ0FBQTtRQUNwRCxDQUFDO0lBQ0gsQ0FBQztDQUNGLENBQUE7QUE1VFksc0RBQXFCO2dDQUFyQixxQkFBcUI7SUFEakMsSUFBQSxtQkFBVSxHQUFFOztHQUNBLHFCQUFxQixDQTRUakMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFxyZXNpbGllbmNlXFxjaXJjdWl0LWJyZWFrZXIuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyDmlofku7bot6/lvoQ6IHBhY2thZ2VzL2NvbW1vbi1iYWNrZW5kL3NyYy9yZXNpbGllbmNlL2NpcmN1aXQtYnJlYWtlci5zZXJ2aWNlLnRzXG4vLyDmoLjlv4PnkIblv7U6IOeGlOaWreWZqOaooeW8j++8jOmYsuatoue6p+iBlOaVhemanFxuXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBMb2dnZXIgfSBmcm9tICdAbmVzdGpzL2NvbW1vbidcbmltcG9ydCB7IFJlZGlzIH0gZnJvbSAnaW9yZWRpcydcblxuLyoqXG4gKiBAZW51bSBDaXJjdWl0U3RhdGVcbiAqIEBkZXNjcmlwdGlvbiDnhpTmlq3lmajnirbmgIFcbiAqL1xuZXhwb3J0IGVudW0gQ2lyY3VpdFN0YXRlIHtcbiAgLyoqIOWFs+mXreeKtuaAge+8muato+W4uOWkhOeQhuivt+axgiAqL1xuICBDTE9TRUQgPSAnY2xvc2VkJyxcbiAgLyoqIOW8gOWQr+eKtuaAge+8muaLkue7neaJgOacieivt+axgu+8jOebtOaOpeWksei0pSAqL1xuICBPUEVOID0gJ29wZW4nLFxuICAvKiog5Y2K5byA54q25oCB77ya5YWB6K646YOo5YiG6K+35rGC6YCa6L+H77yM5rWL6K+V5pyN5Yqh5piv5ZCm5oGi5aSNICovXG4gIEhBTEZfT1BFTiA9ICdoYWxmX29wZW4nLFxufVxuXG4vKipcbiAqIEBpbnRlcmZhY2UgQ2lyY3VpdEJyZWFrZXJPcHRpb25zXG4gKiBAZGVzY3JpcHRpb24g54aU5pat5Zmo6YCJ6aG5XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ2lyY3VpdEJyZWFrZXJPcHRpb25zIHtcbiAgLyoqIOWksei0pemYiOWAvO+8iOinpuWPkeeGlOaWreeahOWksei0peasoeaVsO+8iSAqL1xuICBmYWlsdXJlVGhyZXNob2xkPzogbnVtYmVyXG4gIC8qKiDlpLHotKXnjofpmIjlgLzvvIjop6blj5HnhpTmlq3nmoTlpLHotKXnjofvvIwwLTHvvIkgKi9cbiAgZmFpbHVyZVJhdGVUaHJlc2hvbGQ/OiBudW1iZXJcbiAgLyoqIOaXtumXtOeql+WPo++8iOavq+enku+8iSAqL1xuICB0aW1lb3V0PzogbnVtYmVyXG4gIC8qKiDljYrlvIDnirbmgIHlhYHorrjnmoTor7fmsYLmlbAgKi9cbiAgaGFsZk9wZW5SZXF1ZXN0cz86IG51bWJlclxuICAvKiog5Y2K5byA54q25oCB5oiQ5Yqf5ZCO5YiH5o2i5Yiw5YWz6Zet54q25oCB6ZyA6KaB55qE5oiQ5Yqf5qyh5pWwICovXG4gIHN1Y2Nlc3NUaHJlc2hvbGQ/OiBudW1iZXJcbn1cblxuLyoqXG4gKiBAaW50ZXJmYWNlIENpcmN1aXRCcmVha2VyTWV0cmljc1xuICogQGRlc2NyaXB0aW9uIOeGlOaWreWZqOaMh+agh1xuICovXG5leHBvcnQgaW50ZXJmYWNlIENpcmN1aXRCcmVha2VyTWV0cmljcyB7XG4gIC8qKiDmgLvor7fmsYLmlbAgKi9cbiAgdG90YWxSZXF1ZXN0czogbnVtYmVyXG4gIC8qKiDmiJDlip/or7fmsYLmlbAgKi9cbiAgc3VjY2Vzc2Z1bFJlcXVlc3RzOiBudW1iZXJcbiAgLyoqIOWksei0peivt+axguaVsCAqL1xuICBmYWlsZWRSZXF1ZXN0czogbnVtYmVyXG4gIC8qKiDlvZPliY3lpLHotKXnjocgKi9cbiAgZmFpbHVyZVJhdGU6IG51bWJlclxuICAvKiog5b2T5YmN54q25oCBICovXG4gIHN0YXRlOiBDaXJjdWl0U3RhdGVcbiAgLyoqIOacgOWQjueKtuaAgeWPmOabtOaXtumXtCAqL1xuICBsYXN0U3RhdGVDaGFuZ2U6IG51bWJlclxufVxuXG4vKipcbiAqIEBjbGFzcyBDaXJjdWl0QnJlYWtlclNlcnZpY2VcbiAqIEBkZXNjcmlwdGlvbiDnhpTmlq3lmajmnI3liqFcbiAqIOWunueOsOeGlOaWreWZqOaooeW8j++8jOmYsuatoue6p+iBlOaVhemanFxuICog5pSv5oyBIFJlZGlzIOWtmOWCqOS7peWunueOsOmbhue+pOS4gOiHtOaAp1xuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQ2lyY3VpdEJyZWFrZXJTZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKENpcmN1aXRCcmVha2VyU2VydmljZS5uYW1lKVxuXG4gIC8vIFJlZGlzIOWuouaIt+err++8iOeUqOS6juWIhuW4g+W8j+WtmOWCqO+8iVxuICBwcml2YXRlIHJlZGlzQ2xpZW50PzogUmVkaXNcblxuICAvLyDlhoXlrZjlrZjlgqjvvIhmYWxsYmFjayB3aGVuIFJlZGlzIGlzIHVuYXZhaWxhYmxl77yJXG4gIHByaXZhdGUgcmVhZG9ubHkgY2lyY3VpdHMgPSBuZXcgTWFwPFxuICAgIHN0cmluZyxcbiAgICB7XG4gICAgICBzdGF0ZTogQ2lyY3VpdFN0YXRlXG4gICAgICBmYWlsdXJlczogbnVtYmVyXG4gICAgICBzdWNjZXNzZXM6IG51bWJlclxuICAgICAgbGFzdEZhaWx1cmVUaW1lOiBudW1iZXJcbiAgICAgIGhhbGZPcGVuUmVxdWVzdHM6IG51bWJlclxuICAgICAgbWV0cmljczogQ2lyY3VpdEJyZWFrZXJNZXRyaWNzXG4gICAgfVxuICA+KClcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmluaXRSZWRpcygpXG4gIH1cblxuICAvKipcbiAgICog5Yid5aeL5YyWIFJlZGlzIOWuouaIt+err1xuICAgKi9cbiAgcHJpdmF0ZSBpbml0UmVkaXMoKTogdm9pZCB7XG4gICAgY29uc3QgcmVkaXNVcmwgPSBwcm9jZXNzLmVudi5SRURJU19VUkxcbiAgICBpZiAocmVkaXNVcmwpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMucmVkaXNDbGllbnQgPSBuZXcgUmVkaXMocmVkaXNVcmwsIHtcbiAgICAgICAgICBtYXhSZXRyaWVzUGVyUmVxdWVzdDogMyxcbiAgICAgICAgICByZXRyeVN0cmF0ZWd5OiAodGltZXMpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRlbGF5ID0gTWF0aC5taW4odGltZXMgKiA1MCwgMjAwMClcbiAgICAgICAgICAgIHJldHVybiBkZWxheVxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgdGhpcy5yZWRpc0NsaWVudC5vbignZXJyb3InLCAoZXJyb3IpID0+IHtcbiAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdSZWRpcyBjb25uZWN0aW9uIGVycm9yLCBmYWxsaW5nIGJhY2sgdG8gbWVtb3J5IHN0b3JlOicsIGVycm9yKVxuICAgICAgICAgIHRoaXMucmVkaXNDbGllbnQgPSB1bmRlZmluZWRcbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ0NpcmN1aXQgYnJlYWtlciB1c2luZyBSZWRpcyBzdG9yYWdlJylcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ0ZhaWxlZCB0byBpbml0aWFsaXplIFJlZGlzLCB1c2luZyBtZW1vcnkgc3RvcmU6JywgZXJyb3IpXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubG9nZ2VyLmxvZygnQ2lyY3VpdCBicmVha2VyIHVzaW5nIG1lbW9yeSBzdG9yZSAoUkVESVNfVVJMIG5vdCBjb25maWd1cmVkKScpXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZXhlY3V0ZVxuICAgKiBAZGVzY3JpcHRpb24g5omn6KGM5Y+X5L+d5oqk55qE5pON5L2cXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogY29uc3QgcmVzdWx0ID0gYXdhaXQgY2lyY3VpdEJyZWFrZXJTZXJ2aWNlLmV4ZWN1dGUoXG4gICAqICAgJ2FpLWFwaScsXG4gICAqICAgYXN5bmMgKCkgPT4gYXdhaXQgYWlTZXJ2aWNlLmNhbGwoKSxcbiAgICogICB7IGZhaWx1cmVUaHJlc2hvbGQ6IDUsIHRpbWVvdXQ6IDUwMDAgfSxcbiAgICogKTtcbiAgICogYGBgXG4gICAqL1xuICBhc3luYyBleGVjdXRlPFQ+KFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBvcGVyYXRpb246ICgpID0+IFByb21pc2U8VD4sXG4gICAgb3B0aW9uczogQ2lyY3VpdEJyZWFrZXJPcHRpb25zID0ge31cbiAgKTogUHJvbWlzZTxUPiB7XG4gICAgY29uc3Qge1xuICAgICAgZmFpbHVyZVRocmVzaG9sZCA9IDUsXG4gICAgICBmYWlsdXJlUmF0ZVRocmVzaG9sZCA9IDAuNSxcbiAgICAgIHRpbWVvdXQgPSA1MDAwLFxuICAgICAgaGFsZk9wZW5SZXF1ZXN0cyA9IDMsXG4gICAgICBzdWNjZXNzVGhyZXNob2xkID0gMixcbiAgICB9ID0gb3B0aW9uc1xuXG4gICAgY29uc3QgY2lyY3VpdCA9IGF3YWl0IHRoaXMuZ2V0T3JDcmVhdGVDaXJjdWl0KG5hbWUpXG5cbiAgICAvLyDmo4Dmn6XnhpTmlq3lmajnirbmgIFcbiAgICBpZiAoY2lyY3VpdC5zdGF0ZSA9PT0gQ2lyY3VpdFN0YXRlLk9QRU4pIHtcbiAgICAgIC8vIOajgOafpeaYr+WQpuWPr+S7pei/m+WFpeWNiuW8gOeKtuaAgVxuICAgICAgY29uc3QgdGltZVNpbmNlTGFzdEZhaWx1cmUgPSBEYXRlLm5vdygpIC0gY2lyY3VpdC5sYXN0RmFpbHVyZVRpbWVcbiAgICAgIGlmICh0aW1lU2luY2VMYXN0RmFpbHVyZSA+PSB0aW1lb3V0KSB7XG4gICAgICAgIGNpcmN1aXQuc3RhdGUgPSBDaXJjdWl0U3RhdGUuSEFMRl9PUEVOXG4gICAgICAgIGNpcmN1aXQuaGFsZk9wZW5SZXF1ZXN0cyA9IDBcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKGBDaXJjdWl0IGJyZWFrZXIgXCIke25hbWV9XCIgdHJhbnNpdGlvbmVkIHRvIEhBTEZfT1BFTmApXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENpcmN1aXQgYnJlYWtlciBcIiR7bmFtZX1cIiBpcyBPUEVOLiBSZXF1ZXN0IHJlamVjdGVkLmApXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g5Y2K5byA54q25oCB77ya6ZmQ5Yi26K+35rGC5pWwXG4gICAgaWYgKGNpcmN1aXQuc3RhdGUgPT09IENpcmN1aXRTdGF0ZS5IQUxGX09QRU4pIHtcbiAgICAgIGlmIChjaXJjdWl0LmhhbGZPcGVuUmVxdWVzdHMgPj0gaGFsZk9wZW5SZXF1ZXN0cykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENpcmN1aXQgYnJlYWtlciBcIiR7bmFtZX1cIiBpcyBIQUxGX09QRU4uIFJlcXVlc3QgbGltaXQgcmVhY2hlZC5gKVxuICAgICAgfVxuICAgICAgY2lyY3VpdC5oYWxmT3BlblJlcXVlc3RzKytcbiAgICB9XG5cbiAgICAvLyDmiafooYzmk43kvZxcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgb3BlcmF0aW9uKClcblxuICAgICAgLy8g5oiQ5YqfXG4gICAgICBhd2FpdCB0aGlzLnJlY29yZFN1Y2Nlc3MobmFtZSwgY2lyY3VpdCwgc3VjY2Vzc1RocmVzaG9sZClcbiAgICAgIHJldHVybiByZXN1bHRcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8g5aSx6LSlXG4gICAgICBhd2FpdCB0aGlzLnJlY29yZEZhaWx1cmUobmFtZSwgY2lyY3VpdCwgZmFpbHVyZVRocmVzaG9sZCwgZmFpbHVyZVJhdGVUaHJlc2hvbGQpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGdldE9yQ3JlYXRlQ2lyY3VpdFxuICAgKiBAZGVzY3JpcHRpb24g6I635Y+W5oiW5Yib5bu654aU5pat5ZmoXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldE9yQ3JlYXRlQ2lyY3VpdChuYW1lOiBzdHJpbmcpIHtcbiAgICAvLyBQcmltZWlybyB0ZW50YSBjYXJyZWdhciBkbyBSZWRpc1xuICAgIGlmICh0aGlzLnJlZGlzQ2xpZW50KSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZWRpc0tleSA9IGBjaXJjdWl0X2JyZWFrZXI6JHtuYW1lfWBcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMucmVkaXNDbGllbnQuaGdldGFsbChyZWRpc0tleSlcblxuICAgICAgICBpZiAoT2JqZWN0LmtleXMoZGF0YSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnN0IGNpcmN1aXQgPSB7XG4gICAgICAgICAgICBzdGF0ZTogKGRhdGEuc3RhdGUgYXMgQ2lyY3VpdFN0YXRlKSB8fCBDaXJjdWl0U3RhdGUuQ0xPU0VELFxuICAgICAgICAgICAgZmFpbHVyZXM6IHBhcnNlSW50KGRhdGEuZmFpbHVyZXMpIHx8IDAsXG4gICAgICAgICAgICBzdWNjZXNzZXM6IHBhcnNlSW50KGRhdGEuc3VjY2Vzc2VzKSB8fCAwLFxuICAgICAgICAgICAgbGFzdEZhaWx1cmVUaW1lOiBwYXJzZUludChkYXRhLmxhc3RGYWlsdXJlVGltZSkgfHwgMCxcbiAgICAgICAgICAgIGhhbGZPcGVuUmVxdWVzdHM6IHBhcnNlSW50KGRhdGEuaGFsZk9wZW5SZXF1ZXN0cykgfHwgMCxcbiAgICAgICAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgICAgICAgdG90YWxSZXF1ZXN0czogcGFyc2VJbnQoZGF0YS50b3RhbFJlcXVlc3RzKSB8fCAwLFxuICAgICAgICAgICAgICBzdWNjZXNzZnVsUmVxdWVzdHM6IHBhcnNlSW50KGRhdGEuc3VjY2Vzc2Z1bFJlcXVlc3RzKSB8fCAwLFxuICAgICAgICAgICAgICBmYWlsZWRSZXF1ZXN0czogcGFyc2VJbnQoZGF0YS5mYWlsZWRSZXF1ZXN0cykgfHwgMCxcbiAgICAgICAgICAgICAgZmFpbHVyZVJhdGU6IHBhcnNlRmxvYXQoZGF0YS5mYWlsdXJlUmF0ZSkgfHwgMCxcbiAgICAgICAgICAgICAgc3RhdGU6IChkYXRhLnN0YXRlIGFzIENpcmN1aXRTdGF0ZSkgfHwgQ2lyY3VpdFN0YXRlLkNMT1NFRCxcbiAgICAgICAgICAgICAgbGFzdFN0YXRlQ2hhbmdlOiBwYXJzZUludChkYXRhLmxhc3RTdGF0ZUNoYW5nZSkgfHwgRGF0ZS5ub3coKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuY2lyY3VpdHMuc2V0KG5hbWUsIGNpcmN1aXQpXG4gICAgICAgICAgcmV0dXJuIGNpcmN1aXRcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybihgRmFpbGVkIHRvIGxvYWQgY2lyY3VpdCBicmVha2VyICR7bmFtZX0gZnJvbSBSZWRpcywgdXNpbmcgbWVtb3J5OmAsIGVycm9yKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrIHBhcmEgbWVtw7NyaWFcbiAgICBpZiAoIXRoaXMuY2lyY3VpdHMuaGFzKG5hbWUpKSB7XG4gICAgICB0aGlzLmNpcmN1aXRzLnNldChuYW1lLCB7XG4gICAgICAgIHN0YXRlOiBDaXJjdWl0U3RhdGUuQ0xPU0VELFxuICAgICAgICBmYWlsdXJlczogMCxcbiAgICAgICAgc3VjY2Vzc2VzOiAwLFxuICAgICAgICBsYXN0RmFpbHVyZVRpbWU6IDAsXG4gICAgICAgIGhhbGZPcGVuUmVxdWVzdHM6IDAsXG4gICAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgICB0b3RhbFJlcXVlc3RzOiAwLFxuICAgICAgICAgIHN1Y2Nlc3NmdWxSZXF1ZXN0czogMCxcbiAgICAgICAgICBmYWlsZWRSZXF1ZXN0czogMCxcbiAgICAgICAgICBmYWlsdXJlUmF0ZTogMCxcbiAgICAgICAgICBzdGF0ZTogQ2lyY3VpdFN0YXRlLkNMT1NFRCxcbiAgICAgICAgICBsYXN0U3RhdGVDaGFuZ2U6IERhdGUubm93KCksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jaXJjdWl0cy5nZXQobmFtZSkhXG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCBzYXZlQ2lyY3VpdFRvUmVkaXNcbiAgICogQGRlc2NyaXB0aW9uIOS/neWtmOeGlOaWreWZqOeKtuaAgeWIsCBSZWRpc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBzYXZlQ2lyY3VpdFRvUmVkaXMoXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGNpcmN1aXQ6IEF3YWl0ZWQ8UmV0dXJuVHlwZTx0eXBlb2YgdGhpcy5nZXRPckNyZWF0ZUNpcmN1aXQ+PlxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMucmVkaXNDbGllbnQpIHJldHVyblxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlZGlzS2V5ID0gYGNpcmN1aXRfYnJlYWtlcjoke25hbWV9YFxuICAgICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgc3RhdGU6IGNpcmN1aXQuc3RhdGUsXG4gICAgICAgIGZhaWx1cmVzOiBjaXJjdWl0LmZhaWx1cmVzLnRvU3RyaW5nKCksXG4gICAgICAgIHN1Y2Nlc3NlczogY2lyY3VpdC5zdWNjZXNzZXMudG9TdHJpbmcoKSxcbiAgICAgICAgbGFzdEZhaWx1cmVUaW1lOiBjaXJjdWl0Lmxhc3RGYWlsdXJlVGltZS50b1N0cmluZygpLFxuICAgICAgICBoYWxmT3BlblJlcXVlc3RzOiBjaXJjdWl0LmhhbGZPcGVuUmVxdWVzdHMudG9TdHJpbmcoKSxcbiAgICAgICAgdG90YWxSZXF1ZXN0czogY2lyY3VpdC5tZXRyaWNzLnRvdGFsUmVxdWVzdHMudG9TdHJpbmcoKSxcbiAgICAgICAgc3VjY2Vzc2Z1bFJlcXVlc3RzOiBjaXJjdWl0Lm1ldHJpY3Muc3VjY2Vzc2Z1bFJlcXVlc3RzLnRvU3RyaW5nKCksXG4gICAgICAgIGZhaWxlZFJlcXVlc3RzOiBjaXJjdWl0Lm1ldHJpY3MuZmFpbGVkUmVxdWVzdHMudG9TdHJpbmcoKSxcbiAgICAgICAgZmFpbHVyZVJhdGU6IGNpcmN1aXQubWV0cmljcy5mYWlsdXJlUmF0ZS50b1N0cmluZygpLFxuICAgICAgICBsYXN0U3RhdGVDaGFuZ2U6IGNpcmN1aXQubWV0cmljcy5sYXN0U3RhdGVDaGFuZ2UudG9TdHJpbmcoKSxcbiAgICAgIH1cblxuICAgICAgYXdhaXQgdGhpcy5yZWRpc0NsaWVudC5obXNldChyZWRpc0tleSwgZGF0YSlcbiAgICAgIC8vIERlZmluaXIgVFRMIGRlIDI0IGhvcmFzIHBhcmEgZXZpdGFyIGFjw7ptdWxvIGRlIGRhZG9zIGFudGlnb3NcbiAgICAgIGF3YWl0IHRoaXMucmVkaXNDbGllbnQuZXhwaXJlKHJlZGlzS2V5LCA4NjQwMClcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIud2FybihgRmFpbGVkIHRvIHNhdmUgY2lyY3VpdCBicmVha2VyICR7bmFtZX0gdG8gUmVkaXM6YCwgZXJyb3IpXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgcmVjb3JkU3VjY2Vzc1xuICAgKiBAZGVzY3JpcHRpb24g6K6w5b2V5oiQ5YqfXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHJlY29yZFN1Y2Nlc3MoXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGNpcmN1aXQ6IEF3YWl0ZWQ8UmV0dXJuVHlwZTx0eXBlb2YgdGhpcy5nZXRPckNyZWF0ZUNpcmN1aXQ+PixcbiAgICBzdWNjZXNzVGhyZXNob2xkOiBudW1iZXJcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY2lyY3VpdC5tZXRyaWNzLnRvdGFsUmVxdWVzdHMrK1xuICAgIGNpcmN1aXQubWV0cmljcy5zdWNjZXNzZnVsUmVxdWVzdHMrK1xuICAgIGNpcmN1aXQuc3VjY2Vzc2VzKytcblxuICAgIC8vIOWNiuW8gOeKtuaAge+8muWmguaenOaIkOWKn+asoeaVsOi+vuWIsOmYiOWAvO+8jOWIh+aNouWIsOWFs+mXreeKtuaAgVxuICAgIGlmIChjaXJjdWl0LnN0YXRlID09PSBDaXJjdWl0U3RhdGUuSEFMRl9PUEVOKSB7XG4gICAgICBpZiAoY2lyY3VpdC5zdWNjZXNzZXMgPj0gc3VjY2Vzc1RocmVzaG9sZCkge1xuICAgICAgICBjaXJjdWl0LnN0YXRlID0gQ2lyY3VpdFN0YXRlLkNMT1NFRFxuICAgICAgICBjaXJjdWl0LmZhaWx1cmVzID0gMFxuICAgICAgICBjaXJjdWl0LnN1Y2Nlc3NlcyA9IDBcbiAgICAgICAgY2lyY3VpdC5tZXRyaWNzLnN0YXRlID0gQ2lyY3VpdFN0YXRlLkNMT1NFRFxuICAgICAgICBjaXJjdWl0Lm1ldHJpY3MubGFzdFN0YXRlQ2hhbmdlID0gRGF0ZS5ub3coKVxuICAgICAgICB0aGlzLmxvZ2dlci5sb2coYENpcmN1aXQgYnJlYWtlciBcIiR7bmFtZX1cIiB0cmFuc2l0aW9uZWQgdG8gQ0xPU0VEYClcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDmm7TmlrDlpLHotKXnjodcbiAgICBjaXJjdWl0Lm1ldHJpY3MuZmFpbHVyZVJhdGUgPVxuICAgICAgY2lyY3VpdC5tZXRyaWNzLnRvdGFsUmVxdWVzdHMgPiAwXG4gICAgICAgID8gY2lyY3VpdC5tZXRyaWNzLmZhaWxlZFJlcXVlc3RzIC8gY2lyY3VpdC5tZXRyaWNzLnRvdGFsUmVxdWVzdHNcbiAgICAgICAgOiAwXG5cbiAgICAvLyDkv53lrZjliLAgUmVkaXNcbiAgICBhd2FpdCB0aGlzLnNhdmVDaXJjdWl0VG9SZWRpcyhuYW1lLCBjaXJjdWl0KVxuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgcmVjb3JkRmFpbHVyZVxuICAgKiBAZGVzY3JpcHRpb24g6K6w5b2V5aSx6LSlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHJlY29yZEZhaWx1cmUoXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGNpcmN1aXQ6IEF3YWl0ZWQ8UmV0dXJuVHlwZTx0eXBlb2YgdGhpcy5nZXRPckNyZWF0ZUNpcmN1aXQ+PixcbiAgICBmYWlsdXJlVGhyZXNob2xkOiBudW1iZXIsXG4gICAgZmFpbHVyZVJhdGVUaHJlc2hvbGQ6IG51bWJlclxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjaXJjdWl0Lm1ldHJpY3MudG90YWxSZXF1ZXN0cysrXG4gICAgY2lyY3VpdC5tZXRyaWNzLmZhaWxlZFJlcXVlc3RzKytcbiAgICBjaXJjdWl0LmZhaWx1cmVzKytcbiAgICBjaXJjdWl0Lmxhc3RGYWlsdXJlVGltZSA9IERhdGUubm93KClcblxuICAgIC8vIOabtOaWsOWksei0peeOh1xuICAgIGNpcmN1aXQubWV0cmljcy5mYWlsdXJlUmF0ZSA9XG4gICAgICBjaXJjdWl0Lm1ldHJpY3MudG90YWxSZXF1ZXN0cyA+IDBcbiAgICAgICAgPyBjaXJjdWl0Lm1ldHJpY3MuZmFpbGVkUmVxdWVzdHMgLyBjaXJjdWl0Lm1ldHJpY3MudG90YWxSZXF1ZXN0c1xuICAgICAgICA6IDBcblxuICAgIC8vIOajgOafpeaYr+WQpumcgOimgeW8gOWQr+eGlOaWreWZqFxuICAgIGlmIChjaXJjdWl0LnN0YXRlID09PSBDaXJjdWl0U3RhdGUuQ0xPU0VEKSB7XG4gICAgICBjb25zdCBzaG91bGRPcGVuID1cbiAgICAgICAgY2lyY3VpdC5mYWlsdXJlcyA+PSBmYWlsdXJlVGhyZXNob2xkIHx8IGNpcmN1aXQubWV0cmljcy5mYWlsdXJlUmF0ZSA+PSBmYWlsdXJlUmF0ZVRocmVzaG9sZFxuXG4gICAgICBpZiAoc2hvdWxkT3Blbikge1xuICAgICAgICBjaXJjdWl0LnN0YXRlID0gQ2lyY3VpdFN0YXRlLk9QRU5cbiAgICAgICAgY2lyY3VpdC5tZXRyaWNzLnN0YXRlID0gQ2lyY3VpdFN0YXRlLk9QRU5cbiAgICAgICAgY2lyY3VpdC5tZXRyaWNzLmxhc3RTdGF0ZUNoYW5nZSA9IERhdGUubm93KClcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybihcbiAgICAgICAgICBgQ2lyY3VpdCBicmVha2VyIFwiJHtuYW1lfVwiIG9wZW5lZCBkdWUgdG8gZmFpbHVyZXM6ICR7Y2lyY3VpdC5mYWlsdXJlc30sIGZhaWx1cmUgcmF0ZTogJHtjaXJjdWl0Lm1ldHJpY3MuZmFpbHVyZVJhdGUudG9GaXhlZCgyKX1gXG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGNpcmN1aXQuc3RhdGUgPT09IENpcmN1aXRTdGF0ZS5IQUxGX09QRU4pIHtcbiAgICAgIC8vIOWNiuW8gOeKtuaAge+8muWmguaenOWksei0pe+8jOeri+WNs+WIh+aNouWIsOW8gOWQr+eKtuaAgVxuICAgICAgY2lyY3VpdC5zdGF0ZSA9IENpcmN1aXRTdGF0ZS5PUEVOXG4gICAgICBjaXJjdWl0Lm1ldHJpY3Muc3RhdGUgPSBDaXJjdWl0U3RhdGUuT1BFTlxuICAgICAgY2lyY3VpdC5tZXRyaWNzLmxhc3RTdGF0ZUNoYW5nZSA9IERhdGUubm93KClcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oYENpcmN1aXQgYnJlYWtlciBcIiR7bmFtZX1cIiBvcGVuZWQgYWZ0ZXIgZmFpbHVyZSBpbiBIQUxGX09QRU4gc3RhdGVgKVxuICAgIH1cblxuICAgIC8vIOS/neWtmOWIsCBSZWRpc1xuICAgIGF3YWl0IHRoaXMuc2F2ZUNpcmN1aXRUb1JlZGlzKG5hbWUsIGNpcmN1aXQpXG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCBnZXRNZXRyaWNzXG4gICAqIEBkZXNjcmlwdGlvbiDojrflj5bnhpTmlq3lmajmjIfmoIdcbiAgICovXG4gIGdldE1ldHJpY3MobmFtZTogc3RyaW5nKTogQ2lyY3VpdEJyZWFrZXJNZXRyaWNzIHwgbnVsbCB7XG4gICAgY29uc3QgY2lyY3VpdCA9IHRoaXMuY2lyY3VpdHMuZ2V0KG5hbWUpXG4gICAgcmV0dXJuIGNpcmN1aXQgPyBjaXJjdWl0Lm1ldHJpY3MgOiBudWxsXG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCByZXNldFxuICAgKiBAZGVzY3JpcHRpb24g6YeN572u54aU5pat5ZmoXG4gICAqL1xuICByZXNldChuYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBjaXJjdWl0ID0gdGhpcy5jaXJjdWl0cy5nZXQobmFtZSlcbiAgICBpZiAoY2lyY3VpdCkge1xuICAgICAgY2lyY3VpdC5zdGF0ZSA9IENpcmN1aXRTdGF0ZS5DTE9TRURcbiAgICAgIGNpcmN1aXQuZmFpbHVyZXMgPSAwXG4gICAgICBjaXJjdWl0LnN1Y2Nlc3NlcyA9IDBcbiAgICAgIGNpcmN1aXQuaGFsZk9wZW5SZXF1ZXN0cyA9IDBcbiAgICAgIGNpcmN1aXQubWV0cmljcyA9IHtcbiAgICAgICAgdG90YWxSZXF1ZXN0czogMCxcbiAgICAgICAgc3VjY2Vzc2Z1bFJlcXVlc3RzOiAwLFxuICAgICAgICBmYWlsZWRSZXF1ZXN0czogMCxcbiAgICAgICAgZmFpbHVyZVJhdGU6IDAsXG4gICAgICAgIHN0YXRlOiBDaXJjdWl0U3RhdGUuQ0xPU0VELFxuICAgICAgICBsYXN0U3RhdGVDaGFuZ2U6IERhdGUubm93KCksXG4gICAgICB9XG4gICAgICB0aGlzLmxvZ2dlci5sb2coYENpcmN1aXQgYnJlYWtlciBcIiR7bmFtZX1cIiByZXNldGApXG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=