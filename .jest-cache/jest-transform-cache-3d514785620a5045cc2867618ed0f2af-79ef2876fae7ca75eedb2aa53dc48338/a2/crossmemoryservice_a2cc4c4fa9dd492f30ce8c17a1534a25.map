{"file":"C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\vcp\\cross-memory.service.ts","mappings":";AAAA,+EAA+E;AAC/E,YAAY;AACZ,6BAA6B;AAC7B,+EAA+E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE/E,2CAAsE;AAEtE,wGAKwE;IAG3D,kBAAkB;4BAD9B,IAAA,mBAAU,GAAE;;;;;;;;YACb,6KAysBC;;;YAzsBY,uDAAkB;;QAGT,aAAa;QAFhB,MAAM,GAAG,IAAI,eAAM,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAA;QAE7D,YAAoB,aAA4B;YAA5B,kBAAa,GAAb,aAAa,CAAe;QAAG,CAAC;QAEpD,KAAK,CAAC,YAAY;YAChB,MAAM,IAAI,CAAC,sBAAsB,EAAE,CAAA;YACnC,IAAI,CAAC,sBAAsB,EAAE,CAAA;YAC7B,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC,CAAA;QAChC,CAAC;QAED,oDAAoD;QAEpD;;WAEG;QACK,KAAK,CAAC,sBAAsB;YAClC,WAAW;YACX,MAAM,mBAAmB,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,6BAA6B,EAAE,GAAG,CAAC,CAAA;YACtF,MAAM,cAAc,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,wBAAwB,EAAE,EAAE,CAAC,CAAA;YAC3E,MAAM,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,mBAAmB,EAAE,IAAI,CAAC,CAAA;YAEnE,iBAAiB;YACjB,2CAA2C;YAE3C,WAAW;YACX,MAAM,IAAI,CAAC,oBAAoB,EAAE,CAAA;YAEjC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC,CAAA;QAC9B,CAAC;QAED;;WAEG;QACK,KAAK,CAAC,oBAAoB;YAChC,MAAM,cAAc,GAA2D;gBAC7E;oBACE,OAAO,EAAE,QAAQ;oBACjB,IAAI,EAAE,WAAW;oBACjB,OAAO,EAAE;wBACP,KAAK,EAAE,kBAAkB;wBACzB,WAAW,EAAE,wBAAwB;qBACtC;oBACD,IAAI,EAAE,CAAC,WAAW,EAAE,QAAQ,EAAE,WAAW,EAAE,QAAQ,CAAC;oBACpD,UAAU,EAAE,GAAG;oBACf,WAAW,EAAE,EAAE;iBAChB;gBACD;oBACE,OAAO,EAAE,QAAQ;oBACjB,IAAI,EAAE,YAAY;oBAClB,OAAO,EAAE;wBACP,KAAK,EAAE,uBAAuB;wBAC9B,OAAO,EAAE,WAAW;wBACpB,OAAO,EAAE,gBAAgB;qBAC1B;oBACD,IAAI,EAAE,CAAC,QAAQ,EAAE,gBAAgB,EAAE,YAAY,CAAC;oBAChD,UAAU,EAAE,GAAG;oBACf,WAAW,EAAE,EAAE;iBAChB;gBACD;oBACE,OAAO,EAAE,QAAQ;oBACjB,IAAI,EAAE,WAAW;oBACjB,OAAO,EAAE;wBACP,KAAK,EAAE,wBAAwB;wBAC/B,WAAW,EAAE,0BAA0B;qBACxC;oBACD,IAAI,EAAE,CAAC,eAAe,EAAE,UAAU,EAAE,WAAW,EAAE,QAAQ,CAAC;oBAC1D,UAAU,EAAE,IAAI;oBAChB,WAAW,EAAE,EAAE;iBAChB;aACF,CAAA;YAED,KAAK,MAAM,MAAM,IAAI,cAAc,EAAE,CAAC;gBACpC,IAAI,CAAC;oBACH,MAAM,uCAAkB,CAAC,SAAS,CAAC,MAAM,CAAC,CAAA;gBAC5C,CAAC;gBAAC,OAAO,KAAK,EAAE,CAAC;oBACf,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,MAAM,CAAC,OAAO,EAAE,EAAE,KAAK,CAAC,CAAA;gBACxD,CAAC;YACH,CAAC;YAED,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC,CAAA;QAC9B,CAAC;QAED;;WAEG;QACK,sBAAsB;YAC5B,WAAW;YACX,WAAW,CACT,GAAG,EAAE;gBACH,IAAI,CAAC;oBACH,uCAAkB,CAAC,gBAAgB,EAAE,CAAA;gBACvC,CAAC;gBAAC,OAAO,KAAK,EAAE,CAAC;oBACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,WAAW,EAAE,KAAK,CAAC,CAAA;gBACvC,CAAC;YACH,CAAC,EACD,EAAE,GAAG,EAAE,GAAG,IAAI,CACf,CAAA,CAAC,UAAU;YAEZ,cAAc;YACd,WAAW,CACT,GAAG,EAAE;gBACH,IAAI,CAAC,qBAAqB,EAAE,CAAA;YAC9B,CAAC,EACD,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CACpB,CAAA,CAAC,SAAS;QACb,CAAC;QAED,mDAAmD;QAEnD;;WAEG;QACH,KAAK,CAAC,SAAS,CACb,UAAgE;YAEhE,IAAI,CAAC;gBACH,MAAM,QAAQ,GAAG,MAAM,uCAAkB,CAAC,SAAS,CAAC,UAAU,CAAC,CAAA;gBAC/D,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,QAAQ,EAAE,CAAC,CAAA;gBACvC,OAAO,QAAQ,CAAA;YACjB,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,KAAK,CAAC,CAAA;gBACnC,MAAM,KAAK,CAAA;YACb,CAAC;QACH,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,SAAS,CAAC,QAAgB;YAC9B,IAAI,CAAC;gBACH,OAAO,uCAAkB,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAA;YAC/C,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,QAAQ,GAAG,EAAE,KAAK,CAAC,CAAA;gBAC9C,OAAO,IAAI,CAAA;YACb,CAAC;QACH,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,YAAY,CAChB,QAAgB,EAChB,OAAsE;YAEtE,IAAI,CAAC;gBACH,MAAM,OAAO,GAAG,uCAAkB,CAAC,YAAY,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAA;gBAClE,IAAI,OAAO,EAAE,CAAC;oBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,QAAQ,EAAE,CAAC,CAAA;gBACzC,CAAC;gBACD,OAAO,OAAO,CAAA;YAChB,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,QAAQ,GAAG,EAAE,KAAK,CAAC,CAAA;gBAC/C,OAAO,KAAK,CAAA;YACd,CAAC;QACH,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,YAAY,CAAC,QAAgB;YACjC,IAAI,CAAC;gBACH,MAAM,OAAO,GAAG,uCAAkB,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAA;gBACzD,IAAI,OAAO,EAAE,CAAC;oBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,QAAQ,EAAE,CAAC,CAAA;gBACzC,CAAC;gBACD,OAAO,OAAO,CAAA;YAChB,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,QAAQ,GAAG,EAAE,KAAK,CAAC,CAAA;gBAC/C,OAAO,KAAK,CAAA;YACd,CAAC;QACH,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,aAAa,CAAC,KAAkB;YACpC,IAAI,CAAC;gBACH,OAAO,MAAM,uCAAkB,CAAC,aAAa,CAAC,KAAK,CAAC,CAAA;YACtD,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,KAAK,CAAC,CAAA;gBACnC,OAAO,EAAE,CAAA;YACX,CAAC;QACH,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,sBAAsB,CAAC,QAAgB,EAAE,UAAkB;YAC/D,IAAI,CAAC;gBACH,MAAM,OAAO,GAAG,uCAAkB,CAAC,sBAAsB,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAA;gBAC/E,IAAI,OAAO,EAAE,CAAC;oBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,QAAQ,MAAM,UAAU,EAAE,CAAC,CAAA;gBAC5D,CAAC;gBACD,OAAO,OAAO,CAAA;YAChB,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,QAAQ,GAAG,EAAE,KAAK,CAAC,CAAA;gBAClD,OAAO,KAAK,CAAA;YACd,CAAC;QACH,CAAC;QAED,qDAAqD;QAErD;;WAEG;QACH,KAAK,CAAC,cAAc,CAClB,OAAe,EACf,OAAe,EACf,OAAY,EACZ,OAA4B,YAAY;YAExC,MAAM,UAAU,GAAG;gBACjB,OAAO;gBACP,IAAI;gBACJ,OAAO,EAAE;oBACP,OAAO;oBACP,GAAG,OAAO;iBACX;gBACD,IAAI,EAAE,CAAC,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,OAAO,CAAC;gBACvC,UAAU,EAAE,IAAI,CAAC,8BAA8B,CAAC,OAAO,EAAE,IAAI,CAAC;gBAC9D,WAAW,EAAE,EAAE;aAChB,CAAA;YAED,OAAO,MAAM,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAA;QACzC,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,kBAAkB,CACtB,OAAe,EACf,OAAgB,EAChB,QAAgB,EAAE;YAElB,MAAM,KAAK,GAAgB;gBACzB,IAAI,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC;gBACxB,KAAK;gBACL,MAAM,EAAE,SAAS;aAClB,CAAA;YAED,IAAI,OAAO,EAAE,CAAC;gBACZ,KAAK,CAAC,OAAO,GAAG,OAAO,CAAA;YACzB,CAAC;YAED,OAAO,MAAM,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAA;QACxC,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,kBAAkB,CAAC,WAAmB,EAAE,OAAe,EAAE,OAAY;YACzE,MAAM,UAAU,GAAG;gBACjB,OAAO;gBACP,IAAI,EAAE,YAAY;gBAClB,OAAO,EAAE;oBACP,WAAW;oBACX,GAAG,OAAO;iBACX;gBACD,IAAI,EAAE,CAAC,WAAW,EAAE,WAAW,EAAE,aAAa,EAAE,OAAO,CAAC;gBACxD,UAAU,EAAE,IAAI,CAAC,kCAAkC,CAAC,OAAO,CAAC;gBAC5D,WAAW,EAAE,EAAE;aAChB,CAAA;YAED,OAAO,MAAM,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAA;QACzC,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,sBAAsB,CAC1B,WAAmB,EACnB,QAAgB,EAAE;YAElB,OAAO,MAAM,IAAI,CAAC,aAAa,CAAC;gBAC9B,IAAI,EAAE,CAAC,WAAW,EAAE,WAAW,CAAC;gBAChC,KAAK;gBACL,MAAM,EAAE,YAAY;aACrB,CAAC,CAAA;QACJ,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,kBAAkB,CACtB,WAAmB,EACnB,OAAe,EACf,OAAY,EACZ,OAAgB;YAEhB,MAAM,UAAU,GAAG;gBACjB,OAAO;gBACP,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,WAAW;gBAC1C,OAAO,EAAE;oBACP,WAAW;oBACX,OAAO;oBACP,OAAO;oBACP,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,WAAW;iBAC3C;gBACD,IAAI,EAAE,CAAC,kBAAkB,EAAE,WAAW,EAAE,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,SAAS,EAAE,OAAO,CAAC;gBACjF,UAAU,EAAE,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG;gBAC/B,WAAW,EAAE,EAAE;aAChB,CAAA;YAED,OAAO,MAAM,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAA;QACzC,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,2BAA2B,CAC/B,WAAmB,EACnB,cAAmB,EACnB,QAAgB,CAAC;YAEjB,0BAA0B;YAC1B,MAAM,KAAK,GAAgB;gBACzB,IAAI,EAAE,CAAC,kBAAkB,EAAE,WAAW,EAAE,SAAS,CAAC;gBAClD,KAAK;gBACL,MAAM,EAAE,YAAY;aACrB,CAAA;YAED,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAA;YAE/C,YAAY;YACZ,OAAO,OAAO,CAAC,MAAM,CAAC,CAAC,MAAM,EAAE,EAAE;gBAC/B,MAAM,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAA;gBAC7C,OAAO,IAAI,CAAC,0BAA0B,CAAC,cAAc,EAAE,OAAO,CAAC,GAAG,GAAG,CAAA;YACvE,CAAC,CAAC,CAAA;QACJ,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,iBAAiB,CACrB,MAAc,EACd,cAAsB,EACtB,UAAe;YAEf,MAAM,UAAU,GAAG;gBACjB,OAAO,EAAE,uBAAuB;gBAChC,IAAI,EAAE,WAAW;gBACjB,OAAO,EAAE;oBACP,MAAM;oBACN,cAAc;oBACd,UAAU;oBACV,OAAO,EAAE,iBAAiB;iBAC3B;gBACD,IAAI,EAAE,CAAC,iBAAiB,EAAE,MAAM,EAAE,cAAc,CAAC;gBACjD,UAAU,EAAE,GAAG,EAAE,UAAU;gBAC3B,WAAW,EAAE,EAAE;aAChB,CAAA;YAED,OAAO,MAAM,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAA;QACzC,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,kBAAkB,CAAC,MAAc,EAAE,cAAuB;YAC9D,MAAM,KAAK,GAAgB;gBACzB,IAAI,EAAE,CAAC,iBAAiB,EAAE,MAAM,CAAC;gBACjC,MAAM,EAAE,SAAS;gBACjB,KAAK,EAAE,EAAE;aACV,CAAA;YAED,IAAI,cAAc,EAAE,CAAC;gBACnB,KAAK,CAAC,IAAK,CAAC,IAAI,CAAC,cAAc,CAAC,CAAA;YAClC,CAAC;YAED,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAA;YAC/C,OAAO,OAAO,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;gBAC9B,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,cAAc;gBAC1C,UAAU,EAAE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU;gBAC5C,SAAS,EAAE,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAS;gBAC3C,UAAU,EAAE,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU;aAC9C,CAAC,CAAC,CAAA;QACL,CAAC;QAED,mDAAmD;QAEnD;;WAEG;QACH,KAAK,CAAC,mBAAmB,CAAC,QAAgB,EAAE,QAAgB,EAAE;YAC5D,IAAI,CAAC;gBACH,OAAO,MAAM,uCAAkB,CAAC,mBAAmB,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAA;YACtE,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,QAAQ,GAAG,EAAE,KAAK,CAAC,CAAA;gBAChD,OAAO,EAAE,CAAA;YACX,CAAC;QACH,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,iBAAiB,CACrB,KAAa,EACb,UAKI,EAAE,EACN,QAAgB,EAAE;YAElB,MAAM,WAAW,GAAgB;gBAC/B,OAAO,EAAE,KAAK;gBACd,KAAK,EAAE,IAAI;gBACX,KAAK;gBACL,MAAM,EAAE,WAAW;aACpB,CAAA;YAED,UAAU;YACV,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC;gBACnB,WAAW,CAAC,IAAI,GAAG,CAAC,WAAW,CAAC,IAAI,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,MAAM,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC,CAAA;YAC9E,CAAC;YACD,IAAI,OAAO,CAAC,OAAO,EAAE,CAAC;gBACpB,WAAW,CAAC,IAAI,GAAG,CAAC,WAAW,CAAC,IAAI,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC,CAAA;YAChF,CAAC;YACD,IAAI,OAAO,CAAC,OAAO,EAAE,CAAC;gBACpB,WAAW,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,CAAA;YACvC,CAAC;YACD,IAAI,OAAO,CAAC,IAAI,EAAE,CAAC;gBACjB,WAAW,CAAC,IAAI,GAAG,CAAC,WAAW,CAAC,IAAI,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA;YAClE,CAAC;YAED,OAAO,MAAM,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,CAAA;QAC9C,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,sBAAsB,CAC1B,OAAe,EACf,KAAa,EACb,QAAgB,EAAE;YAElB,iBAAiB;YACjB,MAAM,gBAAgB,GAAgB;gBACpC,IAAI,EAAE,CAAC,kBAAkB,EAAE,SAAS,CAAC;gBACrC,OAAO,EAAE,KAAK;gBACd,KAAK,EAAE,IAAI;gBACX,KAAK;gBACL,MAAM,EAAE,YAAY;aACrB,CAAA;YAED,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAA;YAE1D,cAAc;YACd,MAAM,gBAAgB,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC;gBAChD,IAAI,EAAE,CAAC,WAAW,EAAE,WAAW,CAAC;gBAChC,KAAK,EAAE,CAAC;aACT,CAAC,CAAA;YAEF,OAAO,CAAC,GAAG,OAAO,EAAE,GAAG,gBAAgB,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAA;QAC1D,CAAC;QAED,sDAAsD;QAEtD;;WAEG;QACH,KAAK,CAAC,6BAA6B,CACjC,eAAuB,EACvB,MAAgB,EAChB,OAAY;YAEZ,MAAM,UAAU,GAAG;gBACjB,OAAO,EAAE,qBAAqB;gBAC9B,IAAI,EAAE,YAAY;gBAClB,OAAO,EAAE;oBACP,eAAe;oBACf,MAAM;oBACN,OAAO;oBACP,aAAa,EAAE,IAAI,CAAC,kCAAkC,CAAC,OAAO,CAAC;oBAC/D,OAAO,EAAE,IAAI,CAAC,2BAA2B,CAAC,OAAO,CAAC;iBACnD;gBACD,IAAI,EAAE,CAAC,eAAe,EAAE,YAAY,EAAE,eAAe,EAAE,GAAG,MAAM,CAAC;gBACjE,UAAU,EAAE,GAAG;gBACf,WAAW,EAAE,EAAE;aAChB,CAAA;YAED,OAAO,MAAM,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAA;QACzC,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,uBAAuB,CAC3B,OAAe,EACf,QAAgB,EAAE;YAElB,OAAO,MAAM,IAAI,CAAC,aAAa,CAAC;gBAC9B,IAAI,EAAE,CAAC,eAAe,EAAE,OAAO,CAAC;gBAChC,KAAK;gBACL,MAAM,EAAE,SAAS;aAClB,CAAC,CAAA;QACJ,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,iCAAiC;YACrC,MAAM,wBAAwB,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC;gBACxD,IAAI,EAAE,CAAC,eAAe,EAAE,YAAY,CAAC;gBACrC,OAAO,EAAE,SAAS;gBAClB,KAAK,EAAE,IAAI;gBACX,KAAK,EAAE,EAAE;aACV,CAAC,CAAA;YAEF,SAAS;YACT,MAAM,QAAQ,GAAG,IAAI,CAAC,4BAA4B,CAAC,wBAAwB,CAAC,CAAA;YAC5E,OAAO,QAAQ,CAAA;QACjB,CAAC;QAED,iDAAiD;QAEjD;;WAEG;QACK,8BAA8B,CAAC,OAAY,EAAE,IAAyB;YAC5E,IAAI,UAAU,GAAG,GAAG,CAAA;YAEpB,QAAQ,IAAI,EAAE,CAAC;gBACb,KAAK,YAAY;oBACf,UAAU,GAAG,GAAG,CAAA;oBAChB,MAAK;gBACP,KAAK,WAAW;oBACd,UAAU,GAAG,GAAG,CAAA;oBAChB,MAAK;gBACP,KAAK,OAAO;oBACV,UAAU,GAAG,GAAG,CAAA;oBAChB,MAAK;YACT,CAAC;YAED,YAAY;YACZ,IAAI,OAAO,CAAC,SAAS;gBAAE,UAAU,IAAI,GAAG,CAAA;YACxC,IAAI,OAAO,CAAC,QAAQ;gBAAE,UAAU,IAAI,GAAG,CAAA;YACvC,IAAI,OAAO,CAAC,UAAU;gBAAE,UAAU,IAAI,GAAG,CAAA;YAEzC,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,UAAU,CAAC,CAAA;QAChC,CAAC;QAED;;WAEG;QACK,kCAAkC,CAAC,OAAY;YACrD,IAAI,UAAU,GAAG,GAAG,CAAA;YAEpB,IAAI,OAAO,CAAC,iBAAiB;gBAAE,UAAU,IAAI,GAAG,CAAA;YAChD,IAAI,OAAO,CAAC,kBAAkB;gBAAE,UAAU,IAAI,IAAI,CAAA;YAClD,IAAI,OAAO,CAAC,WAAW;gBAAE,UAAU,IAAI,GAAG,CAAA;YAE1C,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,UAAU,CAAC,CAAA;QAChC,CAAC;QAED;;WAEG;QACK,0BAA0B,CAAC,QAAa,EAAE,QAAa;YAC7D,WAAW;YACX,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC;gBAAE,OAAO,GAAG,CAAA;YAErE,SAAS;YACT,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;YACnC,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;YACnC,MAAM,UAAU,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAA;YAE7D,IAAI,UAAU,CAAC,MAAM,KAAK,CAAC;gBAAE,OAAO,CAAC,CAAA;YAErC,IAAI,UAAU,GAAG,UAAU,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,MAAM,CAAC,CAAA;YAEzE,QAAQ;YACR,KAAK,MAAM,GAAG,IAAI,UAAU,EAAE,CAAC;gBAC7B,IAAI,QAAQ,CAAC,GAAG,CAAC,KAAK,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC;oBACpC,UAAU,IAAI,GAAG,CAAA;gBACnB,CAAC;YACH,CAAC;YAED,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,UAAU,CAAC,CAAA;QAChC,CAAC;QAED;;WAEG;QACK,kCAAkC,CAAC,OAAY;YACrD,WAAW;YACX,IAAI,aAAa,GAAG,GAAG,CAAA;YAEvB,IAAI,OAAO,CAAC,OAAO;gBAAE,aAAa,IAAI,GAAG,CAAA;YACzC,IAAI,OAAO,CAAC,OAAO,GAAG,GAAG;gBAAE,aAAa,IAAI,GAAG,CAAA;YAC/C,IAAI,OAAO,CAAC,cAAc,GAAG,GAAG;gBAAE,aAAa,IAAI,GAAG,CAAA;YAEtD,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,aAAa,CAAC,CAAA;QACnC,CAAC;QAED;;WAEG;QACK,2BAA2B,CAAC,OAAY;YAC9C,MAAM,OAAO,GAAa,EAAE,CAAA;YAE5B,IAAI,OAAO,CAAC,mBAAmB,EAAE,CAAC;gBAChC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;YACxB,CAAC;YACD,IAAI,OAAO,CAAC,aAAa,EAAE,CAAC;gBAC1B,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;YACxB,CAAC;YACD,IAAI,OAAO,CAAC,UAAU,EAAE,CAAC;gBACvB,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;YACxB,CAAC;YAED,OAAO,OAAO,CAAA;QAChB,CAAC;QAED;;WAEG;QACK,4BAA4B,CAAC,cAAoC;YACvE,UAAU;YACV,MAAM,QAAQ,GAAU,EAAE,CAAA;YAE1B,KAAK,MAAM,MAAM,IAAI,cAAc,EAAE,CAAC;gBACpC,MAAM,OAAO,GAAG;oBACd,UAAU,EAAE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,EAAE,MAAM,IAAI,CAAC;oBACrD,aAAa,EAAE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,aAAa,IAAI,GAAG;oBACzD,UAAU,EAAE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,IAAI,EAAE;iBAChD,CAAA;gBACD,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;YACxB,CAAC;YAED,OAAO,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,aAAa,GAAG,CAAC,CAAC,aAAa,CAAC,CAAA;QACnE,CAAC;QAED;;WAEG;QACK,KAAK,CAAC,qBAAqB;YACjC,IAAI,CAAC;gBACH,WAAW;gBACX,MAAM,KAAK,GAAG,uCAAkB,CAAC,QAAQ,EAAE,CAAA;gBAC3C,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,WAAW,KAAK,CAAC,aAAa,QAAQ,KAAK,CAAC,gBAAgB,KAAK,CAAC,CAAA;gBAEpF,iBAAiB;gBACjB,iBAAiB;YACnB,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,WAAW,EAAE,KAAK,CAAC,CAAA;YACvC,CAAC;QACH,CAAC;QAED,kDAAkD;QAElD;;WAEG;QACH,cAAc;YACZ,IAAI,CAAC;gBACH,OAAO,uCAAkB,CAAC,QAAQ,EAAE,CAAA;YACtC,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,WAAW,EAAE,KAAK,CAAC,CAAA;gBACrC,OAAO;oBACL,aAAa,EAAE,CAAC;oBAChB,gBAAgB,EAAE,CAAC;oBACnB,UAAU,EAAE,CAAC;oBACb,WAAW,EAAE,EAAE;oBACf,iBAAiB,EAAE,CAAC;iBACrB,CAAA;YACH,CAAC;QACH,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,WAAW;YACf,IAAI,CAAC;gBACH,MAAM,KAAK,GAAG,IAAI,CAAC,cAAc,EAAE,CAAA;gBACnC,OAAO;oBACL,MAAM,EAAE,SAAS;oBACjB,OAAO,EAAE,KAAK;iBACf,CAAA;YACH,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,OAAO;oBACL,MAAM,EAAE,OAAO;oBACf,OAAO,EAAE,KAAK,CAAC,OAAO;iBACvB,CAAA;YACH,CAAC;QACH,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,gBAAgB;YACpB,IAAI,CAAC;gBACH,OAAO,uCAAkB,CAAC,mBAAmB,EAAE,CAAA;YACjD,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,WAAW,EAAE,KAAK,CAAC,CAAA;gBACrC,OAAO,EAAE,QAAQ,EAAE,EAAE,EAAE,WAAW,EAAE,EAAE,EAAE,CAAA;YAC1C,CAAC;QACH,CAAC;QAED;;WAEG;QACH,KAAK,CAAC,gBAAgB,CAAC,IAAS;YAC9B,IAAI,CAAC;gBACH,uCAAkB,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAA;gBAC5C,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,UAAU,CAAC,CAAA;YAC7B,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,WAAW,EAAE,KAAK,CAAC,CAAA;gBACrC,MAAM,KAAK,CAAA;YACb,CAAC;QACH,CAAC;;;;AAxsBU,gDAAkB","names":[],"sources":["C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\vcp\\cross-memory.service.ts"],"sourcesContent":["// ============================================================================\n// 跨记忆网络服务集成\n// 集成 VCPToolBox 的智能记忆共享和联想能力\n// ============================================================================\n\nimport { Injectable, Logger, type OnModuleInit } from '@nestjs/common'\nimport { ConfigService } from '@nestjs/config'\nimport {\n  crossMemoryNetwork,\n  type MemoryEntry,\n  type MemoryQuery,\n  type MemorySearchResult,\n} from '../../../apps/vcptoolbox/src/modules/storage/CrossMemoryNetwork'\n\n@Injectable()\nexport class CrossMemoryService implements OnModuleInit {\n  private readonly logger = new Logger(CrossMemoryService.name)\n\n  constructor(private configService: ConfigService) {}\n\n  async onModuleInit() {\n    await this.initializeMemorySystem()\n    this.setupMemoryMaintenance()\n    this.logger.log('跨记忆网络服务已初始化')\n  }\n\n  // ==================== 记忆系统初始化 ====================\n\n  /**\n   * 初始化记忆系统\n   */\n  private async initializeMemorySystem(): Promise<void> {\n    // 设置记忆网络参数\n    const similarityThreshold = this.configService.get('MEMORY_SIMILARITY_THRESHOLD', 0.7)\n    const maxConnections = this.configService.get('MEMORY_MAX_CONNECTIONS', 10)\n    const decayRate = this.configService.get('MEMORY_DECAY_RATE', 0.95)\n\n    // 重新配置记忆网络（如果需要）\n    // 注意：crossMemoryNetwork 已经在模块中初始化，这里可以设置参数\n\n    // 创建系统初始记忆\n    await this.createSystemMemories()\n\n    this.logger.log('记忆系统参数已配置')\n  }\n\n  /**\n   * 创建系统初始记忆\n   */\n  private async createSystemMemories(): Promise<void> {\n    const systemMemories: Omit<MemoryEntry, 'id' | 'fingerprint' | 'metadata'>[] = [\n      {\n        agentId: 'system',\n        type: 'knowledge',\n        content: {\n          topic: 'narrative_basics',\n          information: '叙事创作的基本要素包括人物、情节、设定和主题',\n        },\n        tags: ['narrative', 'basics', 'knowledge', 'system'],\n        importance: 0.9,\n        connections: [],\n      },\n      {\n        agentId: 'system',\n        type: 'experience',\n        content: {\n          event: 'system_initialization',\n          outcome: '记忆系统成功初始化',\n          lessons: '记忆系统对于AI创作至关重要',\n        },\n        tags: ['system', 'initialization', 'experience'],\n        importance: 0.8,\n        connections: [],\n      },\n      {\n        agentId: 'system',\n        type: 'knowledge',\n        content: {\n          topic: 'collaboration_patterns',\n          information: '有效的Agent协作需要明确的角色分工和通信协议',\n        },\n        tags: ['collaboration', 'patterns', 'knowledge', 'system'],\n        importance: 0.85,\n        connections: [],\n      },\n    ]\n\n    for (const memory of systemMemories) {\n      try {\n        await crossMemoryNetwork.addMemory(memory)\n      } catch (error) {\n        this.logger.warn(`创建系统记忆失败: ${memory.content}`, error)\n      }\n    }\n\n    this.logger.log('系统初始记忆已创建')\n  }\n\n  /**\n   * 设置记忆维护任务\n   */\n  private setupMemoryMaintenance(): void {\n    // 定期应用记忆衰减\n    setInterval(\n      () => {\n        try {\n          crossMemoryNetwork.applyMemoryDecay()\n        } catch (error) {\n          this.logger.error('记忆衰减应用失败:', error)\n        }\n      },\n      60 * 60 * 1000\n    ) // 每小时执行一次\n\n    // 定期清理和优化记忆网络\n    setInterval(\n      () => {\n        this.optimizeMemoryNetwork()\n      },\n      24 * 60 * 60 * 1000\n    ) // 每天执行一次\n  }\n\n  // ==================== 记忆管理接口 ====================\n\n  /**\n   * 添加记忆\n   */\n  async addMemory(\n    memoryData: Omit<MemoryEntry, 'id' | 'fingerprint' | 'metadata'>\n  ): Promise<string> {\n    try {\n      const memoryId = await crossMemoryNetwork.addMemory(memoryData)\n      this.logger.debug(`记忆已添加: ${memoryId}`)\n      return memoryId\n    } catch (error: any) {\n      this.logger.error('添加记忆失败:', error)\n      throw error\n    }\n  }\n\n  /**\n   * 获取记忆\n   */\n  async getMemory(memoryId: string): Promise<MemoryEntry | null> {\n    try {\n      return crossMemoryNetwork.getMemory(memoryId)\n    } catch (error: any) {\n      this.logger.warn(`获取记忆失败 ${memoryId}:`, error)\n      return null\n    }\n  }\n\n  /**\n   * 更新记忆\n   */\n  async updateMemory(\n    memoryId: string,\n    updates: Partial<Omit<MemoryEntry, 'id' | 'fingerprint' | 'metadata'>>\n  ): Promise<boolean> {\n    try {\n      const success = crossMemoryNetwork.updateMemory(memoryId, updates)\n      if (success) {\n        this.logger.debug(`记忆已更新: ${memoryId}`)\n      }\n      return success\n    } catch (error: any) {\n      this.logger.error(`更新记忆失败 ${memoryId}:`, error)\n      return false\n    }\n  }\n\n  /**\n   * 删除记忆\n   */\n  async deleteMemory(memoryId: string): Promise<boolean> {\n    try {\n      const success = crossMemoryNetwork.deleteMemory(memoryId)\n      if (success) {\n        this.logger.debug(`记忆已删除: ${memoryId}`)\n      }\n      return success\n    } catch (error: any) {\n      this.logger.error(`删除记忆失败 ${memoryId}:`, error)\n      return false\n    }\n  }\n\n  /**\n   * 查询记忆\n   */\n  async queryMemories(query: MemoryQuery): Promise<MemorySearchResult[]> {\n    try {\n      return await crossMemoryNetwork.queryMemories(query)\n    } catch (error: any) {\n      this.logger.error('查询记忆失败:', error)\n      return []\n    }\n  }\n\n  /**\n   * 更新记忆重要性\n   */\n  async updateMemoryImportance(memoryId: string, importance: number): Promise<boolean> {\n    try {\n      const success = crossMemoryNetwork.updateMemoryImportance(memoryId, importance)\n      if (success) {\n        this.logger.debug(`记忆重要性已更新: ${memoryId} = ${importance}`)\n      }\n      return success\n    } catch (error: any) {\n      this.logger.error(`更新记忆重要性失败 ${memoryId}:`, error)\n      return false\n    }\n  }\n\n  // ==================== 叙事专用记忆接口 ====================\n\n  /**\n   * 添加故事记忆\n   */\n  async addStoryMemory(\n    storyId: string,\n    agentId: string,\n    content: any,\n    type: MemoryEntry['type'] = 'experience'\n  ): Promise<string> {\n    const memoryData = {\n      agentId,\n      type,\n      content: {\n        storyId,\n        ...content,\n      },\n      tags: ['story', storyId, type, agentId],\n      importance: this.calculateStoryMemoryImportance(content, type),\n      connections: [],\n    }\n\n    return await this.addMemory(memoryData)\n  }\n\n  /**\n   * 查询故事相关记忆\n   */\n  async queryStoryMemories(\n    storyId: string,\n    agentId?: string,\n    limit: number = 20\n  ): Promise<MemorySearchResult[]> {\n    const query: MemoryQuery = {\n      tags: ['story', storyId],\n      limit,\n      sortBy: 'recency',\n    }\n\n    if (agentId) {\n      query.agentId = agentId\n    }\n\n    return await this.queryMemories(query)\n  }\n\n  /**\n   * 添加角色记忆\n   */\n  async addCharacterMemory(characterId: string, agentId: string, content: any): Promise<string> {\n    const memoryData = {\n      agentId,\n      type: 'experience',\n      content: {\n        characterId,\n        ...content,\n      },\n      tags: ['character', characterId, 'development', agentId],\n      importance: this.calculateCharacterMemoryImportance(content),\n      connections: [],\n    }\n\n    return await this.addMemory(memoryData)\n  }\n\n  /**\n   * 查询角色相关记忆\n   */\n  async queryCharacterMemories(\n    characterId: string,\n    limit: number = 15\n  ): Promise<MemorySearchResult[]> {\n    return await this.queryMemories({\n      tags: ['character', characterId],\n      limit,\n      sortBy: 'importance',\n    })\n  }\n\n  /**\n   * 添加创作模式记忆\n   */\n  async addCreativePattern(\n    patternType: string,\n    agentId: string,\n    pattern: any,\n    success: boolean\n  ): Promise<string> {\n    const memoryData = {\n      agentId,\n      type: success ? 'experience' : 'knowledge',\n      content: {\n        patternType,\n        pattern,\n        success,\n        lessons: success ? '有效的创作模式' : '需要改进的创作模式',\n      },\n      tags: ['creative-pattern', patternType, success ? 'success' : 'failure', agentId],\n      importance: success ? 0.8 : 0.6,\n      connections: [],\n    }\n\n    return await this.addMemory(memoryData)\n  }\n\n  /**\n   * 查找相似创作模式\n   */\n  async findSimilarCreativePatterns(\n    patternType: string,\n    currentPattern: any,\n    limit: number = 5\n  ): Promise<MemorySearchResult[]> {\n    // 简化的模式匹配，实际应该使用更复杂的相似度算法\n    const query: MemoryQuery = {\n      tags: ['creative-pattern', patternType, 'success'],\n      limit,\n      sortBy: 'importance',\n    }\n\n    const results = await this.queryMemories(query)\n\n    // 进一步过滤相似模式\n    return results.filter((result) => {\n      const pattern = result.memory.content.pattern\n      return this.calculatePatternSimilarity(currentPattern, pattern) > 0.7\n    })\n  }\n\n  /**\n   * 添加用户偏好记忆\n   */\n  async addUserPreference(\n    userId: string,\n    preferenceType: string,\n    preference: any\n  ): Promise<string> {\n    const memoryData = {\n      agentId: 'user-preference-agent',\n      type: 'knowledge',\n      content: {\n        userId,\n        preferenceType,\n        preference,\n        context: 'user_preference',\n      },\n      tags: ['user-preference', userId, preferenceType],\n      importance: 0.9, // 用户偏好很重要\n      connections: [],\n    }\n\n    return await this.addMemory(memoryData)\n  }\n\n  /**\n   * 获取用户偏好\n   */\n  async getUserPreferences(userId: string, preferenceType?: string): Promise<any[]> {\n    const query: MemoryQuery = {\n      tags: ['user-preference', userId],\n      sortBy: 'recency',\n      limit: 50,\n    }\n\n    if (preferenceType) {\n      query.tags!.push(preferenceType)\n    }\n\n    const results = await this.queryMemories(query)\n    return results.map((result) => ({\n      type: result.memory.content.preferenceType,\n      preference: result.memory.content.preference,\n      timestamp: result.memory.metadata.createdAt,\n      confidence: result.memory.metadata.confidence,\n    }))\n  }\n\n  // ==================== 智能联想接口 ====================\n\n  /**\n   * 查找相关记忆\n   */\n  async findRelatedMemories(memoryId: string, limit: number = 10): Promise<MemoryEntry[]> {\n    try {\n      return await crossMemoryNetwork.findRelatedMemories(memoryId, limit)\n    } catch (error: any) {\n      this.logger.warn(`查找相关记忆失败 ${memoryId}:`, error)\n      return []\n    }\n  }\n\n  /**\n   * 基于内容的智能搜索\n   */\n  async intelligentSearch(\n    query: string,\n    context: {\n      userId?: string\n      storyId?: string\n      agentId?: string\n      tags?: string[]\n    } = {},\n    limit: number = 20\n  ): Promise<MemorySearchResult[]> {\n    const searchQuery: MemoryQuery = {\n      content: query,\n      fuzzy: true,\n      limit,\n      sortBy: 'relevance',\n    }\n\n    // 添加上下文过滤\n    if (context.userId) {\n      searchQuery.tags = (searchQuery.tags || []).concat(['user', context.userId])\n    }\n    if (context.storyId) {\n      searchQuery.tags = (searchQuery.tags || []).concat(['story', context.storyId])\n    }\n    if (context.agentId) {\n      searchQuery.agentId = context.agentId\n    }\n    if (context.tags) {\n      searchQuery.tags = (searchQuery.tags || []).concat(context.tags)\n    }\n\n    return await this.queryMemories(searchQuery)\n  }\n\n  /**\n   * 获取创作灵感\n   */\n  async getCreativeInspiration(\n    storyId: string,\n    theme: string,\n    limit: number = 10\n  ): Promise<MemorySearchResult[]> {\n    // 查找与主题相关的成功创作经验\n    const inspirationQuery: MemoryQuery = {\n      tags: ['creative-pattern', 'success'],\n      content: theme,\n      fuzzy: true,\n      limit,\n      sortBy: 'importance',\n    }\n\n    const results = await this.queryMemories(inspirationQuery)\n\n    // 补充一些通用的创作知识\n    const generalKnowledge = await this.queryMemories({\n      tags: ['narrative', 'knowledge'],\n      limit: 5,\n    })\n\n    return [...results, ...generalKnowledge].slice(0, limit)\n  }\n\n  // ==================== Agent协作记忆 ====================\n\n  /**\n   * 记录Agent协作经验\n   */\n  async recordCollaborationExperience(\n    collaborationId: string,\n    agents: string[],\n    outcome: any\n  ): Promise<string> {\n    const memoryData = {\n      agentId: 'collaboration-agent',\n      type: 'experience',\n      content: {\n        collaborationId,\n        agents,\n        outcome,\n        effectiveness: this.evaluateCollaborationEffectiveness(outcome),\n        lessons: this.extractCollaborationLessons(outcome),\n      },\n      tags: ['collaboration', 'experience', collaborationId, ...agents],\n      importance: 0.7,\n      connections: [],\n    }\n\n    return await this.addMemory(memoryData)\n  }\n\n  /**\n   * 获取Agent协作历史\n   */\n  async getCollaborationHistory(\n    agentId: string,\n    limit: number = 10\n  ): Promise<MemorySearchResult[]> {\n    return await this.queryMemories({\n      tags: ['collaboration', agentId],\n      limit,\n      sortBy: 'recency',\n    })\n  }\n\n  /**\n   * 学习最优协作模式\n   */\n  async learnOptimalCollaborationPatterns(): Promise<any[]> {\n    const successfulCollaborations = await this.queryMemories({\n      tags: ['collaboration', 'experience'],\n      content: 'success',\n      fuzzy: true,\n      limit: 50,\n    })\n\n    // 分析协作模式\n    const patterns = this.analyzeCollaborationPatterns(successfulCollaborations)\n    return patterns\n  }\n\n  // ==================== 辅助方法 ====================\n\n  /**\n   * 计算故事记忆重要性\n   */\n  private calculateStoryMemoryImportance(content: any, type: MemoryEntry['type']): number {\n    let importance = 0.5\n\n    switch (type) {\n      case 'experience':\n        importance = 0.7\n        break\n      case 'knowledge':\n        importance = 0.8\n        break\n      case 'event':\n        importance = 0.6\n        break\n    }\n\n    // 根据内容调整重要性\n    if (content.keyMoment) importance += 0.2\n    if (content.conflict) importance += 0.1\n    if (content.resolution) importance += 0.1\n\n    return Math.min(1, importance)\n  }\n\n  /**\n   * 计算角色记忆重要性\n   */\n  private calculateCharacterMemoryImportance(content: any): number {\n    let importance = 0.6\n\n    if (content.personalityChange) importance += 0.2\n    if (content.relationshipChange) importance += 0.15\n    if (content.keyDecision) importance += 0.1\n\n    return Math.min(1, importance)\n  }\n\n  /**\n   * 计算模式相似度\n   */\n  private calculatePatternSimilarity(pattern1: any, pattern2: any): number {\n    // 简化的相似度计算\n    if (JSON.stringify(pattern1) === JSON.stringify(pattern2)) return 1.0\n\n    // 检查共同属性\n    const keys1 = Object.keys(pattern1)\n    const keys2 = Object.keys(pattern2)\n    const commonKeys = keys1.filter((key) => keys2.includes(key))\n\n    if (commonKeys.length === 0) return 0\n\n    let similarity = commonKeys.length / Math.max(keys1.length, keys2.length)\n\n    // 检查共同值\n    for (const key of commonKeys) {\n      if (pattern1[key] === pattern2[key]) {\n        similarity += 0.1\n      }\n    }\n\n    return Math.min(1, similarity)\n  }\n\n  /**\n   * 评估协作有效性\n   */\n  private evaluateCollaborationEffectiveness(outcome: any): number {\n    // 简化的有效性评估\n    let effectiveness = 0.5\n\n    if (outcome.success) effectiveness += 0.3\n    if (outcome.quality > 0.8) effectiveness += 0.2\n    if (outcome.timeEfficiency > 0.7) effectiveness += 0.1\n\n    return Math.min(1, effectiveness)\n  }\n\n  /**\n   * 提取协作经验教训\n   */\n  private extractCollaborationLessons(outcome: any): string[] {\n    const lessons: string[] = []\n\n    if (outcome.communicationIssues) {\n      lessons.push('改善沟通机制')\n    }\n    if (outcome.roleConflicts) {\n      lessons.push('明确角色分工')\n    }\n    if (outcome.timeDelays) {\n      lessons.push('优化时间管理')\n    }\n\n    return lessons\n  }\n\n  /**\n   * 分析协作模式\n   */\n  private analyzeCollaborationPatterns(collaborations: MemorySearchResult[]): any[] {\n    // 简化的模式分析\n    const patterns: any[] = []\n\n    for (const collab of collaborations) {\n      const pattern = {\n        agentCount: collab.memory.content.agents?.length || 0,\n        effectiveness: collab.memory.content.effectiveness || 0.5,\n        keyFactors: collab.memory.content.lessons || [],\n      }\n      patterns.push(pattern)\n    }\n\n    return patterns.sort((a, b) => b.effectiveness - a.effectiveness)\n  }\n\n  /**\n   * 优化记忆网络\n   */\n  private async optimizeMemoryNetwork(): Promise<void> {\n    try {\n      // 清理低重要性记忆\n      const stats = crossMemoryNetwork.getStats()\n      this.logger.debug(`记忆网络状态: ${stats.totalMemories} 记忆, ${stats.totalConnections} 连接`)\n\n      // 这里可以添加更复杂的优化逻辑\n      // 比如合并相似记忆、重建连接等\n    } catch (error) {\n      this.logger.error('记忆网络优化失败:', error)\n    }\n  }\n\n  // ==================== 统计和监控 ====================\n\n  /**\n   * 获取记忆统计信息\n   */\n  getMemoryStats(): any {\n    try {\n      return crossMemoryNetwork.getStats()\n    } catch (error) {\n      this.logger.error('获取记忆统计失败:', error)\n      return {\n        totalMemories: 0,\n        totalConnections: 0,\n        agentCount: 0,\n        memoryTypes: {},\n        averageImportance: 0,\n      }\n    }\n  }\n\n  /**\n   * 健康检查\n   */\n  async healthCheck(): Promise<{ status: string; details?: any }> {\n    try {\n      const stats = this.getMemoryStats()\n      return {\n        status: 'healthy',\n        details: stats,\n      }\n    } catch (error: any) {\n      return {\n        status: 'error',\n        details: error.message,\n      }\n    }\n  }\n\n  /**\n   * 导出记忆数据\n   */\n  async exportMemoryData(): Promise<any> {\n    try {\n      return crossMemoryNetwork.exportMemoryNetwork()\n    } catch (error) {\n      this.logger.error('导出记忆数据失败:', error)\n      return { memories: [], connections: {} }\n    }\n  }\n\n  /**\n   * 导入记忆数据\n   */\n  async importMemoryData(data: any): Promise<void> {\n    try {\n      crossMemoryNetwork.importMemoryNetwork(data)\n      this.logger.log('记忆数据导入成功')\n    } catch (error) {\n      this.logger.error('导入记忆数据失败:', error)\n      throw error\n    }\n  }\n}\n"],"version":3}