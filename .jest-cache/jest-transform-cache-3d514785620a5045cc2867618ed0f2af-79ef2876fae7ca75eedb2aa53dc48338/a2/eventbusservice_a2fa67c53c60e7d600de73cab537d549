9a31f65539b35e9b10763e0a496d9ad0
"use strict";
// 文件路径: libs/common/src/event-bus/event-bus.service.ts
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var EventBusService_1;
Object.defineProperty(exports, "__esModule", { value: true });
exports.EventBusService = void 0;
const common_1 = require("@nestjs/common");
const event_bus_module_1 = require("./event-bus.module");
let EventBusService = EventBusService_1 = class EventBusService {
    _client;
    logger = new common_1.Logger(EventBusService_1.name);
    // [核心] 注入我们刚刚在module里定义的“信号发射器”
    constructor(_client) {
        this._client = _client;
    }
    // [核心] 在模块初始化时，确保与 RabbitMQ 的连接已建立
    async onModuleInit() {
        try {
            await this.client.connect();
            this.logger.log('Successfully connected to the RabbitMQ event bus.');
        }
        catch (error) {
            this.logger.error('Failed to connect to the RabbitMQ event bus.', error);
        }
    }
    /**
     * @method publish
     * @description 向宇宙广播一个事件
     * @param eventName - 事件的“暗号”，例如 'PLAYER_ACTION_SUBMITTED'
     * @param data - 要广播的具体信息
     */
    publish(eventName, data) {
        this.logger.log(`Publishing event "${eventName}" to the event bus.`);
        // [核心] client.emit() 用于“发射后不管”的事件广播。
        // 它会将事件名作为路由键，将数据作为消息体，发送到 RabbitMQ。
        this.client.emit(eventName, data);
    }
};
exports.EventBusService = EventBusService;
exports.EventBusService = EventBusService = EventBusService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, common_1.Inject)(event_bus_module_1.NEXUS_EVENT_BUS)),
    __metadata("design:paramtypes", [Object])
], EventBusService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFxldmVudC1idXNcXGV2ZW50LWJ1cy5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7QUFBQSx1REFBdUQ7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFdkQsMkNBQThFO0FBRTlFLHlEQUFvRDtBQUc3QyxJQUFNLGVBQWUsdUJBQXJCLE1BQU0sZUFBZTtJQUk0QjtJQUhyQyxNQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsaUJBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUUxRCxnQ0FBZ0M7SUFDaEMsWUFBc0QsT0FBb0I7UUFBcEIsWUFBTyxHQUFQLE9BQU8sQ0FBYTtJQUFHLENBQUM7SUFFOUUsbUNBQW1DO0lBQ25DLEtBQUssQ0FBQyxZQUFZO1FBQ2hCLElBQUksQ0FBQztZQUNILE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQTtZQUMzQixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxtREFBbUQsQ0FBQyxDQUFBO1FBQ3RFLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsOENBQThDLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDMUUsQ0FBQztJQUNILENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILE9BQU8sQ0FBQyxTQUFpQixFQUFFLElBQVM7UUFDbEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMscUJBQXFCLFNBQVMscUJBQXFCLENBQUMsQ0FBQTtRQUNwRSxxQ0FBcUM7UUFDckMscUNBQXFDO1FBQ3JDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUNuQyxDQUFDO0NBQ0YsQ0FBQTtBQTVCWSwwQ0FBZTswQkFBZixlQUFlO0lBRDNCLElBQUEsbUJBQVUsR0FBRTtJQUtFLFdBQUEsSUFBQSxlQUFNLEVBQUMsa0NBQWUsQ0FBQyxDQUFBOztHQUp6QixlQUFlLENBNEIzQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXDE2NjYzXFxEZXNrdG9wXFx0dWhlZ1xccGFja2FnZXNcXGNvbW1vbi1iYWNrZW5kXFxzcmNcXGV2ZW50LWJ1c1xcZXZlbnQtYnVzLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8g5paH5Lu26Lev5b6EOiBsaWJzL2NvbW1vbi9zcmMvZXZlbnQtYnVzL2V2ZW50LWJ1cy5zZXJ2aWNlLnRzXG5cbmltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgTG9nZ2VyLCB0eXBlIE9uTW9kdWxlSW5pdCB9IGZyb20gJ0BuZXN0anMvY29tbW9uJ1xuaW1wb3J0IHR5cGUgeyBDbGllbnRQcm94eSB9IGZyb20gJ0BuZXN0anMvbWljcm9zZXJ2aWNlcydcbmltcG9ydCB7IE5FWFVTX0VWRU5UX0JVUyB9IGZyb20gJy4vZXZlbnQtYnVzLm1vZHVsZSdcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEV2ZW50QnVzU2VydmljZSBpbXBsZW1lbnRzIE9uTW9kdWxlSW5pdCB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihFdmVudEJ1c1NlcnZpY2UubmFtZSlcblxuICAvLyBb5qC45b+DXSDms6jlhaXmiJHku6zliJrliJrlnKhtb2R1bGXph4zlrprkuYnnmoTigJzkv6Hlj7flj5HlsITlmajigJ1cbiAgY29uc3RydWN0b3IoQEluamVjdChORVhVU19FVkVOVF9CVVMpIHByaXZhdGUgcmVhZG9ubHkgX2NsaWVudDogQ2xpZW50UHJveHkpIHt9XG5cbiAgLy8gW+aguOW/g10g5Zyo5qih5Z2X5Yid5aeL5YyW5pe277yM56Gu5L+d5LiOIFJhYmJpdE1RIOeahOi/nuaOpeW3suW7uueri1xuICBhc3luYyBvbk1vZHVsZUluaXQoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50LmNvbm5lY3QoKVxuICAgICAgdGhpcy5sb2dnZXIubG9nKCdTdWNjZXNzZnVsbHkgY29ubmVjdGVkIHRvIHRoZSBSYWJiaXRNUSBldmVudCBidXMuJylcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBjb25uZWN0IHRvIHRoZSBSYWJiaXRNUSBldmVudCBidXMuJywgZXJyb3IpXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgcHVibGlzaFxuICAgKiBAZGVzY3JpcHRpb24g5ZCR5a6H5a6Z5bm/5pKt5LiA5Liq5LqL5Lu2XG4gICAqIEBwYXJhbSBldmVudE5hbWUgLSDkuovku7bnmoTigJzmmpflj7figJ3vvIzkvovlpoIgJ1BMQVlFUl9BQ1RJT05fU1VCTUlUVEVEJ1xuICAgKiBAcGFyYW0gZGF0YSAtIOimgeW5v+aSreeahOWFt+S9k+S/oeaBr1xuICAgKi9cbiAgcHVibGlzaChldmVudE5hbWU6IHN0cmluZywgZGF0YTogYW55KSB7XG4gICAgdGhpcy5sb2dnZXIubG9nKGBQdWJsaXNoaW5nIGV2ZW50IFwiJHtldmVudE5hbWV9XCIgdG8gdGhlIGV2ZW50IGJ1cy5gKVxuICAgIC8vIFvmoLjlv4NdIGNsaWVudC5lbWl0KCkg55So5LqO4oCc5Y+R5bCE5ZCO5LiN566h4oCd55qE5LqL5Lu25bm/5pKt44CCXG4gICAgLy8g5a6D5Lya5bCG5LqL5Lu25ZCN5L2c5Li66Lev55Sx6ZSu77yM5bCG5pWw5o2u5L2c5Li65raI5oGv5L2T77yM5Y+R6YCB5YiwIFJhYmJpdE1R44CCXG4gICAgdGhpcy5jbGllbnQuZW1pdChldmVudE5hbWUsIGRhdGEpXG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==