4caa9cdc81f9bfcc16e126f13fb94e2c
"use strict";
// 文件路径: libs/common/src/event-bus/event-bus.module.ts (自包含最终版)
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.EventBusModule = exports.NEXUS_EVENT_BUS = void 0;
const common_1 = require("@nestjs/common");
const config_1 = require("@nestjs/config");
const microservices_1 = require("@nestjs/microservices");
const event_bus_service_1 = require("./event-bus.service");
exports.NEXUS_EVENT_BUS = 'NEXUS_EVENT_BUS';
let EventBusModule = class EventBusModule {
};
exports.EventBusModule = EventBusModule;
exports.EventBusModule = EventBusModule = __decorate([
    (0, common_1.Module)({
        imports: [
            // [核心] 在模块内部导入 ClientsModule，为本模块提供 ClientProxy 的创建能力
            microservices_1.ClientsModule.registerAsync([
                {
                    name: exports.NEXUS_EVENT_BUS,
                    imports: [config_1.ConfigModule],
                    useFactory: (configService) => ({
                        transport: microservices_1.Transport.RMQ,
                        options: {
                            urls: [configService.get('RABBITMQ_URL', 'amqp://localhost:5672')],
                            queue: 'nexus_gateway_queue',
                        },
                    }),
                    inject: [config_1.ConfigService],
                },
            ]),
        ],
        providers: [event_bus_service_1.EventBusService],
        // [核心] 将 EventBusService 导出，以便其他模块可以使用它
        exports: [event_bus_service_1.EventBusService],
    })
], EventBusModule);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFxldmVudC1idXNcXGV2ZW50LWJ1cy5tb2R1bGUudHMiLCJtYXBwaW5ncyI6IjtBQUFBLCtEQUErRDs7Ozs7Ozs7O0FBRS9ELDJDQUF1QztBQUN2QywyQ0FBNEQ7QUFDNUQseURBQWdFO0FBQ2hFLDJEQUFxRDtBQUV4QyxRQUFBLGVBQWUsR0FBRyxpQkFBaUIsQ0FBQTtBQXdCekMsSUFBTSxjQUFjLEdBQXBCLE1BQU0sY0FBYztDQUFHLENBQUE7QUFBakIsd0NBQWM7eUJBQWQsY0FBYztJQXRCMUIsSUFBQSxlQUFNLEVBQUM7UUFDTixPQUFPLEVBQUU7WUFDUCxzREFBc0Q7WUFDdEQsNkJBQWEsQ0FBQyxhQUFhLENBQUM7Z0JBQzFCO29CQUNFLElBQUksRUFBRSx1QkFBZTtvQkFDckIsT0FBTyxFQUFFLENBQUMscUJBQVksQ0FBQztvQkFDdkIsVUFBVSxFQUFFLENBQUMsYUFBNEIsRUFBRSxFQUFFLENBQUMsQ0FBQzt3QkFDN0MsU0FBUyxFQUFFLHlCQUFTLENBQUMsR0FBRzt3QkFDeEIsT0FBTyxFQUFFOzRCQUNQLElBQUksRUFBRSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQVMsY0FBYyxFQUFFLHVCQUF1QixDQUFDLENBQUM7NEJBQzFFLEtBQUssRUFBRSxxQkFBcUI7eUJBQzdCO3FCQUNGLENBQUM7b0JBQ0YsTUFBTSxFQUFFLENBQUMsc0JBQWEsQ0FBQztpQkFDeEI7YUFDRixDQUFDO1NBQ0g7UUFDRCxTQUFTLEVBQUUsQ0FBQyxtQ0FBZSxDQUFDO1FBQzVCLHdDQUF3QztRQUN4QyxPQUFPLEVBQUUsQ0FBQyxtQ0FBZSxDQUFDO0tBQzNCLENBQUM7R0FDVyxjQUFjLENBQUciLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFxldmVudC1idXNcXGV2ZW50LWJ1cy5tb2R1bGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8g5paH5Lu26Lev5b6EOiBsaWJzL2NvbW1vbi9zcmMvZXZlbnQtYnVzL2V2ZW50LWJ1cy5tb2R1bGUudHMgKOiHquWMheWQq+acgOe7iOeJiClcblxuaW1wb3J0IHsgTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nXG5pbXBvcnQgeyBDb25maWdNb2R1bGUsIENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZydcbmltcG9ydCB7IENsaWVudHNNb2R1bGUsIFRyYW5zcG9ydCB9IGZyb20gJ0BuZXN0anMvbWljcm9zZXJ2aWNlcydcbmltcG9ydCB7IEV2ZW50QnVzU2VydmljZSB9IGZyb20gJy4vZXZlbnQtYnVzLnNlcnZpY2UnXG5cbmV4cG9ydCBjb25zdCBORVhVU19FVkVOVF9CVVMgPSAnTkVYVVNfRVZFTlRfQlVTJ1xuXG5ATW9kdWxlKHtcbiAgaW1wb3J0czogW1xuICAgIC8vIFvmoLjlv4NdIOWcqOaooeWdl+WGhemDqOWvvOWFpSBDbGllbnRzTW9kdWxl77yM5Li65pys5qih5Z2X5o+Q5L6bIENsaWVudFByb3h5IOeahOWIm+W7uuiDveWKm1xuICAgIENsaWVudHNNb2R1bGUucmVnaXN0ZXJBc3luYyhbXG4gICAgICB7XG4gICAgICAgIG5hbWU6IE5FWFVTX0VWRU5UX0JVUyxcbiAgICAgICAgaW1wb3J0czogW0NvbmZpZ01vZHVsZV0sXG4gICAgICAgIHVzZUZhY3Rvcnk6IChjb25maWdTZXJ2aWNlOiBDb25maWdTZXJ2aWNlKSA9PiAoe1xuICAgICAgICAgIHRyYW5zcG9ydDogVHJhbnNwb3J0LlJNUSxcbiAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICB1cmxzOiBbY29uZmlnU2VydmljZS5nZXQ8c3RyaW5nPignUkFCQklUTVFfVVJMJywgJ2FtcXA6Ly9sb2NhbGhvc3Q6NTY3MicpXSxcbiAgICAgICAgICAgIHF1ZXVlOiAnbmV4dXNfZ2F0ZXdheV9xdWV1ZScsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICAgIGluamVjdDogW0NvbmZpZ1NlcnZpY2VdLFxuICAgICAgfSxcbiAgICBdKSxcbiAgXSxcbiAgcHJvdmlkZXJzOiBbRXZlbnRCdXNTZXJ2aWNlXSxcbiAgLy8gW+aguOW/g10g5bCGIEV2ZW50QnVzU2VydmljZSDlr7zlh7rvvIzku6Xkvr/lhbbku5bmqKHlnZflj6/ku6Xkvb/nlKjlroNcbiAgZXhwb3J0czogW0V2ZW50QnVzU2VydmljZV0sXG59KVxuZXhwb3J0IGNsYXNzIEV2ZW50QnVzTW9kdWxlIHt9XG4iXSwidmVyc2lvbiI6M30=