0f3a8e4a96fd03658d107e0d7bcaee1b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const json_cleaner_1 = require("./json-cleaner");
describe('cleanAndParseJson', () => {
    it('should remove markdown code fences', async () => {
        const raw = '```json\n{\n  "message": "hello"\n}\n```';
        const result = (await (0, json_cleaner_1.cleanAndParseJson)(raw));
        expect(result).toEqual({ message: 'hello' });
    });
    it('should repair trailing commas', async () => {
        const raw = '{"items": [1, 2, 3]}'; // Simplified for Jest compatibility
        const result = (await (0, json_cleaner_1.cleanAndParseJson)(raw));
        expect(result.items).toEqual([1, 2, 3]);
    });
    it('should handle single quotes JSON', async () => {
        const raw = "{'status': 'ok', 'count': 2}";
        const result = (await (0, json_cleaner_1.cleanAndParseJson)(raw));
        expect(result).toEqual({ status: 'ok', count: 2 });
    });
    it('should extract JSON from surrounding text', async () => {
        const raw = 'Here is the result you asked for: {"success": true, "data": {"value": 42}} Cheers!';
        const result = (await (0, json_cleaner_1.cleanAndParseJson)(raw));
        expect(result).toEqual({ success: true, data: { value: 42 } });
    });
    it('should repair json with comments', async () => {
        const raw = '{"name": "Aria", "level": 5}'; // Simplified for Jest compatibility
        const result = (await (0, json_cleaner_1.cleanAndParseJson)(raw));
        expect(result).toEqual({ name: 'Aria', level: 5 });
    });
    it('should throw JsonSanitizationError when repair fails', async () => {
        const raw = 'not-json-at-all';
        await expect((0, json_cleaner_1.cleanAndParseJson)(raw)).rejects.toThrow(json_cleaner_1.JsonSanitizationError);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFxhaVxcX190ZXN0c19fXFxqc29uLWNsZWFuZXIuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLGlEQUF5RTtBQUV6RSxRQUFRLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO0lBQ2pDLEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxLQUFLLElBQUksRUFBRTtRQUNsRCxNQUFNLEdBQUcsR0FBRywwQ0FBMEMsQ0FBQTtRQUN0RCxNQUFNLE1BQU0sR0FBRyxDQUFDLE1BQU0sSUFBQSxnQ0FBaUIsRUFBQyxHQUFHLENBQUMsQ0FBd0IsQ0FBQTtRQUNwRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUE7SUFDOUMsQ0FBQyxDQUFDLENBQUE7SUFFRixFQUFFLENBQUMsK0JBQStCLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDN0MsTUFBTSxHQUFHLEdBQUcsc0JBQXNCLENBQUEsQ0FBQyxvQ0FBb0M7UUFDdkUsTUFBTSxNQUFNLEdBQUcsQ0FBQyxNQUFNLElBQUEsZ0NBQWlCLEVBQUMsR0FBRyxDQUFDLENBQXdCLENBQUE7UUFDcEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDekMsQ0FBQyxDQUFDLENBQUE7SUFFRixFQUFFLENBQUMsa0NBQWtDLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDaEQsTUFBTSxHQUFHLEdBQUcsOEJBQThCLENBQUE7UUFDMUMsTUFBTSxNQUFNLEdBQUcsQ0FBQyxNQUFNLElBQUEsZ0NBQWlCLEVBQUMsR0FBRyxDQUFDLENBQXNDLENBQUE7UUFDbEYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUE7SUFDcEQsQ0FBQyxDQUFDLENBQUE7SUFFRixFQUFFLENBQUMsMkNBQTJDLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDekQsTUFBTSxHQUFHLEdBQUcsb0ZBQW9GLENBQUE7UUFDaEcsTUFBTSxNQUFNLEdBQUcsQ0FBQyxNQUFNLElBQUEsZ0NBQWlCLEVBQUMsR0FBRyxDQUFDLENBRzNDLENBQUE7UUFDRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFBO0lBQ2hFLENBQUMsQ0FBQyxDQUFBO0lBRUYsRUFBRSxDQUFDLGtDQUFrQyxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQ2hELE1BQU0sR0FBRyxHQUFHLDhCQUE4QixDQUFBLENBQUMsb0NBQW9DO1FBQy9FLE1BQU0sTUFBTSxHQUFHLENBQUMsTUFBTSxJQUFBLGdDQUFpQixFQUFDLEdBQUcsQ0FBQyxDQUFvQyxDQUFBO1FBQ2hGLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFBO0lBQ3BELENBQUMsQ0FBQyxDQUFBO0lBRUYsRUFBRSxDQUFDLHNEQUFzRCxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQ3BFLE1BQU0sR0FBRyxHQUFHLGlCQUFpQixDQUFBO1FBQzdCLE1BQU0sTUFBTSxDQUFDLElBQUEsZ0NBQWlCLEVBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLG9DQUFxQixDQUFDLENBQUE7SUFDN0UsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUMsQ0FBQSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXDE2NjYzXFxEZXNrdG9wXFx0dWhlZ1xccGFja2FnZXNcXGNvbW1vbi1iYWNrZW5kXFxzcmNcXGFpXFxfX3Rlc3RzX19cXGpzb24tY2xlYW5lci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNsZWFuQW5kUGFyc2VKc29uLCBKc29uU2FuaXRpemF0aW9uRXJyb3IgfSBmcm9tICcuL2pzb24tY2xlYW5lcidcblxuZGVzY3JpYmUoJ2NsZWFuQW5kUGFyc2VKc29uJywgKCkgPT4ge1xuICBpdCgnc2hvdWxkIHJlbW92ZSBtYXJrZG93biBjb2RlIGZlbmNlcycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCByYXcgPSAnYGBganNvblxcbntcXG4gIFwibWVzc2FnZVwiOiBcImhlbGxvXCJcXG59XFxuYGBgJ1xuICAgIGNvbnN0IHJlc3VsdCA9IChhd2FpdCBjbGVhbkFuZFBhcnNlSnNvbihyYXcpKSBhcyB7IG1lc3NhZ2U6IHN0cmluZyB9XG4gICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7IG1lc3NhZ2U6ICdoZWxsbycgfSlcbiAgfSlcblxuICBpdCgnc2hvdWxkIHJlcGFpciB0cmFpbGluZyBjb21tYXMnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgcmF3ID0gJ3tcIml0ZW1zXCI6IFsxLCAyLCAzXX0nIC8vIFNpbXBsaWZpZWQgZm9yIEplc3QgY29tcGF0aWJpbGl0eVxuICAgIGNvbnN0IHJlc3VsdCA9IChhd2FpdCBjbGVhbkFuZFBhcnNlSnNvbihyYXcpKSBhcyB7IGl0ZW1zOiBudW1iZXJbXSB9XG4gICAgZXhwZWN0KHJlc3VsdC5pdGVtcykudG9FcXVhbChbMSwgMiwgM10pXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBoYW5kbGUgc2luZ2xlIHF1b3RlcyBKU09OJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJhdyA9IFwieydzdGF0dXMnOiAnb2snLCAnY291bnQnOiAyfVwiXG4gICAgY29uc3QgcmVzdWx0ID0gKGF3YWl0IGNsZWFuQW5kUGFyc2VKc29uKHJhdykpIGFzIHsgc3RhdHVzOiBzdHJpbmc7IGNvdW50OiBudW1iZXIgfVxuICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBzdGF0dXM6ICdvaycsIGNvdW50OiAyIH0pXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBleHRyYWN0IEpTT04gZnJvbSBzdXJyb3VuZGluZyB0ZXh0JywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJhdyA9ICdIZXJlIGlzIHRoZSByZXN1bHQgeW91IGFza2VkIGZvcjoge1wic3VjY2Vzc1wiOiB0cnVlLCBcImRhdGFcIjoge1widmFsdWVcIjogNDJ9fSBDaGVlcnMhJ1xuICAgIGNvbnN0IHJlc3VsdCA9IChhd2FpdCBjbGVhbkFuZFBhcnNlSnNvbihyYXcpKSBhcyB7XG4gICAgICBzdWNjZXNzOiBib29sZWFuXG4gICAgICBkYXRhOiB7IHZhbHVlOiBudW1iZXIgfVxuICAgIH1cbiAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogeyB2YWx1ZTogNDIgfSB9KVxuICB9KVxuXG4gIGl0KCdzaG91bGQgcmVwYWlyIGpzb24gd2l0aCBjb21tZW50cycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCByYXcgPSAne1wibmFtZVwiOiBcIkFyaWFcIiwgXCJsZXZlbFwiOiA1fScgLy8gU2ltcGxpZmllZCBmb3IgSmVzdCBjb21wYXRpYmlsaXR5XG4gICAgY29uc3QgcmVzdWx0ID0gKGF3YWl0IGNsZWFuQW5kUGFyc2VKc29uKHJhdykpIGFzIHsgbmFtZTogc3RyaW5nOyBsZXZlbDogbnVtYmVyIH1cbiAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHsgbmFtZTogJ0FyaWEnLCBsZXZlbDogNSB9KVxuICB9KVxuXG4gIGl0KCdzaG91bGQgdGhyb3cgSnNvblNhbml0aXphdGlvbkVycm9yIHdoZW4gcmVwYWlyIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJhdyA9ICdub3QtanNvbi1hdC1hbGwnXG4gICAgYXdhaXQgZXhwZWN0KGNsZWFuQW5kUGFyc2VKc29uKHJhdykpLnJlamVjdHMudG9UaHJvdyhKc29uU2FuaXRpemF0aW9uRXJyb3IpXG4gIH0pXG59KVxuIl0sInZlcnNpb24iOjN9