41c3e1f192e6b3aa013fa7e816ef8144
"use strict";
/**
 * Jest 全局测试设置
 * 配置测试环境的快速失败机制和最佳实践
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
// Mock ESM modules that cause issues in Jest
globals_1.jest.mock('langfuse', () => ({
    Langfuse: globals_1.jest.fn().mockImplementation(() => ({
        trace: globals_1.jest.fn(),
        generation: globals_1.jest.fn(),
        span: globals_1.jest.fn(),
        score: globals_1.jest.fn(),
        shutdownAsync: globals_1.jest.fn().mockResolvedValue(undefined),
    })),
}));
// 设置更严格的超时
globals_1.jest.setTimeout(30000);
// 全局错误处理 - 任何未处理的错误都会导致测试失败
process.on('unhandledRejection', (reason, promise) => {
    console.error('Unhandled Rejection at:', promise, 'reason:', reason);
    // 在测试环境中，让未处理的promise rejection导致测试失败
    throw new Error(`Unhandled promise rejection: ${reason}`);
});
process.on('uncaughtException', (error) => {
    console.error('Uncaught Exception:', error);
    // 在测试环境中，让未处理的异常导致测试失败
    throw error;
});
// 配置控制台警告 - 将console.error转换为测试失败
const originalConsoleError = console.error;
console.error = (...args) => {
    originalConsoleError(...args);
    // 在CI环境中，将console.error转换为测试失败
    if (process.env.CI) {
        throw new Error(`Console error detected: ${args.join(' ')}`);
    }
};
// Mock 全局对象以防止意外的网络调用
global.fetch = globals_1.jest.fn(() => Promise.reject(new Error('fetch should be mocked in tests')));
global.Request = globals_1.jest.fn();
global.Response = globals_1.jest.fn();
// 设置环境变量用于测试
process.env.NODE_ENV = 'test';
process.env.JWT_SECRET = 'test-jwt-secret-for-testing-only';
process.env.DATABASE_URL = 'postgresql://test:test@localhost:5432/test_db';
// 补齐缺失的环境变量
process.env.ENCRYPTION_KEY = 'test-encryption-key-32-characters-long';
process.env.ENCRYPTION_SALT = 'test-encryption-salt-16-chars';
process.env.ENCRYPTION_USE_SALT = 'false';
process.env.ENCRYPTION_ALGORITHM = 'aes-256-gcm';
process.env.CLERK_SECRET_KEY = 'test-clerk-secret-key';
process.env.CLERK_PUBLISHABLE_KEY = 'test-clerk-publishable-key';
process.env.CLERK_WEBHOOK_SECRET_KEY = 'test-clerk-webhook-secret';
process.env.RABBITMQ_URL = 'amqp://localhost:5672';
process.env.REDIS_URL = 'redis://localhost:6379';
process.env.SENTRY_DSN = 'https://test@test.ingest.sentry.io/test';
process.env.SENTRY_ENVIRONMENT = 'test';
process.env.SENTRY_TRACES_SAMPLE_RATE = '0.1';
process.env.QDRANT_URL = 'http://localhost:6333';
process.env.QDRANT_API_KEY = 'test-qdrant-api-key';
process.env.FALLBACK_API_KEY = 'test-fallback-api-key';
process.env.FALLBACK_MODEL_ID = 'deepseek-chat';
process.env.FALLBACK_BASE_URL = 'https://api.deepseek.com';
process.env.DB_CONNECTION_LIMIT = '20';
process.env.DB_POOL_TIMEOUT = '20';
process.env.DB_IDLE_TIMEOUT = '300';
process.env.JWT_EXPIRATION_SECONDS = '3600';
process.env.BACKEND_GATEWAY_PORT = '3000';
process.env.CREATION_AGENT_HTTP_PORT = '8080';
process.env.LOGIC_AGENT_HTTP_PORT = '8081';
process.env.NARRATIVE_AGENT_HTTP_PORT = '8082';
// 清理函数 - 在每个测试后运行
afterEach(() => {
    // 重置所有mock
    globals_1.jest.clearAllMocks();
    // 清理任何可能的文件系统更改（如果适用）
    // 注意：实际的文件系统操作应该在集成测试中进行
    // 检查是否有未处理的异步操作
    if (globals_1.jest.getTimerCount() > 0) {
        console.warn(`Warning: ${globals_1.jest.getTimerCount()} timers still active after test`);
    }
});
afterAll(async () => {
    // 清理测试资源
    globals_1.jest.clearAllMocks();
}, 5000);
// 自定义匹配器
expect.extend({
    toBeValidDate(received) {
        const pass = received instanceof Date && !isNaN(received.getTime());
        if (pass) {
            return {
                message: () => `expected ${received} not to be a valid date`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be a valid date`,
                pass: false,
            };
        }
    },
    toBeValidUUID(received) {
        const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
        const pass = typeof received === 'string' && uuidRegex.test(received);
        if (pass) {
            return {
                message: () => `expected ${received} not to be a valid UUID`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be a valid UUID`,
                pass: false,
            };
        }
    },
});
// 内存使用监控
if (process.env.CI) {
    const initialMemory = process.memoryUsage();
    const memoryThreshold = 500 * 1024 * 1024; // 500MB
    afterEach(() => {
        const currentMemory = process.memoryUsage();
        const memoryIncrease = currentMemory.heapUsed - initialMemory.heapUsed;
        if (memoryIncrease > memoryThreshold) {
            console.warn(`Warning: Memory usage increased by ${Math.round(memoryIncrease / 1024 / 1024)}MB`);
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VXNlcnNcXDE2NjYzXFxEZXNrdG9wXFx0dWhlZ1xcdGVzdHNcXHNldHVwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSmVzdCDlhajlsYDmtYvor5Xorr7nva5cbiAqIOmFjee9rua1i+ivleeOr+Wig+eahOW/q+mAn+Wksei0peacuuWItuWSjOacgOS9s+Wunui3tVxuICovXG5cbmltcG9ydCB7IGplc3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJ1xuXG4vLyDorr7nva7mm7TkuKXmoLznmoTotoXml7Zcbmplc3Quc2V0VGltZW91dCgzMDAwMClcblxuLy8g5YWo5bGA6ZSZ6K+v5aSE55CGIC0g5Lu75L2V5pyq5aSE55CG55qE6ZSZ6K+v6YO95Lya5a+86Ie05rWL6K+V5aSx6LSlXG5wcm9jZXNzLm9uKCd1bmhhbmRsZWRSZWplY3Rpb24nLCAocmVhc29uLCBwcm9taXNlKSA9PiB7XG4gIGNvbnNvbGUuZXJyb3IoJ1VuaGFuZGxlZCBSZWplY3Rpb24gYXQ6JywgcHJvbWlzZSwgJ3JlYXNvbjonLCByZWFzb24pXG4gIC8vIOWcqOa1i+ivleeOr+Wig+S4re+8jOiuqeacquWkhOeQhueahHByb21pc2UgcmVqZWN0aW9u5a+86Ie05rWL6K+V5aSx6LSlXG4gIHRocm93IG5ldyBFcnJvcihgVW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uOiAke3JlYXNvbn1gKVxufSlcblxucHJvY2Vzcy5vbigndW5jYXVnaHRFeGNlcHRpb24nLCAoZXJyb3IpID0+IHtcbiAgY29uc29sZS5lcnJvcignVW5jYXVnaHQgRXhjZXB0aW9uOicsIGVycm9yKVxuICAvLyDlnKjmtYvor5Xnjq/looPkuK3vvIzorqnmnKrlpITnkIbnmoTlvILluLjlr7zoh7TmtYvor5XlpLHotKVcbiAgdGhyb3cgZXJyb3Jcbn0pXG5cbi8vIOmFjee9ruaOp+WItuWPsOitpuWRiiAtIOWwhmNvbnNvbGUuZXJyb3LovazmjaLkuLrmtYvor5XlpLHotKVcbmNvbnN0IG9yaWdpbmFsQ29uc29sZUVycm9yID0gY29uc29sZS5lcnJvclxuY29uc29sZS5lcnJvciA9ICguLi5hcmdzOiBhbnlbXSkgPT4ge1xuICBvcmlnaW5hbENvbnNvbGVFcnJvciguLi5hcmdzKVxuICAvLyDlnKhDSeeOr+Wig+S4re+8jOWwhmNvbnNvbGUuZXJyb3LovazmjaLkuLrmtYvor5XlpLHotKVcbiAgaWYgKHByb2Nlc3MuZW52LkNJKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDb25zb2xlIGVycm9yIGRldGVjdGVkOiAke2FyZ3Muam9pbignICcpfWApXG4gIH1cbn1cblxuLy8gTW9jayDlhajlsYDlr7nosaHku6XpmLLmraLmhI/lpJbnmoTnvZHnu5zosIPnlKhcbmdsb2JhbC5mZXRjaCA9IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdmZXRjaCBzaG91bGQgYmUgbW9ja2VkIGluIHRlc3RzJykpKVxuXG5nbG9iYWwuUmVxdWVzdCA9IGplc3QuZm4oKVxuZ2xvYmFsLlJlc3BvbnNlID0gamVzdC5mbigpXG5cbi8vIE1vY2sgRVNNIG1vZHVsZXMgdGhhdCBjYXVzZSBpc3N1ZXMgaW4gSmVzdFxuamVzdC5tb2NrKCdsYW5nZnVzZScsICgpID0+ICh7XG4gIExhbmdmdXNlOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgdHJhY2U6IGplc3QuZm4oKSxcbiAgICBnZW5lcmF0aW9uOiBqZXN0LmZuKCksXG4gICAgc3BhbjogamVzdC5mbigpLFxuICAgIHNjb3JlOiBqZXN0LmZuKCksXG4gICAgc2h1dGRvd25Bc3luYzogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gIH0pKSxcbn0pKVxuXG4vLyDorr7nva7njq/looPlj5jph4/nlKjkuo7mtYvor5VcbnByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ3Rlc3QnXG5wcm9jZXNzLmVudi5KV1RfU0VDUkVUID0gJ3Rlc3Qtand0LXNlY3JldC1mb3ItdGVzdGluZy1vbmx5J1xucHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMID0gJ3Bvc3RncmVzcWw6Ly90ZXN0OnRlc3RAbG9jYWxob3N0OjU0MzIvdGVzdF9kYidcblxuLy8g6KGl6b2Q57y65aSx55qE546v5aKD5Y+Y6YePXG5wcm9jZXNzLmVudi5FTkNSWVBUSU9OX0tFWSA9ICd0ZXN0LWVuY3J5cHRpb24ta2V5LTMyLWNoYXJhY3RlcnMtbG9uZydcbnByb2Nlc3MuZW52LkVOQ1JZUFRJT05fU0FMVCA9ICd0ZXN0LWVuY3J5cHRpb24tc2FsdC0xNi1jaGFycydcbnByb2Nlc3MuZW52LkVOQ1JZUFRJT05fVVNFX1NBTFQgPSAnZmFsc2UnXG5wcm9jZXNzLmVudi5FTkNSWVBUSU9OX0FMR09SSVRITSA9ICdhZXMtMjU2LWdjbSdcbnByb2Nlc3MuZW52LkNMRVJLX1NFQ1JFVF9LRVkgPSAndGVzdC1jbGVyay1zZWNyZXQta2V5J1xucHJvY2Vzcy5lbnYuQ0xFUktfUFVCTElTSEFCTEVfS0VZID0gJ3Rlc3QtY2xlcmstcHVibGlzaGFibGUta2V5J1xucHJvY2Vzcy5lbnYuQ0xFUktfV0VCSE9PS19TRUNSRVRfS0VZID0gJ3Rlc3QtY2xlcmstd2ViaG9vay1zZWNyZXQnXG5wcm9jZXNzLmVudi5SQUJCSVRNUV9VUkwgPSAnYW1xcDovL2xvY2FsaG9zdDo1NjcyJ1xucHJvY2Vzcy5lbnYuUkVESVNfVVJMID0gJ3JlZGlzOi8vbG9jYWxob3N0OjYzNzknXG5wcm9jZXNzLmVudi5TRU5UUllfRFNOID0gJ2h0dHBzOi8vdGVzdEB0ZXN0LmluZ2VzdC5zZW50cnkuaW8vdGVzdCdcbnByb2Nlc3MuZW52LlNFTlRSWV9FTlZJUk9OTUVOVCA9ICd0ZXN0J1xucHJvY2Vzcy5lbnYuU0VOVFJZX1RSQUNFU19TQU1QTEVfUkFURSA9ICcwLjEnXG5wcm9jZXNzLmVudi5RRFJBTlRfVVJMID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6NjMzMydcbnByb2Nlc3MuZW52LlFEUkFOVF9BUElfS0VZID0gJ3Rlc3QtcWRyYW50LWFwaS1rZXknXG5wcm9jZXNzLmVudi5GQUxMQkFDS19BUElfS0VZID0gJ3Rlc3QtZmFsbGJhY2stYXBpLWtleSdcbnByb2Nlc3MuZW52LkZBTExCQUNLX01PREVMX0lEID0gJ2RlZXBzZWVrLWNoYXQnXG5wcm9jZXNzLmVudi5GQUxMQkFDS19CQVNFX1VSTCA9ICdodHRwczovL2FwaS5kZWVwc2Vlay5jb20nXG5wcm9jZXNzLmVudi5EQl9DT05ORUNUSU9OX0xJTUlUID0gJzIwJ1xucHJvY2Vzcy5lbnYuREJfUE9PTF9USU1FT1VUID0gJzIwJ1xucHJvY2Vzcy5lbnYuREJfSURMRV9USU1FT1VUID0gJzMwMCdcbnByb2Nlc3MuZW52LkpXVF9FWFBJUkFUSU9OX1NFQ09ORFMgPSAnMzYwMCdcbnByb2Nlc3MuZW52LkJBQ0tFTkRfR0FURVdBWV9QT1JUID0gJzMwMDAnXG5wcm9jZXNzLmVudi5DUkVBVElPTl9BR0VOVF9IVFRQX1BPUlQgPSAnODA4MCdcbnByb2Nlc3MuZW52LkxPR0lDX0FHRU5UX0hUVFBfUE9SVCA9ICc4MDgxJ1xucHJvY2Vzcy5lbnYuTkFSUkFUSVZFX0FHRU5UX0hUVFBfUE9SVCA9ICc4MDgyJ1xuXG4vLyDmuIXnkIblh73mlbAgLSDlnKjmr4/kuKrmtYvor5XlkI7ov5DooYxcbmFmdGVyRWFjaCgoKSA9PiB7XG4gIC8vIOmHjee9ruaJgOaciW1vY2tcbiAgamVzdC5jbGVhckFsbE1vY2tzKClcblxuICAvLyDmuIXnkIbku7vkvZXlj6/og73nmoTmlofku7bns7vnu5/mm7TmlLnvvIjlpoLmnpzpgILnlKjvvIlcbiAgLy8g5rOo5oSP77ya5a6e6ZmF55qE5paH5Lu257O757uf5pON5L2c5bqU6K+l5Zyo6ZuG5oiQ5rWL6K+V5Lit6L+b6KGMXG5cbiAgLy8g5qOA5p+l5piv5ZCm5pyJ5pyq5aSE55CG55qE5byC5q2l5pON5L2cXG4gIGlmIChqZXN0LmdldFRpbWVyQ291bnQoKSA+IDApIHtcbiAgICBjb25zb2xlLndhcm4oYFdhcm5pbmc6ICR7amVzdC5nZXRUaW1lckNvdW50KCl9IHRpbWVycyBzdGlsbCBhY3RpdmUgYWZ0ZXIgdGVzdGApXG4gIH1cbn0pXG5cbmFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgLy8g5riF55CG5rWL6K+V6LWE5rqQXG4gIGplc3QuY2xlYXJBbGxNb2NrcygpXG59LCA1MDAwKVxuXG4vLyDoh6rlrprkuYnljLnphY3lmahcbmV4cGVjdC5leHRlbmQoe1xuICB0b0JlVmFsaWREYXRlKHJlY2VpdmVkOiBhbnkpIHtcbiAgICBjb25zdCBwYXNzID0gcmVjZWl2ZWQgaW5zdGFuY2VvZiBEYXRlICYmICFpc05hTihyZWNlaXZlZC5nZXRUaW1lKCkpXG4gICAgaWYgKHBhc3MpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBleHBlY3RlZCAke3JlY2VpdmVkfSBub3QgdG8gYmUgYSB2YWxpZCBkYXRlYCxcbiAgICAgICAgcGFzczogdHJ1ZSxcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7cmVjZWl2ZWR9IHRvIGJlIGEgdmFsaWQgZGF0ZWAsXG4gICAgICAgIHBhc3M6IGZhbHNlLFxuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICB0b0JlVmFsaWRVVUlEKHJlY2VpdmVkOiBhbnkpIHtcbiAgICBjb25zdCB1dWlkUmVnZXggPSAvXlswLTlhLWZdezh9LVswLTlhLWZdezR9LVsxLTVdWzAtOWEtZl17M30tWzg5YWJdWzAtOWEtZl17M30tWzAtOWEtZl17MTJ9JC9pXG4gICAgY29uc3QgcGFzcyA9IHR5cGVvZiByZWNlaXZlZCA9PT0gJ3N0cmluZycgJiYgdXVpZFJlZ2V4LnRlc3QocmVjZWl2ZWQpXG4gICAgaWYgKHBhc3MpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBleHBlY3RlZCAke3JlY2VpdmVkfSBub3QgdG8gYmUgYSB2YWxpZCBVVUlEYCxcbiAgICAgICAgcGFzczogdHJ1ZSxcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7cmVjZWl2ZWR9IHRvIGJlIGEgdmFsaWQgVVVJRGAsXG4gICAgICAgIHBhc3M6IGZhbHNlLFxuICAgICAgfVxuICAgIH1cbiAgfSxcbn0pXG5cbi8vIOWvvOWHuuexu+Wei+S7peS+v+WcqOa1i+ivleS4reS9v+eUqFxuZGVjbGFyZSBnbG9iYWwge1xuICBuYW1lc3BhY2UgamVzdCB7XG4gICAgaW50ZXJmYWNlIE1hdGNoZXJzPFI+IHtcbiAgICAgIHRvQmVWYWxpZERhdGUoKTogUlxuICAgICAgdG9CZVZhbGlkVVVJRCgpOiBSXG4gICAgfVxuICB9XG59XG5cbi8vIOWGheWtmOS9v+eUqOebkeaOp1xuaWYgKHByb2Nlc3MuZW52LkNJKSB7XG4gIGNvbnN0IGluaXRpYWxNZW1vcnkgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKClcbiAgY29uc3QgbWVtb3J5VGhyZXNob2xkID0gNTAwICogMTAyNCAqIDEwMjQgLy8gNTAwTUJcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGNvbnN0IGN1cnJlbnRNZW1vcnkgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKClcbiAgICBjb25zdCBtZW1vcnlJbmNyZWFzZSA9IGN1cnJlbnRNZW1vcnkuaGVhcFVzZWQgLSBpbml0aWFsTWVtb3J5LmhlYXBVc2VkXG5cbiAgICBpZiAobWVtb3J5SW5jcmVhc2UgPiBtZW1vcnlUaHJlc2hvbGQpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgYFdhcm5pbmc6IE1lbW9yeSB1c2FnZSBpbmNyZWFzZWQgYnkgJHtNYXRoLnJvdW5kKG1lbW9yeUluY3JlYXNlIC8gMTAyNCAvIDEwMjQpfU1CYFxuICAgICAgKVxuICAgIH1cbiAgfSlcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==