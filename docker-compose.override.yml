# docker-compose.override.yml (行业最佳实践最终版)
version: '3.8'

services:
  x-develop: &develop
    build:
      context: .
      dockerfile: Dockerfile
      target: dev
    volumes:
      - ./apps:/app/apps
      - ./packages:/app/packages
      - ./package.json:/app/package.json
      - ./pnpm-workspace.yaml:/app/pnpm-workspace.yaml
      - ./tsconfig.json:/app/tsconfig.json
      - ./turbo.json:/app/turbo.json
    environment:
      - NODE_ENV=development

  backend-gateway:
    <<: *develop
    command: pnpm --filter=@tuheg/backend-gateway dev
    ports:
      - "3000:3000"

  creation-agent:
    <<: *develop
    command: pnpm --filter=@tuheg/creation-agent dev

  logic-agent:
    <<: *develop
    command: pnpm --filter=@tuheg/logic-agent dev

  narrative-agent:
    <<: *develop
    command: pnpm --filter=@tuheg/narrative-agent dev

  frontend:
    <<: *develop
    command: pnpm --filter=@tuheg/frontend dev
    ports:
      - "5174:5173"
