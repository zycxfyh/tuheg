<!-- 
文件路径: apps/frontend/src/views/NexusHubView.with-query.vue.example
这是一个示例文件，展示如何使用 TanStack Query 替换原有的手动数据获取
在实际使用时，可以逐步迁移到这种模式
-->

<template>
  <div class="page active">
    <div class="top-right-actions">
      <UserButton afterSignOutUrl="/" />
      <span @click="settingsStore.showAiSettingsModal" class="api-settings-icon" title="AI指挥中心">
        ⚙️
      </span>
    </div>

    <div class="center-content" style="justify-content: flex-start; padding-top: 2rem;">
      <h2>观测者中枢</h2>
      <p>这里是您在每次旅程之间的永恒基地与强化中心。</p>
      <div class="nexus-main-layout">
        <div class="nexus-panel">
          <h3>新的开始</h3>
          <p>开启一次全新的化身，探索未知的世界。</p>
          <router-link to="/creation" class="button primary">开启一次新的化身</router-link>
        </div>
        <div class="nexus-panel">
          <h3>读取化身档案</h3>
          <p>从之前的决策点继续您的旅程。</p>
          
          <!-- [核心改造] 使用 TanStack Query -->
          <SaveList
            :is-loading="gamesQuery.isLoading.value"
            :game-list="gamesQuery.data.value || []"
            @load-game="loadGame"
            @delete-game="deleteGameMutation.mutate"
          />
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { useRouter } from 'vue-router';
import { UserButton } from '@clerk/vue';
import { useSettingsStore } from '@/stores/settings.store';
import { useGameList, useDeleteGame } from '@/composables/useGameQuery';
import SaveList from '@/components/nexus/SaveList.vue';

const settingsStore = useSettingsStore();
const router = useRouter();

// [核心改造] 使用 TanStack Query hooks
const gamesQuery = useGameList();
const deleteGameMutation = useDeleteGame();

function loadGame(gameId) {
  router.push(`/game/${gameId}`);
}

// [说明] deleteGame 现在由 useDeleteGame mutation 处理
// 它会自动刷新列表和显示提示
</script>

