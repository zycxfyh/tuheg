{"file":"C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\config\\env-loader.ts","mappings":"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","names":[],"sources":["C:\\Users\\16663\\Desktop\\tuheg\\packages\\common-backend\\src\\config\\env-loader.ts"],"sourcesContent":["// 文件路径: packages/common-backend/src/config/env-loader.ts\n// 核心理念: 支持环境变量扩展和多环境配置\n\nimport { existsSync } from 'node:fs'\nimport { resolve } from 'node:path'\nimport { config } from 'dotenv'\nimport { expand } from 'dotenv-expand'\n\n/**\n * @interface EnvLoaderOptions\n * @description 环境加载器选项\n */\nexport interface EnvLoaderOptions {\n  /** 环境名称 */\n  env?: string\n  /** 配置目录 */\n  configDir?: string\n  /** 是否覆盖已有变量 */\n  override?: boolean\n  /** 是否静默失败 */\n  silent?: boolean\n}\n\n/**\n * @class EnvLoader\n * @description 环境变量加载器\n * 支持环境变量扩展和多环境配置\n */\n// biome-ignore lint/complexity/noStaticOnlyClass: 这个类包含了环境变量处理的静态方法，适合作为工具类\nexport class EnvLoader {\n  /**\n   * @method load\n   * @description 加载环境变量\n   *\n   * @example\n   * ```typescript\n   * // 加载 .env 文件\n   * EnvLoader.load();\n   *\n   * // 加载特定环境的配置\n   * EnvLoader.load({ env: 'production' });\n   * ```\n   */\n  public static load(options: EnvLoaderOptions = {}): void {\n    const {\n      env = process.env.NODE_ENV || 'development',\n      configDir = process.cwd(),\n      override = false,\n      silent = false,\n    } = options\n\n    // 加载顺序：\n    // 1. .env (基础配置)\n    // 2. .env.local (本地覆盖，不提交到 Git)\n    // 3. .env.{env} (环境特定配置，如 .env.production)\n    // 4. .env.{env}.local (环境特定的本地覆盖)\n\n    const envFiles = ['.env', '.env.local', `.env.${env}`, `.env.${env}.local`]\n\n    for (const envFile of envFiles) {\n      const envPath = resolve(configDir, envFile)\n\n      if (existsSync(envPath)) {\n        try {\n          const result = config({\n            path: envPath,\n            override,\n          })\n\n          if (result.error && !silent) {\n            console.warn(`Failed to load ${envFile}:`, result.error.message)\n          } else if (result.parsed) {\n            // 扩展环境变量（支持 ${VAR} 引用）\n            expand(result)\n            console.log(`✓ Loaded ${envFile}`)\n          }\n        } catch (error) {\n          if (!silent) {\n            console.warn(`Error loading ${envFile}:`, error)\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * @method loadForApp\n   * @description 为特定应用加载环境变量\n   *\n   * @example\n   * ```typescript\n   * // 为 backend-gateway 加载配置\n   * EnvLoader.loadForApp('backend-gateway');\n   * ```\n   */\n  public static loadForApp(appName: string, options: EnvLoaderOptions = {}): void {\n    const { env = process.env.NODE_ENV || 'development', configDir = process.cwd() } = options\n\n    // 应用特定的环境文件\n    const appEnvFiles = [\n      `.env.${appName}`,\n      `.env.${appName}.local`,\n      `.env.${appName}.${env}`,\n      `.env.${appName}.${env}.local`,\n    ]\n\n    for (const envFile of appEnvFiles) {\n      const envPath = resolve(configDir, envFile)\n\n      if (existsSync(envPath)) {\n        try {\n          const result = config({\n            path: envPath,\n            override: true, // 应用特定配置覆盖全局配置\n          })\n\n          if (result.parsed) {\n            expand(result)\n            console.log(`✓ Loaded ${envFile} for ${appName}`)\n          }\n        } catch (error) {\n          console.warn(`Error loading ${envFile}:`, error)\n        }\n      }\n    }\n  }\n}\n"],"version":3}