8266e96fa3f5371884bc61c273f506f4
"use strict";
// 文件路径: libs/common/src/types/state-change-directive.dto.ts
Object.defineProperty(exports, "__esModule", { value: true });
exports.directiveSetSchema = exports.stateChangeDirectiveSchema = void 0;
const zod_1 = require("zod");
// --- 原子操作定义 ---
// 定义了可以对数值进行的原子操作
const numericOperationSchema = zod_1.z.object({
    op: zod_1.z.enum(['set', 'increment', 'decrement']),
    value: zod_1.z.number(),
});
// 定义了可以对字符串进行的操作
const stringOperationSchema = zod_1.z.object({
    op: zod_1.z.enum(['set', 'append', 'prepend']),
    value: zod_1.z.string(),
});
// --- 实体更新指令 ---
// 定义了针对一个角色的具体更新操作
const characterUpdateSchema = zod_1.z.object({
    hp: numericOperationSchema.optional(),
    mp: numericOperationSchema.optional(),
    status: stringOperationSchema.optional(),
});
// --- 状态变更指令核心定义 ---
/**
 * 定义了一条单独的、完整的状态变更指令。
 * 这是我们系统中“确定性操作”的最小单元。
 */
exports.stateChangeDirectiveSchema = zod_1.z.object({
    op: zod_1.z.enum(['update_character', 'update_world_book']),
    targetId: zod_1.z.string(),
    payload: zod_1.z.union([characterUpdateSchema, zod_1.z.record(zod_1.z.string(), zod_1.z.any())]),
});
/**
 * 定义了一个指令集，它是一个指令数组。
 * “逻辑AI”的最终输出，就是一个符合此 Schema 的JSON对象。
 */
exports.directiveSetSchema = zod_1.z.array(exports.stateChangeDirectiveSchema);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFwxNjY2M1xcRGVza3RvcFxcdHVoZWdcXHBhY2thZ2VzXFxjb21tb24tYmFja2VuZFxcc3JjXFx0eXBlc1xcc3RhdGUtY2hhbmdlLWRpcmVjdGl2ZS5kdG8udHMiLCJtYXBwaW5ncyI6IjtBQUFBLDREQUE0RDs7O0FBRTVELDZCQUF1QjtBQUV2QixpQkFBaUI7QUFDakIsa0JBQWtCO0FBQ2xCLE1BQU0sc0JBQXNCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUN0QyxFQUFFLEVBQUUsT0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDN0MsS0FBSyxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUU7Q0FDbEIsQ0FBQyxDQUFBO0FBR0YsaUJBQWlCO0FBQ2pCLE1BQU0scUJBQXFCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUNyQyxFQUFFLEVBQUUsT0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDeEMsS0FBSyxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUU7Q0FDbEIsQ0FBQyxDQUFBO0FBR0YsaUJBQWlCO0FBQ2pCLG1CQUFtQjtBQUNuQixNQUFNLHFCQUFxQixHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDckMsRUFBRSxFQUFFLHNCQUFzQixDQUFDLFFBQVEsRUFBRTtJQUNyQyxFQUFFLEVBQUUsc0JBQXNCLENBQUMsUUFBUSxFQUFFO0lBQ3JDLE1BQU0sRUFBRSxxQkFBcUIsQ0FBQyxRQUFRLEVBQUU7Q0FDekMsQ0FBQyxDQUFBO0FBR0YscUJBQXFCO0FBQ3JCOzs7R0FHRztBQUNVLFFBQUEsMEJBQTBCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUNqRCxFQUFFLEVBQUUsT0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLGtCQUFrQixFQUFFLG1CQUFtQixDQUFDLENBQUM7SUFDckQsUUFBUSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUU7SUFDcEIsT0FBTyxFQUFFLE9BQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxxQkFBcUIsRUFBRSxPQUFDLENBQUMsTUFBTSxDQUFDLE9BQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxPQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0NBQ3pFLENBQUMsQ0FBQTtBQUdGOzs7R0FHRztBQUNVLFFBQUEsa0JBQWtCLEdBQUcsT0FBQyxDQUFDLEtBQUssQ0FBQyxrQ0FBMEIsQ0FBQyxDQUFBIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcMTY2NjNcXERlc2t0b3BcXHR1aGVnXFxwYWNrYWdlc1xcY29tbW9uLWJhY2tlbmRcXHNyY1xcdHlwZXNcXHN0YXRlLWNoYW5nZS1kaXJlY3RpdmUuZHRvLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIOaWh+S7tui3r+W+hDogbGlicy9jb21tb24vc3JjL3R5cGVzL3N0YXRlLWNoYW5nZS1kaXJlY3RpdmUuZHRvLnRzXG5cbmltcG9ydCB7IHogfSBmcm9tICd6b2QnXG5cbi8vIC0tLSDljp/lrZDmk43kvZzlrprkuYkgLS0tXG4vLyDlrprkuYnkuoblj6/ku6Xlr7nmlbDlgLzov5vooYznmoTljp/lrZDmk43kvZxcbmNvbnN0IG51bWVyaWNPcGVyYXRpb25TY2hlbWEgPSB6Lm9iamVjdCh7XG4gIG9wOiB6LmVudW0oWydzZXQnLCAnaW5jcmVtZW50JywgJ2RlY3JlbWVudCddKSxcbiAgdmFsdWU6IHoubnVtYmVyKCksXG59KVxuZXhwb3J0IHR5cGUgTnVtZXJpY09wZXJhdGlvbiA9IHouaW5mZXI8dHlwZW9mIG51bWVyaWNPcGVyYXRpb25TY2hlbWE+XG5cbi8vIOWumuS5ieS6huWPr+S7peWvueWtl+espuS4sui/m+ihjOeahOaTjeS9nFxuY29uc3Qgc3RyaW5nT3BlcmF0aW9uU2NoZW1hID0gei5vYmplY3Qoe1xuICBvcDogei5lbnVtKFsnc2V0JywgJ2FwcGVuZCcsICdwcmVwZW5kJ10pLFxuICB2YWx1ZTogei5zdHJpbmcoKSxcbn0pXG5leHBvcnQgdHlwZSBTdHJpbmdPcGVyYXRpb24gPSB6LmluZmVyPHR5cGVvZiBzdHJpbmdPcGVyYXRpb25TY2hlbWE+XG5cbi8vIC0tLSDlrp7kvZPmm7TmlrDmjIfku6QgLS0tXG4vLyDlrprkuYnkuobpkojlr7nkuIDkuKrop5LoibLnmoTlhbfkvZPmm7TmlrDmk43kvZxcbmNvbnN0IGNoYXJhY3RlclVwZGF0ZVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgaHA6IG51bWVyaWNPcGVyYXRpb25TY2hlbWEub3B0aW9uYWwoKSxcbiAgbXA6IG51bWVyaWNPcGVyYXRpb25TY2hlbWEub3B0aW9uYWwoKSxcbiAgc3RhdHVzOiBzdHJpbmdPcGVyYXRpb25TY2hlbWEub3B0aW9uYWwoKSxcbn0pXG5leHBvcnQgdHlwZSBDaGFyYWN0ZXJVcGRhdGUgPSB6LmluZmVyPHR5cGVvZiBjaGFyYWN0ZXJVcGRhdGVTY2hlbWE+XG5cbi8vIC0tLSDnirbmgIHlj5jmm7TmjIfku6TmoLjlv4PlrprkuYkgLS0tXG4vKipcbiAqIOWumuS5ieS6huS4gOadoeWNleeLrOeahOOAgeWujOaVtOeahOeKtuaAgeWPmOabtOaMh+S7pOOAglxuICog6L+Z5piv5oiR5Lus57O757uf5Lit4oCc56Gu5a6a5oCn5pON5L2c4oCd55qE5pyA5bCP5Y2V5YWD44CCXG4gKi9cbmV4cG9ydCBjb25zdCBzdGF0ZUNoYW5nZURpcmVjdGl2ZVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgb3A6IHouZW51bShbJ3VwZGF0ZV9jaGFyYWN0ZXInLCAndXBkYXRlX3dvcmxkX2Jvb2snXSksXG4gIHRhcmdldElkOiB6LnN0cmluZygpLFxuICBwYXlsb2FkOiB6LnVuaW9uKFtjaGFyYWN0ZXJVcGRhdGVTY2hlbWEsIHoucmVjb3JkKHouc3RyaW5nKCksIHouYW55KCkpXSksXG59KVxuZXhwb3J0IHR5cGUgU3RhdGVDaGFuZ2VEaXJlY3RpdmUgPSB6LmluZmVyPHR5cGVvZiBzdGF0ZUNoYW5nZURpcmVjdGl2ZVNjaGVtYT5cblxuLyoqXG4gKiDlrprkuYnkuobkuIDkuKrmjIfku6Tpm4bvvIzlroPmmK/kuIDkuKrmjIfku6TmlbDnu4TjgIJcbiAqIOKAnOmAu+i+kUFJ4oCd55qE5pyA57uI6L6T5Ye677yM5bCx5piv5LiA5Liq56ym5ZCI5q2kIFNjaGVtYSDnmoRKU09O5a+56LGh44CCXG4gKi9cbmV4cG9ydCBjb25zdCBkaXJlY3RpdmVTZXRTY2hlbWEgPSB6LmFycmF5KHN0YXRlQ2hhbmdlRGlyZWN0aXZlU2NoZW1hKVxuZXhwb3J0IHR5cGUgRGlyZWN0aXZlU2V0ID0gei5pbmZlcjx0eXBlb2YgZGlyZWN0aXZlU2V0U2NoZW1hPlxuIl0sInZlcnNpb24iOjN9